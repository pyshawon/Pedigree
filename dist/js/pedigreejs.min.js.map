{"version":3,"sources":["../../js/jquery.magicsearch.js","../../js/io.js","../../js/legend.js","../../js/pan_zoom.js","../../js/pedigree.js","../../js/pedigree_form.js","../../js/undo_redo_refresh.js","../../js/widgets.js"],"names":["_toConsumableArray","arr","Array","isArray","i","arr2","length","from","utils","$","undefined","messages","title","msg","onConfirm","opts","dataset","dialog","modal","width","buttons","Yes","this","No","text","click","validate_age_yob","age","yob","status","year","Date","getFullYear","sum","parseInt","Math","abs","window","jQuery","io","process_ped","ped","name","idx","level","pedigree_util","getIdxByName","update_parents_level","parents","pidx","mother","father","max_level","getDepth","top_level","noparents","getPartnerIdx","j","sex","anode","bnode","cancers","breast_cancer","breast_cancer2","ovarian_cancer","prostate_cancer","pancreatic_cancer","genetic_test","pathology_tests","add","change","e","load","save","print","get_printable_svg","svg_download","svgData","wrapper","appendTo","svg","querySelector","XMLSerializer","serializeToString","xml","canvas","document","createElement","svgSize","getBoundingClientRect","height","ctx","getContext","img","setAttribute","btoa","unescape","encodeURIComponent","onload","drawImage","imgsrc","toDataURL","a","href","download","target","body","appendChild","removeChild","setTimeout","remove","copy_svg_html","svg_html","html","myRegexp","match","exec","val","replace","RegExp","ptree","makeid","local_dataset","pedcache","current","tree_dimensions","get_tree_dimensions","svg_div","targetDiv","find","parent","wid","hgt","scale","xscale","yscale","parentClone","clone","map","selection","append","attr","ytransform","symbol_size","el","constructor","cssFiles","printWindow","open","headContent","css","write","close","focus","content","JSON","stringify","DEBUG","console","log","uriContent","f","files","reader","FileReader","result","startsWith","readBoadiceaV4","parse","err","readLinkage","validate_pedigree","err1","error","message","rebuild","err2","onerror","event","code","readAsText","value","boadicea_lines","famid","lines","trim","split","indi","display_name","affected","alleles","unshift","proband","mztwin","each","cancer","diagnosis_age","ashkenazi","warn","type","factory","define","amd","Zepto","KEY","doms","isString","formatParse","format","data","fields","_i","deletePx","index","lastIndexOf","Number","substring","transform2PositiveNum","key","isNumeric","ceil","MagicSearch","defaults","element","options","$element","dataSource","ajaxOptions","id","hidden","inputFormat","maxShow","isClear","showSelected","dropdownBtn","dropdownMaxItem","multiple","maxItem","showMultiSkin","multiStyle","multiField","focusShow","noResult","skin","disableRule","success","$input","afterDelete","prototype","init","_this","extend","props","isFirstGetDataSource","style","objDataSource","space","is","styles","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","maxWidth","sightHeight","ids","$wrapper","wrap","$magicsearch_wrapper","inputDisplay","display","float","margin","box-sizing","removeAttr","top","$hidden","$arrow","addClass","bottom","right","$loading","loadingTimeout","show","url","dataType","clearTimeout","initAfterAjax","ajax","isFunction","toLowerCase","parseJSON","push","_dataSource","_id","getDataSource","$items","left","idArr","hasSetId","join","appendHtml","destroy","padding-top","padding-right","padding-bottom","placeholder","removeClass","siblings","unwrap","off","String","_i2","setData","$magicsearch_box","$ishover","deleteData","that","delIdArr","delCallBack","fadeOut","splice","indexOf","maxLineItem","lineNum","searchData","isAll","isScroll","dataJson","inputVal","htmlStr","isAppendHtml","page","slice","num","inputVals","concat","Set","inputData","_i3","flag","_i4","includes","item","k","every","_inputVals","filter","tempArr","_i5","_j","dataHighlight","forEach","field","posArr","_i6","position","_i7","tmpPosArr","hasStarted","start","_i8","tmpItem","matchStr","substr","showSearchBox","callback","$magicsearch_arrow","slideDown","hideSearchBox","scrollTop","BOX_ANIMATE_TIME","slideUp","$item","margin-bottom","margin-right","line-height","fn","magicsearch","hasDropdownBtn","searchTimeout","preInput","jqo","$this","magicSearch","selfOptions","dropdown","hasClass","max-height","unbind","on","scrollHeight","$_this","which","$li","toggleClass","next","_$li","_$ishover","prev","_$ishover2","trigger","currentInput","$last_multi_item","tmpDataSource","originId","multi","override","hasBindBody","$target","first","get","v","legend","toggle","arrowButton","min-width","drag","addEventListener","dataTransfer","conditions","$legend_elem","color","hide","phenotypes","list_id","hasOwnProperty","addPhenotypesToLegend","candidate_genotype","addCandidateToLegend","causal_genotype","addCausalsToLegend","carrier_genotype","addCarriersToLegend","addConditionLegendToOpts","all_cancers","common_cancers","colour","showCancerLegends","prop","showHideCancerColors","showHideConditionColors","openEditDialog","alreadyAdded","condition_legend","array_values","condition_id","condition_legend_id","caseCount","getCaseCount","caseText","phenotype_legend","candidate_legend","causal_legend","carrier_legend","addCancersToLegend","newType","cancer_legend","cancerCount","count","deleteConditionsFromOpts","person","legend_type","target_div","otherPersonHasCondition","case_count","cancer_legend_id","copy_dataset","$nodeProperties","$node_properties","dialogWidth","autoOpen","dialogClass","selectedSetting","get_hierarchy_settings","isChecked","table","changeOccurred","prevDepth","d3","selectAll","d1","depth","save_hierarchy_settings","pedigree_form","update","hierarchy","switches","values","markAsCheked","select","property","empty","panZoom","getZoomValue","topPosition","config","zoom","zoomHandle","scaleLinear","domain","maxTop","minTop","range","zoomIn","zoomOut","getTopValue","zoomStep","panStep","minZoom","maxZoom","updatePedigreeDiagram","x","y","setposition","updateXYTransform","parseFloat","$viewControl","showPanZoomControl","isFullScreenMode","$zoomHandle","xytransform","getposition","draggable","axis","ui","max","min","xtransform","call","transform","zoomIdentity","translate","translateY","translateX","bRect","node","innerWidth","innerHeight","registerClickListenersForPan","topValue","topValueStr","registerClickListeners","updateParent","p","nodes","parent_node","dztwins","twins","getTwins","twin","getNodeByName","setChildrenId","children","sort","b","dztwin","buildTree","root","partnerLinks","getChildren","flatten","partners","child","m","contains_parent","merge","ptr","midx","fidx","gp","get_grandparents_idx","isProband","obj","setProband","is_proband","getProbandIndex","getSiblings","getAllSiblings","sibs","twin_type","getAdoptedSiblings","getAllChildren","getNodesAtDepth","fnodes","exclude_names","inArray","linkNodes","flattenNodes","links","ancestors","recurse","consanguity","node1","node2","ancestors1","ancestors2","names1","ancestor","names2","some","it","consanguineous_parents","flat","adjust_coords","xmid","overlap","descendants","diff","child1","child2","descendantsNames","descendant","xnew","nodesOverlap","n","urlParam","results","location","gmidx","gfidx","proband_attr","newdataset","syncTwins","proband_add_child","breastfeeding","newchild","addchild","exists","isChildNode","d","print_opts","prefixInObj","prefix","found","specialRegex","prefixInCondition","condition","include_children","connected","combineArrays","get_partners","child_idx","arr1","get_svg_dimensions","pbuttons","is_fullscreen","ptrs","addLabel","size","fx","fy","ftext","class_label","labels","font_family","font_size","font_weight","getUniqueTwinID","mz","adjacent_nodes","excludes","lhs_node","rhs_node","dnodes","roots","build","diseases","background","node_background","validate","nstore","updateButtons","top_level_seen","group_top_level","disease","Object","keys","test","newKey","svg_dimensions","initialZoom","hidden_root","tree","separation","treemap","create_err","ptrLinkNodes","clash","check_ptr_link_clashes","check_ptr_links","enter","symbol","symbolTriangle","symbolCircle","symbolSquare","exclude","hierarchy_settings","ncancers","carrier_status","pie","arc","innerRadius","outerRadius","adopted_in","adopted_out","get_bracket","dx","dy","indent","offset","INSIDE_OFFSET","ICON_SIZE","offsetY","cx","cy","r","appendDonorCircles","individual_role","emVal","adiv","getPx","ilab","label","y_offset","vars","ivar","gestation","uniqueId","dob","dage","cause_of_death","ethnicity","country_of_origin","data_value","dis","phenotype","candidate","causal","carrier","addAliveAndWellLabelAndStillBirth","market_by_tick","addMarketBy","market_by_text","x1","y1","x2","y2","g","heredity","addHeredityDetails","addCarrierStatus","widgets","addWidgets","clash_depth","insert","divorced","dy1","path","parent_nodes","parent_node_name","ii","dy2","draw_path","cshift","l","dx1","dx2","divorce_path","source","dash_len","dash_array","usedlen","twinx","xmin","xmax","t","thisx","ymid","xhbar","xx","yy","circleNodes","openNodeLinkDialog","probandIdx","probandNode","scaleExtent","zf","pos","selectedName","drop","allowDrop","preventDefault","conditionName","Error","uniquenames","unconnected","nconnect","has_parent","names","maxscore","generation","score","max_depth","templates","disallowed","nchild","abortion","ptr_name","partner","addsibling","c","twin_id","newchildren","add_lhs","newbie","d2","setMzTwin","addparents","flat_tree","tree_node","pid","node_mother","node_father","node_sibs","rid","lid","sid","orphans","nid","oid","oidx","ptr_node","addpartner","delete_node_dataset","onDone","deletes","d3node","ps","children_names","adj","del","twin_types","checkTwins","newopts","len","possible","charAt","floor","random","update_cancer_by_sex","ovarian_cancer_diagnosis_age","closest","prostate_cancer_diagnosis_age","round5","round","mutation_frequencies","mfreq","gene","nodeclick","approx_diagnosis_age","update_diagnosis_age_widget","valid","saveTabbedForm","formOptions","newName","full_name","conceived_by_donor_egg","conceived_by_donor_sperm","action","ethnicityIds","countryOfOrigin","countryOfOriginIds","ageOnset","diagnosisStatus","diagnosisDiagnosed","diagnosisType","diagnosisNotes","conditionToDelete","selected_phenotypes","phenotype_id","selected_candidate_genotype","candidate_id","selected_causal_genotype","causal_id","selected_carrier_genotype","carrier_id","clinical_comments","gestationContainer","marketSelectedId","currentSelected","checked","iswitch","s","tres","save_common_cancers","cancerValue","ageOfDiagnosis","is_age_change","remove_cancers","ageChange","cancerAge","remove_phenotypes","remove_candidate","remove_causal","remove_carrier","btn_target","btns","fa","$btn_target","lis","removeDialogs","mozFullScreen","webkitFullScreen","mozCancelFullScreen","webkitCancelFullScreen","mozRequestFullScreen","webkitRequestFullScreen","Element","ALLOW_KEYBOARD_INPUT","stopPropagation","previous","reset","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","clear","selected","get_count","max_limit","dict_cache","has_browser_storage","store_type","localStorage","setItem","removeItem","get_prefix","get_arr","get_browser_store","getItem","sessionStorage","set_browser_store","set_count","last","clear_browser_store","dragging","last_mouseover","setLineDragPosition","getConditionId","conditionKey","getGenesId","genesName","genes","popup_selection","square","square_title","circle","circle_title","unspecified","add_person","classed","datum","highlight","sourceEvent","drag_handle","delete","font-weight","fill","font-family","widget","parentNode","opt","edit","ctrlKey","currentNode_tabs","$targetDiv","$node_tabs","tabHeader","breast_cancer_age","ovarian_cancer_age","colon_cancer","colon_cancer_age","prostate_cancer_age","pancreatic_cancer_age","melanoma_cancer","melanoma_cancer_age","kidney_cancer","kidney_cancer_age","gastric_cancer","gastric_cancer_age","lung_cancer","lung_cancer_age","brain_cancer","brain_cancer_age","oesophagus_cancer","oesophagus_cancer_age","thyroid_cancer","thyroid_cancer_age","liver_cancer","liver_cancer_age","cervix_cancer","cervix_cancer_age","myeloma_cancer","myeloma_cancer_age","leukemia_cancer","leukemia_cancer_age","pageX","tabs","create","my","at","of","datepicker","candidate_genotypes","causal_genotypes","carrier_genotypes","genesAppender","geneId","geneName","geneType","close_cls","gene_inp","conditionForm","cancersView","cancer_id","cancer_name","ageValue","cancer_close","autocomplete","response","gap","phenotypeId","phenoName","phenoType","phenotypeElement","phenotypeAlreadyThere","hasFocus","_renderItem","ul","candidateId","candidateName","candidateType","candidateElement","candidateAlreadyThere","casualId","casualName","casualType","casualElement","casualAlreadyThere","carrierId","carrierName","carrierType","carrierElement","carrierAlreadyThere","_trigger","node_name","availableConditions","conditionId","cancerId","cancerElement","cancerAlreadyThere","selected_cancers","condition_window","condition_form","ph_count","gn_count","ca_count","keyCode","openTabbedDialog","mouse","$node_link","motherName","fatherName","pageY"],"mappings":"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","file":"pedigreejs.min.js","sourcesContent":["'use strict';\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\n/*!\n * MagicSearch - An input plugin based on jquery\n *\n * Copyright (c) 2016 dingyi1993\n *\n * Version: 1.0.2\n *\n * Licensed under the MIT license:\n *   http://www.opensource.org/licenses/MIT\n *\n * project link:\n *   https://github.com/dingyi1993/jquery-magicsearch\n *\n * home page link:\n *   https://www.dingyi1993.com/blog/magicsearch\n */\n\n;(function (factory) {\n    'use strict';\n\n    if (typeof define === 'function' && define.amd) {\n        // using AMD; register as anon module\n        define(['jquery'], factory);\n    } else {\n        // no AMD; invoke directly\n        factory(typeof jQuery != 'undefined' ? jQuery : window.Zepto);\n    }\n})(function ($) {\n    'use strict';\n\n    var\n    //separator of format\n    SEPARATOR = '%',\n\n\n    //default multi style,unit px\n    DEFAULT_ITEM_WIDTH = 57,\n        DEFAULT_ITEM_SPACE = 3,\n\n\n    //default max width when multiple,unit px\n    DEFAULT_INPUT_MAX_WIDTH = 500,\n\n\n    //max loaded item at a time when show all(min:dropdownMaxItem + 1)\n    ALL_DROPDOWN_NUM = 100,\n\n\n    //default search box animate duration,unit ms\n    BOX_ANIMATE_TIME = 200,\n\n\n    //default search delay,unit ms\n    SEARCH_DELAY = 200,\n\n\n    //default dropdown button width,unit px\n    DROPDOWN_WIDTH = 24,\n\n\n    //key code\n    KEY = {\n        BACKSPACE: 8,\n        ENTER: 13,\n        ESC: 27,\n        SPACE: 32,\n        LEFT: 37,\n        UP: 38,\n        RIGHT: 39,\n        DOWN: 40\n    },\n\n\n    //cache doms string\n    doms = {\n        wrapper: 'magicsearch-wrapper',\n        box: 'magicsearch-box',\n        arrow: 'magicsearch-arrow',\n        loading: 'magicsearch-loading',\n        hidden: 'magicsearch-hidden',\n        items: 'multi-items',\n        item: 'multi-item',\n        close: 'multi-item-close'\n    },\n        isString = function isString(value) {\n        return $.type(value) === 'string';\n    },\n\n\n    //transform string which like this : %username%\n    formatParse = function formatParse(format, data) {\n        var fields = format.match(new RegExp('\\\\' + SEPARATOR + '[^\\\\' + SEPARATOR + ']+\\\\' + SEPARATOR, 'g'));\n        if (!fields) {\n            return format;\n        }\n        for (var i = 0; i < fields.length; i++) {\n            fields[i] = fields[i].replace(new RegExp('\\\\' + SEPARATOR, 'g'), '');\n        }\n        for (var _i = 0; _i < fields.length; _i++) {\n            format = format.replace(SEPARATOR + fields[_i] + SEPARATOR, data[fields[_i]] ? data[fields[_i]] : 'error');\n        }\n        return format;\n    },\n\n    //delete px at ending\n    deletePx = function deletePx(value) {\n        var index = value.lastIndexOf('px');\n        return index < 0 ? Number(value) : Number(value.substring(0, index));\n    },\n\n    //transform to positive num\n    transform2PositiveNum = function transform2PositiveNum(value, key) {\n        if (!$.isNumeric(value)) {\n            value = MagicSearch.defaults[key];\n        } else {\n            value = Math.ceil(Number(value));\n            if (value <= 0) {\n                value = MagicSearch.defaults[key];\n            }\n        }\n        return value;\n    },\n\n    //constructor\n    MagicSearch = function MagicSearch(element, options) {\n        this.element = element;\n        this.$element = $(element);\n        this.options = options;\n    };\n\n    MagicSearch.defaults = {\n        dataSource: [], //array or string or function\n        type: '', //string\n        ajaxOptions: {}, //object\n        id: '', //string\n        hidden: false, //boolean\n        fields: '', //string or array\n        format: '', //string(function?)\n        inputFormat: '', //string\n        maxShow: 5, //int\n        isClear: true, //boolean\n        showSelected: true, //boolean\n        dropdownBtn: false, //boolean\n        dropdownMaxItem: 8, //int\n        multiple: false, //boolean\n        maxItem: true, //boolean or int\n        showMultiSkin: true, //boolean\n        multiStyle: {}, //object\n        multiField: '', //string\n        focusShow: false, //boolean\n        noResult: '', //string\n        skin: '', //string\n        disableRule: function disableRule(data) {\n            return false;\n        },\n        success: function success($input, data) {\n            return true;\n        },\n        afterDelete: function afterDelete($input, data) {\n            return true;\n        }\n    };\n\n    MagicSearch.prototype = {\n        init: function init() {\n            var _this = this;\n\n            //to ensure unique,plus one at init everytime\n            window.MagicSearch.index += 1;\n\n            //you must do those things before ajax\n            var $input = this.$element;\n            this.options = $.extend({}, MagicSearch.defaults, this.options);\n\n            this.props = {\n                isFirstGetDataSource: true,\n                style: $.extend({}, this.element.style),\n                objDataSource: {},\n                multiStyle: {\n                    space: DEFAULT_ITEM_SPACE,\n                    width: DEFAULT_ITEM_WIDTH\n                }\n            };\n\n            //can bind on input text only\n            if (!this.$element.is('input:text')) {\n                console.error('magicsearch: Can not bind magicsearch to other elements except input which type is text.');\n                return false;\n            }\n\n            if (!isString(this.options.id) || this.options.id === '') {\n                console.error('magicsearch: The option id must be a string which is not empty.');\n                return false;\n            }\n\n            if (this.options.multiple) {\n                this.options.isClear = true;\n            } else if (!this.options.isClear) {\n                this.options.hidden = false;\n            }\n\n            this.props.styles = {\n                borderTopWidth: deletePx($input.css('border-top-width')),\n                borderRightWidth: deletePx($input.css('border-right-width')),\n                borderBottomWidth: deletePx($input.css('border-bottom-width')),\n                borderLeftWidth: deletePx($input.css('border-left-width')),\n                paddingTop: deletePx($input.css('padding-top')),\n                paddingRight: deletePx($input.css('padding-right')),\n                paddingBottom: deletePx($input.css('padding-bottom')),\n                paddingLeft: deletePx($input.css('padding-left')),\n                maxWidth: deletePx($input.css('max-width')) || DEFAULT_INPUT_MAX_WIDTH\n            };\n            this.props.styles.height = $input.height() + this.props.styles.borderTopWidth + this.props.styles.borderBottomWidth + this.props.styles.paddingTop + this.props.styles.paddingBottom;\n            this.props.styles.sightHeight = this.props.styles.height - this.props.styles.borderTopWidth - this.props.styles.borderBottomWidth;\n            this.props.styles.width = $input.width() + this.props.styles.borderLeftWidth + this.props.styles.borderRightWidth + this.props.styles.paddingLeft + this.props.styles.paddingRight;\n\n            var styles = this.props.styles;\n            var ids = $input.attr('data-id');\n            if ($input.parent().attr('data-belong') !== 'magicsearch') {\n                var $wrapper = $('<div class=\"' + (doms.wrapper + (this.options.skin ? ' ' + this.options.skin : '')) + '\" data-belong=\"magicsearch\"></div>');\n                $wrapper.css('width', styles.width);\n                $input.wrap($wrapper);\n            }\n            var $magicsearch_wrapper = $input.parent();\n            var inputDisplay = $input.css('display');\n            //init magicsearch wrapper\n            $magicsearch_wrapper.css({\n                // if input's display is inline,regard as inline-block\n                'display': inputDisplay === 'inline' ? 'inline-block' : inputDisplay,\n                'float': $input.css('float'),\n                'margin': $input.css('margin')\n            });\n            $magicsearch_wrapper.attr('data-index', window.MagicSearch.index);\n\n            //init input\n            $input.css({\n                'margin': 0,\n                'box-sizing': 'border-box',\n                'width': styles.width,\n                'height': styles.height\n            });\n            if ($input.attr('placeholder')) {\n                $input.attr('data-placeholder', $input.attr('placeholder'));\n            }\n            $input.removeAttr('disabled');\n            if (this.options.isClear) {\n                $input.val('');\n            }\n            if (ids === undefined) {\n                $input.attr('data-id', '');\n                ids = '';\n            }\n\n            //init magicsearch box\n            if ($magicsearch_wrapper.find('.' + doms.box).length === 0) {\n                $magicsearch_wrapper.append('<div class=\"' + doms.box + '\"></div>');\n            }\n            $magicsearch_wrapper.find('.' + doms.box).css({\n                'top': styles.height\n            });\n\n            //init hidden\n            if (this.options.hidden) {\n                var name = $input.attr('name');\n                var $hidden = $('<input class=\"' + doms.hidden + '\" type=\"hidden\" value=\"' + ids + '\">');\n                if (name) {\n                    $hidden.attr('name', name);\n                    $input.removeAttr('name');\n                }\n                $magicsearch_wrapper.append($hidden);\n            }\n\n            //init magicsearch arrow\n            if (this.options.dropdownBtn) {\n                var $arrow = $('<div class=\"' + doms.arrow + '\"><i></i></div>');\n                $input.addClass('dropdown');\n                $input.css('padding-right', styles.paddingRight + DROPDOWN_WIDTH);\n                $arrow.css({\n                    'top': styles.borderTopWidth,\n                    'bottom': styles.borderBottomWidth,\n                    'right': styles.borderRightWidth\n                });\n                $magicsearch_wrapper.append($arrow);\n            }\n\n            if (this.options.type == 'ajax') {\n                var $loading = $('<div class=\"' + doms.loading + '\"><div></div></div>');\n                $magicsearch_wrapper.append($loading);\n\n                var loadingTimeout = setTimeout(function () {\n                    $magicsearch_wrapper.find('.' + doms.loading).find('div').show();\n                }, 500);\n\n                var ajaxOptions = {\n                    type: 'GET',\n                    url: this.options.dataSource,\n                    dataType: 'json',\n                    error: function error() {\n                        console.error('magicsearch: Error with xhr.Index: ' + window.MagicSearch.index);\n                    },\n                    success: function success(data) {}\n                };\n                ajaxOptions = $.extend({}, ajaxOptions, this.options.ajaxOptions);\n                var success = ajaxOptions.success;\n                ajaxOptions.success = function (data) {\n                    clearTimeout(loadingTimeout);\n                    _this.options.dataSource = data;\n                    $magicsearch_wrapper.find('.' + doms.loading).remove();\n                    _this.initAfterAjax();\n                    success(data);\n                };\n\n                $.ajax(ajaxOptions);\n            } else {\n                this.initAfterAjax();\n            }\n            return this;\n        },\n        initAfterAjax: function initAfterAjax() {\n            var $input = this.$element;\n            var $magicsearch_wrapper = $input.parent();\n            var styles = this.props.styles;\n            var ids = $input.attr('data-id');\n            if ($.isFunction(this.options.dataSource)) {\n                this.options.dataSource = this.options.dataSource(this.$element);\n            }\n            if (!this.options.dataSource) {\n                this.options.dataSource = [];\n            } else if (isString(this.options.dataSource)) {\n                if (this.options.dataSource.toLowerCase() == 'null') {\n                    this.options.dataSource = [];\n                } else {\n                    try {\n                        this.options.dataSource = $.parseJSON(this.options.dataSource);\n                        if (!$.isArray(this.options.dataSource)) {\n                            var dataSource = [];\n                            for (var id in this.options.dataSource) {\n                                dataSource.push(this.options.dataSource[id]);\n                            }\n                            this.options.dataSource = dataSource;\n                        }\n                    } catch (err) {\n                        this.options.dataSource = [];\n                        console.error('magicsearch: A problem is occured during parsing dataSource,please check.Index: ' + window.MagicSearch.index);\n                        return false;\n                    }\n                }\n            } else if (!$.isArray(this.options.dataSource)) {\n                var _dataSource = [];\n                for (var _id in this.options.dataSource) {\n                    _dataSource.push(this.options.dataSource[_id]);\n                }\n                this.options.dataSource = _dataSource;\n            }\n            if (isString(this.options.fields)) {\n                this.options.fields = [this.options.fields === '' ? this.options.id : this.options.fields];\n            } else if (!$.isArray(this.options.fields)) {\n                this.options.fields = [this.options.id];\n            }\n            if (!isString(this.options.format) || this.options.format === '') {\n                this.options.format = SEPARATOR + this.options.id + SEPARATOR;\n            }\n            this.options.maxShow = transform2PositiveNum(this.options.maxShow, 'maxShow');\n            if (this.options.dropdownBtn) {\n                this.options.dropdownMaxItem = transform2PositiveNum(this.options.dropdownMaxItem, 'dropdownMaxItem');\n            }\n            if (this.options.multiple) {\n                if (this.options.maxItem !== true) {\n                    this.options.maxItem = transform2PositiveNum(this.options.maxItem, 'maxItem');\n                }\n                if (this.options.showMultiSkin) {\n                    if (!isString(this.options.multiField) || this.options.multiField === '') {\n                        this.options.multiField = this.options.id;\n                    }\n                }\n                if (this.options.multiStyle) {\n                    this.props.multiStyle.space = this.options.multiStyle.space ? this.options.multiStyle.space : DEFAULT_ITEM_SPACE;\n                    this.props.multiStyle.width = this.options.multiStyle.width ? this.options.multiStyle.width : DEFAULT_ITEM_WIDTH;\n                }\n            }\n            if (!$.isFunction(this.options.success)) {\n                this.options.success = function ($input, data) {\n                    return true;\n                };\n            }\n            if (!$.isFunction(this.options.disableRule)) {\n                this.options.disableRule = function (data) {\n                    return false;\n                };\n            }\n            if (ids !== '') {\n                this.getDataSource();\n            }\n            //init multi items\n            if (this.options.multiple) {\n                $input.addClass('multi');\n                if (this.options.showMultiSkin && $magicsearch_wrapper.find('.' + doms.items).length === 0) {\n                    var $items = $('<div class=\"' + doms.items + '\"></div>');\n                    $items.css({\n                        'top': this.props.multiStyle.space + styles.borderTopWidth,\n                        'left': this.props.multiStyle.space + styles.borderLeftWidth,\n                        'bottom': this.props.multiStyle.space + styles.borderBottomWidth,\n                        'right': this.props.multiStyle.space + styles.borderRightWidth + (this.options.dropdownBtn ? DROPDOWN_WIDTH : 0)\n                    });\n                    $magicsearch_wrapper.append($items);\n                }\n            }\n\n            if (this.options.multiple) {\n                var idArr = ids ? ids.split(',') : [];\n\n                if (this.options.maxItem !== true && idArr.length >= this.options.maxItem) {\n                    $input.attr('disabled', 'disabled');\n                    $magicsearch_wrapper.addClass('disabled');\n                }\n\n                //init default style\n                if (this.options.showMultiSkin) {\n                    var hasSetId = [];\n                    for (var i = 0; i < idArr.length; i++) {\n                        hasSetId.push(idArr[i]);\n                        $input.attr('data-id', hasSetId.join(','));\n                        if (this.options.hidden) {\n                            $magicsearch_wrapper.find('.' + doms.hidden).val(hasSetId.join(','));\n                        }\n                        this.appendHtml(this.props.objDataSource[idArr[i]]);\n                    }\n                }\n            } else {\n                if (ids !== '') {\n                    var data = this.props.objDataSource[ids];\n                    var format = this.options.inputFormat ? this.options.inputFormat : this.options.format;\n                    $input.val(formatParse(format, data));\n                }\n            }\n        },\n        destroy: function destroy() {\n            var $input = this.$element,\n                $magicsearch_wrapper = $input.parent();\n            if ($magicsearch_wrapper.attr('data-belong') === 'magicsearch') {\n                this.element.style = this.props.style;\n                $input.css({\n                    'margin': $magicsearch_wrapper.css('margin'),\n                    'padding-top': this.props.styles.paddingTop,\n                    'padding-right': this.props.styles.paddingRight,\n                    'padding-bottom': this.props.styles.paddingBottom,\n                    //'padding-left': this.props.styles.paddingLeft,\n                    'height': this.props.styles.height,\n                    'width': this.props.styles.width\n                });\n                var placeholder = $input.attr('data-placeholder');\n                if (placeholder !== undefined) {\n                    $input.attr('placeholder', placeholder);\n                    $input.removeAttr('data-placeholder');\n                }\n                $input.removeClass('dropdown multi').removeAttr('disabled data-id');\n                $input.siblings().remove();\n                $input.unwrap();\n                $input.off();\n                $input.val('');\n            }\n        },\n        getDataSource: function getDataSource() {\n            var dataSource = this.options.dataSource;\n            if (this.props.isFirstGetDataSource) {\n                var objDataSource = {};\n                for (var i = 0; i < dataSource.length; i++) {\n                    for (var key in dataSource[i]) {\n                        this.options.dataSource[i][key] = String(dataSource[i][key]);\n                    }\n                }\n                this.props.isFirstGetDataSource = false;\n                for (var _i2 = 0; _i2 < dataSource.length; _i2++) {\n                    objDataSource[dataSource[_i2][this.options.id]] = dataSource[_i2];\n                }\n                this.props.objDataSource = objDataSource;\n            }\n            return this.options.dataSource;\n        },\n        setData: function setData() {\n            var $input = this.$element,\n                $magicsearch_wrapper = $input.parent(),\n                $magicsearch_box = $magicsearch_wrapper.find('.' + doms.box),\n                $magicsearch_arrow = $magicsearch_wrapper.find('.' + doms.arrow),\n                $ishover = $magicsearch_box.find('li.ishover');\n            var options = this.options,\n                ids = $input.attr('data-id'),\n                data = this.props.objDataSource[$ishover.attr('data-id')];\n            if (options.multiple) {\n                if ($magicsearch_box.is(':hidden')) {\n                    return;\n                }\n                $input.val('');\n\n                var idArr = ids ? ids.split(',') : [];\n                if (options.maxItem !== true && idArr.length >= options.maxItem) {\n                    return this;\n                }\n                idArr.push($ishover.attr('data-id'));\n                if (options.maxItem !== true && idArr.length == options.maxItem) {\n                    $input.attr('disabled', 'disabled');\n                    $magicsearch_wrapper.addClass('disabled');\n                }\n                $input.attr('data-id', idArr.join(','));\n                if (options.hidden) {\n                    $magicsearch_wrapper.find('.' + doms.hidden).val(idArr.join(','));\n                }\n                if (options.showMultiSkin) {\n                    this.appendHtml(data);\n                }\n            } else {\n                $input.val(options.inputFormat ? formatParse(options.inputFormat, data) : $ishover.text());\n                $input.attr('data-id', $ishover.attr('data-id'));\n                if (options.hidden) {\n                    $magicsearch_wrapper.find('.' + doms.hidden).val($ishover.attr('data-id'));\n                }\n            }\n            options.success($input, data);\n            return this;\n        },\n        deleteData: function deleteData(id) {\n            var $input = this.$element,\n                $magicsearch_wrapper = $input.parent(),\n                $magicsearch_box = $magicsearch_wrapper.find('.' + doms.box),\n                $magicsearch_arrow = $magicsearch_wrapper.find('.' + doms.arrow);\n            var that = this,\n                delIdArr = id ? id.split(',') : [],\n                ids = $input.attr('data-id'),\n                idArr = ids ? ids.split(',') : [],\n                options = this.options,\n                styles = this.props.styles;\n\n            if (!options.multiple) {\n                id = $input.attr('data-id');\n                $input.val('').attr('data-id', '');\n                if (options.hidden) {\n                    $magicsearch_wrapper.find('.' + doms.hidden).val('');\n                }\n                options.afterDelete($input, that.props.objDataSource[id]);\n                return this;\n            }\n\n            var delCallBack = function delCallBack() {\n                $(this).remove();\n            };\n\n            for (var i = 0; i < delIdArr.length; i++) {\n                $magicsearch_wrapper.find('.' + doms.item + '[data-id=\"' + delIdArr[i] + '\"]').fadeOut(400, delCallBack);\n                idArr.splice(idArr.indexOf(delIdArr[i]), 1);\n            }\n            setTimeout(function () {\n                var maxLineItem = parseInt((styles.maxWidth - (options.dropdownBtn ? DROPDOWN_WIDTH : 0) - styles.borderLeftWidth - styles.borderRightWidth - that.props.multiStyle.space) / (that.props.multiStyle.width + that.props.multiStyle.space));\n                var lineNum = parseInt(idArr.length / maxLineItem);\n                $input.attr('data-id', idArr.join(','));\n                if (options.hidden) {\n                    $magicsearch_wrapper.find('.' + doms.hidden).val(idArr.join(','));\n                }\n                $magicsearch_wrapper.removeClass('disabled');\n                $input.removeAttr('disabled');\n                if (options.showMultiSkin) {\n                    if (idArr.length === 0 && $input.attr('data-placeholder')) {\n                        $input.attr('placeholder', $input.attr('data-placeholder'));\n                    }\n                    //$input.css('padding-left', idArr.length % maxLineItem * (that.props.multiStyle.width + that.props.multiStyle.space) + styles.paddingLeft);\n                    $input.css('height', styles.height + lineNum * styles.sightHeight);\n                    $input.css('padding-top', lineNum * styles.sightHeight + styles.paddingTop);\n                    $magicsearch_box.css('top', styles.height + lineNum * styles.sightHeight);\n                    if (lineNum === 0) {\n                        var minWidth = (idArr.length % maxLineItem + 1) * (that.props.multiStyle.width + that.props.multiStyle.space) + that.props.multiStyle.space * 2 + styles.borderLeftWidth + styles.borderRightWidth + (options.dropdownBtn ? DROPDOWN_WIDTH : 0);\n                        //$input.css('min-width', minWidth);\n                        //$magicsearch_wrapper.css('min-width', minWidth);\n                    }\n                }\n                if (delIdArr.length == 1) {\n                    options.afterDelete($input, that.props.objDataSource[delIdArr[0]]);\n                }\n            }, 400);\n            return this;\n        },\n        searchData: function searchData(isAll, isScroll) {\n            var $input = this.$element,\n                $magicsearch_box = $input.parent().find('.' + doms.box);\n\n            var options = this.options,\n                dataJson = this.getDataSource(),\n                ids = $input.attr('data-id'),\n                idArr = ids ? ids.split(',') : [],\n                inputVal = $.trim($input.val()),\n                htmlStr = '',\n                data = [],\n                isAppendHtml = true;\n\n            //if is not scroll,clean all items first\n            if (isScroll !== true) {\n                $magicsearch_box.html('');\n            }\n            if (inputVal === '' && !isAll) {\n                return this;\n            }\n            //get the match data\n            if (isAll) {\n                var page = $input.data('page') || 1;\n                data = dataJson.slice(0);\n                //skip selected data\n                if (!options.showSelected) {\n                    for (var i = 0, num = 0; i < data.length; i++) {\n                        var index = idArr.indexOf(data[i][options.id]);\n                        if (index > -1) {\n                            data.splice(i, 1);\n                            num++;\n                            i--;\n                            if (num == idArr.length) {\n                                break;\n                            }\n                        }\n                    }\n                }\n                //if page less than total page,page plus one\n                if (page <= Math.ceil(data.length / ALL_DROPDOWN_NUM)) {\n                    $input.data('page', page + 1);\n                }\n                data = data.slice((page - 1) * ALL_DROPDOWN_NUM, page * ALL_DROPDOWN_NUM);\n                //will not appending html if data's length is zero when scrolling\n                if (page != 1 && data.length === 0) {\n                    isAppendHtml = false;\n                }\n            } else {\n                var inputVals = [].concat(_toConsumableArray(new Set(inputVal.toLowerCase().split(' '))));\n                var inputData = [];\n                for (var _i3 = 0; _i3 < inputVals.length; _i3++) {\n                    if (inputVals[_i3] === '') {\n                        continue;\n                    }\n                    inputData.push({ value: inputVals[_i3], flag: false });\n                }\n                //search match data\n                for (var _i4 = 0; _i4 < dataJson.length; _i4++) {\n                    //skip selected\n                    if (!options.showSelected) {\n                        if (idArr.includes(dataJson[_i4][options.id])) {\n                            continue;\n                        }\n                    }\n                    inputData = inputData.map(function (item) {\n                        item.flag = false;\n                        return item;\n                    });\n                    for (var j = 0; j < options.fields.length; j++) {\n                        for (var k = 0; k < inputData.length; k++) {\n                            if (dataJson[_i4][options.fields[j]] !== null && dataJson[_i4][options.fields[j]].toLowerCase().includes(inputData[k].value)) {\n                                inputData[k].flag = true;\n                            }\n                        }\n                        var isMatch = inputData.every(function (item) {\n                            return item.flag;\n                        });\n                        if (isMatch) {\n                            data.push(dataJson[_i4]);\n                            break;\n                        }\n                    }\n                    if (data.length >= options.maxShow) {\n                        break;\n                    }\n                }\n            }\n\n            //generate html string\n            if (data.length === 0) {\n                var noResult = options.noResult ? options.noResult : '&#x672a;&#x641c;&#x7d22;&#x5230;&#x7ed3;&#x679c;';\n                htmlStr = '<span class=\"no-result\">' + noResult + '</span>';\n            } else {\n                //delete empty input\n                var _inputVals = [].concat(_toConsumableArray(new Set(inputVal.split(' ')))).filter(function (item) {\n                    return item !== '';\n                });\n                var tempArr = [];\n                for (var _i5 = 0; _i5 < _inputVals.length - 1; _i5++) {\n                    for (var _j = _i5 + 1; _j < _inputVals.length; _j++) {\n                        tempArr.push(_inputVals[_i5] + ' ' + _inputVals[_j]);\n                    }\n                }\n                _inputVals = _inputVals.concat(tempArr);\n                //locate highlight chars\n                var dataHighlight = void 0;\n                if (!isAll) {\n                    dataHighlight = $.extend(true, [], data);\n                    data.forEach(function (item, index) {\n                        options.fields.forEach(function (field) {\n                            var posArr = [];\n                            if (item[field] !== null) {\n                                for (var _i6 = 0; _i6 < item[field].length; _i6++) {\n                                    posArr[_i6] = 0;\n                                }\n                                _inputVals.forEach(function (value) {\n                                    var position = item[field].toLowerCase().indexOf(value.toLowerCase());\n                                    if (position > -1) {\n                                        for (var _i7 = position; _i7 < value.length + position; _i7++) {\n                                            posArr[_i7] = 1;\n                                        }\n                                    }\n                                });\n                            }\n                            var tmpPosArr = [];\n                            var hasStarted = false,\n                                start = -1,\n                                length = 0;\n                            for (var _i8 = posArr.length - 1; _i8 >= 0; _i8--) {\n                                if (posArr[_i8] == 1) {\n                                    if (!hasStarted) {\n                                        hasStarted = true;\n                                        start = _i8;\n                                    } else {\n                                        start--;\n                                    }\n                                    length++;\n                                    if (_i8 === 0) {\n                                        tmpPosArr.push({ start: start, length: length });\n                                    }\n                                } else {\n                                    if (hasStarted) {\n                                        hasStarted = false;\n                                        tmpPosArr.push({ start: start, length: length });\n                                        length = 0;\n                                    }\n                                }\n                            }\n                            if (dataHighlight[index][field] !== undefined) {\n                                dataHighlight[index][field] = tmpPosArr;\n                            }\n                        });\n                    });\n                }\n\n                htmlStr += '<ul>';\n                data.forEach(function (item, index) {\n                    var tmpItem = $.extend({}, item);\n                    htmlStr += '<li class=\"';\n                    htmlStr += options.disableRule(item) ? 'disabled' : 'enabled';\n                    if (options.showSelected) {\n                        htmlStr += idArr.includes(item[options.id]) ? ' selected' : '';\n                    }\n                    htmlStr += '\" data-id=\"' + (item[options.id] === undefined ? '' : item[options.id]) + '\"';\n                    if (!isAll) {\n                        options.fields.forEach(function (field) {\n                            if (item[field] !== null) {\n                                dataHighlight[index][field].forEach(function (value) {\n                                    var matchStr = tmpItem[field].substr(value.start, value.length);\n                                    tmpItem[field] = tmpItem[field].replace(new RegExp(matchStr, 'i'), '<span class=\"keyword\">' + matchStr + '</span>');\n                                });\n                            }\n                        });\n                    }\n                    htmlStr += ' title=\"' + formatParse(options.format, item) + '\">' + formatParse(options.format, tmpItem) + '</li>';\n                });\n                htmlStr += '</ul>';\n            }\n\n            //create dom\n            if (isAll) {\n                if (isAppendHtml) {\n                    $magicsearch_box.html($magicsearch_box.html() + htmlStr);\n                }\n                $magicsearch_box.addClass('all');\n            } else {\n                $magicsearch_box.html(htmlStr);\n                $magicsearch_box.removeClass('all').css('max-height', 'none');\n            }\n            return this;\n        },\n        showSearchBox: function showSearchBox(callback) {\n            var $input = this.$element,\n                $magicsearch_wrapper = $input.parent(),\n                $magicsearch_box = $magicsearch_wrapper.find('.' + doms.box);\n            if ($magicsearch_box.is(':visible')) {\n                return false;\n            }\n            //rotate the dropdown button 180deg\n            if (this.options.dropdownBtn) {\n                var $magicsearch_arrow = $magicsearch_wrapper.find('.' + doms.arrow);\n                $magicsearch_arrow.removeClass('arrow-rotate-360');\n                $magicsearch_arrow.addClass('arrow-rotate-180');\n            }\n            $magicsearch_box.slideDown(BOX_ANIMATE_TIME, callback);\n            return this;\n        },\n        hideSearchBox: function hideSearchBox(isClear) {\n            var $input = this.$element,\n                $magicsearch_wrapper = $input.parent(),\n                $magicsearch_box = $magicsearch_wrapper.find('.' + doms.box);\n            if (!$magicsearch_box.is(':visible')) {\n                return false;\n            }\n            if (isClear === undefined) {\n                if (this.options.isClear && (this.options.multiple || $input.attr('data-id') === '')) {\n                    $input.val('');\n                }\n            } else {\n                if (isClear) {\n                    $input.val('');\n                }\n            }\n            //rotate the dropdown button 360deg\n            if (this.options.dropdownBtn) {\n                var $magicsearch_arrow = $magicsearch_wrapper.find('.' + doms.arrow);\n                $magicsearch_arrow.removeClass('arrow-rotate-180');\n                $magicsearch_arrow.addClass('arrow-rotate-360');\n            }\n            setTimeout(function () {\n                $magicsearch_box.scrollTop(0);\n            }, BOX_ANIMATE_TIME - 1);\n            $magicsearch_box.slideUp(BOX_ANIMATE_TIME, function () {\n                $magicsearch_box.html('');\n            });\n            return this;\n        },\n        appendHtml: function appendHtml(data) {\n            var $input = this.$element,\n                $magicsearch_wrapper = $input.parent(),\n                $magicsearch_box = $magicsearch_wrapper.find('.' + doms.box),\n                $magicsearch_arrow = $magicsearch_wrapper.find('.' + doms.arrow),\n                $ishover = $magicsearch_box.find('li.ishover');\n            var options = this.options,\n                styles = this.props.styles,\n                that = this;\n\n            var idArr = $input.attr('data-id').split(',');\n            if ($input.attr('placeholder')) {\n                $input.removeAttr('placeholder');\n            }\n            var maxLineItem = parseInt((styles.maxWidth - (options.dropdownBtn ? DROPDOWN_WIDTH : 0) - styles.borderLeftWidth - styles.borderRightWidth - that.props.multiStyle.space) / (that.props.multiStyle.width + that.props.multiStyle.space));\n\n            //create item and insert into items\n            var $item = $('<div class=\"' + doms.item + '\" data-id=\"' + data[options.id] + '\" title=\"' + formatParse(options.format, data) + '\"><span>' + formatParse(SEPARATOR + options.multiField + SEPARATOR, data) + '</span><a class=\"' + doms.close + '\" data-id=\"' + data[options.id] + '\" href=\"javascript:;\"></a></div>');\n            $item.css({\n                'height': styles.sightHeight - that.props.multiStyle.space * 2,\n                'width': that.props.multiStyle.width,\n                'margin-bottom': that.props.multiStyle.space * 2,\n                'margin-right': that.props.multiStyle.space,\n                'line-height': styles.sightHeight - that.props.multiStyle.space * 2 - 2 + 'px'\n            });\n            $item.find('.' + doms.close).css({\n                'top': parseInt((styles.sightHeight - that.props.multiStyle.space * 2 - 2 - 12) / 2)\n            });\n\n            var lineNum = parseInt(idArr.length / maxLineItem);\n            //$input.css('padding-left', styles.paddingLeft + idArr.length % maxLineItem * (that.props.multiStyle.width + that.props.multiStyle.space));\n            if (idArr.length % maxLineItem === 0) {\n                $input.css('height', styles.height + lineNum * styles.sightHeight);\n                $input.css('padding-top', lineNum * styles.sightHeight);\n                $magicsearch_box.css('top', styles.height + lineNum * styles.sightHeight);\n            } else {\n                if (lineNum === 0) {\n                    var minWidth = (idArr.length % maxLineItem + 1) * (that.props.multiStyle.width + that.props.multiStyle.space) + that.props.multiStyle.space * 2 + styles.borderLeftWidth + styles.borderRightWidth + (options.dropdownBtn ? DROPDOWN_WIDTH : 0);\n                    //$input.css('min-width', minWidth);\n                    //$magicsearch_wrapper.css('min-width', minWidth);\n                }\n            }\n\n            //bind click event on delete button\n            $item.find('.' + doms.close).click(function () {\n                that.deleteData($(this).attr('data-id')).hideSearchBox();\n            });\n            $magicsearch_wrapper.find('.' + doms.items).append($item);\n        }\n    };\n\n    $.fn.magicsearch = function (options) {\n        var hasDropdownBtn = false;\n        var searchTimeout = null;\n        var preInput = '';\n        var jqo = this.each(function () {\n            var $this = $(this);\n            var magicSearch = $.data(this, 'magicsearch');\n            if (magicSearch) {\n                magicSearch.destroy();\n            }\n            magicSearch = new MagicSearch(this, options);\n            if (magicSearch.init() === false) {\n                return;\n            }\n            $.data(this, 'magicsearch', magicSearch);\n            var selfOptions = magicSearch.options;\n            var $magicsearch_wrapper = $this.parent(),\n                $magicsearch_box = $magicsearch_wrapper.find('.' + doms.box);\n            var dropdown = function dropdown() {\n                if ($magicsearch_wrapper.hasClass('disabled')) {\n                    return false;\n                }\n                if ($magicsearch_box.is(':visible')) {\n                    magicSearch.hideSearchBox();\n                } else {\n                    $magicsearch_box.css({\n                        'max-height': selfOptions.dropdownMaxItem * 30 + 8\n                    });\n                    $magicsearch_box.unbind('scroll');\n                    $this.data('page', 1);\n                    magicSearch.searchData(true).showSearchBox(function () {\n                        $magicsearch_box.on('scroll', function (e) {\n                            if (this.scrollHeight - $(this).scrollTop() < 300) {\n                                magicSearch.searchData(true, true);\n                            }\n                        });\n                    });\n                }\n            };\n            $this.off().on('keyup', function (e) {\n                var $_this = $(this);\n                if (e.which == KEY.ESC) {\n                    $_this.val('').focus();\n                    magicSearch.hideSearchBox();\n                } else if (e.which == KEY.DOWN) {\n                    var $li = $magicsearch_box.find('li');\n                    var $ishover = $magicsearch_box.find('li.ishover');\n                    if ($li.length > 0) {\n                        if ($ishover.length > 0) {\n                            $ishover.toggleClass('ishover');\n                            if ($ishover.next().length > 0) {\n                                $ishover.next().toggleClass('ishover');\n                            } else {\n                                $magicsearch_box.find('li:first').toggleClass('ishover');\n                            }\n                        } else {\n                            $magicsearch_box.find('li:first').toggleClass('ishover');\n                        }\n                    }\n                    return false;\n                } else if (e.which == KEY.UP) {\n                    var _$li = $magicsearch_box.find('li');\n                    var _$ishover = $magicsearch_box.find('li.ishover');\n                    if (_$li.length > 0) {\n                        if (_$ishover.length > 0) {\n                            _$ishover.toggleClass('ishover');\n                            if (_$ishover.prev().length > 0) {\n                                _$ishover.prev().toggleClass('ishover');\n                            } else {\n                                $magicsearch_box.find('li:last').toggleClass('ishover');\n                            }\n                        } else {\n                            $magicsearch_box.find('li:last').toggleClass('ishover');\n                        }\n                    }\n                    return false;\n                } else if (e.which == KEY.ENTER) {\n                    var _$ishover2 = $magicsearch_box.find('li.ishover');\n                    if (_$ishover2.length > 0) {\n                        _$ishover2.trigger('click');\n                    }\n                } else if (e.which == KEY.LEFT || e.which == KEY.RIGHT) {\n                    return true;\n                } else {\n                    var currentInput = $_this.val();\n                    if ($.trim(preInput) == $.trim(currentInput)) {\n                        return true;\n                    }\n                    if (currentInput !== '') {\n                        if ($.trim(currentInput) === '') {\n                            magicSearch.hideSearchBox(e.which == KEY.BACKSPACE || e.which == KEY.SPACE ? false : undefined);\n                            return false;\n                        }\n                        //hide search box when key up\n                        if (!selfOptions.multiple && $_this.attr('data-id') !== '') {\n                            magicSearch.hideSearchBox();\n                            return;\n                        }\n                        clearTimeout(searchTimeout);\n                        searchTimeout = setTimeout(function () {\n                            magicSearch.searchData().showSearchBox();\n                        }, SEARCH_DELAY);\n                    } else {\n                        magicSearch.hideSearchBox();\n                    }\n                }\n            }).on('keydown', function (e) {\n                var $_this = $(this);\n                if (e.which == KEY.ESC) {} else if (e.which == KEY.UP) {\n                    return false;\n                } else if (e.which == KEY.DOWN) {\n                    return false;\n                } else if (e.which == KEY.ENTER) {\n                    return !$magicsearch_box.is(':visible');\n                } else if (e.which == KEY.BACKSPACE) {\n                    preInput = $_this.val();\n                    if (selfOptions.multiple) {\n                        var $last_multi_item = $magicsearch_wrapper.find('.' + doms.items + ' .' + doms.item + ':last');\n                        if (selfOptions.showMultiSkin && $_this.val() === '') {\n                            magicSearch.deleteData($last_multi_item.attr('data-id')).hideSearchBox();\n                        }\n                    } else {\n                        if ($(this).attr('data-id') !== '') {\n                            magicSearch.deleteData();\n                            magicSearch.hideSearchBox();\n                        }\n                    }\n                } else if (e.which == KEY.LEFT || e.which == KEY.RIGHT) {\n                    return true;\n                } else {\n                    preInput = $_this.val();\n                    if (preInput !== '') {\n                        //set empty value when key down\n                        if (!selfOptions.multiple && $_this.attr('data-id') !== '') {\n                            magicSearch.deleteData();\n                            return;\n                        }\n                    }\n                }\n            }).on('focus', function () {\n                $magicsearch_wrapper.addClass('focus');\n                if (!selfOptions.isClear && $this.val() !== '' && $this.attr('data-id') === '') {\n                    magicSearch.searchData().showSearchBox();\n                } else if (selfOptions.focusShow) {\n                    dropdown();\n                }\n            }).on('blur', function () {\n                $magicsearch_wrapper.removeClass('focus');\n                magicSearch.hideSearchBox();\n            });\n\n            $magicsearch_box.off().on('mousedown', 'ul', function () {\n                return false;\n            }).on('mouseenter', 'li', function () {\n                $(this).parent().find('li.ishover').removeClass('ishover');\n                $(this).addClass('ishover');\n            }).on('mouseleave', 'li', function () {\n                $(this).removeClass('ishover');\n            }).on('click', 'li', function () {\n                var $li = $(this);\n                if ($li.hasClass('selected') && selfOptions.multiple) {\n                    magicSearch.deleteData($li.attr('data-id')).hideSearchBox();\n                } else {\n                    magicSearch.setData().hideSearchBox();\n                }\n            });\n\n            //When the option of dropdownBtn is true,bind the related event\n            if (selfOptions.dropdownBtn) {\n                hasDropdownBtn = true;\n                $magicsearch_wrapper.on('click', '.' + doms.arrow, function () {\n                    return dropdown();\n                });\n            }\n            $this.on('clear', function () {\n                $this.val('');\n                if (selfOptions.multiple) {\n                    if (selfOptions.showMultiSkin) {\n                        magicSearch.deleteData($this.attr('data-id'));\n                    } else {\n                        $this.attr('data-id', '');\n                        if (selfOptions.hidden) {\n                            $magicsearch_wrapper.find('.' + doms.hidden).val('');\n                        }\n                    }\n                } else {\n                    $this.attr('data-id', '');\n                    if (selfOptions.hidden) {\n                        $magicsearch_wrapper.find('.' + doms.hidden).val('');\n                    }\n                }\n            }).on('update', function (e, options) {\n                //update dataSource\n                if (options.dataSource !== undefined) {\n                    var tmpDataSource = options.dataSource;\n                    if (isString(tmpDataSource)) {\n                        if (options.dataSource.toLowerCase() == 'null') {\n                            tmpDataSource = [];\n                        } else {\n                            try {\n                                tmpDataSource = $.parseJSON(options.dataSource);\n                                if (!$.isArray(tmpDataSource)) {\n                                    var dataSource = [];\n                                    for (var id in tmpDataSource) {\n                                        dataSource.push(tmpDataSource[id]);\n                                    }\n                                    tmpDataSource = dataSource;\n                                }\n                            } catch (err) {\n                                tmpDataSource = [];\n                                console.error('magicsearch: The dataSource you updated is wrong,please check.');\n                            }\n                        }\n                    }\n                    magicSearch.props.isFirstGetDataSource = true;\n                    magicSearch.options.dataSource = tmpDataSource;\n                }\n            }).on('set', function (e, options) {\n                var originId = magicSearch.$element.attr('data-id');\n                var multi = magicSearch.options.multiple;\n                magicSearch.destroy();\n                magicSearch.$element.attr('data-id', options.override || !multi ? options.id : [].concat(_toConsumableArray(new Set((originId ? originId.split(',') : []).concat(options.id.split(','))))));\n                magicSearch.$element.magicsearch(magicSearch.options);\n            }).on('destroy', function () {\n                magicSearch.destroy();\n            });\n            $magicsearch_wrapper.on('click', '.' + doms.items, function (e) {\n                if ($(e.target).is('.' + doms.items)) {\n                    $this.focus();\n                }\n            }).on('mousedown', '.' + doms.items, function () {\n                return false;\n            });\n        });\n\n        if (hasDropdownBtn && !window.MagicSearch.hasBindBody) {\n            $('body').on('mousedown', function (e) {\n                var $target = $(e.target),\n                    $magicsearch_wrapper = $(this).find('.' + doms.wrapper + ' .' + doms.box + ':visible').first().parent(),\n                    $input = $magicsearch_wrapper.find('input:text');\n                var index = $magicsearch_wrapper.attr('data-index');\n                if (index !== undefined && !$target.is('.' + doms.wrapper + '[data-index=\"' + index + '\"] *')) {\n                    $.data($input.get(0), 'magicsearch').hideSearchBox();\n                }\n            });\n            window.MagicSearch.hasBindBody = true;\n        }\n        return jqo;\n    };\n\n    window.MagicSearch = {\n        v: '1.0.2',\n        index: 0,\n        hasBindBody: false\n    };\n});","\n\n// pedigree utils\n(function(utils, $, undefined) {\n\n\t/**\n\t * Show message or confirmation dialog.\n\t * @param title     - dialog window title\n\t * @param msg       - message to diasplay\n\t * @param onConfirm - function to call in a confirmation dialog\n\t * @param opts      - pedigreejs options\n\t * @param dataset    - pedigree dataset\n\t */ \n\tutils.messages = function(title, msg, onConfirm, opts, dataset) {\n\t\tif(onConfirm) {\n\t\t\t$('<div id=\"msgDialog\">'+msg+'</div>').dialog({\n\t\t\t        modal: true,\n\t\t\t        title: title,\n\t\t\t        width: 350,\n\t\t\t        buttons: {\n\t\t\t        \t\"Yes\": function () {\n\t\t\t                $(this).dialog('close');\n\t\t\t                onConfirm(opts, dataset);\n\t\t\t            },\n\t\t\t            \"No\": function () {\n\t\t\t                $(this).dialog('close');\n\t\t\t            }\n\t\t\t        }\n\t\t\t    });\n\t\t} else {\n\t\t\t$('<div id=\"msgDialog\">'+msg+'</div>').dialog({\n\t    \t\ttitle: title,\n\t    \t\twidth: 350,\n\t    \t\tbuttons: [{\n\t    \t\t\ttext: \"OK\",\n\t    \t\t\tclick: function() { $( this ).dialog( \"close\" );}\n\t    \t\t}]\n\t\t\t});\n\t\t}\n\t}\n\t\n\t/**\n\t * Validate age and yob is consistent with current year. The sum of age and\n\t * yob should not be greater than or equal to current year. If alive the\n\t * absolute difference between the sum of age and year of birth and the\n\t * current year should be <= 1.\n\t * @param age    - age in years.\n\t * @param yob    - year of birth.\n\t * @param status - 0 = alive, 1 = dead.\n\t * @return true if age and yob are consistent with current year otherwise false.\n\t */\n\tutils.validate_age_yob = function(age, yob, status) {\n\t\tvar year = new Date().getFullYear();\n\t\tvar sum = parseInt(age) + parseInt(yob);\n\t\tif(status == 1) {   // deceased\n\t\t\treturn year >= sum;\n\t\t}\n\t\treturn Math.abs(year - sum) <= 1 && year >= sum;\n\t}\n}(window.utils = window.utils || {}, jQuery));\n\n\n// pedigree I/O \n(function(io, $, undefined) {\n\n\t// cancers, genetic & pathology tests\n\tio.cancers = {\n\t\t\t'breast_cancer': 'breast_cancer_diagnosis_age',\n\t\t\t'breast_cancer2': 'breast_cancer2_diagnosis_age',\n\t\t\t'ovarian_cancer': 'ovarian_cancer_diagnosis_age',\n\t\t\t'prostate_cancer': 'prostate_cancer_diagnosis_age',\n\t\t\t'pancreatic_cancer': 'pancreatic_cancer_diagnosis_age'\n\t\t};\n\tio.genetic_test = ['brca1', 'brca2', 'palb2', 'atm', 'chek2'];\n\tio.pathology_tests = ['er', 'pr', 'her2', 'ck14', 'ck56'];\n\t\n\t\n\tio.add = function(opts) {\n\t\t$('#load').change(function(e) {\n\t\t\tio.load(e, opts);\n\t\t});\n\n\t\t$('#save').click(function(e) {\n\t\t\tio.save(opts);\n\t\t});\n\n\t\t$('#print').click(function(e) {\n\t\t\tio.print(io.get_printable_svg(opts));\n\t\t});\n\n\t\t$('#svg_download').click(function(e) {\n\t\t\tio.svg_download(io.get_printable_svg(opts));\n\t\t});\n\n\t\t$('#png_download').click(function(e) {\n\t\t\tvar wrapper = $(io.get_printable_svg(opts)).appendTo('body')[0];\n\t\t\tvar svg = wrapper.querySelector(\"svg\");\n\t\t\tvar svgData;\n\t\t    if (typeof window.XMLSerializer != \"undefined\") {\n\t\t        svgData = (new XMLSerializer()).serializeToString(svg);\n\t\t    } else if (typeof svg.xml != \"undefined\") {\n\t\t        svgData = svg.xml;\n\t\t    }\n\n\t\t    var canvas = document.createElement(\"canvas\");\n\t\t    var svgSize = svg.getBoundingClientRect();\n\t\t    canvas.width = svgSize.width;\n\t\t    canvas.height = svgSize.height;\n\t\t    var ctx = canvas.getContext(\"2d\");\n\n\t\t    var img = document.createElement(\"img\");\n\t\t    img.setAttribute(\"src\", \"data:image/svg+xml;base64,\" + btoa(unescape(encodeURIComponent(svgData))) );\n\t\t    img.onload = function() {\n\t\t        ctx.drawImage(img, 0, 0);\n\t\t        var imgsrc = canvas.toDataURL(\"image/png\");\n\t\t\t\tvar a      = document.createElement('a');\n\t\t\t\ta.href     = imgsrc;\n\t\t\t\ta.download = 'plot.png';\n\t\t\t\ta.target   = '_blank';\n\t\t\t\tdocument.body.appendChild(a); a.click(); document.body.removeChild(a);\n\t\t        setTimeout(function() {\n\t\t        \twrapper.remove();\n\t\t        }, 200);\n\t\t    };\n\t\t});\n\t};\n\n\t// return a copy of svg html with unique url references (e.g. for clippath)\n\tio.copy_svg_html = function(opts) {\n    \tvar svg_html = io.get_printable_svg(opts).html();\n    \t// find all url's to make unique\n    \tvar myRegexp = /url\\(\\#(.*?)\\)/g;\n\t\tvar match = myRegexp.exec(svg_html);\n\t\twhile (match !== null) {\n\t\t\tvar val = match[1];  // replace all url id's with new unique id's\n\t\t\tsvg_html = svg_html.replace(new RegExp(val, 'g'), val+ptree.makeid(2));\n\t\t\tmatch = myRegexp.exec(svg_html);\n\t\t}\n\t\treturn svg_html;\n\t};\n\n\t// get printable svg div, adjust size to tree dimensions and scale to fit\n\tio.get_printable_svg = function(opts) {\n\t\tvar local_dataset = pedcache.current(opts); // get current dataset\n\t\tif (local_dataset !== undefined && local_dataset !== null) {\n\t\t\topts.dataset = local_dataset;\n\t\t}\n\n\t\tvar tree_dimensions = ptree.get_tree_dimensions(opts);\n\t\tvar svg_div = $('#'+opts.targetDiv).find('svg').parent();\n\t\tif(opts.width < tree_dimensions.width || opts.height < tree_dimensions.height ||\n\t\t   tree_dimensions.width > 595 || tree_dimensions.height > 842) {\n\t\t\tvar wid = tree_dimensions.width;\n\t\t    var hgt = tree_dimensions.height + 100;\n\t\t    var scale = 1.0;\n\n\t\t    if(tree_dimensions.width > 595 || tree_dimensions.height > 842) {   // scale to fit A4\n\t\t    \tif(tree_dimensions.width > 595)  wid = 595;\n\t\t    \tif(tree_dimensions.height > 842) hgt = 842;\n\t\t    \tvar xscale = wid/tree_dimensions.width;\n\t\t    \tvar yscale = hgt/tree_dimensions.height;\n\t\t    \tscale = (xscale < yscale ? xscale : yscale);\n\t\t    }\n\t\t\tsvg_div = $('<div></div>');// create a new div\n\t\t\tlet parentClone = $('svg').parent().clone();\n\t\t\tlet selectionsToBeRemoved = ['.view-controls', '.view-controls-zoom .field-no-user-select', '.all-legend-container', '#dataButton', '#dataShower'];\n\t\t\tselectionsToBeRemoved.map((selection)=>parentClone.find(selection).remove());\n\t\t\tsvg_div.append(parentClone.html());\t// copy svg html to new div\n\t\t    var svg = svg_div.find( \"svg\" );\n\t\t    svg.attr('width', wid);\t\t// adjust dimensions\n\t\t    svg.attr('height', hgt);\n\n\t\t    var ytransform = (-opts.symbol_size*1.5*scale);\n\t\t    svg.find(\".diagram\").attr(\"transform\", \"translate(0, \"+ytransform+\") scale(\"+scale+\")\");\n\t\t}\n\t\treturn svg_div;\n\t};\n\t// download the SVG to a file\n\tio.svg_download = function(svg){\n\t\tvar a      = document.createElement('a');\n\t\ta.href     = 'data:image/svg+xml;base64,'+ btoa( unescape( encodeURIComponent( svg.html() ) ) );\n\t\ta.download = 'plot.svg';\n\t\ta.target   = '_blank';\n\t\tdocument.body.appendChild(a); a.click(); document.body.removeChild(a);\n\t};\n\n\t// open print window for a given element\n\tio.print = function(el){\n        if(el.constructor !== Array)\n        \tel = [el];\n\n        var width = $(window).width()*2/3;\n        var height = $(window).height()-40;\n        var cssFiles = [\n        \t'/static/css/output.css',\n        \t'https://use.fontawesome.com/releases/v5.7.2/css/all.css',\n        \t'https://use.fontawesome.com/releases/v5.7.2/css/v4-shims.css'\n        ];\n        var printWindow = window.open('', 'PrintMap', 'width=' + width + ',height=' + height);\n        var headContent = '';\n        for(var i=0; i<cssFiles.length; i++)\n        \theadContent += '<link href=\"'+cssFiles[i]+'\" rel=\"stylesheet\" type=\"text/css\" media=\"all\">';\n        headContent += \"<style>body {font-size: \" + $(\"body\").css('font-size') + \";}</style>\";\n\n            /*var headContent2 = '';\n            var links = document.getElementsByTagName('link');\n            for(var i=0;i<links.length; i++) {\n            \tvar html = links[i].outerHTML;\n            \tif(html.indexOf('href=\"http') !== -1)\n            \t\theadContent2 += html;\n            }\n            headContent2 += html;          \n            var scripts = document.getElementsByTagName('script');\n            for(var i=0;i<scripts.length; i++) {\n            \tvar html = scripts[i].outerHTML;\n            \tif(html.indexOf('src=\"http') !== -1)\n            \t\theadContent += html;\n            }*/\n\n        html = \"\";\n        for(i=0; i<el.length; i++) {\n        \thtml += $(el[i]).html();\n        \tif(i < el.length-1)\n        \t\thtml += '<div style=\"page-break-before:always\"> </div>';\n        }\n\n        printWindow.document.write(headContent);\n        printWindow.document.write(html);\n        printWindow.document.close();\n\n        printWindow.focus();\n        setTimeout(function() {\n            printWindow.print();\n            printWindow.close();\n        }, 100);\n\t};\n\n\tio.save = function(opts){\n\t\tvar content = JSON.stringify(pedcache.current(opts));\n\t\tif(opts.DEBUG)\n\t\t\tconsole.log(content);\n\t\tvar uriContent = \"data:application/csv;charset=utf-8,\" + encodeURIComponent(content);\n\t\twindow.open(uriContent, 'boadicea_pedigree');\n\t};\n\n\tio.load = function(e, opts) {\n\t    var f = e.target.files[0];\n\t\tif(f) {\n\t\t\tvar reader = new FileReader();\n\t\t\treader.onload = function(e) {\n\t\t\t\tif(opts.DEBUG)\n\t\t\t\t\tconsole.log(e.target.result);\n\t\t\t\ttry {\n\t\t\t\t\tif(e.target.result.startsWith(\"BOADICEA import pedigree file format 4.0\"))\n\t\t\t\t\t\topts.dataset = io.readBoadiceaV4(e.target.result);\n\t\t\t\t\telse {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\topts.dataset = JSON.parse(e.target.result);\n\t\t\t\t\t\t} catch(err) {\n\t\t\t\t\t\t\topts.dataset = io.readLinkage(e.target.result);\n\t\t\t\t\t    }\n\t\t\t\t\t}\n\t\t\t\t\tptree.validate_pedigree(opts);\n\t\t\t\t} catch(err1) {\n\t\t\t\t\tconsole.error(err1);\n\t\t\t\t\tutils.messages(\"File Error\", ( err1.message ? err1.message : err1));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconsole.log(opts.dataset);\n\t\t\t\ttry{\n\t\t\t\t\tptree.rebuild(opts);\n\t\t\t\t} catch(err2) {\n\t\t\t\t\tutils.messages(\"File Error\", ( err2.message ? err2.message : err2));\n\t\t\t\t}\n\t\t\t};\n\t\t\treader.onerror = function(event) {\n\t\t\t    utils.messages(\"File Error\", \"File could not be read! Code \" + event.target.error.code);\n\t\t\t};\n\t\t\treader.readAsText(f);\n\t\t} else {\n\t\t\tconsole.error(\"File could not be read!\");\n\t\t}\n\t\t$(\"#load\")[0].value = ''; // reset value\n\t};\n\n\t// \n\t// https://www.cog-genomics.org/plink/1.9/formats#ped\n\t// https://www.cog-genomics.org/plink/1.9/formats#fam\n\t//\t1. Family ID ('FID')\n\t//\t2. Within-family ID ('IID'; cannot be '0')\n\t//\t3. Within-family ID of father ('0' if father isn't in dataset)\n\t//\t4. Within-family ID of mother ('0' if mother isn't in dataset)\n\t//\t5. Sex code ('1' = male, '2' = female, '0' = unknown)\n\t//\t6. Phenotype value ('1' = control, '2' = case, '-9'/'0'/non-numeric = missing data if case/control)\n\t//  7. Genotypes (column 7 onwards);\n\t//     columns 7 & 8 are allele calls for first variant ('0' = no call); colummns 9 & 10 are calls for second variant etc.\n\tio.readLinkage = function(boadicea_lines) {\n\t\tvar lines = boadicea_lines.trim().split('\\n');\n\t\tvar ped = [];\n\t\tvar famid;\n\t\tfor(var i = 0;i < lines.length;i++){\n\t\t   var attr = $.map(lines[i].trim().split(/\\s+/), function(val, i){return val.trim();});\n\t\t   if(attr.length < 5)\n\t\t\t   throw('unknown format');\n\t\t   var sex = (attr[4] == '1' ? 'M' : (attr[4] == '2' ? 'F' : 'U'));\n\t\t   var indi = {\n\t\t\t\t'famid': attr[0],\n\t\t\t\t'display_name': attr[1],\n\t\t\t\t'name':\tattr[1],\n\t\t\t\t'sex': sex \n\t\t\t};\n\t\t\tif(attr[2] !== \"0\") indi.father = attr[2];\n\t\t\tif(attr[3] !== \"0\") indi.mother = attr[3];\n\t\t\t\n\t\t\tif (typeof famid != 'undefined' && famid !== indi.famid) {\n\t\t\t\tconsole.error('multiple family IDs found only using famid = '+famid);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif(attr[5] == \"2\") indi.affected = 2;\n\t\t\t// add genotype columns\n\t\t\tif(attr.length > 6) {\n\t\t\t\tindi.alleles = \"\";\n\t\t\t\tfor(var j=6; j<attr.length; j+=2) {\n\t\t\t\t\tindi.alleles += attr[j] + \"/\" + attr[j+1] + \";\";\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tped.unshift(indi);\n\t\t\tfamid = attr[0];\n\t\t}\n\t\treturn process_ped(ped);\n\t};\n\n\t// read boadicea format v4\n\tio.readBoadiceaV4 = function(boadicea_lines) {\n\t\tvar lines = boadicea_lines.trim().split('\\n');\n\t\tvar ped = [];\n\t\t// assumes two line header\n\t\tfor(var i = 2;i < lines.length;i++){\n\t\t   var attr = $.map(lines[i].trim().split(/\\s+/), function(val, i){return val.trim();});\n\t\t\tif(attr.length > 1) {\n\t\t\t\tvar indi = {\n\t\t\t\t\t'famid': attr[0],\n\t\t\t\t\t'display_name': attr[1],\n\t\t\t\t\t'name':\tattr[3],\n\t\t\t\t\t'sex': attr[6],\n\t\t\t\t\t'status': attr[8]\n\t\t\t\t};\n\t\t\t\tif(attr[2] == 1) indi.proband = true;\n\t\t\t\tif(attr[4] !== \"0\") indi.father = attr[4];\n\t\t\t\tif(attr[5] !== \"0\") indi.mother = attr[5];\n\t\t\t\tif(attr[7] !== \"0\") indi.mztwin = attr[7];\n\t\t\t\tif(attr[9] !== \"0\") indi.age = attr[9];\n\t\t\t\tif(attr[10] !== \"0\") indi.yob = attr[10];\n\n\t\t\t\tvar idx = 11;\n\t\t\t\t$.each(io.cancers, function(cancer, diagnosis_age) {\n\t\t\t\t\t// Age at 1st cancer or 0 = unaffected, AU = unknown age at diagnosis (affected unknown)\n\t\t\t\t\tif(attr[idx] !== \"0\") {\n\t\t\t\t\t\tindi[diagnosis_age] = attr[idx];\n\t\t\t\t\t}\n\t\t\t\t\tidx++;\n\t\t\t\t});\n\n\t\t\t\tif(attr[idx++] !== \"0\") indi.ashkenazi = 1;\n\t\t\t\t// BRCA1, BRCA2, PALB2, ATM, CHEK2 genetic tests\n\t\t\t\t// genetic test type, 0 = untested, S = mutation search, T = direct gene test\n\t\t\t\t// genetic test result, 0 = untested, P = positive, N = negative\n\t\t\t\tfor(var j=0; j<io.genetic_test.length; j++) {\n\t\t\t\t\tidx+=2;\n\t\t\t\t\tif(attr[idx-2] !== '0') {\n\t\t\t\t\t\tif((attr[idx-2] === 'S' || attr[idx-2] === 'T') && (attr[idx-1] === 'P' || attr[idx-1] === 'N'))\n\t\t\t\t\t\t\tindi[io.genetic_test[j] + '_gene_test'] = {'type': attr[idx-2], 'result': attr[idx-1]};\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tconsole.warn('UNRECOGNISED GENE TEST ON LINE '+ (i+1) + \": \" + attr[idx-2] + \" \" + attr[idx-1]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// status, 0 = unspecified, N = negative, P = positive\n\t\t\t\tfor(j=0; j<io.pathology_tests.length; j++) {\n\t\t\t\t\tif(attr[idx] !== '0') {\n\t\t\t\t\t\tif(attr[idx] === 'N' || attr[idx] === 'P')\n\t\t\t\t\t\t\tindi[io.pathology_tests[j] + '_bc_pathology'] = attr[idx];\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tconsole.warn('UNRECOGNISED PATHOLOGY ON LINE '+ (i+1) + \": \" +io.pathology_tests[j] + \" \" +attr[idx]);\n\t\t\t\t\t}\n\t\t\t\t\tidx++;\n\t\t\t\t}\n\t\t\t\tped.unshift(indi);\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\treturn process_ped(ped);\n\t\t} catch(e) {\n\t\t\tconsole.error(e);\n\t\t\treturn ped;\n\t\t}\n\t};\n\n\tfunction process_ped(ped) {\n\t\t// find the level of individuals in the pedigree\n\t\tfor(var i=0;i<ped.length;i++) {\n\t\t\tgetLevel(ped, ped[i].name);\n\t\t}\n\n\t\t// find the max level (i.e. top_level)\n\t\tvar max_level = 0;\n\t\tfor(i=0;i<ped.length;i++) {\n\t\t\tif(ped[i].level && ped[i].level > max_level)\n\t\t\t\tmax_level = ped[i].level;\n\t\t}\n\n\t\t// identify top_level and other nodes without parents\n\t\tfor(i=0;i<ped.length;i++) {\n\t\t\tif(pedigree_util.getDepth(ped, ped[i].name) == 1) {\n\t\t\t\tif(ped[i].level && ped[i].level == max_level) {\n\t\t\t\t\tped[i].top_level = true;\n\t\t\t\t} else {\n\t\t\t\t\tped[i].noparents = true;\n\n\t\t\t\t\t// 1. look for partners parents\n\t\t\t\t\tvar pidx = getPartnerIdx(ped, ped[i]);\n\t\t\t\t\tif(pidx > -1) {\n\t\t\t\t\t\tif(ped[pidx].mother) {\n\t\t\t\t\t\t\tped[i].mother = ped[pidx].mother;\n\t\t\t\t\t\t\tped[i].father = ped[pidx].father;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// 2. or adopt parents from level above\n\t\t\t\t\tif(!ped[i].mother){\n\t\t\t\t\t\tfor(var j=0; j<ped.length; j++) {\n\t\t\t\t\t\t\tif(ped[i].level == (ped[j].level-1)) {\n\t\t\t\t\t\t\t\tpidx = getPartnerIdx(ped, ped[j]);\n\t\t\t\t\t\t\t\tif(pidx > -1) {\n\t\t\t\t\t\t\t\t\tped[i].mother = (ped[j].sex === 'F' ? ped[j].name : ped[pidx].name);\n\t\t\t\t\t\t\t\t\tped[i].father = (ped[j].sex === 'M' ? ped[j].name : ped[pidx].name);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tdelete ped[i].top_level;\n\t\t\t}\n\t\t}\n\t\treturn ped;\n\t}\n\n\t// get the partners for a given node\n\tfunction getPartnerIdx(dataset, anode) {\n\t\tvar ptrs = [];\n\t\tfor(var i=0; i<dataset.length; i++) {\n\t\t\tvar bnode = dataset[i];\n\t\t\tif(anode.name === bnode.mother)\n\t\t\t\treturn pedigree_util.getIdxByName(dataset, bnode.father);\n\t\t\telse if(anode.name === bnode.father)\n\t\t\t\treturn pedigree_util.getIdxByName(dataset, bnode.mother);\n\t\t}\n\t\treturn -1;\n\t}\n\t\n\t// for a given individual assign levels to a parents ancestors\n\tfunction getLevel(dataset, name) {\n\t\tvar idx = pedigree_util.getIdxByName(dataset, name);\n\t\tvar level = (dataset[idx].level ? dataset[idx].level : 0);\n\t\tupdate_parents_level(idx, level, dataset);\n\t}\n\n\t// recursively update parents levels \n\tfunction update_parents_level(idx, level, dataset) {\n\t\tvar parents = ['mother', 'father'];\n\t\tlevel++;\n\t\tfor(var i=0; i<parents.length; i++) {\n\t\t\tvar pidx = pedigree_util.getIdxByName(dataset, dataset[idx][parents[i]]);\n\t\t\tif(pidx >= 0) {\n\t\t\t\tif(!dataset[pidx].level || dataset[pidx].level < level) {\n\t\t\t\t\tdataset[pedigree_util.getIdxByName(dataset, dataset[idx].mother)].level = level;\n\t\t\t\t\tdataset[pedigree_util.getIdxByName(dataset, dataset[idx].father)].level = level;\n\t\t\t\t}\n\t\t\t\tupdate_parents_level(pidx, level, dataset);\n\t\t\t}\n\t\t}\n\t}\n\n}(window.io = window.io || {}, jQuery));\n","(function (legend, $) {\n    legend.add = function (opts) {\n        let lengendContent = `\n        <div class=\"all-legend-container\" id=\"all-legend-container\">\n    <div class=\"patient-assign-legend generic-legend field-no-user-select pedigree_family_record_ui\" id=\"legend-assign\" style=\"\n    min-width:150px;width: 175px; margin-top: 8px; clear: both\">\n       <div class=\"legend-box-controls-closed\">\n       <span id=\"legend-horizontal-expand\" style=\"float: left;\" class=\"fa fa-angle-double-left\" title=\"expand\"></span>\n       <span id=\"legend-vertical-expand\" class=\"fa legend-box-button-right legend-action-restore fa-angle-double-up\" title=\"restore\" style=\"float: right;\"></span>\n       <span class=\"glyphicon glyphicon-cog\" title=\"settings\" style=\"float: right; padding-right: 10px;\" id=\"settings\"></span>\n       <div class=\"legend-minimized-title field-no-user-select\" style=\"\">\n       &emsp;Legend </div></div>\n       <div id=\"legend-content\"  class=\"legend-box\"  style=\"display: block\">\n            <input id=\"dragged-legend-name\" style=\"display:none;\"/>\n            <h2 class=\"legend-title field-no-user-select\">Conditions <input id=\"legend-condition-checkbox\" type=\"checkbox\" class=\"legend-hide-show-checkbox\" checked></h2>\n            <ul class=\"candidategene-list abnormality-list\" id=\"legend-condition-list\">\n            </ul>\n            <h2 class=\"legend-title field-no-user-select\">Phenotypes</h2>\n            <ul class=\"candidategene-list abnormality-list\" id=\"legend-phenotype-list\"></ul>\n            <h2 class=\"legend-title field-no-user-select\">Candidate Genes</h2>\n            <ul class=\"candidategene-list abnormality-list\" id=\"legend-candidate-list\">\n            <li><div></div></li></ul>\n            <h2 class=\"legend-title field-no-user-select\">Confirmed Causal Genes</h2>\n            <ul class=\"candidategene-list abnormality-list\" id=\"legend-causal-list\">\n            <li><div></div></li></ul>\n            <h2 class=\"legend-title field-no-user-select\">Carrier Genes</h2>\n            <ul class=\"candidategene-list abnormality-list\" id=\"legend-carrier-list\">\n            <li><div></div></li></ul>\n            <h2 class=\"legend-title field-no-user-select\">Cancers<input type=\"checkbox\" id=\"legend-cancer-checkbox\" class=\"legend-hide-show-checkbox\" checked></h2>\n            <ul class=\"candidategene-list abnormality-list\" id=\"legend-cancer-list\"></ul>\n        </div>\n    </div>\n    <div class=\"patient-assign-legend generic-legend field-no-user-select pedigree_family_record_ui\" id=\"samples-assign\" style=\"\n    width: 175px; min-width: 150px; margin-top: 8px; clear: both\">\n       <div class=\"legend-box-controls-closed\" id=\"samples-legend-box-controls\"><div class=\"legend-minimized-title field-no-user-select\" style=\"\">\n       Samples </div><span class=\"fa legend-box-button-right legend-action-restore fa-angle-double-down\" title=\"restore\"></span></div>\n       <div id=\"sample-content\">\n</div>\n    </div>\n</div>`;\n\n        if ($('.all-legend-container').length < 1) {\n            $('#' + opts.targetDiv).append(lengendContent);\n        }\n\n        //set click listeners\n        $('#legend-vertical-expand').click(function () {\n            $(this).toggleClass('fa-angle-double-up fa-angle-double-down legend-action-minimize legend-action-restore');\n            $('#legend-content').toggle();\n        });\n\n        $('#legend-horizontal-expand').click(function () {\n            if ($(this).hasClass('fa-angle-double-left')) {\n                $('#legend-assign').css('width', '245px');\n            } else {\n                $('#legend-assign').css('width', '175px');\n            }\n            $(this).toggleClass('fa fa-angle-double-left fa fa-angle-double-right');\n        });\n\n        $('#samples-legend-box-controls').click(function () {\n            $(this).toggleClass('legend-box-controls-open legend-box-controls-close');\n            let arrowButton = $(this).find('.legend-box-button-right');\n            arrowButton.toggleClass('fa-angle-double-up fa-angle-double-down legend-action-minimize legend-action-restore');\n            if (arrowButton.hasClass('fa-angle-double-up')) {\n                $('#sample-content').css({'height': '50px'});\n                $('#samples-assign').css({'min-width':'245px'});\n            } else {\n                $('#sample-content').css('height', '0');\n                $('#samples-assign').css({ 'min-width':'150px'});\n            }\n        });\n\n        window.drag = function (event) {\n            event.target.addEventListener('dragstart', function (e) {\n                e.dataTransfer.setData('text', 'sample');\n            });\n            $('#dragged-legend-name').val('');\n            $('#dragged-legend-name').val($(event.target).find('input').val());\n        };\n\n        $.each(opts.conditions, function (k, v) {\n            var list_id = k + '_legend';\n            var $legend_elem = $('<li draggable=\"true\" ondragstart=\"drag(event)\" id=' + list_id + ' class=\"condition-legend\">' +\n                '<div><span class=\"dot\" style=\"background-color:' + v.color + '\"></span>&nbsp;<span class=\"condition-name\">'\n                + v.name + '</span>&nbsp;<span class=\"case\"></span><input style=\"display: none;\" value=' + k + ' /></div></li>');\n            $('#legend-condition-list').append($legend_elem);\n            $legend_elem.hide();\n        });\n\n        $.each(opts.phenotypes, function (index) {\n            var list_id = opts.phenotypes[index].type + '_legend';\n            var $legend_elem = $('<li draggable=\"true\" ondragstart=\"drag(event)\" id=' + list_id + '><div>' + opts.phenotypes[index].name + '<input style=\"display: none;\" value='+opts.phenotypes[index].type+' ></div></li>');\n            $('#legend-phenotype-list').append($legend_elem);\n            $legend_elem.hide();\n            for (var i = 0; i < opts.dataset.length; i++) {\n                if (opts.dataset[i].hasOwnProperty(opts.phenotypes[index].type)) {\n                    legend.addPhenotypesToLegend(opts.phenotypes[index].type);\n                }\n            }\n        });\n\n        $.each(opts.candidate_genotype, function (index) {\n            var list_id = opts.candidate_genotype[index].type + '_legend';\n            var $legend_elem = $('<li draggable=\"true\" ondragstart=\"drag(event)\" id=' + list_id + '><div>' + opts.candidate_genotype[index].name + '<input style=\"display: none;\" value='+opts.candidate_genotype[index].type+' ></div></li>');\n            $('#legend-candidate-list').append($legend_elem);\n            $legend_elem.hide();\n            for (var i = 0; i < opts.dataset.length; i++) {\n                if (opts.dataset[i].hasOwnProperty(opts.candidate_genotype[index].type)) {\n                    legend.addCandidateToLegend(opts.candidate_genotype[index].type);\n                }\n            }\n        });\n\n        $.each(opts.causal_genotype, function (index) {\n            var list_id = opts.causal_genotype[index].type + '_legend';\n            var $legend_elem = $('<li draggable=\"true\" ondragstart=\"drag(event)\" id=' + list_id + '><div>' + opts.causal_genotype[index].name + '<input style=\"display: none;\" value='+opts.causal_genotype[index].type+' ></div></li>');\n            $('#legend-causal-list').append($legend_elem);\n            $legend_elem.hide();\n            for (var i = 0; i < opts.dataset.length; i++) {\n                if (opts.dataset[i].hasOwnProperty(opts.causal_genotype[index].type)) {\n                    legend.addCausalsToLegend(opts.causal_genotype[index].type);\n                }\n            }\n        });\n\n        $.each(opts.carrier_genotype, function (index) {\n            var list_id = opts.carrier_genotype[index].type + '_legend';\n            var $legend_elem = $('<li draggable=\"true\" ondragstart=\"drag(event)\" id=' + list_id + '><div>' + opts.carrier_genotype[index].name + '<input style=\"display: none;\" value='+opts.carrier_genotype[index].type+'></div></li>');\n            $('#legend-carrier-list').append($legend_elem);\n            $legend_elem.hide();\n            for (var i = 0; i < opts.dataset.length; i++) {\n                if (opts.dataset[i].hasOwnProperty(opts.carrier_genotype[index].type)) {\n                    legend.addCarriersToLegend(opts.carrier_genotype[index].type);\n                }\n            }\n        });\n\n        $.each(opts.conditions, function (k, v) {\n            for (var i = 0; i < opts.dataset.length; i++) {\n                if (opts.dataset[i].hasOwnProperty(k)) {\n                    legend.addConditionLegendToOpts(opts, k, v);\n                }\n            }\n        });\n\n        let all_cancers = opts.cancers.concat(opts.common_cancers);\n        $.each(all_cancers, function (index) {\n            var list_id = all_cancers[index].type + '_legend';\n            var $legend_elem = $('<li draggable=\"true\" ondragstart=\"drag(event)\" id=' + list_id + ' class=\"cancer-legend\">' +\n                '<div><span class=\"dot\" style=\"background-color:' + all_cancers[index].colour + '\"></span>&nbsp;<span class=\"cancer-name\">'\n                + all_cancers[index].name + '</span>&nbsp;<span class=\"case\"></span><input style=\"display: none;\" value=' + all_cancers[index].type + ' /></div></li>');\n            $('#legend-cancer-list').append($legend_elem);\n            $legend_elem.hide();\n        });\n\n        legend.showCancerLegends(opts);\n\n        if (opts.hasOwnProperty('show_cancer_colors') && !opts['show_cancer_colors']) {\n            $(\"#legend-cancer-checkbox\").prop('checked', false);\n        }\n\n        $('#legend-cancer-checkbox').change(function () {\n            legend.showHideCancerColors(opts);\n        });\n\n        if (opts.hasOwnProperty('show_condition_colors') && !opts['show_condition_colors']) {\n            $(\"#legend-condition-checkbox\").prop('checked', false);\n        }\n\n        $('#legend-condition-checkbox').change(function () {\n            legend.showHideConditionColors(opts);\n        });\n\n        $(document).on('click', '#settings', function() {\n            legend.openEditDialog(opts);\n        });\n    };\n\n    legend.addConditionLegendToOpts = function (opts, k, v) {\n        if (opts.hasOwnProperty('condition_legend')) {\n            var alreadyAdded = false;\n            opts.condition_legend.forEach(function (array_values) {\n                if (k === array_values['condition_id']) {\n                    alreadyAdded = true;\n                    return;\n                }\n            });\n            if (!alreadyAdded) {\n                opts['condition_legend'].push({'condition_id': k, 'color': v.color});\n            }\n        } else {\n            opts['condition_legend'] = [{'condition_id': k, 'color': v.color}];\n        }\n        var condition_legend_id = k + '_legend';\n        var caseCount = legend.getCaseCount(opts, k);\n        var caseText = '';\n        if (caseCount > 1) {\n            caseText = '(' + caseCount + ' cases)';\n        } else {\n            caseText = '(' + caseCount + ' case)';\n        }\n        $('#' + condition_legend_id).find('.case').text('');\n        $('#' + condition_legend_id).find('.case').text(caseText);\n        $('#' + condition_legend_id).show();\n    };\n\n    legend.addPhenotypesToLegend = function (k) {\n        if (opts.hasOwnProperty('phenotype_legend')) {\n            var alreadyAdded = false;\n            for (var i = 0; i < opts.phenotype_legend.length; i++) {\n                if (k === opts.phenotype_legend[i]) {\n                    alreadyAdded = true;\n                    break;\n                }\n            }\n\n            if (!alreadyAdded) {\n                opts['phenotype_legend'].push(k);\n            }\n        } else {\n            opts['phenotype_legend'] = [k];\n        }\n        var condition_legend_id = k + '_legend';\n        $('#' + condition_legend_id).show();\n    };\n\n    legend.addCandidateToLegend = function (k) {\n        if (opts.hasOwnProperty('candidate_legend')) {\n            var alreadyAdded = false;\n            for (var i = 0; i < opts.candidate_legend.length; i++) {\n                if (k === opts.candidate_legend[i]) {\n                    alreadyAdded = true;\n                    break;\n                }\n            }\n\n            if (!alreadyAdded) {\n                opts['candidate_legend'].push(k);\n            }\n        } else {\n            opts['candidate_legend'] = [k];\n        }\n        var candidate_legend_id = k + '_legend';\n        $('#' + candidate_legend_id).show();\n    };\n\n    legend.addCausalsToLegend = function (k) {\n        if (opts.hasOwnProperty('causal_legend')) {\n            var alreadyAdded = false;\n            for (var i = 0; i < opts.causal_legend.length; i++) {\n                if (k === opts.causal_legend[i]) {\n                    alreadyAdded = true;\n                    break;\n                }\n            }\n\n            if (!alreadyAdded) {\n                opts['causal_legend'].push(k);\n            }\n        } else {\n            opts['causal_legend'] = [k];\n        }\n        var causal_legend_id = k + '_legend';\n        $('#' + causal_legend_id).show();\n    };\n\n    legend.addCarriersToLegend = function (k) {\n        if (opts.hasOwnProperty('carrier_legend')) {\n            var alreadyAdded = false;\n            for (var i = 0; i < opts.carrier_legend.length; i++) {\n                if (k === opts.carrier_legend[i]) {\n                    alreadyAdded = true;\n                    break;\n                }\n            }\n\n            if (!alreadyAdded) {\n                opts['carrier_legend'].push(k);\n            }\n        } else {\n            opts['carrier_legend'] = [k];\n        }\n        var carrier_legend_id = k + '_legend';\n        $('#' + carrier_legend_id).show();\n    };\n\n    legend.addCancersToLegend = function (k) {\n        if (opts.hasOwnProperty('cancer_legend')) {\n            var newType = true;\n            for (var i = 0; i < opts.cancer_legend.length; i++) {\n                if (k === opts.cancer_legend[i].type) {\n                    var cancerCount = opts.cancer_legend[i].count;\n                    opts.cancer_legend[i].count = cancerCount + 1;\n                    newType = false;\n                    break;\n                }\n            }\n            if (newType) {\n                opts.cancer_legend.push({'type': k, 'count': 1});\n            }\n        } else {\n            opts['cancer_legend'] = [{'type': k, 'count': 1}];\n        }\n    };\n\n    legend.deleteConditionsFromOpts = function (opts, person, k, legend_type, target_div) {\n        if (opts.hasOwnProperty(legend_type)) {\n            var otherPersonHasCondition = false;\n            for (var i = 0; i < opts[legend_type].length; i++) {\n                if ((opts[legend_type][i]['condition_id'] === k)) {\n                    otherPersonHasCondition = true;\n                    var caseCount = legend.getCaseCount(opts, k) - 1;\n                    var caseText = '';\n                    if (caseCount > 1) {\n                        caseText = '(' + caseCount + ' cases)';\n                    } else {\n                        caseText = '(' + caseCount + ' case)';\n                    }\n                    $('#' + k + '_legend').find('.case').text('');\n                    $('#' + k + '_legend').find('.case').text(caseText);\n                    break;\n                }\n            }\n            if (!otherPersonHasCondition) {\n                for (var j = 0; j < opts[legend_type].length; j++) {\n                    if (opts[legend_type][j]['condition_id'] === k) {\n                        opts[legend_type].slice(j, 1);\n                        break;\n                    }\n                }\n                $('#' + k + '_legend').hide();\n            }\n        }\n    };\n\n    legend.getCaseCount = function(opts, k) {\n        let case_count = 0;\n        opts.dataset.forEach(function (person) {\n            if (person.hasOwnProperty(k)) {\n                case_count++;\n            }\n        });\n        return case_count;\n    };\n\n    legend.showCancerLegends = function (opts) {\n        $.each(opts.cancer_legend, function (index) {\n            var cancer_legend_id = opts.cancer_legend[index].type + '_legend';\n            if (opts.cancer_legend[index].count > 0) {\n                var caseCount = opts.cancer_legend[index].count;\n                var caseText = '';\n                if (caseCount > 1) {\n                    caseText = '(' + caseCount + ' cases)';\n                } else {\n                    caseText = '(' + caseCount + ' case)';\n                }\n                $('#' + cancer_legend_id).find('.case').text('');\n                $('#' + cancer_legend_id).find('.case').text(caseText);\n                $('#' + cancer_legend_id).show();\n            } else {\n                $('#' + cancer_legend_id).hide();\n            }\n        });\n    };\n\n    legend.showHideCancerColors = function (opts) {\n        if ($('#legend-cancer-checkbox').is(':checked')) {\n            if (opts.hasOwnProperty('show_cancer_colors')) {\n                opts['show_cancer_colors'] = true;\n            }\n        } else {\n            opts['show_cancer_colors'] = false;\n        }\n        opts.dataset = ptree.copy_dataset(pedcache.current(opts));\n        ptree.rebuild(opts);\n    };\n\n    legend.showHideConditionColors = function (opts) {\n        if ($('#legend-condition-checkbox').is(':checked')) {\n            if (opts.hasOwnProperty('show_condition_colors')) {\n                opts['show_condition_colors'] = true;\n            }\n        } else {\n            opts['show_condition_colors'] = false;\n        }\n        opts.dataset = ptree.copy_dataset(pedcache.current(opts));\n        ptree.rebuild(opts);\n    };\n\n    //open settings dialog\n    legend.openEditDialog = function (opts) {\n        let $nodeProperties = $('#node_properties');\n        if ($nodeProperties.length > 0) {\n            $nodeProperties.remove();\n        }\n        let $targetDiv = $('#' + opts.targetDiv);\n        $targetDiv.append('<div id=\"node_properties\"></div>');\n        let $node_properties = $('#node_properties');\n        let dialogWidth = ($(window).width() > 400 ? 450 : $(window).width() - 30);\n        $node_properties.dialog({\n            autoOpen: false,\n            appendTo: '#pedigrees',\n            width: dialogWidth,\n            dialogClass: 'node-properties-dialog'\n        });\n\n        let selectedSetting = pedcache.get_hierarchy_settings(opts, String(1)); //Used default depth value 1\n        function isChecked(id) {\n            if (selectedSetting.includes(id) || selectedSetting.includes('all'))\n                return 'checked';\n            return '';\n        }\n\n        var table = \"<table id='person_details' class='table'>\" +\n            \"<tr><td><div class='form-group' style='text-align: left;'>Select the legends to display under the nodes of this generation line</div>\" +\n            \"<div class='checkbox'><label style='width: 100%; text-align: left;'><input id='s_name' type='checkbox' value='' \" + isChecked('name') + \">Node ID</label>\" +\n            \"<label style='width: 100%; text-align: left;'><input id='s_full_name' type='checkbox' value='' \" + isChecked('full_name') + \">Name</label>\" +\n            \"<label style='width: 100%; text-align: left;'><input id='s_id' type='checkbox' value='' \" + isChecked('id') + \">Identifier</label>\" +\n            \"<label style='width: 100%; text-align: left;'><input id='s_age_dob' type='checkbox' value='' \" + isChecked('age_dob') + \">Age and date of birth</label>\" +\n            \"<label style='width: 100%; text-align: left;'><input id='s_dod_cod' type='checkbox' value='' \" + isChecked('dod_cod') + \">Date and cause of death</label>\" +\n            \"<label style='width: 100%; text-align: left;'><input id='s_ethnicity_country' type='checkbox' value='' \" + isChecked('ethnicity_country') + \">Ethnicity and Country of origin</label>\" +\n            \"<label style='width: 100%; text-align: left;'><input id='s_phenotypes_symptoms' type='checkbox' value='' \" + isChecked('phenotypes_symptoms') + \">Phenotypes, clinical symptoms</label>\" +\n            \"<label style='width: 100%; text-align: left;'><input id='s_conditions' type='checkbox' value='' \" + isChecked('conditions') + \">Conditions</label>\" +\n            \"<label style='width: 100%; text-align: left;'><input id='s_genotypes_can_genes' type='checkbox' value='' \" + isChecked('genotypes_can_genes') + \">Genotype: candidate genes</label>\" +\n            \"<label style='width: 100%; text-align: left;'><input id='s_genotypes_con_genes' type='checkbox' value='' \" + isChecked('genotypes_con_genes') + \">Genotype: confirmed causal genes</label>\" +\n            \"<label style='width: 100%; text-align: left;'><input id='s_genotypes_car_genes' type='checkbox' value='' \" + isChecked('genotypes_car_genes') + \">Genotype: carrier genes</label>\" +\n            \"<label style='width: 100%; text-align: left;'><input id='s_risk_factors_cancers' type='checkbox' value='' \" + isChecked('risk_factors_cancers') + \">Risk factors: cancers</label></div></td></tr>\"\n            + \"</table>\";\n        $node_properties.html(table);\n        $('.node-properties-dialog').css('float', 'left');\n        $node_properties.dialog('open');\n        var changeOccurred = false;\n        $('#node_properties input[type=radio], #node_properties input[type=checkbox], #node_properties input[type=text], #node_properties input[type=number]').change(function () {\n            var prevDepth = -1;\n            d3.selectAll('g').each(function (d1) {\n                if (d1 && d1.depth) {\n                    changeOccurred = true;\n                    if (prevDepth !== d1.depth) {\n                        legend.save_hierarchy_settings(opts, String(d1.depth));\n                    }\n                    prevDepth = d1.depth;\n                }\n            });\n            if (changeOccurred) {\n                ptree.rebuild(opts);\n            }\n        });\n        pedigree_form.update(opts);\n    };\n\n    //save each hierarchy level settings\n    legend.save_hierarchy_settings = function (opts, hierarchy) {\n        var switches = ['name', 'full_name', 'id', 'age_dob', 'dod_cod', 'ethnicity_country', 'phenotypes_symptoms', 'conditions',\n            'genotypes_can_genes', 'genotypes_con_genes', 'genotypes_car_genes', 'risk_factors_cancers'];\n        let values = [];\n        switches.map((id) => {\n            let s = $('#s_' + id);\n            if (s.is(\":checked\")) {\n                values.push(id)\n            }\n        });\n        $(\"#\" + opts.targetDiv).empty();\n        opts.dataset = ptree.copy_dataset(pedcache.current(opts));\n\n        function markAsCheked(ids) {\n            ids.map((id) => {\n                d3.select('#s_' + id).property('checked', true)\n            })\n        }\n\n        if (values.includes('all')) {\n            values = switches;\n            markAsCheked(switches)\n        } else {\n            markAsCheked(values)\n        }\n\n        pedcache.save_hierarchy_settings(opts, hierarchy, JSON.stringify(values));\n\n    };\n\n})(window.legend = window.legend || {}, jQuery);","(function (panZoom, $) {\n    panZoom.config = {\n        zoom: {\n            zoomHandle: {\n                minTop: 0,\n                maxTop:92,\n                zoomStep:5,\n                panStep:30,\n                zoom:1,\n                minZoom:0.1,\n                maxZoom:2\n            }\n        }\n    };\n\n    function getZoomValue(opts, topPosition){\n        let config  = panZoom.config.zoom.zoomHandle;\n        let scale  =  d3.scaleLinear().domain([config.maxTop,config.minTop]).range([opts.zoomIn, opts.zoomOut]);\n        return scale(topPosition);\n    }\n\n    function getTopValue(opts, zoom){\n        let config  = panZoom.config.zoom.zoomHandle;\n        let scale  =  d3.scaleLinear().domain([opts.zoomIn, opts.zoomOut]).range([ config.maxTop, config.minTop]);\n        return scale(zoom);\n    }\n\n    panZoom.updatePedigreeDiagram = function(opts, x, y, zoom){\n        pedcache.setposition(opts, x, y, zoom);\n        d3.select('.diagram').attr('transform', 'translate(' + x + ',' + y + ') scale(' + zoom + ')');\n    };\n\n    panZoom.updateXYTransform = function(opts, x, y, zoom){\n        let $zoomHandle =  $( \".zoom-handle\" );\n        $zoomHandle.css({ top: getTopValue(opts, parseFloat(zoom))});\n    };\n\n    panZoom.add = function(opts){\n        let $viewControl = $('.view-controls');\n        if($viewControl.length>0){\n            $viewControl.remove();\n        }\n        if(!opts.showPanZoomControl && !panZoom.config.isFullScreenMode)return;\n        $( `#${opts.targetDiv}`).append(\n                `<div class=\"view-controls\"><div class=\"view-controls-pan field-no-user-select\" title=\"Pan\">\n<span class=\"view-control-pan pan-up fa fa-fw fa-arrow-up\" title=\"Pan up\"></span>\n<span class=\"view-control-pan pan-right fa fa-fw fa-arrow-right\" title=\"Pan right\">\n</span><span class=\"view-control-pan pan-down fa fa-fw fa-arrow-down\" title=\"Pan down\">\n</span><span class=\"view-control-pan pan-left fa fa-fw fa-arrow-left\" title=\"Pan left\">\n</span><span class=\"view-control-pan pan-home fa fa-fw fa-user\" title=\"Pan home\"></span>\n</div><div class=\"view-controls-zoom field-no-user-select\" title=\"Zoom\">\n<div class=\"field-no-user-select zoom-button zoom-in fa fa-fw fa-search-plus\" title=\"Zoom in\">\n</div><div class=\"field-no-user-select zoom-track\" style=\"height: 100px;\">\n<div class=\"field-no-user-select zoom-handle selected\" title=\"Drag to zoom\" style=\"top: 85px; position: relative;\">\n</div></div><div class=\"field-no-user-select zoom-button zoom-out fa fa-fw fa-search-minus\" title=\"Zoom out\"></div>\n<div class=\"field-no-user-select zoom-crt-value\"></div></div></div>`);\n        //make the zoom handle draggable\n        let $zoomHandle =  $( \".zoom-handle\" );\n        let xytransform = pedcache.getposition(opts);\n        let xtransform = xytransform[0]!==null? xytransform[0]:0;\n        let ytransform = xytransform[1] !==null? xytransform[1]:0;\n        let zoom = 1;\n        if(xytransform.length === 3) {\n            zoom = xytransform[2];\n        }\n        $zoomHandle.css({ top: getTopValue(opts, zoom)});\n        $zoomHandle.draggable({\n            axis: \"y\",\n            drag:function (event, ui) {\n                ui.position.top = Math.max( panZoom.config.zoom.zoomHandle.minTop, ui.position.top);\n                ui.position.top = Math.min( panZoom.config.zoom.zoomHandle.maxTop, ui.position.top);\n                var xytransform = pedcache.getposition(opts);  // cached position\n                var xtransform = xytransform[0];\n                var ytransform = xytransform[1];\n                panZoom.svg.call(panZoom.zoom.transform, d3.zoomIdentity.translate(xtransform, ytransform).scale(getZoomValue(opts,ui.position.top)));\n            }\n        });\n            registerClickListeners(opts);\n    };\n\n    panZoom.translateX = function (opts, value) {\n        var xytransform = pedcache.getposition(opts);  // cached position\n        var xtransform = xytransform[0]!== null ? xytransform[0] : 0;\n        var ytransform = xytransform[1]!== null ? xytransform[1] : 0;\n        let zoom = 1;\n        if (xytransform.length === 3) {\n            zoom = xytransform[2];\n        }\n        panZoom.svg.call(panZoom.zoom.transform, d3.zoomIdentity.translate(xtransform, ytransform).scale(zoom));\n        panZoom.updatePedigreeDiagram(opts,parseFloat(xtransform) + value, ytransform, zoom);\n    };\n\n    panZoom.translateY = function (opts, value) {\n        var xytransform = pedcache.getposition(opts);  // cached position\n        var xtransform = xytransform[0]!== null ? xytransform[0] : 0;\n        var ytransform = xytransform[1]!== null ? xytransform[1] : 0;\n        let zoom = 1;\n        if (xytransform.length === 3) {\n            zoom = xytransform[2];\n        }\n        panZoom.svg.call(panZoom.zoom.transform, d3.zoomIdentity.translate(xtransform, ytransform).scale(zoom));\n        panZoom.updatePedigreeDiagram(opts,parseFloat(xtransform),parseFloat(ytransform)+value,zoom);\n    };\n\n    function registerClickListenersForPan(opts){\n        let dimension;\n        let config = panZoom.config.zoom.zoomHandle;\n        $('.fa-arrow-up').on('click', function () {\n           panZoom.translateY(opts, -config.panStep)\n        });\n        $('.fa-arrow-right').on('click', function () {\n            panZoom.translateX(opts, config.panStep);\n        });\n        $('.fa-arrow-down').on('click', function () {\n            panZoom.translateY(opts, config.panStep)\n        });\n        $('.fa-arrow-left').on('click', function () {\n           panZoom.translateX(opts, -config.panStep);\n        });\n\n        $('.fa-user').on('click', function () {\n            var xytransform = pedcache.getposition(opts);  // cached position\n            var xtransform = xytransform[0]!== null ? xytransform[0] : 0;\n            var ytransform = xytransform[1]!== null ? xytransform[1] : 0;\n            let zoom = 1;\n            if (xytransform.length === 3) {\n                zoom = xytransform[2];\n            }\n            let bRect = d3.select('.diagram').node().getBoundingClientRect();\n            panZoom.svg.call(panZoom.zoom.transform, d3.zoomIdentity.translate((window.innerWidth/2 - bRect.width/4), window.innerHeight/2 - bRect.width/4).scale(zoom));\n        });\n    }\n\n    function registerClickListeners(opts) {\n        registerClickListenersForPan(opts);\n        let xytransform = pedcache.getposition(opts);\n        let xtransform = xytransform[0]!==null? xytransform[0]:0;\n        let ytransform = xytransform[1] !== null?  xytransform[1]:0;\n        let $zoomHandle =  $( \".zoom-handle\" );\n        let topValue;\n        let config = panZoom.config.zoom.zoomHandle;\n        $('.fa-search-plus').on('click', function () {\n            let topValueStr = $zoomHandle.css('top');\n            topValueStr =  topValueStr.substring(0, topValueStr.length-2);\n            topValue = Math.max(config.minTop, parseFloat(topValueStr,10)-config.zoomStep);\n            var xytransform = pedcache.getposition(opts);  // cached position\n            var xtransform = xytransform[0];\n            var ytransform = xytransform[1];\n            panZoom.svg.call(panZoom.zoom.transform, d3.zoomIdentity.translate(xtransform, ytransform).scale(getZoomValue(opts, topValue)));\n            panZoom.updateXYTransform(opts, xtransform,ytransform,getZoomValue(opts, topValue));\n        });\n\n        $('.fa-search-minus').on('click', function () {\n            let topValueStr = $zoomHandle.css('top');\n            topValueStr =  topValueStr.substring(0, topValueStr.length-2);\n            topValue = Math.min(config.maxTop, parseFloat(topValueStr,10)+config.zoomStep);\n            var xytransform = pedcache.getposition(opts);  // cached position\n            var xtransform = xytransform[0];\n            var ytransform = xytransform[1];\n            panZoom.svg.call(panZoom.zoom.transform, d3.zoomIdentity.translate(xtransform, ytransform).scale(getZoomValue(opts, topValue)));\n            panZoom.updateXYTransform(opts, xtransform,ytransform,getZoomValue(opts, topValue));\n        });\n\n    }\n\n\n\n})(window.panZoom = window.panZoom || {}, jQuery);","// Pedigree Tree Utils\n(function (pedigree_util, $, undefined) {\n\n    pedigree_util.buildTree = function (opts, person, root, partnerLinks, id) {\n        if (typeof person.children === typeof undefined)\n            person.children = pedigree_util.getChildren(opts.dataset, person);\n\n        if (typeof partnerLinks === typeof undefined) {\n            partnerLinks = [];\n            id = 1;\n        }\n\n        var nodes = pedigree_util.flatten(root);\n        //console.log('NAME='+person.name+' NO. CHILDREN='+person.children.length);\n        var partners = [];\n        $.each(person.children, function (i, child) {\n            $.each(opts.dataset, function (j, p) {\n                if (((child.name === p.mother) || (child.name === p.father)) && child.id === undefined) {\n                    var m = pedigree_util.getNodeByName(nodes, p.mother);\n                    var f = pedigree_util.getNodeByName(nodes, p.father);\n                    m = (m !== undefined ? m : pedigree_util.getNodeByName(opts.dataset, p.mother));\n                    f = (f !== undefined ? f : pedigree_util.getNodeByName(opts.dataset, p.father));\n                    if (!contains_parent(partners, m, f))\n                        partners.push({'mother': m, 'father': f});\n                }\n            });\n        });\n        $.merge(partnerLinks, partners);\n\n        $.each(partners, function (i, ptr) {\n            var mother = ptr.mother;\n            var father = ptr.father;\n            mother.children = [];\n            var parent = {\n                name: ptree.makeid(4),\n                hidden: true,\n                parent: null,\n                father: father,\n                mother: mother,\n                children: pedigree_util.getChildren(opts.dataset, mother, father)\n            };\n\n            var midx = pedigree_util.getIdxByName(opts.dataset, mother.name);\n            var fidx = pedigree_util.getIdxByName(opts.dataset, father.name);\n            if (!('id' in father) && !('id' in mother))\n                id = setChildrenId(person.children, id);\n\n            // look at grandparents index\n            var gp = pedigree_util.get_grandparents_idx(opts.dataset, midx, fidx);\n            if (gp.fidx < gp.midx) {\n                father.id = id++;\n                parent.id = id++;\n                mother.id = id++;\n            } else {\n                mother.id = id++;\n                parent.id = id++;\n                father.id = id++;\n            }\n            id = updateParent(mother, parent, id, nodes, opts);\n            id = updateParent(father, parent, id, nodes, opts);\n            person.children.push(parent);\n        });\n        id = setChildrenId(person.children, id);\n\n        $.each(person.children, function (i, p) {\n            id = pedigree_util.buildTree(opts, p, root, partnerLinks, id)[1];\n        });\n        return [partnerLinks, id];\n    };\n\n    // update parent node and sort twins\n    function updateParent(p, parent, id, nodes, opts) {\n        // add to parent node\n        if ('parent_node' in p)\n            p.parent_node.push(parent);\n        else\n            p.parent_node = [parent];\n\n        // check twins lie next to each other\n        if (p.mztwin || p.dztwins) {\n            var twins = pedigree_util.getTwins(opts.dataset, p);\n            for (var i = 0; i < twins.length; i++) {\n                var twin = pedigree_util.getNodeByName(nodes, twins[i].name);\n                if (twin)\n                    twin.id = id++;\n            }\n        }\n        return id;\n    }\n\n    function setChildrenId(children, id) {\n        // sort twins to lie next to each other\n        children.sort(function (a, b) {\n            if (a.mztwin && b.mztwin && a.mztwin == b.mztwin)\n                return 0;\n            else if (a.dztwin && b.dztwin && a.dztwin == b.dztwin)\n                return 0;\n            else if (a.mztwin || b.mztwin || a.dztwin || b.dztwin)\n                return 1;\n            return 0;\n        });\n\n        $.each(children, function (i, p) {\n            if (p.id === undefined) p.id = id++;\n        });\n        return id;\n    }\n\n    pedigree_util.isProband = function (obj) {\n        return typeof $(obj).attr('proband') !== typeof undefined && $(obj).attr('proband') !== false;\n    };\n\n    pedigree_util.setProband = function (dataset, name, is_proband) {\n        $.each(dataset, function (i, p) {\n            if (name === p.name)\n                p.proband = is_proband;\n            else\n                delete p.proband;\n        });\n    };\n\n    pedigree_util.getProbandIndex = function (dataset) {\n        var proband;\n        $.each(dataset, function (i, val) {\n            if (pedigree_util.isProband(val)) {\n                proband = i;\n                return proband;\n            }\n        });\n        return proband;\n    };\n\n    pedigree_util.getChildren = function (dataset, mother, father) {\n        var children = [];\n        if (mother.sex === 'F')\n            $.each(dataset, function (i, p) {\n                if (mother.name === p.mother)\n                    if (!father || father.name == p.father)\n                        children.push(p);\n            });\n        return children;\n    };\n\n    function contains_parent(arr, m, f) {\n        for (var i = 0; i < arr.length; i++)\n            if (arr[i].mother === m && arr[i].father === f)\n                return true;\n        return false;\n    }\n\n    // get the siblings of a given individual - sex is an optional parameter\n    // for only returning brothers or sisters\n    pedigree_util.getSiblings = function (dataset, person, sex) {\n        if (!person.mother || person.noparents)\n            return [];\n\n        return $.map(dataset, function (p, i) {\n            return p.name !== person.name && !('noparents' in p) && p.mother &&\n            (p.mother === person.mother && p.father === person.father) &&\n            (!sex || p.sex == sex) ? p : null;\n        });\n    };\n\n    // get the siblings + adopted siblings\n    pedigree_util.getAllSiblings = function (dataset, person, sex) {\n        return $.map(dataset, function (p, i) {\n            return p.name !== person.name && !('noparents' in p) && p.mother &&\n            (p.mother === person.mother && p.father === person.father) &&\n            (!sex || p.sex == sex) ? p : null;\n        });\n    };\n\n    // get the mono/di-zygotic twin(s)\n    pedigree_util.getTwins = function (dataset, person) {\n        var sibs = pedigree_util.getSiblings(dataset, person);\n        var twin_type = (person.mztwin ? \"mztwin\" : \"dztwin\");\n        return $.map(sibs, function (p, i) {\n            return p.name !== person.name && p[twin_type] == person[twin_type] ? p : null;\n        });\n    };\n\n    // get the adopted siblings of a given individual\n    pedigree_util.getAdoptedSiblings = function (dataset, person) {\n        return $.map(dataset, function (p, i) {\n            return p.name !== person.name && 'noparents' in p &&\n            (p.mother === person.mother && p.father === person.father) ? p : null;\n        });\n    };\n\n    pedigree_util.getAllChildren = function (dataset, person, sex) {\n        return $.map(dataset, function (p, i) {\n            return !('noparents' in p) &&\n            (p.mother === person.name || p.father === person.name) &&\n            (!sex || p.sex === sex) ? p : null;\n        });\n    };\n\n    // get the depth of the given person from the root\n    pedigree_util.getDepth = function (dataset, name) {\n        var idx = pedigree_util.getIdxByName(dataset, name);\n        var depth = 1;\n\n        while (idx >= 0 && ('mother' in dataset[idx] || dataset[idx].top_level)) {\n            idx = pedigree_util.getIdxByName(dataset, dataset[idx].mother);\n            depth++;\n        }\n        return depth;\n    };\n\n    // given an array of people get an index for a given person\n    pedigree_util.getIdxByName = function (arr, name) {\n        var idx = -1;\n        $.each(arr, function (i, p) {\n            if (name === p.name) {\n                idx = i;\n                return idx;\n            }\n        });\n        return idx;\n    };\n\n    // get the nodes at a given depth sorted by their x position\n    pedigree_util.getNodesAtDepth = function (fnodes, depth, exclude_names) {\n        return $.map(fnodes, function (p, i) {\n            return p.depth == depth && !p.data.hidden && $.inArray(p.data.name, exclude_names) == -1 ? p : null;\n        }).sort(function (a, b) {\n            return a.x - b.x;\n        });\n    };\n\n    // convert the partner names into corresponding tree nodes\n    pedigree_util.linkNodes = function (flattenNodes, partners) {\n        var links = [];\n        for (var i = 0; i < partners.length; i++)\n            links.push({\n                'mother': pedigree_util.getNodeByName(flattenNodes, partners[i].mother.name),\n                'father': pedigree_util.getNodeByName(flattenNodes, partners[i].father.name)\n            });\n        return links;\n    };\n\n    // get ancestors of a node\n    pedigree_util.ancestors = function (dataset, node) {\n        var ancestors = [];\n\n        function recurse(node) {\n            if (node.data) node = node.data;\n            if ('mother' in node && 'father' in node && !('noparents' in node)) {\n                recurse(pedigree_util.getNodeByName(dataset, node.mother));\n                recurse(pedigree_util.getNodeByName(dataset, node.father));\n            }\n            ancestors.push(node);\n        }\n\n        recurse(node);\n        return ancestors;\n    }\n\n    // test if two nodes are consanguinous partners\n    pedigree_util.consanguity = function (node1, node2, opts) {\n        var ancestors1 = pedigree_util.ancestors(opts.dataset, node1);\n        var ancestors2 = pedigree_util.ancestors(opts.dataset, node2);\n        var names1 = $.map(ancestors1, function (ancestor, i) {\n            return ancestor.name;\n        });\n        var names2 = $.map(ancestors2, function (ancestor, i) {\n            return ancestor.name;\n        });\n        // Detect common ancestor and also allow a flag on a child to turn on consang. parents too. This allows this to be\n        // expressed in a partial pedigree i.e. where there are not enough generations shown to model consanguity normally.\n        return names1.some(function (name) {\n                return names2.indexOf(name) !== -1;\n            }) ||\n            pedigree_util.getChildren(opts.dataset, node1.data, node2.data).some(function (it) {\n                return it.consanguineous_parents;\n            });\n    }\n\n    // return a flattened representation of the tree\n    pedigree_util.flatten = function (root) {\n        var flat = [];\n\n        function recurse(node) {\n            if (node.children)\n                node.children.forEach(recurse);\n            flat.push(node);\n        }\n\n        recurse(root);\n        return flat;\n    };\n\n    // Adjust D3 layout positioning.\n    // Position hidden parent node centring them between father and mother nodes. Remove kinks\n    // from links - e.g. where there is a single child plus a hidden child\n    pedigree_util.adjust_coords = function (opts, root, flattenNodes) {\n        function recurse(node) {\n            if (node.children) {\n                node.children.forEach(recurse);\n\n                if (node.data.father !== undefined) { \t// hidden nodes\n                    var father = pedigree_util.getNodeByName(flattenNodes, node.data.father.name);\n                    var mother = pedigree_util.getNodeByName(flattenNodes, node.data.mother.name);\n                    var xmid = (father.x + mother.x) / 2;\n                    if (!pedigree_util.overlap(opts, root.descendants(), xmid, node.depth, [node.data.name])) {\n                        node.x = xmid;   // centralise parent nodes\n                        var diff = node.x - xmid;\n                        if (node.children.length == 2 && (node.children[0].data.hidden || node.children[1].data.hidden)) {\n                            if (!(node.children[0].data.hidden && node.children[1].data.hidden)) {\n                                var child1 = (node.children[0].data.hidden ? node.children[1] : node.children[0]);\n                                var child2 = (node.children[0].data.hidden ? node.children[0] : node.children[1]);\n                                if (((child1.x < child2.x && xmid < child2.x) || (child1.x > child2.x && xmid > child2.x)) &&\n                                    !pedigree_util.overlap(opts, root.descendants(), xmid, child1.depth, [child1.data.name])) {\n                                    child1.x = xmid;\n                                }\n                            }\n                        } else if (node.children.length == 1 && !node.children[0].data.hidden) {\n                            if (!pedigree_util.overlap(opts, root.descendants(), xmid, node.children[0].depth, [node.children[0].data.name]))\n                                node.children[0].x = xmid;\n                        } else {\n                            if (diff !== 0 && !nodesOverlap(opts, node, diff, root)) {\n                                if (node.children.length == 1) {\n                                    node.children[0].x = xmid;\n                                } else {\n                                    var descendants = node.descendants();\n                                    if (opts.DEBUG)\n                                        console.log('ADJUSTING ' + node.data.name + ' NO. DESCENDANTS ' + descendants.length + ' diff=' + diff);\n                                    for (var i = 0; i < descendants.length; i++) {\n                                        if (node.data.name !== descendants[i].data.name)\n                                            descendants[i].x -= diff;\n                                    }\n                                }\n                            }\n                        }\n                    } else if ((node.x < father.x && node.x < mother.x) || (node.x > father.x && node.x > mother.x)) {\n                        node.x = xmid;   // centralise parent nodes if it doesn't lie between mother and father\n                    }\n                }\n            }\n        }\n\n        recurse(root);\n        recurse(root);\n    };\n\n    // test if moving siblings by diff overlaps with other nodes\n    function nodesOverlap(opts, node, diff, root) {\n        var descendants = node.descendants();\n        var descendantsNames = $.map(descendants, function (descendant, i) {\n            return descendant.data.name;\n        });\n        var nodes = root.descendants();\n        for (var i = 0; i < descendants.length; i++) {\n            var descendant = descendants[i];\n            if (node.data.name !== descendant.data.name) {\n                var xnew = descendant.x - diff;\n                if (pedigree_util.overlap(opts, nodes, xnew, descendant.depth, descendantsNames))\n                    return true;\n            }\n        }\n        return false;\n    }\n\n    // test if x position overlaps a node at the same depth\n    pedigree_util.overlap = function (opts, nodes, xnew, depth, exclude_names) {\n        for (var n = 0; n < nodes.length; n++) {\n            if (depth == nodes[n].depth && $.inArray(nodes[n].data.name, exclude_names) == -1) {\n                if (Math.abs(xnew - nodes[n].x) < (opts.symbol_size * 1.15))\n                    return true;\n            }\n        }\n        return false;\n    };\n\n    // given a persons name return the corresponding d3 tree node\n    pedigree_util.getNodeByName = function (nodes, name) {\n        for (var i = 0; i < nodes.length; i++) {\n            if (nodes[i].data && name === nodes[i].data.name)\n                return nodes[i];\n            else if (name === nodes[i].name)\n                return nodes[i];\n        }\n    };\n\n    // given the name of a url param get the value\n    pedigree_util.urlParam = function (name) {\n        var results = new RegExp('[\\?&]' + name + '=([^&#]*)').exec(window.location.href);\n        if (results === null)\n            return null;\n        else\n            return results[1] || 0;\n    };\n\n    // get grandparents index\n    pedigree_util.get_grandparents_idx = function (dataset, midx, fidx) {\n        var gmidx = midx;\n        var gfidx = fidx;\n        while ('mother' in dataset[gmidx] && 'mother' in dataset[gfidx] &&\n        !('noparents' in dataset[gmidx]) && !('noparents' in dataset[gfidx])) {\n            gmidx = pedigree_util.getIdxByName(dataset, dataset[gmidx].mother);\n            gfidx = pedigree_util.getIdxByName(dataset, dataset[gfidx].mother);\n        }\n        return {'midx': gmidx, 'fidx': gfidx};\n    };\n\n    // Set or remove proband attributes.\n    // If a value is not provided the attribute is removed from the proband.\n    pedigree_util.proband_attr = function (opts, key, value) {\n        var newdataset = ptree.copy_dataset(pedcache.current(opts));\n        var proband = newdataset[pedigree_util.getProbandIndex(newdataset)];\n        if (!proband) {\n            console.warn(\"No proband defined\");\n            return;\n        }\n        if (value) {\n            if (key in proband) {\n                if (proband[key] === value)\n                    return;\n                try {\n                    if (JSON.stringify(proband[key]) === JSON.stringify(value))\n                        return;\n                } catch (e) {\n                }\n            }\n            proband[key] = value;\n        } else {\n            if (key in proband)\n                delete proband[key];\n            else\n                return;\n        }\n        ptree.syncTwins(newdataset, proband);\n        opts.dataset = newdataset;\n        ptree.rebuild(opts);\n    }\n\n    // add a child to the proband; giveb sex, age, yob and breastfeeding months (optional)\n    pedigree_util.proband_add_child = function (opts, sex, age, yob, breastfeeding) {\n        var newdataset = ptree.copy_dataset(pedcache.current(opts));\n        var proband = newdataset[pedigree_util.getProbandIndex(newdataset)];\n        if (!proband) {\n            console.warn(\"No proband defined\");\n            return;\n        }\n        var newchild = ptree.addchild(newdataset, proband, sex, 1)[0];\n        newchild.age = age;\n        newchild.yob = yob;\n        if (breastfeeding !== undefined)\n            newchild.breastfeeding = breastfeeding;\n        opts.dataset = newdataset;\n        ptree.rebuild(opts);\n        return newchild.name;\n    }\n\n    // check by name if the individual exists\n    pedigree_util.exists = function (opts, name) {\n        return pedigree_util.getNodeByName(pedcache.current(opts), name) !== undefined;\n    };\n\n    //check if a node is a childNode\n    pedigree_util.isChildNode = function(opts, name){\n        let newdataset = ptree.copy_dataset(pedcache.current(opts));\n        let result =[];\n        newdataset.map((d)=>{\n            if(d.father===name||d.mother===name){\n                result.push(d)\n            }\n        });\n        return result.length===0\n    };\n\n    // print options and dataset\n    pedigree_util.print_opts = function (opts) {\n        $(\"#pedigree_data\").remove();\n        $(\"body\").append(\"<div id='pedigree_data'></div>\");\n        var key;\n        for (var i = 0; i < opts.dataset.length; i++) {\n            var person = \"<div class='row'><strong class='col-md-1 text-right'>\" + opts.dataset[i].name + \"</strong><div class='col-md-11'>\";\n            for (key in opts.dataset[i]) {\n                if (key === 'name') continue;\n                if (key === 'parent')\n                    person += \"<span>\" + key + \":\" + opts.dataset[i][key].name + \"; </span>\";\n                else if (key === 'children') {\n                    if (opts.dataset[i][key][0] !== undefined)\n                        person += \"<span>\" + key + \":\" + opts.dataset[i][key][0].name + \"; </span>\";\n                } else\n                    person += \"<span>\" + key + \":\" + opts.dataset[i][key] + \"; </span>\";\n            }\n            $(\"#pedigree_data\").append(person + \"</div></div>\");\n\n        }\n        $(\"#pedigree_data\").append(\"<br /><br />\");\n        for (key in opts) {\n            if (key === 'dataset') continue;\n            $(\"#pedigree_data\").append(\"<span>\" + key + \":\" + opts[key] + \"; </span>\");\n        }\n    };\n}(window.pedigree_util = window.pedigree_util || {}, jQuery));\n\n\n// Pedigree Tree Builder\n(function (ptree, $, undefined) {\n    ptree.roots = {};\n\n    function appendDonorCircles(node, opts) {\n        function circlePath(cx, cy, r) {\n            return 'm ' + cx + ' ' + (-cy) + ' m -' + r + ', 0 a ' + r + ',' + r + ' 0 1,0 ' + (r * 2) + ',0 a ' + r + ',' + r + ' 0 1,0 -' + (r * 2) + ',0';\n        }\n        function offset(d) {\n            let offset=0;\n           if(d.data.status === 4 || d.data.status === 6){\n                offset = -0.36 * opts.symbol_size;\n            }\n            else if(d.data.sex ==='F'){\n                offset = -0.08 * opts.symbol_size;\n            }  else if(d.data.sex ==='U'){\n                offset = -0.20 * opts.symbol_size;\n            }\n            return offset\n        }\n        const INSIDE_OFFSET = opts.symbol_size/2;\n        const ICON_SIZE = opts.symbol_size * (2.5/3);\n        let offsetY = 0.04*opts.symbol_size;\n        node.append('text')\n            .filter(function (d) {\n                return !d.data.hidden && (d.data.conceived_by_donor_egg);\n            })\n            .attr('x', function () {\n                return 1.5 * opts.symbol_size;\n            })\n            .style('text-anchor', 'middle')\n            .attr('y', function (d) {\n                return -(INSIDE_OFFSET + 0.5*opts.symbol_size+ ICON_SIZE/2-4) + offset(d)-offsetY\n            }).text('D');\n        node.append(\"path\")\n            .filter(function (d) {\n                return !d.data.hidden && (d.data.conceived_by_donor_egg);\n            }).attr(\"d\", function (d) {\n            return `M 0,${-INSIDE_OFFSET+offset(d)} \n            l ${1.5 * opts.symbol_size},${-0.5*opts.symbol_size} \n            ${circlePath(0, ICON_SIZE/2+offsetY,ICON_SIZE/2+offsetY)}`})\n            .attr(\"shape-rendering\", \"geometricPrecision\")\n            .style(\"stroke\", 'grey')\n            .style(\"stroke-width\", function (d) {\n            return \".05em\";})\n            .style('fill', 'transparent');\n        node.append('text')\n            .filter(function (d) {\n                return !d.data.hidden && (d.data.conceived_by_donor_sperm);\n            })\n            .attr('x', function () {\n                return -1.5 * opts.symbol_size;\n            })\n            .attr('y', function (d) {\n                return -(INSIDE_OFFSET + 0.5*opts.symbol_size+ ICON_SIZE/2-4) + offset(d)\n            })\n            .style('text-anchor', 'middle')\n            .text('D');\n        node.append(\"path\")\n            .filter(function (d) {\n                return !d.data.hidden && (d.data.conceived_by_donor_sperm);\n            }).attr(\"d\", function (d) {\n            return `M 0, ${-INSIDE_OFFSET+offset(d)} l ${-1.5 * opts.symbol_size},${-0.5*opts.symbol_size} \n            m ${-ICON_SIZE/2}  ${-ICON_SIZE} l ${ICON_SIZE} ,0 0,${ICON_SIZE}   ${-ICON_SIZE},0 z\n            `\n        }).style(\"stroke\", 'grey').style(\"stroke-width\", function (d) {\n            return \".05em\";\n        }).style('fill', 'transparent');\n    }\n\n    ptree.build = function (options) {\n        var opts = $.extend({ // defaults\n            targetDiv: 'pedigree_edit',\n            dataset: [{\"name\": \"m21\", \"display_name\": \"father\", \"sex\": \"M\", \"top_level\": true},\n                {\"name\": \"f21\", \"display_name\": \"mother\", \"sex\": \"F\", \"top_level\": true},\n                {\"name\": \"ch1\", \"display_name\": \"me\", \"sex\": \"F\", \"mother\": \"f21\", \"father\": \"m21\", \"proband\": true}],\n            width: 600,\n            height: 400,\n            symbol_size: 35,\n            zoomIn: 1.0,\n            zoomOut: 1.0,\n            diseases: [{'type': 'breast_cancer', 'colour': '#F68F35'},\n                {'type': 'ovarian_cancer', 'colour': '#4DAA4D'},\n                {'type': 'pancreatic_cancer', 'colour': '#4289BA'},\n                {'type': 'prostate_cancer', 'colour': '#D5494A'}],\n            labels: ['stillbirth', 'age', 'yob', 'alleles'],\n            font_size: '.75em',\n            font_family: 'Helvetica',\n            font_weight: 700,\n            background: \"#EEE\",\n            node_background: '#fdfdfd',\n            validate: true,\n            showPanZoomControl: false,\n            DEBUG: false\n        }, options);\n        if ($(\"#fullscreen\").length === 0) {\n            // add undo, redo, fullscreen buttons and event listeners once\n            pbuttons.add(opts);\n            io.add(opts);\n        }\n\n        panZoom.add(opts);\n        legend.add(opts)\n\n        if (pedcache.nstore(opts) == -1)\n            pedcache.add(opts);\n\n        pbuttons.updateButtons(opts);\n\n        // validate pedigree data\n        ptree.validate_pedigree(opts);\n        // group top level nodes by partners\n        opts.dataset = group_top_level(opts.dataset);\n\n        //pre-process opts : Include or remove data info\n        (function () {\n            const specialRegex = new RegExp(`[ ~!@#$%^&*()|+-=?;:'\",.]`, 'gi') ;\n           //replace space in disease type with -\n            opts.diseases.forEach((disease)=>{\n                disease.type = disease.type.replace(specialRegex, '-')\n            });\n            Object.keys(opts.conditions).forEach(function(key) {\n                if(specialRegex.test( key)){\n                    let newKey =  key.replace(specialRegex, '-');\n                    let value  = opts.conditions[key];\n                    delete opts.conditions[key];\n                    opts.conditions[newKey] = value;\n                }\n            });\n        })();\n\n\n        if (opts.DEBUG)\n            pedigree_util.print_opts(opts);\n        var svg_dimensions = get_svg_dimensions(opts);\n        var svg = d3.select(\"#\" + opts.targetDiv)\n            .append(\"svg:svg\")\n            .attr(\"width\", svg_dimensions.width)\n            .attr(\"height\", svg_dimensions.height);\n\n        svg.append(\"rect\")\n            .attr(\"width\", \"100%\")\n            .attr(\"height\", \"100%\")\n            .attr(\"rx\", 6)\n            .attr(\"ry\", 6)\n            .style(\"stroke\", \"darkgrey\")\n            .style(\"fill\", opts.background) // or none\n            .style(\"stroke-width\", 1);\n\n        var xytransform = pedcache.getposition(opts);  // cached position\n        var xtransform = xytransform[0];\n        var ytransform = xytransform[1];\n        let initialZoom  = 1;\n        if (xytransform.length === 3) {\n            initialZoom = xytransform[2];\n        }\n\n        if (xtransform === null) {\n            xtransform = opts.symbol_size / 2;\n            ytransform = (-opts.symbol_size * 2.5);\n        }\n        var ped = svg.append(\"g\")\n            .attr(\"class\", \"diagram\")\n            .attr(\"transform\", \"translate(\" + xtransform + \",\" + ytransform + \") scale(\" + initialZoom + \")\");\n\n        var top_level = $.map(opts.dataset, function (val, i) {\n            return 'top_level' in val && val.top_level ? val : null;\n        });\n        var hidden_root = {\n            name: 'hidden_root',\n            id: 0,\n            hidden: true,\n            children: top_level\n        };\n\n        var partners = pedigree_util.buildTree(opts, hidden_root, hidden_root)[0];\n        var root = d3.hierarchy(hidden_root);\n        ptree.roots[opts.targetDiv] = root;\n\n        /// get score at each depth used to adjust node separation\n        var tree_dimensions = ptree.get_tree_dimensions(opts);\n        if (opts.DEBUG)\n            console.log('opts.width=' + svg_dimensions.width + ' width=' + tree_dimensions.width +\n                ' opts.height=' + svg_dimensions.height + ' height=' + tree_dimensions.height);\n\n        var treemap = d3.tree().separation(function (a, b) {\n            return a.parent === b.parent || a.data.hidden || b.data.hidden ? 1.2 : 2.2;\n        }).size([tree_dimensions.width, tree_dimensions.height]);\n\n        var nodes = treemap(root.sort(function (a, b) {\n            return a.data.id - b.data.id;\n        }));\n        var flattenNodes = nodes.descendants();\n\n        // check the number of visible nodes equals the size of the pedigree dataset\n        var vis_nodes = $.map(opts.dataset, function (p, i) {\n            return p.hidden ? null : p;\n        });\n        if (vis_nodes.length !== opts.dataset.length) {\n            throw create_err('NUMBER OF VISIBLE NODES DIFFERENT TO NUMBER IN THE DATASET');\n        }\n\n        pedigree_util.adjust_coords(opts, nodes, flattenNodes);\n\n        var ptrLinkNodes = pedigree_util.linkNodes(flattenNodes, partners);\n        check_ptr_links(opts, ptrLinkNodes);   // check for crossing of partner lines\n\n        var node = ped.selectAll(\".node\")\n            .data(nodes.descendants())\n            .enter()\n            .append(\"g\")\n            .attr(\"transform\", function (d, i) {\n                return \"translate(\" + d.x + \",\" + d.y + \")\";\n            });\n\n        // provide a border to the node\n        node.append(\"path\")\n            .filter(function (d) {\n                return !d.data.hidden;\n            })\n            .attr(\"shape-rendering\", \"geometricPrecision\")\n            .attr(\"transform\", function (d) {\n                return d.data.sex == \"U\"  && d.data.status !== 4 && d.data.status !== 6 ? \"rotate(45)\" : \"\";\n            })\n            .attr(\"d\", d3.symbol().size(function (d) {\n                return (opts.symbol_size * opts.symbol_size) + 2;\n            })\n                .type(function (d) {\n                    if (d.data.status === 4 || d.data.status == 6)\n                        return d3.symbolTriangle;\n                    return d.data.sex == \"F\" ? d3.symbolCircle : d3.symbolSquare;\n                }))\n            .style(\"stroke\", function (d) {\n                return d.data.age && d.data.yob && !d.data.exclude ? \"#303030\" : \"grey\";\n            })\n            .style(\"stroke-width\", function (d) {\n                return d.data.age && d.data.yob && !d.data.exclude ? \".3em\" : \".1em\";\n            })\n            .style(\"stroke-dasharray\", function (d) {\n                return !d.data.exclude ? null : (\"3, 3\");\n            })\n            .style(\"fill\", \"none\");\n\n        // set a clippath\n        node.append(\"clipPath\")\n            .attr(\"id\", function (d) {\n                return d.data.name;\n            }).append(\"path\")\n            .filter(function (d) {\n                return !(d.data.hidden && !opts.DEBUG);\n            })\n            .attr(\"class\", \"node\")\n            .attr(\"transform\", function (d) {\n                return d.data.sex == \"U\"  && d.data.status !== 4 && d.data.status !== 6 ? \"rotate(45)\" : \"\";\n            })\n            .attr(\"d\", d3.symbol().size(function (d) {\n                if (d.data.hidden)\n                    return opts.symbol_size * opts.symbol_size / 5;\n                return opts.symbol_size * opts.symbol_size;\n            })\n                .type(function (d) {\n                    if (d.data.status === 4 || d.data.status == 6)\n                        return d3.symbolTriangle;\n                    return d.data.sex == \"F\" ? d3.symbolCircle : d3.symbolSquare;\n                }));\n\n        //load hierarchy level settings\n        let hierarchy_settings = {};\n\n        // pie plots for disease colours\n        var pienode = node.selectAll(\"pienode\")\n            .data(function (d) {     \t\t// set the disease data for the pie plot\n                hierarchy_settings[d.depth] = pedcache.get_hierarchy_settings(opts, String(d.depth)) || [];\n                var ncancers = 0;\n                var cancers = $.map(opts.diseases, function (val, i) {\n                    if (prefixInObj(opts.diseases[i].type, d.data)) {\n                        if (opts.diseases[i].type.replace('_', ' ').includes('cancer') && opts.hasOwnProperty('show_cancer_colors') && !opts['show_cancer_colors']) {\n                            return 0;\n                        }\n                        if (opts.diseases[i].type.replace('_', ' ').includes('condition') && opts.hasOwnProperty('show_condition_colors') && !opts['show_condition_colors']) {\n                            return 0;\n                        }\n                        ncancers++;\n                        return 1;\n                    } else return 0;\n                });\n                if (ncancers === 0) cancers = [1];\n                return [$.map(cancers, function (val, i) {\n                    return {\n                        'cancer': val, 'ncancers': ncancers, 'id': d.data.name,\n                        'sex': d.data.sex, 'proband': d.data.proband, 'hidden': d.data.hidden,\n                        'affected': d.data.affected,\n                        'exclude': d.data.exclude,\n                        'carrier_status':d.data.carrier_status\n                    };\n                })];\n            })\n            .enter()\n            .append(\"g\");\n\n        pienode.selectAll(\"path\")\n            .data(d3.pie().value(function (d) {\n                return d.cancer;\n            }))\n            .enter().append(\"path\")\n            .attr(\"clip-path\", function (d) {\n                return \"url(#\" + d.data.id + \")\";\n            }) // clip the rectangle\n            .attr(\"class\", \"pienode\")\n            .attr(\"d\", d3.arc().innerRadius(0).outerRadius(opts.symbol_size))\n            .style(\"fill\", function (d, i) {\n                if(d.data.carrier_status === 'affected') {\n                    return '#7f7f7f';\n                }\n                if (d.data.exclude)\n                    return 'lightgrey';\n                if (d.data.ncancers === 0) {\n                    if (d.data.affected)\n                        return 'darkgrey';\n                    return opts.node_background;\n                }\n                return opts.diseases[i].colour;\n            });\n\n        // adopted in/out brackets\n        node.append(\"path\")\n            .filter(function (d) {\n                return !d.data.hidden && (d.data.adopted_in === true || d.data.adopted_out === true);\n            })\n            .attr(\"d\", function (d) {\n                {\n                    function get_bracket(dx, dy, indent) {\n                        return \"M\" + (dx + indent) + \",\" + dy +\n                            \"L\" + dx + \" \" + dy +\n                            \"L\" + dx + \" \" + (dy + (opts.symbol_size * 1.28)) +\n                            \"L\" + dx + \" \" + (dy + (opts.symbol_size * 1.28)) +\n                            \"L\" + (dx + indent) + \",\" + (dy + (opts.symbol_size * 1.28))\n                    }\n\n                    var dx = -(opts.symbol_size * 0.66);\n                    var dy = -(opts.symbol_size * 0.64);\n                    var indent = opts.symbol_size / 4;\n                    return get_bracket(dx, dy, indent) + get_bracket(-dx, dy, -indent);\n                }\n            })\n            .style(\"stroke\", function (d) {\n                return d.data.age && d.data.yob && !d.data.exclude ? \"#303030\" : \"grey\";\n            })\n            .style(\"stroke-width\", function (d) {\n                return \".1em\";\n            })\n            .style(\"stroke-dasharray\", function (d) {\n                return !d.data.exclude ? null : (\"3, 3\");\n            })\n            .style(\"fill\", \"none\");\n\n        //append donor circle;\n        appendDonorCircles(node, opts);\n\n        // alive status = 0; dead status = 1\n        var status = node.append('line')\n            .filter(function (d) {\n                return d.data.status === 1 || d.data.status === 5 || d.data.status === 6;\n            })\n            .style(\"stroke\", \"black\")\n            .attr(\"x1\", function (d, i) {\n                return -0.6 * opts.symbol_size;\n            })\n            .attr(\"y1\", function (d, i) {\n                return 0.6 * opts.symbol_size;\n            })\n            .attr(\"x2\", function (d, i) {\n                return 0.6 * opts.symbol_size;\n            })\n            .attr(\"y2\", function (d, i) {\n                return -0.6 * opts.symbol_size;\n            });\n\n        // names of individuals\n        addLabel(opts, node, \".25em\", -(0.4 * opts.symbol_size), (d)=>{\n                return  -(0.12 * opts.symbol_size);\n            },\n            function (d) {\n                return   d.data.individual_role && d.data.individual_role !=='none' ? d.data.individual_role : '';\n            });\n\n       /* // names of individuals\n        addLabel(opts, node, \".25em\", -(0.4 * opts.symbol_size), (d)=>{\n               if(d.data.display_name){\n                   d.y_offset = -(0.1 * opts.symbol_size);\n               }\n                return d.y_offset;\n            },\n            function (d) {\n                if (opts.DEBUG)\n                    return ('display_name' in d.data ? d.data.display_name : d.data.name) + '  ' + d.data.id;\n                return 'display_name' in d.data ? d.data.display_name : '';\n            });\n*/\n        var font_size = parseInt(getPx(opts.font_size)) + 4;\n\n\n        /*\t\tvar warn = node.filter(function (d) {\n                    return (!d.data.age || !d.data.yob) && !d.data.hidden;\n                }).append(\"text\")\n                .attr('font-family', 'FontAwesome')\n                .attr(\"x\", \".25em\")\n                .attr(\"y\", -(0.4 * opts.symbol_size), -(0.2 * opts.symbol_size))\n                .html(\"\\uf071\");\n                warn.append(\"svg:title\").text(\"incomplete\");*/\n        // display label defined in opts.labels e.g. alleles/genotype data\n        for (var ilab = 0; ilab < opts.labels.length; ilab++) {\n            var label = opts.labels[ilab];\n            addLabel(opts, node, \".25em\", -(0.7 * opts.symbol_size),\n                function (d) {\n                    if (!hierarchy_settings[d.depth].includes(label) || !d.data[label]) {\n                        if(label === 'name'){\n                            d.y_offset = (font_size * 2.25) + 10;\n                        }\n                        return;\n                    }\n                    d.y_offset = ( !d.y_offset ? (font_size * 2.25) + 10 : d.y_offset + font_size);\n                    return d.y_offset;\n                },\n                function (d) {\n                    if(!hierarchy_settings[d.depth].includes(label)){\n                        return '' ;\n                    }\n                    if (d.data[label]) {\n                        if (label === 'alleles') {\n                            var alleles = \"\";\n                            var vars = d.data.alleles.split(';');\n                            for (var ivar = 0; ivar < vars.length; ivar++) {\n                                if (vars[ivar] !== \"\") alleles += vars[ivar] + ';';\n                            }\n                            return alleles;\n                        } else if (label === 'age') {\n                            return d.data[label] + 'y';\n                        }\n                        return d.data[label];\n                    }\n                }, 'indi_details');\n        }\n        //gestation\n        addLabel(opts, node, \".25em\", -(0.7 * opts.symbol_size),\n            function (d) {\n                if (d.data.status < 2 || !d.data.gestation)\n                    return;\n                d.y_offset = (!d.y_offset ? (font_size * 2.25) + 10 : d.y_offset + font_size);\n                return d.y_offset;\n            },\n            function (d) {\n                return d.data.status > 2 && d.data.gestation ? \"GA: \" + d.data.gestation + ' weeks' : ''\n            }, 'indi_details');\n\n        addLabel(opts, node, \".25em\", -(0.7 * opts.symbol_size),\n            function (d) {\n                if (!d.data.uniqueId || !hierarchy_settings[d.depth].includes('id'))\n                    return;\n                d.y_offset = ( !d.y_offset ? (font_size * 2.25) + 10 : d.y_offset + font_size);\n                return d.y_offset;\n            },\n            function (d) {\n                return  d.data.uniqueId && hierarchy_settings[d.depth].includes('id') ? 'ID: ' + d.data.uniqueId : \"\";\n            }, 'indi_details');\n\n        // age and dob\n        addLabel(opts, node, \".25em\", -(0.4 * opts.symbol_size), (d)=> {\n            if(!hierarchy_settings[d.depth].includes('age_dob')){\n                return;\n            }\n            if(d.data.age || d.data.dob)\n            d.y_offset = d.y_offset + font_size;\n            return d.y_offset;\n            },\n            function (d) {\n                let label = '';\n                if(hierarchy_settings[d.depth].includes('age_dob')){\n                    if(d.data.age){\n                        label += d.data.age+'y'\n                    }\n                    if(d.data.dob){\n                        label += ' b. '+d.data.dob;\n                    }\n                }\n\n                return label;\n            });\n\n        // age of death and cause of death\n        addLabel(opts, node, \".25em\", -(0.4 * opts.symbol_size), (d)=> {\n                if(!hierarchy_settings[d.depth].includes('dod_cod')){\n                    return;\n                }\n                if(d.data.dage || d.data.cause_of_death)\n                    d.y_offset = d.y_offset + font_size;\n                return d.y_offset;\n            },\n            function (d) {\n                let label = '';\n                if(hierarchy_settings[d.depth].includes('dod_cod')) {\n                    if (d.data.dage) {\n                        label += 'd ' + d.data.dage + 'y'\n                    }\n                    if (d.data.cause_of_death) {\n                        label += ' ' + d.data.cause_of_death;\n                    }\n                }\n                return label;\n            });\n\n        // age of ethnicity and country_of_origin\n        addLabel(opts, node, \".25em\", -(0.4 * opts.symbol_size), (d)=> {\n            if(!hierarchy_settings[d.depth].includes('ethnicity_country'))\n                return;\n                if((d.data.ethnicity && d.data.ethnicity.length>0) || (d.data.country_of_origin && d.data.country_of_origin.length>0))\n                    d.y_offset = d.y_offset + font_size;\n                return d.y_offset;\n            },\n            function (d) {\n                let label = '';\n                if(hierarchy_settings[d.depth].includes('ethnicity_country')) {\n                    if (d.data.ethnicity && d.data.ethnicity.length > 0) {\n                        label += d.data.ethnicity[0].data_value + ' '\n                    }\n                    if (d.data.country_of_origin && d.data.country_of_origin.length > 0) {\n                        label += d.data.country_of_origin[0].data_value;\n                    }\n                }\n                return label;\n            });\n\n\n        // individuals disease details\n        const specialRegex = new RegExp(`[ ~!@#$%^&*()|+-=?;:'\",.]`, 'gi') ;\n        for (var i = 0; i < opts.diseases.length; i++) {\n            var disease = opts.diseases[i].type;\n            addLabel(opts, node, \".25em\", -(opts.symbol_size),\n                function (d) {\n                if(!hierarchy_settings[d.depth].includes('risk_factors_cancers')){\n                    return\n                }\n                    var y_offset = (d.y_offset ? d.y_offset + font_size : font_size * 2.2);\n                    for (var j = 0; j < opts.diseases.length; j++) {\n                        if (disease === opts.diseases[j].type)\n                            break;\n                        if (prefixInObj(opts.diseases[j].type, d.data))\n                            y_offset += font_size - 1;\n                    }\n                    return y_offset;\n                },\n                function (d) {\n                    d.data.conditions = d.data.conditions ||  [];\n                    if(!hierarchy_settings[d.depth].includes('risk_factors_cancers')){\n                        return\n                    }\n                    var text = '';\n                    if (disease.replace('_', ' ').includes('cancer')) {\n                        var dis = disease.replace('_', ' ').replace('cancer', 'ca.');\n                        var value = disease + '_age' in d.data ? d.data[disease + '_age'] : null;\n                        if(disease in d.data) {\n                            if (value === null) {\n                                text = dis;\n                            } else {\n                                text = dis + \": \" + value;\n                            }\n                        }\n                    }\n                    if (disease.replace('_', ' ').includes('condition')) {\n                        const condition =  d.data.conditions.find((condition)=> condition.name.replace(specialRegex, '-') + '_condition' === disease);\n                        if (condition) {\n                            var dis = opts.conditions[disease].name.toLowerCase();\n                            text = dis;\n                            if (condition.age) {\n                                text = dis + ': ' + condition.age;\n                            }\n                        }\n                    }\n                    return text;\n                }, 'indi_details');\n        }\n\n        // individuals phenotype details\n        for (var k = 0; k < opts.phenotypes.length; k++) {\n            var phenotype = opts.phenotypes[k].type;\n            addLabel(opts, node, \".25em\", -(opts.symbol_size),\n                function (d) {\n                    var y_offset = (d.y_offset ? d.y_offset + font_size : font_size * 2.2);\n                    for (var j = 0; j < opts.diseases.length; j++) {\n                        if (prefixInObj(opts.diseases[j].type, d.data))\n                            y_offset += font_size - 1;\n                    }\n                    for (var j = 0; j < opts.phenotypes.length; j++) {\n                        if (phenotype === opts.phenotypes[j].type)\n                            break;\n                        if (prefixInObj(opts.phenotypes[j].type, d.data))\n                            y_offset += font_size - 1;\n                    }\n                    return y_offset;\n                },\n                function (d) {\n                    var text = '';\n                    if (phenotype in d.data) {\n                        var dis = opts.phenotypes[k].name.toLowerCase()+' '+'ph.';\n                        text = dis;\n                    }\n                    return text;\n                }, 'indi_details');\n        }\n\n        // individuals candidate genes details\n        for (var k = 0; k < opts.candidate_genotype.length; k++) {\n            var candidate = opts.candidate_genotype[k].type;\n            addLabel(opts, node, \".25em\", -(opts.symbol_size),\n                function (d) {\n                    var y_offset = (d.y_offset ? d.y_offset + font_size : font_size * 2.2);\n                    for (var j = 0; j < opts.diseases.length; j++) {\n                        if (prefixInObj(opts.diseases[j].type, d.data))\n                            y_offset += font_size - 1;\n                    }\n                    for (var j = 0; j < opts.phenotypes.length; j++) {\n                        if (prefixInObj(opts.phenotypes[j].type, d.data))\n                            y_offset += font_size - 1;\n                    }\n                    for (var j = 0; j < opts.candidate_genotype.length; j++) {\n                        if (candidate === opts.candidate_genotype[j].type)\n                            break;\n                        if (prefixInObj(opts.candidate_genotype[j].type, d.data))\n                            y_offset += font_size - 1;\n                    }\n                    return y_offset;\n                },\n                function (d) {\n                    var text = '';\n                    if (candidate in d.data) {\n                        var dis = opts.candidate_genotype[k].name.toLowerCase()+' '+'ge. candidate genes';\n                        text = dis;\n                    }\n                    return text;\n                }, 'indi_details');\n        }\n\n        // individuals causal genes details\n        for (var k = 0; k < opts.causal_genotype.length; k++) {\n            var causal = opts.causal_genotype[k].type;\n            addLabel(opts, node, \".25em\", -(opts.symbol_size),\n                function (d) {\n                    var y_offset = (d.y_offset ? d.y_offset + font_size : font_size * 2.2);\n                    for (var j = 0; j < opts.diseases.length; j++) {\n                        if (prefixInObj(opts.diseases[j].type, d.data))\n                            y_offset += font_size - 1;\n                    }\n                    for (var j = 0; j < opts.phenotypes.length; j++) {\n                        if (prefixInObj(opts.phenotypes[j].type, d.data))\n                            y_offset += font_size - 1;\n                    }\n                    for (var j = 0; j < opts.candidate_genotype.length; j++) {\n                        if (prefixInObj(opts.candidate_genotype[j].type, d.data))\n                            y_offset += font_size - 1;\n                    }\n                    for (var j = 0; j < opts.causal_genotype.length; j++) {\n                        if (causal === opts.causal_genotype[j].type)\n                            break;\n                        if (prefixInObj(opts.causal_genotype[j].type, d.data))\n                            y_offset += font_size - 1;\n                    }\n                    return y_offset;\n                },\n                function (d) {\n                    var text = '';\n                    if (causal in d.data) {\n                        var dis = opts.causal_genotype[k].name.toLowerCase()+' '+'ge. causal genes';\n                        text = dis;\n                    }\n                    return text;\n                }, 'indi_details');\n        }\n\n        // individuals carrier genes details\n        for (var k = 0; k < opts.carrier_genotype.length; k++) {\n            var carrier = opts.carrier_genotype[k].type;\n            addLabel(opts, node, \".25em\", -(opts.symbol_size),\n                function (d) {\n                    var y_offset = (d.y_offset ? d.y_offset + font_size : font_size * 2.2);\n                    for (var j = 0; j < opts.diseases.length; j++) {\n                        if (prefixInObj(opts.diseases[j].type, d.data))\n                            y_offset += font_size - 1;\n                    }\n                    for (var j = 0; j < opts.phenotypes.length; j++) {\n                        if (prefixInObj(opts.phenotypes[j].type, d.data))\n                            y_offset += font_size - 1;\n                    }\n                    for (var j = 0; j < opts.candidate_genotype.length; j++) {\n                        if (prefixInObj(opts.candidate_genotype[j].type, d.data))\n                            y_offset += font_size - 1;\n                    }\n                    for (var j = 0; j < opts.causal_genotype.length; j++) {\n                        if (prefixInObj(opts.causal_genotype[j].type, d.data))\n                            y_offset += font_size - 1;\n                    }\n                    for (var j = 0; j < opts.carrier_genotype.length; j++) {\n                        if (carrier === opts.carrier_genotype[j].type)\n                            break;\n                        if (prefixInObj(opts.carrier_genotype[j].type, d.data))\n                            y_offset += font_size - 1;\n                    }\n                    return y_offset;\n                },\n                function (d) {\n                    var text = '';\n                    if (carrier in d.data) {\n                        var dis = opts.carrier_genotype[k].name.toLowerCase()+' '+'carrier genes';\n                        text = dis;\n                    }\n                    return text;\n                }, 'indi_details');\n        }\n\n        //show Alive and well\n        addAliveAndWellLabelAndStillBirth(opts, node, \".25em\", (0.36 * opts.symbol_size), 0.76 * opts.symbol_size,\n            function (d) {\n                    let label = '';\n                    if(d.data.status === 2){\n                        label = 'A & W';\n                    }else if(d.data.status === 5){\n                        label = 'SB';\n                    }\n                return label;\n            }, 'indi_details');\n\n\n        //draw the centre P for unknown status\n        node.filter(function (d) {\n            return !d.data.hidden && d.data.status === 3 ;\n        }).append(\"text\")\n            .attr('x', 0)\n            .attr('y', opts.symbol_size* 0.3)\n            .style('font-size', opts.symbol_size*0.8)\n            .attr('text-anchor', 'middle')\n            .text('P');\n\n        //marketBy\n        addMarketBy(opts, node, \".25em\", (0.7 * opts.symbol_size), -0.76 * opts.symbol_size,\n            function (d) {\n                return d.data.market_by_text? d.data.market_by_text.substring(0, Math.min(10, d.data.market_by_text.length)) : '';\n            }, 'indi_details');\n\n        //add heredity\n        addHeredityDetails(opts, node, 0.04 * opts.symbol_size, 0.55 * opts.symbol_size)\n        //\n\n        //Clinical tab\n        addCarrierStatus(opts, node)\n\n        widgets.addWidgets(opts, node);\n\n        // links between partners\n        var clash_depth = {};\n        partners = ped.selectAll(\".partner\")\n            .data(ptrLinkNodes)\n            .enter()\n            .insert(\"path\", \"g\")\n            .attr(\"fill\", \"none\")\n            .attr(\"stroke\", \"#000\")\n            .attr(\"shape-rendering\", \"auto\")\n            .attr('d', function (d, i) {\n                var node1 = pedigree_util.getNodeByName(flattenNodes, d.mother.data.name);\n                var node2 = pedigree_util.getNodeByName(flattenNodes, d.father.data.name);\n                var consanguity = pedigree_util.consanguity(node1, node2, opts) || (node1.data.consanguity && node1.data.consanguity === 'yes' && node2.data.consanguity === 'yes');\n                var divorced = (d.mother.data.divorced && d.mother.data.divorced === d.father.data.name);\n\n                var x1 = (d.mother.x < d.father.x ? d.mother.x : d.father.x);\n                var x2 = (d.mother.x < d.father.x ? d.father.x : d.mother.x);\n                var dy1 = d.mother.y;\n\n                // identify clashes with other nodes at the same depth\n                var clash = ptree.check_ptr_link_clashes(opts, d);\n                var path = \"\";\n                if (clash) {\n                    if (d.mother.depth in clash_depth)\n                        clash_depth[d.mother.depth] += 4;\n                    else\n                        clash_depth[d.mother.depth] = 4;\n\n                    dy1 -= clash_depth[d.mother.depth];\n                    var dx = clash_depth[d.mother.depth] + opts.symbol_size / 2 + 2;\n\n                    var parent_nodes = d.mother.data.parent_node;\n                    var parent_node_name = parent_nodes[0];\n                    for (var ii = 0; ii < parent_nodes.length; ii++) {\n                        if (parent_nodes[ii].father.name === d.father.data.name &&\n                            parent_nodes[ii].mother.name === d.mother.data.name)\n                            parent_node_name = parent_nodes[ii].name;\n                    }\n                    var parent_node = pedigree_util.getNodeByName(flattenNodes, parent_node_name);\n                    parent_node.y = dy1; // adjust hgt of parent node\n                    clash.sort(function (a, b) {\n                        return a - b;\n                    });\n\n                    var dy2 = (dy1 - opts.symbol_size / 2 - 3);\n                    // get path looping over node(s)\n                    draw_path = function (clash, dx, dy1, dy2, parent_node, cshift) {\n                        extend = function (i, l) {\n                            if (i + 1 < l)   //  && Math.abs(clash[i] - clash[i+1]) < (opts.symbol_size*1.25)\n                                return extend(++i);\n                            return i;\n                        };\n                        var path = \"\";\n                        for (var j = 0; j < clash.length; j++) {\n                            var k = extend(j, clash.length);\n                            var dx1 = clash[j] - dx - cshift;\n                            var dx2 = clash[k] + dx + cshift;\n                            if (parent_node.x > dx1 && parent_node.x < dx2)\n                                parent_node.y = dy2;\n\n                            path += \"L\" + dx1 + \",\" + (dy1 - cshift) +\n                                \"L\" + dx1 + \",\" + (dy2 - cshift) +\n                                \"L\" + dx2 + \",\" + (dy2 - cshift) +\n                                \"L\" + dx2 + \",\" + (dy1 - cshift);\n                            j = k;\n                        }\n                        return path;\n                    }\n                    path = draw_path(clash, dx, dy1, dy2, parent_node, 0);\n                }\n\n                var divorce_path = \"\";\n                if (divorced && !clash)\n                    divorce_path = \"M\" + (x1 + ((x2 - x1) * .66) + 6) + \",\" + (dy1 - 6) +\n                        \"L\" + (x1 + ((x2 - x1) * .66) - 6) + \",\" + (dy1 + 6) +\n                        \"M\" + (x1 + ((x2 - x1) * .66) + 10) + \",\" + (dy1 - 6) +\n                        \"L\" + (x1 + ((x2 - x1) * .66) - 2) + \",\" + (dy1 + 6);\n                if (consanguity) {  // consanguinous, draw double line between partners\n                    var cshift = 3;\n                    var path2 = (clash ? draw_path(clash, dx, dy1, dy2, parent_node, cshift) : \"\");\n                    return \"M\" + x1 + \",\" + dy1 + path + \"L\" + x2 + \",\" + dy1 + \",\" +\n                        \"M\" + x1 + \",\" + (dy1 - cshift) + path2 + \"L\" + x2 + \",\" + (dy1 - cshift) + divorce_path;\n                }\n                return \"M\" + x1 + \",\" + dy1 + path + \"L\" + x2 + \",\" + dy1 + divorce_path;\n            });\n\n        // links to children\n        var links = ped.selectAll(\".link\")\n            .data(root.links(nodes.descendants()))\n            .enter()\n            .filter(function (d) {\n                // filter unless debug is set\n                return (opts.DEBUG ||\n                    (d.target.data.noparents === undefined && d.source.parent !== null && !d.target.data.hidden));\n            })\n            .insert(\"path\", \"g\")\n            .attr(\"fill\", \"none\")\n            .attr(\"stroke-width\", function (d, i) {\n                if (d.target.data.noparents !== undefined || d.source.parent === null || d.target.data.hidden)\n                    return 1;\n                return (opts.DEBUG ? 2 : 1);\n            })\n            .attr(\"stroke\", function (d, i) {\n                if (d.target.data.noparents !== undefined || d.source.parent === null || d.target.data.hidden)\n                    return 'pink';\n                return \"#000\";\n            })\n            .attr(\"stroke-dasharray\", function (d, i) {\n                if (!d.target.data.adopted_in) return null;\n                var dash_len = Math.abs(d.source.y - ((d.source.y + d.target.y) / 2));\n                var dash_array = [dash_len, 0, Math.abs(d.source.x - d.target.x), 0];\n                var twins = pedigree_util.getTwins(opts.dataset, d.target.data);\n                if (twins.length >= 1) dash_len = dash_len * 3;\n                for (var usedlen = 0; usedlen < dash_len; usedlen += 10)\n                    $.merge(dash_array, [5, 5]);\n                return dash_array;\n            })\n            .attr(\"shape-rendering\", function (d, i) {\n                if (d.target.data.mztwin || d.target.data.dztwin)\n                    return \"geometricPrecision\";\n                return \"auto\";\n            })\n            .attr(\"d\", function (d, i) {\n                if (d.target.data.mztwin || d.target.data.dztwin) {\n                    // get twin position\n                    var twins = pedigree_util.getTwins(opts.dataset, d.target.data);\n                    if (twins.length >= 1) {\n                        var twinx = 0;\n                        var xmin = d.target.x;\n                        var xmax = d.target.x;\n                        for (var t = 0; t < twins.length; t++) {\n                            var thisx = pedigree_util.getNodeByName(flattenNodes, twins[t].name).x;\n                            if (xmin > thisx) xmin = thisx;\n                            if (xmax < thisx) xmax = thisx;\n                            twinx += thisx;\n                        }\n\n                        var xmid = ((d.target.x + twinx) / (twins.length + 1));\n                        var ymid = ((d.source.y + d.target.y) / 2);\n\n                        var xhbar = \"\";\n                        if (xmin === d.target.x && d.target.data.mztwin) {\n                            // horizontal bar for mztwins\n                            var xx = (xmid + d.target.x) / 2;\n                            var yy = (ymid + (d.target.y - opts.symbol_size / 2)) / 2;\n                            xhbar = \"M\" + xx + \",\" + yy +\n                                \"L\" + (xmid + (xmid - xx)) + \" \" + yy;\n                        }\n\n                        return \"M\" + (d.source.x) + \",\" + (d.source.y) +\n                            \"V\" + ymid +\n                            \"H\" + xmid +\n                            \"L\" + (d.target.x) + \" \" + (d.target.y - opts.symbol_size / 2) +\n                            xhbar;\n                    }\n                }\n\n                //draw a circle at the point of connection\n                return \"M\" + (d.source.x) + \",\" + (d.source.y) +\n                    \"V\" + ((d.source.y + d.target.y) / 2) +\n                    \"H\" + (d.target.x) +\n                    \"V\" + (d.target.y);\n            });\n\n        //draw Circle at each connection point\n        let circleNodes = root.links(nodes.descendants()).slice();\n        //console.log(circleNodes)\n        //circleNodes = circleNodes.slice(12);\n        let linksCircles = ped.selectAll(\".link-circles\")\n            .data(circleNodes)\n            .enter()\n            .append('circle')\n            .attr('opacity', (d)=> d.source.parent === null ?  0 : 1)\n            .attr('class','link-circles' )\n            .attr('r', 5)\n            .attr('cx', function (d) {\n                return d.source.x\n            })\n            .attr('cy', function (d) {\n                return d.source.y\n            })\n            .on('click', function (d) {\n                let e = d3.event;\n                widgets.openNodeLinkDialog(opts, d, e)\n            })\n            .style('fill', '#337ab7')\n            .style('stroke-width', '2')\n            .style('stroke', 'black');\n\n        // draw proband arrow\n        var probandIdx = pedigree_util.getProbandIndex(opts.dataset);\n        if (probandIdx) {\n            var probandNode = pedigree_util.getNodeByName(flattenNodes, opts.dataset[probandIdx].name);\n\n            ped.append(\"svg:defs\").append(\"svg:marker\")    // arrow head\n                .attr(\"id\", \"triangle\")\n                .attr(\"refX\", 6)\n                .attr(\"refY\", 6)\n                .attr(\"markerWidth\", 20)\n                .attr(\"markerHeight\", 20)\n                .attr(\"orient\", \"auto\")\n                .append(\"path\")\n                .attr(\"d\", \"M 0 0 12 6 0 12 3 6\")\n                .style(\"fill\", \"black\");\n\n            ped.append(\"line\")\n                .attr(\"x1\", probandNode.x - opts.symbol_size)\n                .attr(\"y1\", probandNode.y + opts.symbol_size)\n                .attr(\"x2\", probandNode.x - opts.symbol_size / 2)\n                .attr(\"y2\", probandNode.y + opts.symbol_size / 2)\n                .attr(\"stroke-width\", 1)\n                .attr(\"stroke\", \"black\")\n                .attr(\"marker-end\", \"url(#triangle)\");\n        }\n        // drag and zoom\n        let zoom = d3.zoom()\n            .scaleExtent([opts.zoomIn, opts.zoomOut])\n            .on('zoom', zoomFn);\n\n        function zoomFn(zf) {\n            var t = d3.event.transform;\n            pos = [t.x , t.y ];\n            console.log(opts.zoomIn, t)\n            ped.attr('transform', 'translate(' + pos[0] + ',' + pos[1] + ') scale(' + t.k + ')');\n            pedcache.setposition(opts, pos[0], pos[1], t.k);\n            panZoom.updateXYTransform(opts, pos[0], pos[1], t.k)\n        }\n\n        $('svg').on('drop', 'rect', function (event) {\n            var hasClass = $(this).hasClass('indi_rect');\n            if (hasClass) {\n                var selectedName = d3.select(event.target).data()[0].data.name;\n                window.drop(event, hasClass, selectedName);\n            }\n        });\n\n        $('svg').on('dragover', 'rect', function (event) {\n            window.allowDrop(event);\n        });\n\n        window.allowDrop = function (event) {\n            event.preventDefault();\n            window.drop = function (event, hasClass, selectedName) {\n                event.preventDefault();\n                if (hasClass) {\n                    var conditionName = $('#dragged-legend-name').val().trim();\n                    let dataset = pedcache.current(opts);\n                    let name = typeof (selectedName) === 'string' && selectedName.length > 0 ? selectedName : $('#id_name').val();\n                    let newdataset = ptree.copy_dataset(dataset);\n                    var person = pedigree_util.getNodeByName(newdataset, name);\n                    if (selectedName === person.name) {\n                        if (!person.hasOwnProperty(conditionName)) {\n                            person[conditionName] = true;\n                            if(conditionName.replace('_', ' ').includes('cancer')) {\n                                legend.addCancersToLegend(conditionName);\n                                legend.showCancerLegends(opts);\n                            }\n                        }\n                    }\n                    ptree.syncTwins(newdataset, person);\n                    opts.dataset = newdataset;\n                    ptree.rebuild(opts);\n                    event.preventDefault();\n                }\n            }\n        };\n        panZoom.zoom = zoom;\n        panZoom.svg = svg;\n        svg.call(zoom).call(zoom.transform, d3.zoomIdentity.translate(xtransform, ytransform).scale(initialZoom));\n        return opts;\n    };\n\n    // validate pedigree data\n    ptree.validate_pedigree = function (opts) {\n        if (opts.validate) {\n            if (typeof opts.validate == 'function') {\n                if (opts.DEBUG)\n                    console.log('CALLING CONFIGURED VALIDATION FUNCTION');\n                return opts.validate.call(this, opts);\n                ;\n            }\n\n            function create_err(err) {\n                console.error(err);\n                return new Error(err);\n            }\n\n            // check consistency of parents sex\n            var uniquenames = [];\n            for (var p = 0; p < opts.dataset.length; p++) {\n                if (!p.hidden) {\n                    if (opts.dataset[p].mother || opts.dataset[p].father) {\n                        var display_name = opts.dataset[p].display_name;\n                        if (!display_name)\n                            display_name = 'unnamed';\n                        display_name += ' (IndivID: ' + opts.dataset[p].name + ')';\n                        var mother = opts.dataset[p].mother;\n                        var father = opts.dataset[p].father;\n                        if (!mother || !father) {\n                            throw create_err('Missing parent for ' + display_name);\n                        }\n\n                        var midx = pedigree_util.getIdxByName(opts.dataset, mother);\n                        var fidx = pedigree_util.getIdxByName(opts.dataset, father);\n                        if (midx === -1)\n                            throw create_err('The mother (IndivID: ' + mother + ') of family member ' +\n                                display_name + ' is missing from the pedigree.');\n                        if (fidx === -1)\n                            throw create_err('The father (IndivID: ' + father + ') of family member ' +\n                                display_name + ' is missing from the pedigree.');\n                        if (opts.dataset[midx].sex !== \"F\")\n                            throw create_err(\"The mother of family member \" + display_name +\n                                \" is not specified as female. All mothers in the pedigree must have sex specified as 'F'.\");\n                        if (opts.dataset[fidx].sex !== \"M\")\n                            throw create_err(\"The father of family member \" + display_name +\n                                \" is not specified as male. All fathers in the pedigree must have sex specified as 'M'.\");\n                    }\n                }\n                if (!opts.dataset[p].name)\n                    throw create_err(display_name + ' has no IndivID.');\n                if ($.inArray(opts.dataset[p].name, uniquenames) > -1)\n                    throw create_err('IndivID for family member ' + display_name + ' is not unique.');\n                uniquenames.push(opts.dataset[p].name);\n            }\n            // warn if there is a break in the pedigree\n            var unconnected = ptree.unconnected(opts.dataset);\n            if (unconnected.length > 0)\n                console.warn(\"individuals unconnected to pedigree \", unconnected);\n        }\n    }\n\n    // check if the object contains a key with a given prefix\n    function prefixInObj(prefix, obj) {\n        var found = false;\n        if (obj)\n            $.each(obj, function (k, n) {\n                if (k.indexOf(prefix + \"_\") === 0 || k === prefix) {\n                    found = true;\n                    return found;\n                }\n            });\n        const specialRegex = new RegExp(`[ ~!@#$%^&*()|+-=?;:'\",.]`, 'gi') ;\n        const prefixInCondition =  obj.conditions && obj.conditions.find((condition)=> condition.name.replace(specialRegex, '-') + '_condition' === prefix)\n        return found || prefixInCondition;\n    }\n\n    // return a list of individuals that aren't connected to the target\n    ptree.unconnected = function (dataset) {\n        var target = dataset[pedigree_util.getProbandIndex(dataset)];\n        if (!target) {\n            console.warn(\"No target defined\");\n            if (dataset.length == 0) {\n                throw \"empty pedigree data set\";\n            }\n            target = dataset[0];\n        }\n        var connected = [target.name];\n        var change = true;\n        var ii = 0;\n        while (change && ii < 200) {\n            ii++;\n            var nconnect = connected.length;\n            $.each(dataset, function (idx, p) {\n                if ($.inArray(p.name, connected) != -1) {\n                    // check if this person or a partner has a parent\n                    var ptrs = get_partners(dataset, p);\n                    var has_parent = (p.name === target.name || !p.noparents);\n                    for (var i = 0; i < ptrs.length; i++) {\n                        if (!pedigree_util.getNodeByName(dataset, ptrs[i]).noparents)\n                            has_parent = true;\n                    }\n\n                    if (has_parent) {\n                        if (p.mother && $.inArray(p.mother, connected) == -1)\n                            connected.push(p.mother);\n                        if (p.father && $.inArray(p.father, connected) == -1)\n                            connected.push(p.father);\n                    }\n                } else if (!p.noparents &&\n                    ((p.mother && $.inArray(p.mother, connected) != -1) ||\n                        (p.father && $.inArray(p.father, connected) != -1))) {\n                    connected.push(p.name);\n                }\n                // include any children\n                include_children(connected, p, dataset);\n            });\n            change = (nconnect != connected.length);\n        }\n        var names = $.map(dataset, function (val, i) {\n            return val.name;\n        });\n        return $.map(names, function (name, i) {\n            return $.inArray(name, connected) == -1 ? name : null;\n        });\n    };\n\n    function include_children(connected, p, dataset) {\n        if ($.inArray(p.name, connected) == -1)\n            return;\n        combineArrays(connected, get_partners(dataset, p));\n        var children = pedigree_util.getAllChildren(dataset, p);\n        $.each(children, function (child_idx, child) {\n            if ($.inArray(child.name, connected) == -1) {\n                connected.push(child.name);\n                combineArrays(connected, get_partners(dataset, child));\n            }\n        });\n    }\n\n    // combine arrays ignoring duplicates\n    function combineArrays(arr1, arr2) {\n        for (var i = 0; i < arr2.length; i++)\n            if ($.inArray(arr2[i], arr1) == -1) arr1.push(arr2[i]);\n    }\n\n    // check for crossing of partner lines\n    function check_ptr_links(opts, ptrLinkNodes) {\n        for (var a = 0; a < ptrLinkNodes.length; a++) {\n            var clash = ptree.check_ptr_link_clashes(opts, ptrLinkNodes[a]);\n            if (clash)\n                console.log(\"CLASH :: \" + ptrLinkNodes[a].mother.data.name + \" \" + ptrLinkNodes[a].father.data.name, clash);\n        }\n    }\n\n    ptree.check_ptr_link_clashes = function (opts, anode) {\n        var root = ptree.roots[opts.targetDiv];\n        var flattenNodes = pedigree_util.flatten(root);\n        var mother, father;\n        if ('name' in anode) {\n            anode = pedigree_util.getNodeByName(flattenNodes, anode.name);\n            if (!('mother' in anode.data))\n                return null;\n            mother = pedigree_util.getNodeByName(flattenNodes, anode.data.mother);\n            father = pedigree_util.getNodeByName(flattenNodes, anode.data.father);\n        } else {\n            mother = anode.mother;\n            father = anode.father;\n        }\n\n        var x1 = (mother.x < father.x ? mother.x : father.x);\n        var x2 = (mother.x < father.x ? father.x : mother.x);\n        var dy = mother.y;\n\n        // identify clashes with other nodes at the same depth\n        var clash = $.map(flattenNodes, function (bnode, i) {\n            return !bnode.data.hidden &&\n            bnode.data.name !== mother.data.name && bnode.data.name !== father.data.name &&\n            bnode.y == dy && bnode.x > x1 && bnode.x < x2 ? bnode.x : null;\n        });\n        return clash.length > 0 ? clash : null;\n    };\n\n    function get_svg_dimensions(opts) {\n        return {\n            'width': (pbuttons.is_fullscreen() ? window.innerWidth : opts.width),\n            'height': (pbuttons.is_fullscreen() ? window.innerHeight : opts.height)\n        };\n    }\n\n    ptree.get_tree_dimensions = function (opts) {\n        /// get score at each depth used to adjust node separation\n        var svg_dimensions = get_svg_dimensions(opts);\n        var maxscore = 0;\n        var generation = {};\n        for (var i = 0; i < opts.dataset.length; i++) {\n            var depth = pedigree_util.getDepth(opts.dataset, opts.dataset[i].name);\n            var children = pedigree_util.getAllChildren(opts.dataset, opts.dataset[i]);\n\n            // score based on no. of children and if parent defined\n            var score = 1 + (children.length > 0 ? 0.55 + (children.length * 0.25) : 0) + (opts.dataset[i].father ? 0.25 : 0);\n            if (depth in generation)\n                generation[depth] += score;\n            else\n                generation[depth] = score;\n\n            if (generation[depth] > maxscore)\n                maxscore = generation[depth];\n        }\n\n        var max_depth = Object.keys(generation).length * opts.symbol_size * 3.5;\n        var tree_width = (svg_dimensions.width - opts.symbol_size > maxscore * opts.symbol_size * 1.65 ?\n            svg_dimensions.width - opts.symbol_size : maxscore * opts.symbol_size * 1.65);\n        var tree_height = (svg_dimensions.height - opts.symbol_size > max_depth ?\n            svg_dimensions.height - opts.symbol_size : max_depth);\n        return {'width': tree_width, 'height': tree_height};\n    };\n\n    // get the partners for a given node\n    function get_partners(dataset, anode) {\n        var ptrs = [];\n        for (var i = 0; i < dataset.length; i++) {\n            var bnode = dataset[i];\n            if (anode.name === bnode.mother && $.inArray(bnode.father, ptrs) == -1)\n                ptrs.push(bnode.father);\n            else if (anode.name === bnode.father && $.inArray(bnode.mother, ptrs) == -1)\n                ptrs.push(bnode.mother);\n        }\n        return ptrs;\n    }\n\n    // group top_level nodes by their partners\n    function group_top_level(dataset) {\n        // var top_level = $.map(dataset, function(val, i){return 'top_level' in val && val.top_level ? val : null;});\n        // calculate top_level nodes\n        for (var i = 0; i < dataset.length; i++) {\n            if (pedigree_util.getDepth(dataset, dataset[i].name) == 2)\n                dataset[i].top_level = true;\n        }\n\n        var top_level = [];\n        var top_level_seen = [];\n        for (i = 0; i < dataset.length; i++) {\n            var node = dataset[i];\n            if ('top_level' in node && $.inArray(node.name, top_level_seen) == -1) {\n                top_level_seen.push(node.name);\n                top_level.push(node);\n                var ptrs = get_partners(dataset, node);\n                for (var j = 0; j < ptrs.length; j++) {\n                    if ($.inArray(ptrs[j], top_level_seen) == -1) {\n                        top_level_seen.push(ptrs[j]);\n                        top_level.push(pedigree_util.getNodeByName(dataset, ptrs[j]));\n                    }\n                }\n            }\n        }\n\n        var newdataset = $.map(dataset, function (val, i) {\n            return 'top_level' in val && val.top_level ? null : val;\n        });\n        for (i = top_level.length; i > 0; --i)\n            newdataset.unshift(top_level[i - 1]);\n        return newdataset;\n    }\n\n    // get height in pixels\n    function getPx(emVal) {\n        if (emVal === parseInt(emVal, 10)) // test if integer\n            return emVal;\n\n        if (emVal.indexOf(\"px\") > -1)\n            return emVal.replace('px', '');\n        else if (emVal.indexOf(\"em\") === -1)\n            return emVal;\n        var adiv = $('<div style=\"display: none; font-size: ' + emVal + '; margin: 0; padding:0; height: auto; line-height: 1; border:0;\">&nbsp;</div>').appendTo('body');\n        var hgt = adiv.height();\n        adiv.remove();\n        return hgt;\n    };\n\n    // Add label\n    function addLabel(opts, node, size, fx, fy, ftext, class_label) {\n        if (opts.labels.includes('full_name')) {\n            fx = -50;\n        }\n        fx = fx + 25;\n        node.filter(function (d) {\n            return d.data.hidden && !opts.DEBUG ? false : true;\n        }).append(\"text\")\n            .attr(\"class\", class_label + ' ped_label' || \"ped_label\")\n            .attr(\"x\", fx)\n            .attr(\"y\", fy)\n            //.attr(\"dy\", size)\n            .attr(\"font-family\", opts.font_family)\n            .attr(\"font-size\", opts.font_size)\n            .attr(\"font-weight\", opts.font_weight)\n            .text(ftext);\n    }\n\n    function addAliveAndWellLabelAndStillBirth(opts, node, size, fx, fy, ftext, class_label) {\n        node.filter(function (d) {\n            return d.data.hidden && !opts.DEBUG ? false : true;\n        }).append(\"text\")\n            .attr(\"class\", class_label + ' ped_label' || \"ped_label\")\n            .attr(\"x\", fx)\n            .attr(\"y\", fy)\n            .attr(\"font-family\", opts.font_family)\n            .attr(\"font-size\", opts.font_size)\n            .attr(\"font-weight\", opts.font_weight)\n            .text(ftext);\n    }\n    \n    function addMarketBy(opts, node, size, fx, fy, ftext, class_label) {\n        node.filter(function (d) {\n            return d.data.hidden && !opts.DEBUG ? false : true;\n        }).append(\"text\")\n            .attr(\"class\", class_label + ' ped_label' || \"ped_label\")\n            .attr(\"x\", fx)\n            .attr(\"y\", fy)\n            .attr(\"font-family\", opts.font_family)\n            .attr(\"font-size\", opts.font_size)\n            .attr(\"font-weight\", opts.font_weight)\n            .text(ftext);\n\n        //add Icon\n        var warn = node.filter(function (d) {\n            return   !d.data.hidden && d.data.market_by_tick;\n        }).append(\"foreignObject\")\n            .attr('font-family', 'FontAwesome')\n            .attr('width', 50)\n            .attr('height', 50)\n            .attr(\"x\", fx-18)\n            .attr(\"y\", fy-14)\n            .html((d)=>{\n                switch (d.data.market_by_tick) {\n                    case 'market_na':\n                        return '';\n                    case 'market_p':\n                       return '\\uf067';\n                    case 'market_m':\n                        return '\\uf068';\n                    case 'market_s':\n                        return '\\uf069';\n                    case  'market_st':\n                        return '<i class=\"fas fa-vial\"></i>';\n                    default:\n                        return '';\n                }\n            });\n        warn.append(\"svg:title\").text(\"incomplete\");\n    }\n\n    function addHeredityDetails(opts, node, fx, fy) {\n        let x1, y1, x2, y2;\n        x1 = y1 = 0;\n        x2 = 0;\n        y2 = 8\n        let g = node.filter(function (d) {\n            return d.data.hidden && !opts.DEBUG ? false : true;\n        }).append('g')\n            .attr('opacity', function (d) {\n               return (d.data.heredity === 'Childless' ||  d.data.heredity === 'Infertile')?1: 0;\n            })\n            .attr('class', 'heredity')\n            .attr('transform', function (d) {\n                return `translate(${fx},${fy})`\n            });\n        g.append(\"line\")\n            .attr('x1', x1)\n            .attr('x2', x2)\n            .attr('y1', y1)\n            .attr('y2', y2)\n        g.append(\"line\")\n            .attr('x1', x1-4)\n            .attr('x2', x1+4)\n            .attr('y1', y2)\n            .attr('y2', y2)\n        y2 += 2;\n        g.append(\"line\")\n            .attr('opacity', function (d) {\n                return  d.data.heredity === 'Infertile'?1: 0;\n            })\n            .attr('x1', x1-4)\n            .attr('x2', x1+4)\n            .attr('y1', y2)\n            .attr('y2', y2)\n\n    }\n\n    function addCarrierStatus(opts, node){\n        let fontSize = opts.font_size * 4.5;\n       node.filter(function (d) {\n            return !(d.data.hidden && !opts.DEBUG) && (d.data.carrier_status==='carrier'|| d.data.carrier_status==='uncertain');\n        }).append(\"text\")\n            .attr('font-family', 'FontAwesome')\n            .attr(\"x\", -6)\n            .attr(\"y\", 4)\n            .html((d)=>{\n                switch (d.data.carrier_status) {\n                    case 'carrier':\n                        return '\\uf111';\n                    case 'uncertain':\n                        return '\\uf128';\n                    default:\n                        return '';\n                }\n            });\n\n      node.filter(function (d) {\n            return !(d.data.hidden && !opts.DEBUG) && (d.data.carrier_status==='asymptomatic');\n        }).append(\"line\")\n          .attr('class', 'asymptomatic')\n            .attr('x1', 0)\n            .attr('x2', 0)\n            .attr('y1', -opts.symbol_size/2)\n            .attr('y2', opts.symbol_size/2)\n    }\n\n    ptree.rebuild = function (opts) {\n        $(\"#\" + opts.targetDiv).empty();\n        pedcache.add(opts);\n        try {\n            ptree.build(opts);\n        } catch (e) {\n            console.error(e);\n            throw e;\n        }\n\n        try {\n            templates.update(opts);\n        } catch (e) {\n            // templates not declared\n        }\n        $(document).trigger('ptree.rebuild', [opts]);\n    };\n\n    ptree.copy_dataset = function (dataset) {\n        if (dataset[0].id) { // sort by id\n            dataset.sort(function (a, b) {\n                return (!a.id || !b.id ? 0 : (a.id > b.id) ? 1 : ((b.id > a.id) ? -1 : 0));\n            });\n        }\n\n        var disallowed = [\"id\", \"parent_node\"];\n        var newdataset = [];\n        for (var i = 0; i < dataset.length; i++) {\n            var obj = {};\n            for (var key in dataset[i]) {\n                if (disallowed.indexOf(key) == -1)\n                    obj[key] = dataset[i][key];\n            }\n            newdataset.push(obj);\n        }\n        return newdataset;\n    };\n\n    // add children to a given node\n    ptree.addchild = function (dataset, node, sex, nchild, twin_type, abortion) {\n        if (twin_type && $.inArray(twin_type, [\"mztwin\", \"dztwin\"]) === -1)\n            return new Error(\"INVALID TWIN TYPE SET: \" + twin_type);\n\n        if (typeof nchild === typeof undefined)\n            nchild = 1;\n        var children = pedigree_util.getAllChildren(dataset, node);\n        var ptr_name, idx;\n        if (children.length === 0) {\n            var partner = ptree.addsibling(dataset, node, node.sex === 'F' ? 'M' : 'F');\n            partner.noparents = true;\n            ptr_name = partner.name;\n            idx = pedigree_util.getIdxByName(dataset, node.name) + 1;\n        } else {\n            var c = children[0];\n            ptr_name = (c.father === node.name ? c.mother : c.father);\n            idx = pedigree_util.getIdxByName(dataset, c.name);\n        }\n\n        if (twin_type)\n            var twin_id = getUniqueTwinID(dataset, twin_type);\n        var newchildren = [];\n        for (var i = 0; i < nchild; i++) {\n            var child = {\n                \"name\": ptree.makeid(4), \"sex\": sex,\n                \"mother\": (node.sex === 'F' ? node.name : ptr_name),\n                \"father\": (node.sex === 'F' ? ptr_name : node.name)\n            };\n            if(abortion)\n                child.status = 6;\n            dataset.splice(idx, 0, child);\n\n            if (twin_type)\n                child[twin_type] = twin_id;\n            newchildren.push(child);\n        }\n        return newchildren;\n    };\n\n    //\n    ptree.addsibling = function (dataset, node, sex, add_lhs, twin_type, abortion) {\n        if (twin_type && $.inArray(twin_type, [\"mztwin\", \"dztwin\"]) === -1)\n            return new Error(\"INVALID TWIN TYPE SET: \" + twin_type);\n\n        var newbie = {\"name\": ptree.makeid(4), \"sex\": sex};\n        if(abortion)\n            newbie.status = 6;\n        if (node.top_level) {\n            newbie.top_level = true;\n        } else {\n            newbie.mother = node.mother;\n            newbie.father = node.father;\n        }\n        var idx = pedigree_util.getIdxByName(dataset, node.name);\n\n        if (twin_type) {\n            setMzTwin(dataset, dataset[idx], newbie, twin_type);\n        }\n\n        if (add_lhs) { // add to LHS\n            if (idx > 0) idx--;\n        } else\n            idx++;\n        dataset.splice(idx, 0, newbie);\n        return newbie;\n    };\n\n    // set two siblings as twins\n    function setMzTwin(dataset, d1, d2, twin_type) {\n        if (!d1[twin_type]) {\n            d1[twin_type] = getUniqueTwinID(dataset, twin_type);\n            if (!d1[twin_type])\n                return false;\n        }\n        d2[twin_type] = d1[twin_type];\n        if (d1.yob)\n            d2.yob = d1.yob;\n        if (d1.age && (d1.status == 0 || !d1.status))\n            d2.age = d1.age;\n        return true;\n    }\n\n    // get a new unique twins ID, max of 10 twins in a pedigree\n    function getUniqueTwinID(dataset, twin_type) {\n        var mz = [1, 2, 3, 4, 5, 6, 7, 8, 9, \"A\"];\n        for (var i = 0; i < dataset.length; i++) {\n            if (dataset[i][twin_type]) {\n                var idx = mz.indexOf(dataset[i][twin_type]);\n                if (idx > -1)\n                    mz.splice(idx, 1);\n            }\n        }\n        if (mz.length > 0)\n            return mz[0];\n        return undefined;\n    }\n\n    // sync attributes of twins\n    ptree.syncTwins = function (dataset, d1) {\n        if (!d1.mztwin && !d1.dztwin)\n            return;\n        var twin_type = (d1.mztwin ? \"mztwin\" : \"dztwin\");\n        for (var i = 0; i < dataset.length; i++) {\n            var d2 = dataset[i];\n            if (d2[twin_type] && d1[twin_type] == d2[twin_type] && d2.name !== d1.name) {\n                if (twin_type === \"mztwin\")\n                    d2.sex = d1.sex;\n                if (d1.yob)\n                    d2.yob = d1.yob;\n                if (d1.age && (d1.status == 0 || !d1.status))\n                    d2.age = d1.age;\n            }\n        }\n    };\n\n    // check integrity twin settings\n    function checkTwins(dataset) {\n        var twin_types = [\"mztwin\", \"dztwin\"];\n        for (var i = 0; i < dataset.length; i++) {\n            for (var j = 0; j < twin_types.length; j++) {\n                var twin_type = twin_types[j];\n                if (dataset[i][twin_type]) {\n                    var count = 0;\n                    for (var j = 0; j < dataset.length; j++) {\n                        if (dataset[j][twin_type] == dataset[i][twin_type])\n                            count++;\n                    }\n                    if (count < 2)\n                        delete dataset[i][[twin_type]];\n                }\n            }\n        }\n    }\n\n    // add parents to the 'node'\n    ptree.addparents = function (opts, dataset, name) {\n        var mother, father;\n        var root = ptree.roots[opts.targetDiv];\n        var flat_tree = pedigree_util.flatten(root);\n        var tree_node = pedigree_util.getNodeByName(flat_tree, name);\n        var node = tree_node.data;\n        var depth = tree_node.depth;   // depth of the node in relation to the root (depth = 1 is a top_level node)\n\n        var pid = -101;\n        var ptr_name;\n        var children = pedigree_util.getAllChildren(dataset, node);\n        if (children.length > 0) {\n            ptr_name = children[0].mother == node.name ? children[0].father : children[0].mother;\n            pid = pedigree_util.getNodeByName(flat_tree, ptr_name).data.id;\n        }\n\n        var i;\n        if (depth == 1) {\n            mother = {\"name\": ptree.makeid(4), \"sex\": \"F\", \"top_level\": true};\n            father = {\"name\": ptree.makeid(4), \"sex\": \"M\", \"top_level\": true};\n            dataset.splice(0, 0, father);\n            dataset.splice(0, 0, mother);\n\n            for (i = 0; i < dataset.length; i++) {\n                if (dataset[i].top_level && dataset[i].name !== mother.name && dataset[i].name !== father.name) {\n                    delete dataset[i].top_level;\n                    dataset[i].noparents = true;\n                    dataset[i].mother = mother.name;\n                    dataset[i].father = father.name;\n                }\n            }\n        } else {\n            var node_mother = pedigree_util.getNodeByName(flat_tree, tree_node.data.mother);\n            var node_father = pedigree_util.getNodeByName(flat_tree, tree_node.data.father);\n            var node_sibs = pedigree_util.getAllSiblings(dataset, node);\n\n            // lhs & rhs id's for siblings of this node\n            var rid = 10000;\n            var lid = tree_node.data.id;\n            for (i = 0; i < node_sibs.length; i++) {\n                var sid = pedigree_util.getNodeByName(flat_tree, node_sibs[i].name).data.id;\n                if (sid < rid && sid > tree_node.data.id)\n                    rid = sid;\n                if (sid < lid)\n                    lid = sid;\n            }\n            var add_lhs = (lid >= tree_node.data.id || (pid == lid && rid < 10000));\n            if (opts.DEBUG)\n                console.log('lid=' + lid + ' rid=' + rid + ' nid=' + tree_node.data.id + ' ADD_LHS=' + add_lhs);\n            var midx;\n            if ((!add_lhs && node_father.data.id > node_mother.data.id) ||\n                (add_lhs && node_father.data.id < node_mother.data.id))\n                midx = pedigree_util.getIdxByName(dataset, node.father);\n            else\n                midx = pedigree_util.getIdxByName(dataset, node.mother);\n\n            var parent = dataset[midx];\n            mother = ptree.addsibling(dataset, parent, 'F', add_lhs);\n            father = ptree.addsibling(dataset, parent, 'M', add_lhs);\n\n            var orphans = pedigree_util.getAdoptedSiblings(dataset, node);\n            var nid = tree_node.data.id;\n            for (i = 0; i < orphans.length; i++) {\n                var oid = pedigree_util.getNodeByName(flat_tree, orphans[i].name).data.id;\n                if (opts.DEBUG)\n                    console.log('ORPHAN=' + i + ' ' + orphans[i].name + ' ' + (nid < oid && oid < rid) + ' nid=' + nid + ' oid=' + oid + ' rid=' + rid);\n                if ((add_lhs || nid < oid) && oid < rid) {\n                    var oidx = pedigree_util.getIdxByName(dataset, orphans[i].name);\n                    dataset[oidx].mother = mother.name;\n                    dataset[oidx].father = father.name;\n                }\n            }\n        }\n\n        if (depth == 2) {\n            mother.top_level = true;\n            father.top_level = true;\n        } else if (depth > 2) {\n            mother.noparents = true;\n            father.noparents = true;\n        }\n        var idx = pedigree_util.getIdxByName(dataset, node.name);\n        dataset[idx].mother = mother.name;\n        dataset[idx].father = father.name;\n        delete dataset[idx].noparents;\n\n        if ('parent_node' in node) {\n            var ptr_node = dataset[pedigree_util.getIdxByName(dataset, ptr_name)];\n            if ('noparents' in ptr_node) {\n                ptr_node.mother = mother.name;\n                ptr_node.father = father.name;\n            }\n        }\n    };\n\n    // add partner\n    ptree.addpartner = function (opts, dataset, name) {\n        var root = ptree.roots[opts.targetDiv];\n        var flat_tree = pedigree_util.flatten(root);\n        var tree_node = pedigree_util.getNodeByName(flat_tree, name);\n\n        var partner = ptree.addsibling(dataset, tree_node.data, tree_node.data.sex === 'F' ? 'M' : 'F');\n        partner.noparents = true;\n\n        var child = {\"name\": ptree.makeid(4), \"sex\": \"M\"};\n        child.mother = (tree_node.data.sex === 'F' ? tree_node.data.name : partner.name);\n        child.father = (tree_node.data.sex === 'F' ? partner.name : tree_node.data.name);\n\n        var idx = pedigree_util.getIdxByName(dataset, tree_node.data.name) + 2;\n        dataset.splice(idx, 0, child);\n    };\n\n    // get adjacent nodes at the same depth\n    function adjacent_nodes(root, node, excludes) {\n        var dnodes = pedigree_util.getNodesAtDepth(pedigree_util.flatten(root), node.depth, excludes);\n        var lhs_node, rhs_node;\n        for (var i = 0; i < dnodes.length; i++) {\n            if (dnodes[i].x < node.x)\n                lhs_node = dnodes[i];\n            if (!rhs_node && dnodes[i].x > node.x)\n                rhs_node = dnodes[i];\n        }\n        return [lhs_node, rhs_node];\n    }\n\n    // delete a node and descendants\n    ptree.delete_node_dataset = function (dataset, node, opts, onDone) {\n        var root = ptree.roots[opts.targetDiv];\n        var fnodes = pedigree_util.flatten(root);\n        var deletes = [];\n        var i, j;\n\n        // get d3 data node\n        if (node.id === undefined) {\n            var d3node = pedigree_util.getNodeByName(fnodes, node.name);\n            if (d3node !== undefined)\n                node = d3node.data;\n        }\n\n        if (node.parent_node) {\n            for (i = 0; i < node.parent_node.length; i++) {\n                var parent = node.parent_node[i];\n                var ps = [pedigree_util.getNodeByName(dataset, parent.mother.name),\n                    pedigree_util.getNodeByName(dataset, parent.father.name)];\n                // delete parents\n                for (j = 0; j < ps.length; j++) {\n                    if (ps[j].name === node.name || ps[j].noparents !== undefined || ps[j].top_level) {\n                        dataset.splice(pedigree_util.getIdxByName(dataset, ps[j].name), 1);\n                        deletes.push(ps[j]);\n                    }\n                }\n\n                var children = parent.children;\n                var children_names = $.map(children, function (p, i) {\n                    return p.name;\n                });\n                for (j = 0; j < children.length; j++) {\n                    var child = pedigree_util.getNodeByName(dataset, children[j].name);\n                    if (child) {\n                        child.noparents = true;\n                        var ptrs = get_partners(dataset, child);\n                        var ptr;\n                        if (ptrs.length > 0)\n                            ptr = pedigree_util.getNodeByName(dataset, ptrs[0]);\n                        if (ptr && ptr.mother !== child.mother) {\n                            child.mother = ptr.mother;\n                            child.father = ptr.father;\n                        } else if (ptr) {\n                            var child_node = pedigree_util.getNodeByName(fnodes, child.name);\n                            var adj = adjacent_nodes(root, child_node, children_names);\n                            child.mother = adj[0] ? adj[0].data.mother : (adj[1] ? adj[1].data.mother : null);\n                            child.father = adj[0] ? adj[0].data.father : (adj[1] ? adj[1].data.father : null);\n                        } else {\n                            dataset.splice(pedigree_util.getIdxByName(dataset, child.name), 1);\n                        }\n                    }\n                }\n            }\n        } else {\n            dataset.splice(pedigree_util.getIdxByName(dataset, node.name), 1);\n        }\n\n        // delete ancestors\n        console.log(deletes);\n        for (i = 0; i < deletes.length; i++) {\n            var del = deletes[i];\n            var sibs = pedigree_util.getAllSiblings(dataset, del);\n            console.log('DEL', del.name, sibs);\n            if (sibs.length < 1) {\n                console.log('del sibs', del.name, sibs);\n                var data_node = pedigree_util.getNodeByName(fnodes, del.name);\n                var ancestors = data_node.ancestors();\n                for (j = 0; j < ancestors.length; j++) {\n                    console.log(ancestors[i]);\n                    if (ancestors[j].data.mother) {\n                        console.log('DELETE ', ancestors[j].data.mother, ancestors[j].data.father);\n                        dataset.splice(pedigree_util.getIdxByName(dataset, ancestors[j].data.mother.name), 1);\n                        dataset.splice(pedigree_util.getIdxByName(dataset, ancestors[j].data.father.name), 1);\n                    }\n                }\n            }\n        }\n        // check integrity of mztwins settings\n        checkTwins(dataset);\n\n        try {\n            // validate new pedigree dataset\n            var newopts = $.extend({}, opts);\n            newopts.dataset = ptree.copy_dataset(dataset);\n            ptree.validate_pedigree(newopts);\n            // check if pedigree is split\n            var unconnected = ptree.unconnected(dataset);\n        } catch (err) {\n            utils.messages('Warning', 'Deletion of this pedigree member is disallowed.')\n            throw err;\n        }\n        if (unconnected.length > 0) {\n            // check & warn only if this is a new split\n            if (ptree.unconnected(opts.dataset).length === 0) {\n                console.error(\"individuals unconnected to pedigree \", unconnected);\n                utils.messages(\"Warning\", \"Deleting this will split the pedigree. Continue?\", onDone, opts, dataset);\n                return;\n            }\n        }\n\n        if (onDone) {\n            onDone(opts, dataset);\n        }\n        return dataset;\n    };\n\n    ptree.makeid = function (len) {\n        var text = \"\";\n        var possible = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\";\n        for (var i = 0; i < len; i++)\n            text += possible.charAt(Math.floor(Math.random() * possible.length));\n        return text;\n    };\n\n}(window.ptree = window.ptree || {}, jQuery));\n","\n// pedigree form\n(function(pedigree_form, $, undefined) {\n\n\tpedigree_form.update = function(opts) {\n\t\t$('.node_save').click(function() {\n\t\t\tpedigree_form.save(opts);\n\t\t});\n\n\t\t$('#id_proband, #id_exclude').click(function(e) {\n\t\t\tvar dataset = pedcache.current(opts);\n\t\t\topts.dataset = ptree.copy_dataset(dataset);\n\n\t\t\tvar name = $('#id_name').val();\n\t\t\tif($(this).attr(\"id\") === 'id_proband') {\n\t\t\t\tpedigree_util.setProband(opts.dataset, name, $(this).is(':checked'));\n\t\t\t} else {\n\t\t\t\tvar idx = pedigree_util.getIdxByName(opts.dataset, name);\n\t\t\t\tif($(this).is(':checked'))\n\t\t\t\t\topts.dataset[idx].exclude = true;\n\t\t\t\telse\n\t\t\t\t\tdelete opts.dataset[idx].exclude;\n\t\t\t}\n\t\t\tpedcache.add(opts);\n\t\t\t$(\"#\"+opts.targetDiv).empty();\n\t\t\tptree.build(opts);\n\t\t});\n\n\t\t// advanced options - model parameters\n\t\t$(\"input[id$='_mut_sensitivity'], input[id$='_mut_frequency']\").prop('disabled', true);\n\t\t$('#id_use_custom_mutation_sensitivities').change(function() {\n\t\t\t$(\"input[id$='_mut_sensitivity']\").prop('disabled', !$(this).is(\":checked\"));\n\t\t});\n\n\t\t$('#id_mutation_frequencies').change(function() {\n\t\t\t$(\"input[id$='_mut_frequency']\").prop('disabled', (this.value !== 'Custom'));\n\t\t\t// note pedigree_form.mutation_frequencies is set in the view see pedigree_section_js.html\n\t\t\tif(pedigree_form.mutation_frequencies && this.value !== 'Custom') {\n\t\t\t\tvar mfreq = pedigree_form.mutation_frequencies[this.value];\n\t\t\t\tfor (var gene in mfreq)\n\t\t\t\t\t$('#id_'+gene.toLowerCase()+'_mut_frequency').val(mfreq[gene]);\n\t\t\t}\n\t\t});\n\t};\n\n\t// handle family history change events (undo/redo/delete)\n\t$(document).on('fhChange', function(e, opts){\n\t\ttry {\n\t\t\tvar id = $('#id_name').val();  // get name from hidden field\n\t\t\tvar node = pedigree_util.getNodeByName(pedcache.current(opts), id)\n\t\t\tif(node === undefined)\n\t\t\t\t$('form > fieldset').prop(\"disabled\", true);\n\t\t\telse\n\t\t\t\t$('form > fieldset').prop('disabled', false);\n\t\t} catch(err) {\n\t\t\tconsole.warn(err);\n\t\t}\n    })\n\n\tpedigree_form.nodeclick = function(node) {\n\t\t$('form > fieldset').prop('disabled', false);\n\t\t// clear values\n\t\t$('#person_details').find(\"input[type=text], input[type=number]\").val(\"\");\n\t\t$('#person_details select').val('').prop('selected', true);\n\n\t\t// assign values to input fields in form\n\t\tif(node.sex === 'M' || node.sex === 'F')\n\t\t\t$('input[name=sex][value=\"'+node.sex+'\"]').prop('checked', true);\n\t\telse\n\t\t\t$('input[name=sex]').prop('checked', false);\n\t\tupdate_cancer_by_sex(node);\n\n\t\tif(!('status' in node))\n\t\t\tnode.status = 0;\n\t\t$('input[name=status][value=\"'+node.status+'\"]').prop('checked', true);\n\n\t\tif('proband' in node) {\n\t\t\t$('#id_proband').prop('checked', node.proband);\n\t\t} else {\n\t\t\t$('#id_proband').prop('checked', false);\n\t\t}\n\n\t\tif('exclude' in node) {\n\t\t\t$('#id_exclude').prop('checked', node.exclude);\n\t\t} else {\n\t\t\t$('#id_exclude').prop('checked', false);\n\t\t}\n\n/*\t\tif('ashkenazi' in node) {\n\t\t\t$('#id_ashkenazi').prop('checked', (node.proband == 1 ? true: false));\n\t\t} else {\n\t\t\t$('#id_ashkenazi').prop('checked', false);\n\t\t}*/\n\n\t\t// year of both\n\t\tif('yob' in node) {\n\t\t\t$('#id_yob_0').val(node.yob);\n\t\t} else {\n\t\t\t$('#id_yob_0').val('-');\n\t\t}\n\n\t\t// clear pathology\n\t\t$('select[name$=\"_bc_pathology\"]').val('-');\n\t\t// clear gene tests\n\t\t$('select[name*=\"_gene_test\"]').val('-');\n\n\t\t// disable sex radio buttons if the person has a partner\n\t\t$(\"input[id^='id_sex_']\").prop(\"disabled\", (node.parent_node && node.sex !== 'U' ? true : false));\n\n\t\t// disable pathology for male relatives (as not used by model)\n\t\t$(\"select[id$='_bc_pathology']\").prop(\"disabled\", (node.sex === 'M' ? true : false));\n\n\t\t// approximate diagnosis age\n\t\t$('#id_approx').prop('checked', (node.approx_diagnosis_age ? true: false));\n\t\tpedigree_form.update_diagnosis_age_widget();\n\n\t\tfor(var key in node ) {\n\t\t\tif(key !== 'proband' && key !== 'sex') {\n\t\t\t\tif($('#id_'+key).length) {\t// input value\n\t\t\t\t\tif(key.indexOf('_gene_test')  !== -1 && node[key] !== null && typeof node[key] === 'object') {\n\t\t\t\t\t\t$('#id_'+key).val(node[key].type);\n\t\t\t\t\t\t$('#id_'+key+'_result').val(node[key].result);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$('#id_'+key).val(node[key]);\n\t\t\t\t\t}\n\t\t\t\t} else if(key.indexOf('_diagnosis_age') !== -1) {\n\t\t\t\t\tif($(\"#id_approx\").is(':checked')) {\n\t\t\t\t\t\t$('#id_'+key+'_1').val(round5(node[key])).prop('selected', true);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$('#id_'+key+'_0').val(node[key]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\t$('#person_details').find('form').valid();\n\t\t} catch(err) {\n\t\t\tconsole.warn('valid() not found');\n\t\t}\n\t};\n\n\tpedigree_form.saveTabbedForm =  function(opts, selectedName, formOptions){\n\t\tlet dataset = pedcache.current(opts);\n        let name = typeof (selectedName) === 'string' && selectedName.length>0? selectedName:$('#id_name').val();\n        let newdataset = ptree.copy_dataset(dataset);\n        var person = pedigree_util.getNodeByName(newdataset, name);\n        if(!person) {\n            console.warn('TABBED DIALOG: ','person not found when saving details');\n            return;\n        }\n\t\t$(\"#\"+opts.targetDiv).empty();\n        let newName = $('#id__name').val();\n        person.full_name = newName && newName.length>0?newName.substring(0,Math.min(15, newName.length)):'';\n        person.uniqueId = $('#id_uniqueId').val();\n        person.age = $('#id__age').val();\n        person.dob = $('#dob').val();\n        person.dage = $('#id__dage').val();\n        person.cause_of_death = $('#cause_of_death').val();\n        person.country_of_origin = $('#country_of_origin').val();\n        person.individual_role = $(\"input[name='individual_role']:checked\").val();\n        person.conceived_by_donor_egg = $(\"#id_conceived_by_donor_egg\").is(\":checked\");\n        person.conceived_by_donor_sperm = $(\"#id_conceived_by_donor_sperm\").is(\":checked\");\n        //ethicity and country of origin magic search\n\t\tif(formOptions){\n\t\t\tif(formOptions.ethnicity){\n\t\t\t\tlet ethnicity = formOptions.ethnicity;\n\t\t\t\tif(ethnicity.action === 'save'){\n\t\t\t\t\tif(person.ethnicity && !person.ethnicity.includes(ethnicity.data)){\n\t\t\t\t\t\tperson.ethnicity = person.ethnicity.filter((e)=>e.id!==ethnicity.data.id)\n\t\t\t\t\t\tperson.ethnicity.push(ethnicity.data)\n\t\t\t\t\t}else{\n\t\t\t\t\t\tperson.ethnicity = [ethnicity.data]\n\t\t\t\t\t}\n\t\t\t\t}else if(ethnicity.action === 'delete'){\n\t\t\t\t\tif(person.ethnicity && person.ethnicity.length>0){\n\t\t\t\t\t\tperson.ethnicity = person.ethnicity.filter((e)=>e.id!==ethnicity.data.id)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(person.ethnicity && person.ethnicity.length>0) {\n\t\t\t\t\tlet ethnicityIds= person.ethnicity.map((e)=>e.id).join();\n\t\t\t\t\t$('#'+ethnicity.id).trigger('set', {id: ethnicityIds});\n\t\t\t\t}\n\n\t\t\t}\n\t\t\tif(formOptions.countryOfOrigin){\n\t\t\t\tlet countryOfOrigin = formOptions.countryOfOrigin;\n\t\t\t\tif(countryOfOrigin.action === 'save'){\n\t\t\t\t\tif(person.country_of_origin && person.country_of_origin.length>0){\n\t\t\t\t\t\tperson.country_of_origin = person.country_of_origin.filter((e)=>e.id!==countryOfOrigin.data.id)\n\t\t\t\t\t\tperson.country_of_origin.push(countryOfOrigin.data)\n\t\t\t\t\t}else{\n\t\t\t\t\t\tperson.country_of_origin = [countryOfOrigin.data]\n\t\t\t\t\t}\n\t\t\t\t}else if(countryOfOrigin.action === 'delete'){\n\t\t\t\t\tif(person.country_of_origin && person.country_of_origin.length>0){\n\t\t\t\t\t\tperson.country_of_origin = person.country_of_origin.filter((e)=>e.id!==countryOfOrigin.data.id)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(person.country_of_origin && person.country_of_origin.length>0) {\n\t\t\t\t\tlet countryOfOriginIds= person.country_of_origin.map((e)=>e.id).join();\n\t\t\t\t\t$('#'+countryOfOrigin.id).trigger('set', {id: countryOfOriginIds});\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\t\t//save gestation\n\t\tlet gestation = $('#gestation').val();\n\t\tif(gestation && person.status && person.status >2){\n\t\t\tperson.gestation = gestation;\n\t\t}\n\n\n\t\tvar conditionAge = 'age';\n\t\tvar conditionStatus =  'status';\n\t\tvar conditionDiagnosed = 'diagnosed';\n\t\tvar conditionType = 'type';\n\t\tvar conditionNotes = 'notes';\n\t\tperson.conditions = person.conditions ||  [];\n\t\tperson.conditions =  [];\n\t\tconst specialRegex = new RegExp(`[ ~!@#$%^&*()|+-=?;:'\",.]`, 'gi') ;\n\t\td3.selectAll('.diagnosisTypes').each(function(){\n\t\t\tlet k = d3.select(this).select('label').select('input').attr('id').split('_')[0] + '_condition';\n\t\t\tif ($('#' + k + '_check').is(\":checked\")) {\n\t\t\t\tvar ageOnset = $('#' + k + '_ageOnset').val();\n\t\t\t\tvar diagnosisStatus = $(\"input[name='\" + k + \"_status']:checked\").val();\n\t\t\t\tvar diagnosisDiagnosed = $('#' + k + '_diagnosed').val();\n\t\t\t\tvar diagnosisType = $('#' + k + '_diagnosisType').val();\n\t\t\t\tvar diagnosisNotes = $('#' + k + '_notes').val();\n\t\t\t\tlet condition =  {name :  opts.conditions[k].name};\n\n\t\t\t\tif (ageOnset && ageOnset.length > 0) {\n\t\t\t\t\tcondition[conditionAge] =  ageOnset\n\t\t\t\t}\n\t\t\t\tif (diagnosisStatus && diagnosisStatus.length > 0) {\n\t\t\t\t\tcondition[conditionStatus] = diagnosisStatus;\n\t\t\t\t}\n\t\t\t\tif (diagnosisDiagnosed && diagnosisDiagnosed.length > 0) {\n\t\t\t\t\tcondition[conditionDiagnosed] =  diagnosisDiagnosed;\n\t\t\t\t}\n\t\t\t\tif (diagnosisType && diagnosisType.length > 0) {\n\t\t\t\t\tcondition[conditionType] = diagnosisType;\n\t\t\t\t}\n\t\t\t\tif (diagnosisNotes && diagnosisNotes.length > 0) {\n\t\t\t\t\tcondition[conditionNotes] = diagnosisNotes;\n\t\t\t\t}\n\t\t\t\tperson.conditions.push(condition);\n\t\t\t\tlegend.addConditionLegendToOpts(opts, k, opts.conditions[k]);\n\t\t\t}\n\t\t});\n\n\t\tif(formOptions && formOptions.conditionToDelete){\n\t\t\tconst k = formOptions.conditionToDelete;\n\t\t\tperson.conditions =  person.conditions.filter((condition)=> condition.name.replace(specialRegex, '-') + '_condition' !== k);\n\t\t\tlegend.deleteConditionsFromOpts(opts, person, k, 'condition_legend', 'legend-condition-list');\n\t\t\t$('#' + k + '_check').prop('checked', false)\n\t\t}\n\n        if (opts.selected_phenotypes[person.name]) {\n            $.each(opts.selected_phenotypes[person.name], function (phenotype_id) {\n                person[opts.selected_phenotypes[person.name][phenotype_id]] = true;\n            });\n        }\n\n        if (opts.selected_candidate_genotype[person.name]) {\n            $.each(opts.selected_candidate_genotype[person.name], function (candidate_id) {\n                person[opts.selected_candidate_genotype[person.name][candidate_id]] = true;\n            });\n        }\n\n        if (opts.selected_causal_genotype[person.name]) {\n            $.each(opts.selected_causal_genotype[person.name], function (causal_id) {\n                person[opts.selected_causal_genotype[person.name][causal_id]] = true;\n            });\n        }\n\n        if (opts.selected_carrier_genotype[person.name]) {\n            $.each(opts.selected_carrier_genotype[person.name], function (carrier_id) {\n                person[opts.selected_carrier_genotype[person.name][carrier_id]] = true;\n            });\n        }\n\n        if ($('#commentClinical')) {\n            person.clinical_comments = $('#commentClinical').val();\n        }\n\n// current status: 0 = alive, 1 = dead Alive&Well = 2\n        let status = $(\"input[name='status']:checked\").val();\n        if(status){\n            person.status = parseInt(status);\n        }\n        let gestationContainer = $('#gestation_container');\n        if(person.status > 2){\n        \tgestationContainer.show();\n\t\t}else{\n\t\t\tgestationContainer.hide();\n\t\t}\n        let sex = $(\"input[name='sex']:checked\").val();\n        if(sex){\n            person.sex = sex;\n        }\n\n        let heredity = $('#heredity').val();\n        if(heredity){\n        \tperson.heredity = heredity;\n\t\t}\n\n        //market by\n        person.market_by_text = $('#reason').val();\n        let marketSelectedId = ['market_na', 'market_p', 'market_m', 'market_s', 'market_st'];\n        let currentSelected =  person.market_by_tick;\n        delete person['market_by_tick'];\n        $(marketSelectedId).each(function (index, id) {\n\t\t\tlet s = $('#'+id);\n\t\t\tif(s.is(\":checked\")){\n\t\t\t\tif(currentSelected !== id) {\n                    person.market_by_tick = id;\n                }\n\t\t\t}\n        });\n        if(!person.market_by_tick)\n        \tperson.market_by_tick = currentSelected;\n\n\n        for(let i=0; i< marketSelectedId.length; i++){\n        \tif(marketSelectedId[i] !== person.market_by_tick)\n\t\t\t\t$('#'+marketSelectedId[i])[0].checked= false;\n\t\t}\n\n        var switches = [ \"adopted_in\", \"adopted_out\", \"conceived_by_donor_egg_or_sperm\",\"conceived_by_icf\",\n\t\t\t\"ivf_icsi\",\"termination\", \"consanguineous_parents\", \"proband\"];\n        for(var iswitch=0; iswitch<switches.length; iswitch++){\n            var attr = switches[iswitch];\n            var s = $('#id_'+attr);\n            if(s.length > 0){\n                if(s.is(\":checked\"))\n                    person[attr] = true;\n                else {\n                    delete person[attr];\n                }\n            }\n        }\n\n        /*CLINICAL*/\n\t\tlet carrier_status = $(\"input[name='carrier_status']:checked\").val();\n\t\tif(carrier_status){\n\t\t\tperson.carrier_status = carrier_status;\n\t\t}\n        ptree.syncTwins(newdataset, person);\n        opts.dataset = newdataset;\n        ptree.rebuild(opts);\n\n\t};\n\n    pedigree_form.save = function(opts, selectedName) {\n\t\tvar dataset = pedcache.current(opts);\n\t\tvar name = typeof (selectedName) === 'string' && selectedName.length>0? selectedName:$('#id_name').val();\n\t\tvar newdataset = ptree.copy_dataset(dataset);\n\t\tvar person = pedigree_util.getNodeByName(newdataset, name);\n\t\tif(!person) {\n\t\t\tconsole.warn('person not found when saving details');\n\t\t\treturn;\n\t\t}\n\t\t$(\"#\"+opts.targetDiv).empty();\n\n\t\t// individual's personal and clinical details\n\t\tvar yob = $('#id_yob_0').val();\n\t\tif(yob && yob !== '') {\n\t\t\tperson.yob = yob;\n\t\t} else {\n\t\t\tdelete person.yob;\n\t\t}\n\n\t\t// current status: 0 = alive, 1 = dead\n\t\tvar status = $('#id_status').find(\"input[type='radio']:checked\");\n\t\tif(status.length > 0){\n\t\t\tperson.status = status.val();\n\t\t}\n\n\t\t// booleans switches\n\t\tvar switches = [\"adopted_in\", \"adopted_out\", \"consanguineous_parents\"];\n\t\tfor(var iswitch=0; iswitch<switches.length; iswitch++){\n\t\t\tvar attr = switches[iswitch];\n\t\t\tvar s = $('#id_'+attr);\n\t\t\tif(s.length > 0){\n\t\t\t\tif(s.is(\":checked\"))\n\t\t\t\t\tperson[attr] = true;\n\t\t\t\telse\n\t\t\t\t\tdelete person[attr];\n\t\t\t}\n\t\t}\n\n\t\t// current sex\n\t\tvar sex = $('#id_sex').find(\"input[type='radio']:checked\");\n\t\tif(sex.length > 0){\n\t\t\tperson.sex = sex.val();\n\t\t\tupdate_cancer_by_sex(person);\n\t\t}\n\n\t\t// Ashkenazi status, 0 = not Ashkenazi, 1 = Ashkenazi\n/*\t\tif($('#id_ashkenazi').is(':checked'))\n\t\t\tperson.ashkenazi = 1;\n\t\telse\n\t\t\tdelete person.ashkenazi;*/\n\n\t\tif($('#id_approx').is(':checked')) // approximate diagnosis age\n\t\t\tperson.approx_diagnosis_age = true;\n\t\telse\n\t\t\tdelete person.approx_diagnosis_age;\n\n\t\t$(\"#person_details select[name*='_diagnosis_age']:visible, #person_details input[type=text]:visible, #person_details input[type=number]:visible, #person_details input[type=checkbox][id$=_diagnosis_age_0]:visible\").each(function() {\n\t\t\tvar name = (this.name.indexOf(\"_diagnosis_age\")>-1 ? this.name.substring(0, this.name.length-2): this.name);\n      if ($(this).attr('type') === 'checkbox') {\n        if ($(this).is(':checked')) {\n          person[name] = -1;\n        } else {\n          delete person[name];\n        }\n      } else {\n\t\t\tif($(this).val()) {\n\t\t\t\tvar val = $(this).val();\n\t\t\t\tif(name.indexOf(\"_diagnosis_age\") > -1 && $(\"#id_approx\").is(':checked'))\n\t\t\t\t\tval = round5(val);\n\t\t\t\tperson[name] = val;\n\t\t\t} else {\n\t\t\t\tdelete person[name];\n\t\t\t}\n        }});\n\n\t\t// cancer checkboxes\n\t\t$('#person_details input[type=\"checkbox\"][name$=\"cancer\"],input[type=\"checkbox\"][name$=\"cancer2\"]').each(function() {\n\t\t\tif(this.checked)\n\t\t\t\tperson[$(this).attr('name')] = true;\n\t\t\telse\n\t\t\t\tdelete person[$(this).attr('name')];\n\t\t});\n\n\t\t// pathology tests\n\t\t$('#person_details select[name$=\"_bc_pathology\"]').each(function() {\n\t\t\tif($(this).val() !== '-') {\n\t\t\t\tperson[$(this).attr('name')] = $(this).val();\n\t\t\t} else {\n\t\t\t\tdelete person[$(this).attr('name')];\n\t\t\t}\n\t\t});\n\n\t\t// genetic tests\n\t\t$('#person_details select[name$=\"_gene_test\"]').each(function() {\n\t\t\tif($(this).val() !== '-') {\n\t\t\t\tvar tres = $('select[name=\"'+$(this).attr('name')+'_result\"]');\n\t\t\t\tperson[$(this).attr('name')] = {'type': $(this).val(), 'result': $(tres).val()};\n\t\t\t} else {\n\t\t\t\tdelete person[$(this).attr('name')];\n\t\t\t}\n\t\t});\n\n\t\ttry {\n\t\t\t$('#person_details').find('form').valid();\n\t\t} catch(err) {\n\t\t\tconsole.warn('valid() not found');\n\t\t}\n\n\n\t\tptree.syncTwins(newdataset, person);\n\t\topts.dataset = newdataset;\n\t\tptree.rebuild(opts);\n    };\n\n    pedigree_form.update_diagnosis_age_widget = function() {\n\t\tif($(\"#id_approx\").is(':checked')) {\n\t\t\t$(\"[id$='_diagnosis_age_0']\").each(function( index ) {\n\t\t\t\tif($(this).val() !== '') {\n\t\t\t\t\tvar name = this.name.substring(0, this.name.length-2);\n\t\t\t\t\t$(\"#id_\"+name+\"_1\").val(round5($(this).val())).prop('selected', true);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t$(\"[id$='_diagnosis_age_0']\").hide();\n\t\t\t$(\"[id$='_diagnosis_age_1']\").show();\n\t\t} else {\n\t\t\t$(\"[id$='_diagnosis_age_1']\").each(function( index ) {\n\t\t\t\tif($(this).val() !== '') {\n\t\t\t\t\tvar name = this.name.substring(0, this.name.length-2);\n\t\t\t\t\t$(\"#id_\"+name+\"_0\").val($(this).val());\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t$(\"[id$='_diagnosis_age_0']\").show();\n\t\t\t$(\"[id$='_diagnosis_age_1']\").hide();\n\t\t}\n    };\n\n\tpedigree_form.save_common_cancers = function (cancerValue, ageOfDiagnosis, opts, selectedName, is_age_change) {\n\t\tlet dataset = pedcache.current(opts);\n\t\tlet name = typeof (selectedName) === 'string' && selectedName.length > 0 ? selectedName : $('#id_name').val();\n\t\tlet newdataset = ptree.copy_dataset(dataset);\n\t\tvar person = pedigree_util.getNodeByName(newdataset, name);\n\n\t\tif (cancerValue) {\n\t\t\tperson[cancerValue] = true;\n\t\t\tif(!is_age_change) {\n\t\t\t\tlegend.addCancersToLegend(cancerValue);\n\t\t\t}\n\t\t}\n\t\tif (ageOfDiagnosis) {\n\t\t\tvar cancerAge = cancerValue + '_age';\n\t\t\tperson[cancerAge] = ageOfDiagnosis;\n\t\t}\n\t\tptree.syncTwins(newdataset, person);\n\t\topts.dataset = newdataset;\n\t\tptree.rebuild(opts);\n\t};\n\n\tpedigree_form.remove_cancers = function (cancerValue, ageOfDiagnosis, opts, selectedName, ageChange) {\n\t\tlet dataset = pedcache.current(opts);\n\t\tlet name = typeof (selectedName) === 'string' && selectedName.length > 0 ? selectedName : $('#id_name').val();\n\t\tlet newdataset = ptree.copy_dataset(dataset);\n\t\tvar person = pedigree_util.getNodeByName(newdataset, name);\n\n\t\tif (!ageChange && cancerValue && (cancerValue in person)) {\n\t\t\tdelete person[cancerValue];\n\t\t}\n\t\tvar cancerAge = cancerValue + '_age';\n\t\tif (cancerAge in person) {\n\t\t\tdelete person[cancerAge];\n\t\t}\n\t\tptree.syncTwins(newdataset, person);\n\t\topts.dataset = newdataset;\n\t\tptree.rebuild(opts);\n\t};\n\n    pedigree_form.remove_phenotypes = function (opts, selectedName, phenotype_id) {\n        let dataset = pedcache.current(opts);\n        let name = typeof (selectedName) === 'string' && selectedName.length > 0 ? selectedName : $('#id_name').val();\n        let newdataset = ptree.copy_dataset(dataset);\n        var person = pedigree_util.getNodeByName(newdataset, name);\n\n        if (phenotype_id in person) {\n            delete person[phenotype_id];\n        }\n\n\t\tif (opts.selected_phenotypes[person.name]) {\n\t\t\t$.each(opts.selected_phenotypes[person.name], function (index) {\n\t\t\t\topts.selected_phenotypes[person.name].splice(index, 1);\n\t\t\t});\n\t\t}\n\n        ptree.syncTwins(newdataset, person);\n        opts.dataset = newdataset;\n        ptree.rebuild(opts);\n    };\n\n    pedigree_form.remove_candidate = function (opts, selectedName, candidate_id) {\n        let dataset = pedcache.current(opts);\n        let name = typeof (selectedName) === 'string' && selectedName.length > 0 ? selectedName : $('#id_name').val();\n        let newdataset = ptree.copy_dataset(dataset);\n        var person = pedigree_util.getNodeByName(newdataset, name);\n\n        if (candidate_id in person) {\n            delete person[candidate_id];\n        }\n\n\t\tif (opts.selected_candidate_genotype[person.name]) {\n\t\t\t$.each(opts.selected_candidate_genotype[person.name], function (index) {\n\t\t\t\topts.selected_candidate_genotype[person.name].splice(index, 1);\n\t\t\t});\n\t\t}\n\n        ptree.syncTwins(newdataset, person);\n        opts.dataset = newdataset;\n        ptree.rebuild(opts);\n    };\n\n    pedigree_form.remove_causal = function (opts, selectedName, causal_id) {\n        let dataset = pedcache.current(opts);\n        let name = typeof (selectedName) === 'string' && selectedName.length > 0 ? selectedName : $('#id_name').val();\n        let newdataset = ptree.copy_dataset(dataset);\n        var person = pedigree_util.getNodeByName(newdataset, name);\n\n        if (causal_id in person) {\n            delete person[causal_id];\n        }\n\n\t\tif (opts.selected_causal_genotype[person.name]) {\n\t\t\t$.each(opts.selected_causal_genotype[person.name], function (index) {\n\t\t\t\topts.selected_causal_genotype[person.name].splice(index, 1);\n\t\t\t});\n\t\t}\n\n        ptree.syncTwins(newdataset, person);\n        opts.dataset = newdataset;\n        ptree.rebuild(opts);\n    };\n\n    pedigree_form.remove_carrier = function (opts, selectedName, carrier_id) {\n        let dataset = pedcache.current(opts);\n        let name = typeof (selectedName) === 'string' && selectedName.length > 0 ? selectedName : $('#id_name').val();\n        let newdataset = ptree.copy_dataset(dataset);\n        var person = pedigree_util.getNodeByName(newdataset, name);\n\n        if (carrier_id in person) {\n            delete person[carrier_id];\n        }\n\n\t\tif (opts.selected_carrier_genotype[person.name]) {\n\t\t\t$.each(opts.selected_carrier_genotype[person.name], function (index) {\n\t\t\t\topts.selected_carrier_genotype[person.name].splice(index, 1);\n\t\t\t});\n\t\t}\n\n        ptree.syncTwins(newdataset, person);\n        opts.dataset = newdataset;\n        ptree.rebuild(opts);\n    };\n\n    // males should not have ovarian cancer and females should not have prostate cancer\n    function update_cancer_by_sex(node) {\n\t\t$('#cancer .row').show();\n\t\tif(node.sex === 'M') {\n\t\t\tdelete node.ovarian_cancer_diagnosis_age;\n\t\t\t$(\"[id^='id_ovarian_cancer_diagnosis_age']\").closest('.row').hide();\n\t\t} else if(node.sex === 'F') {\n\t\t\tdelete node.prostate_cancer_diagnosis_age;\n\t\t\t$(\"[id^='id_prostate_cancer_diagnosis_age']\").closest('.row').hide();\n\t\t}\n    }\n\n    // round to 5, 15, 25, 35 ....\n    function round5(x1) {\n    \tvar x2 = (Math.round((x1-1) / 10) * 10);\n    \treturn (x1 < x2 ? x2 - 5 : x2 + 5);\n    }\n\n}(window.pedigree_form = window.pedigree_form || {}, jQuery));\n","//\n// undo, redo, reset buttons\n(function(pbuttons, $, undefined) {\n\n    pbuttons.add = function(options) {\n        var opts = $.extend({\n            // defaults\n            btn_target: 'pedigree_history'\n        }, options );\n        $( \"#\"+options.btn_target ).empty()\n\n        var btns = [{\"fa\": \"fa-undo\", \"title\": \"undo\"},\n            {\"fa\": \"fa-repeat\", \"title\": \"redo\"},\n            {\"fa\": \"fa-refresh\", \"title\": \"reset\"}];\n        let $btn_target = $( \"#\"+opts.btn_target );\n        var lis = `<div style=\"margin-bottom: 5px\">`;\n        lis += `<li class=\"inline-block\">\n        <label class=\"btn btn-default btn-file\">\n\t\t\t\t\t\t<input id=\"load\" type=\"file\" style=\"display: none;\">Load\n\t\t\t\t</label>\t\n\t\t\t\t</li>\n\t\t\t\t<li class=\"inline-block\">\t\n\t\t\t\t<label class=\"btn btn-default btn-file\">\n\t\t\t\t\t\t<input id=\"save\" type=\"button\" style=\"display: none;\">Save\n\t\t\t\t</label>\t\t\n                </li>\n                <li class=\"inline-block\">\n                <label class=\"btn btn-default btn-file\">\n                                        <input id=\"print\" type=\"button\" style=\"display: none;\">Print\n                                </label>\n                </li>\n                <li class=\"inline-block\">\n                <label class=\"btn btn-default btn-file\">\n                                        <input id=\"svg_download\" type=\"button\" style=\"display: none;\">SVG\n                                </label>\n                </li>\n                <li class=\"inline-block\">\n                <label class=\"btn btn-default btn-file\">\n                                        <input id=\"png_download\" type=\"button\" style=\"display: none;\">PNG\n                                </label>\n                </li>\n               </div\n        `;\n        for(var i=0; i<btns.length; i++) {\n            lis += '<li\">';\n            lis += '&nbsp;<i class=\"fa fa-lg ' + btns[i].fa + '\" ' +\n                (btns[i].fa == \"fa-arrows-alt\" ? 'id=\"fullscreen\" ' : '') +\n                ' aria-hidden=\"true\" title=\"'+ btns[i].title +'\"></i>';\n            lis += '</li>';\n        }\n        $btn_target.append(lis);\n        click(opts);\n    };\n\n    pbuttons.is_fullscreen = function(){\n        return (document.fullscreenElement || document.mozFullScreenElement || document.webkitFullscreenElement);\n    };\n\n    function click(opts) {\n        // fullscreen\n        $(document).on('webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange', function(e)  {\n            var local_dataset = pedcache.current(opts);\n            if (local_dataset !== undefined && local_dataset !== null) {\n                opts.dataset = local_dataset;\n            }\n            ptree.rebuild(opts);\n            panZoom.config.isFullScreenMode = !panZoom.config.isFullScreenMode;\n            panZoom.add(opts);\n            if(panZoom.config.isFullScreenMode) {\n                legend.add(opts);\n            }\n            widgets.removeDialogs();\n        });\n\n        $('#fullscreen').on('click', function(e) {\n            if (!document.mozFullScreen && !document.webkitFullScreen) {\n                var target = $(\"#\"+opts.targetDiv)[0];\n                if(target.mozRequestFullScreen)\n                    target.mozRequestFullScreen();\n                else\n                    target.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);\n            } else {\n                if(document.mozCancelFullScreen)\n                    document.mozCancelFullScreen();\n                else\n                    document.webkitCancelFullScreen();\n            }\n        });\n\n        // undo/redo/reset\n        $( \"#\"+opts.btn_target ).on( \"click\", function(e) {\n            e.stopPropagation();\n            if($(e.target).hasClass(\"disabled\"))\n                return false;\n\n            if($(e.target).hasClass('fa-undo')) {\n                opts.dataset = pedcache.previous(opts);\n                $(\"#\"+opts.targetDiv).empty();\n                ptree.build(opts);\n            } else if ($(e.target).hasClass('fa-repeat')) {\n                opts.dataset = pedcache.next(opts);\n                $(\"#\"+opts.targetDiv).empty();\n                ptree.build(opts);\n            } else if ($(e.target).hasClass('fa-refresh')) {\n                pbuttons.reset(opts);\n            }\n            // trigger fhChange event\n            $(document).trigger('fhChange', [opts]);\n        });\n    }\n\n    // reset pedigree and clear the history\n    pbuttons.reset = function(opts) {\n        pedcache.clear(opts);\n        delete opts.dataset;\n\n        var selected = $(\"input[name='default_fam']:checked\");\n        if(selected.length > 0 && selected.val() == 'extended2') {    // secondary relatives\n            opts.dataset = [\n                {\"name\":\"wZA\",\"sex\":\"M\",\"top_level\":true,\"status\":\"0\",\"display_name\":\"paternal grandfather\"},\n                {\"name\":\"MAk\",\"sex\":\"F\",\"top_level\":true,\"status\":\"0\",\"display_name\":\"paternal grandmother\"},\n                {\"name\":\"zwB\",\"sex\":\"M\",\"top_level\":true,\"status\":\"0\",\"display_name\":\"maternal grandfather\"},\n                {\"name\":\"dOH\",\"sex\":\"F\",\"top_level\":true,\"status\":\"0\",\"display_name\":\"maternal grandmother\"},\n                {\"name\":\"MKg\",\"sex\":\"F\",\"mother\":\"MAk\",\"father\":\"wZA\",\"status\":\"0\",\"display_name\":\"paternal aunt\"},\n                {\"name\":\"xsm\",\"sex\":\"M\",\"mother\":\"MAk\",\"father\":\"wZA\",\"status\":\"0\",\"display_name\":\"paternal uncle\"},\n                {\"name\":\"m21\",\"sex\":\"M\",\"mother\":\"MAk\",\"father\":\"wZA\",\"status\":\"0\",\"display_name\":\"father\"},\n                {\"name\":\"f21\",\"sex\":\"F\",\"mother\":\"dOH\",\"father\":\"zwB\",\"status\":\"0\",\"display_name\":\"mother\"},\n                {\"name\":\"aOH\",\"sex\":\"F\",\"mother\":\"f21\",\"father\":\"m21\",\"status\":\"0\",\"display_name\":\"sister\"},\n                {\"name\":\"Vha\",\"sex\":\"M\",\"mother\":\"f21\",\"father\":\"m21\",\"status\":\"0\",\"display_name\":\"brother\"},\n                {\"name\":\"Spj\",\"sex\":\"M\",\"mother\":\"f21\",\"father\":\"m21\",\"noparents\":true,\"status\":\"0\",\"display_name\":\"partner\"},\n                {\"name\":\"ch1\",\"sex\":\"F\",\"mother\":\"f21\",\"father\":\"m21\",\"proband\":true,\"status\":\"0\",\"display_name\":\"me\"},\n                {\"name\":\"zhk\",\"sex\":\"F\",\"mother\":\"ch1\",\"father\":\"Spj\",\"status\":\"0\",\"display_name\":\"daughter\"},\n                {\"name\":\"Knx\",\"display_name\":\"son\",\"sex\":\"M\",\"mother\":\"ch1\",\"father\":\"Spj\",\"status\":\"0\"},\n                {\"name\":\"uuc\",\"display_name\":\"maternal aunt\",\"sex\":\"F\",\"mother\":\"dOH\",\"father\":\"zwB\",\"status\":\"0\"},\n                {\"name\":\"xIw\",\"display_name\":\"maternal uncle\",\"sex\":\"M\",\"mother\":\"dOH\",\"father\":\"zwB\",\"status\":\"0\"}];\n        } else if(selected.length > 0 && selected.val() == 'extended1') {    // primary relatives\n            opts.dataset = [\n                {\"name\":\"m21\",\"sex\":\"M\",\"mother\":null,\"father\":null,\"status\":\"0\",\"display_name\":\"father\",\"noparents\":true},\n                {\"name\":\"f21\",\"sex\":\"F\",\"mother\":null,\"father\":null,\"status\":\"0\",\"display_name\":\"mother\",\"noparents\":true},\n                {\"name\":\"aOH\",\"sex\":\"F\",\"mother\":\"f21\",\"father\":\"m21\",\"status\":\"0\",\"display_name\":\"sister\"},\n                {\"name\":\"Vha\",\"sex\":\"M\",\"mother\":\"f21\",\"father\":\"m21\",\"status\":\"0\",\"display_name\":\"brother\"},\n                {\"name\":\"Spj\",\"sex\":\"M\",\"mother\":\"f21\",\"father\":\"m21\",\"noparents\":true,\"status\":\"0\",\"display_name\":\"partner\"},\n                {\"name\":\"ch1\",\"sex\":\"F\",\"mother\":\"f21\",\"father\":\"m21\",\"proband\":true,\"status\":\"0\",\"display_name\":\"me\"},\n                {\"name\":\"zhk\",\"sex\":\"F\",\"mother\":\"ch1\",\"father\":\"Spj\",\"status\":\"0\",\"display_name\":\"daughter\"},\n                {\"name\":\"Knx\",\"display_name\":\"son\",\"sex\":\"M\",\"mother\":\"ch1\",\"father\":\"Spj\",\"status\":\"0\"}];\n        } else {\n            opts.dataset = [\n                {\"name\": \"m21\", \"display_name\": \"father\", \"sex\": \"M\", \"top_level\": true},\n                {\"name\": \"f21\", \"display_name\": \"mother\", \"sex\": \"F\", \"top_level\": true},\n                {\"name\": \"ch1\", \"display_name\": \"me\", \"sex\": \"F\", \"mother\": \"f21\", \"father\": \"m21\", \"proband\": true}];\n        }\n        ptree.rebuild(opts);\n    }\n\n    pbuttons.updateButtons = function(opts) {\n        var current = pedcache.get_count(opts);\n        var nstore = pedcache.nstore(opts);\n        var id = \"#\"+opts.btn_target;\n        if(nstore <= current)\n            $(id+\" .fa-repeat\").addClass('disabled');\n        else\n            $(id+\" .fa-repeat\").removeClass('disabled');\n\n        if(current > 1)\n            $(id+\" .fa-undo\").removeClass('disabled');\n        else\n            $(id+\" .fa-undo\").addClass('disabled');\n    };\n}(window.pbuttons = window.pbuttons || {}, jQuery));\n\n//\n//store a history of pedigree\n(function(pedcache, $, undefined) {\n    var count = 0;\n    var max_limit = 25;\n    var dict_cache = {};\n\n    // test if browser storage is supported\n    function has_browser_storage(opts) {\n        try {\n            if(opts.store_type === 'array')\n                return false;\n\n            if(opts.store_type !== 'local' && opts.store_type !== 'session' && opts.store_type !== undefined)\n                return false;\n\n            var mod = 'test';\n            localStorage.setItem(mod, mod);\n            localStorage.removeItem(mod);\n            return true;\n        } catch(e) {\n            return false;\n        }\n    }\n\n    function get_prefix(opts) {\n        return \"PEDIGREE_\"+opts.btn_target+\"_\";\n    }\n\n    // use dict_cache to store cache as an array\n    function get_arr(opts) {\n        return dict_cache[get_prefix(opts)];\n    }\n\n    function get_browser_store(opts, item) {\n        if(opts.store_type === 'local')\n            return localStorage.getItem(item);\n        else\n            return sessionStorage.getItem(item);\n    }\n\n    function set_browser_store(opts, name, item) {\n        if(opts.store_type === 'local')\n            return localStorage.setItem(name, item);\n        else\n            return sessionStorage.setItem(name, item);\n    }\n\n    function clear_browser_store(opts) {\n        if(opts.store_type === 'local')\n            return localStorage.clear();\n        else\n            return sessionStorage.clear();\n    }\n\n    pedcache.save_hierarchy_settings = function(opts, hierarchy, value){\n        set_browser_store(opts,get_prefix(opts) + 'hierarchy_' + hierarchy,value)\n    };\n\n    pedcache.get_hierarchy_settings = function(opts, hierarchy){\n        let value = get_browser_store(opts, get_prefix(opts) + 'hierarchy_' + hierarchy);\n        return value === null ? ['name', 'full_name', 'id', 'age_dob', 'dod_cod', 'ethnicity_country', 'phenotypes_symptoms', 'conditions',\n            'genotypes_can_genes', 'genotypes_con_genes', 'genotypes_car_genes', 'risk_factors_cancers'] : JSON.parse(value)\n    };\n\n    pedcache.get_count = function(opts) {\n        var count;\n        if (has_browser_storage(opts))\n            count = get_browser_store(opts, get_prefix(opts)+'COUNT');\n        else\n            count = dict_cache[get_prefix(opts)+'COUNT'];\n        if(count !== null && count !== undefined)\n            return count;\n        return 0;\n    };\n\n    function set_count(opts, count) {\n        if (has_browser_storage(opts))\n            set_browser_store(opts, get_prefix(opts)+'COUNT', count);\n        else\n            dict_cache[get_prefix(opts)+'COUNT'] = count;\n    }\n\n    pedcache.add = function(opts) {\n        if(!opts.dataset)\n            return;\n        var count = pedcache.get_count(opts);\n        if (has_browser_storage(opts)) {   // local storage\n            //make a clone of the dataset to avoid circular\n            set_browser_store(opts, get_prefix(opts)+count, JSON.stringify(opts.dataset));\n        } else {   // TODO :: array cache\n            console.warn('Local storage not found/supported for this browser!', opts.store_type);\n            max_limit = 500;\n            if(get_arr(opts) === undefined)\n                dict_cache[get_prefix(opts)] = [];\n            get_arr(opts).push(JSON.stringify(opts.dataset));\n        }\n        if(count < max_limit)\n            count++;\n        else\n            count = 0;\n        set_count(opts, count);\n    };\n\n    pedcache.nstore = function(opts) {\n        if(has_browser_storage(opts)) {\n            for(var i=max_limit; i>0; i--) {\n                if(get_browser_store(opts, get_prefix(opts)+(i-1)) !== null)\n                    return i;\n            }\n        } else {\n            return (get_arr(opts) && get_arr(opts).length > 0 ? get_arr(opts).length : -1);\n        }\n        return -1;\n    };\n\n    pedcache.current = function(opts) {\n        var current = pedcache.get_count(opts)-1;\n        if(current == -1)\n            current = max_limit-1;\n        if(has_browser_storage(opts))\n            return JSON.parse(get_browser_store(opts, get_prefix(opts)+current));\n        else if(get_arr(opts))\n            return JSON.parse(get_arr(opts)[current]);\n    };\n\n    pedcache.last = function(opts) {\n        if(has_browser_storage(opts)) {\n            for(var i=max_limit; i>0; i--) {\n                var it = get_browser_store(opts, get_prefix(opts)+(i-1));\n                if(it !== null) {\n                    set_count(opts, i);\n                    return JSON.parse(it);\n                }\n            }\n        } else {\n            var arr = get_arr(opts);\n            if(arr)\n                return JSON.parse(arr(arr.length-1));\n        }\n        return undefined;\n    };\n\n    pedcache.previous = function(opts, previous) {\n        if(previous === undefined)\n            previous = pedcache.get_count(opts) - 2;\n\n        if(previous < 0) {\n            var nstore = pedcache.nstore(opts);\n            if(nstore < max_limit)\n                previous = nstore - 1;\n            else\n                previous = max_limit - 1;\n        }\n        set_count(opts, previous + 1);\n        if(has_browser_storage(opts))\n            return JSON.parse(get_browser_store(opts, get_prefix(opts)+previous));\n        else\n            return JSON.parse(get_arr(opts)[previous]);\n    };\n\n    pedcache.next = function(opts, next) {\n        if(next === undefined)\n            next = pedcache.get_count(opts);\n        if(next >= max_limit)\n            next = 0;\n\n        set_count(opts, parseInt(next) + 1);\n        if(has_browser_storage(opts))\n            return JSON.parse(get_browser_store(opts, get_prefix(opts)+next));\n        else\n            return JSON.parse(get_arr(opts)[next]);\n    };\n\n    pedcache.clear = function(opts) {\n        if(has_browser_storage(opts))\n            clear_browser_store(opts);\n        dict_cache = {};\n    };\n\n    // zoom - store translation coords\n    pedcache.setposition = function(opts, x, y, zoom) {\n        if(has_browser_storage(opts)) {\n            set_browser_store(opts, get_prefix(opts)+'_X', x);\n            set_browser_store(opts, get_prefix(opts)+'_Y', y);\n            if(zoom)\n                set_browser_store(opts, get_prefix(opts)+'_ZOOM', zoom);\n        } else {\n            //TODO\n        }\n    };\n\n    pedcache.getposition = function(opts) {\n        if(!has_browser_storage(opts) ||\n            (localStorage.getItem(get_prefix(opts)+'_X') === null &&\n                sessionStorage.getItem(get_prefix(opts)+'_X') === null))\n            return [null, null];\n        var pos = [parseInt(get_browser_store(opts, get_prefix(opts)+'_X')),\n            parseInt(get_browser_store(opts, get_prefix(opts)+'_Y'))];\n        if(get_browser_store(opts,get_prefix(opts)+'_ZOOM') !== null)\n            pos.push(parseFloat(get_browser_store(opts, get_prefix(opts)+'_ZOOM')));\n        return pos;\n    };\n\n}(window.pedcache = window.pedcache || {}, jQuery));\n","// pedigree widgets\n(function (widgets, $, undefined) {\n\n    function getTranslation(transform) {\n        // Create a dummy g for calculation purposes only. This will never\n        // be appended to the DOM and will be discarded once this function\n        // returns.\n        var g = document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\");\n\n        // Set the transform attribute to the provided string value.\n        g.setAttributeNS(null, \"transform\", transform);\n\n        // consolidate the SVGTransformList containing all transformations\n        // to a single SVGTransform of type SVG_TRANSFORM_MATRIX and get\n        // its SVGMatrix.\n        var matrix = g.transform.baseVal.consolidate().matrix;\n\n        // As per definition values e and f are the ones for the translation.\n        return [matrix.e, matrix.f];\n    }\n\n    var dragging;\n    var last_mouseover;\n    //\n    // Add widgets to nodes and bind events\n    widgets.addWidgets = function (opts, node) {\n        let malePathData =\n            `M730 1285 l0 -215 -193 0 c-189 0 -194 -1 -215 -23 -22 -23 -22 -26\n        -22 -448 l0 -426 23 -21 c23 -22 26 -22 443 -22 l421 0 21 23 c22 23 22 26 22\n        448 l0 426 -23 21 c-22 21 -32 22 -215 22 l-192 0 0 215 0 215 -35 0 -35 0 0\n        -215z m418 -307 c17 -17 17 -739 0 -756 -17 -17 -749 -17 -766 0 -17 17 -17\n        739 0 756 17 17 749 17 766 0z`,\n            femalePathData = `M690 1286 l0 -214 -32 -6 c-79 -16 -88 -19 -88 -27 0 -5 -6 -9 -14\n        -9 -28 0 -112 -56 -163 -107 -51 -52 -100 -141 -122 -219 -24 -90 -10 -213 35\n        -311 34 -72 115 -166 156 -179 10 -3 18 -10 18 -15 0 -5 7 -9 15 -9 8 0 15 -4\n        15 -10 0 -5 9 -10 20 -10 11 0 20 -4 20 -9 0 -20 169 -42 238 -31 101 17 122\n        22 122 31 0 5 7 9 16 9 21 0 101 55 146 102 44 44 88 111 88 133 0 8 3 15 8\n        15 26 0 42 217 21 295 -33 126 -137 252 -250 303 -74 33 -128 52 -152 52 -15\n        0 -17 20 -17 215 l0 215 -40 0 -40 0 0 -214z m172 -314 c7 -7 20 -12 30 -12\n        10 0 18 -4 18 -10 0 -5 5 -10 10 -10 30 0 98 -62 141 -127 59 -91 78 -178 60\n        -284 -14 -86 -43 -140 -111 -209 -55 -55 -69 -65 -145 -95 -57 -23 -209 -23\n        -272 1 -90 33 -174 108 -220 197 -26 48 -28 61 -28 172 0 86 4 129 15 153 8\n        17 18 32 22 32 5 0 8 5 8 11 0 31 119 149 151 149 5 0 9 5 9 10 0 6 8 10 18\n        10 10 0 22 4 28 9 15 15 54 19 156 17 61 -1 102 -6 110 -14z`,\n            unspecifiedPathData = `M770 1323 l0 -176 -260 -260 c-219 -219 -260 -264 -260 -288 0 -25\n        41 -70 265 -294 221 -220 270 -265 294 -265 23 0 72 45 294 267 219 218 267\n        271 267 293 0 23 -47 75 -260 287 l-260 260 0 177 0 176 -40 0 -40 0 0 -177z\n        m274 -478 c136 -136 226 -233 226 -244 0 -27 -436 -461 -463 -461 -30 0 -457\n        427 -457 456 0 15 49 70 151 170 83 82 161 160 173 173 11 13 32 34 45 45 13\n        12 38 36 54 54 17 17 33 32 37 32 4 0 109 -101 234 -225`,\n            abortionPathData = `M770 1295 l0 -204 -39 -55 c-21 -31 -44 -69 -51 -86 -7 -16 -16 -30\n        -21 -30 -5 0 -9 -7 -9 -15 0 -8 -4 -15 -10 -15 -5 0 -10 -4 -10 -10 0 -5 -20\n        -41 -45 -80 -25 -39 -45 -75 -45 -80 0 -6 -4 -10 -10 -10 -5 0 -10 -5 -10 -11\n        0 -6 -20 -42 -45 -80 -25 -38 -45 -74 -45 -79 0 -6 -4 -10 -9 -10 -5 0 -13\n        -10 -17 -22 -4 -12 -31 -60 -60 -106 -30 -45 -54 -87 -54 -92 0 -6 -4 -10 -10\n        -10 -17 0 -11 -46 12 -89 l22 -41 497 0 497 0 21 45 c12 25 21 49 21 55 0 10\n        -21 51 -30 60 -11 10 -130 212 -130 220 0 5 -3 10 -8 12 -9 4 -82 126 -82 139\n        0 5 -4 9 -10 9 -5 0 -10 6 -10 14 0 8 -3 16 -8 18 -9 4 -82 126 -82 139 0 5\n        -4 9 -8 9 -5 0 -30 39 -57 88 -27 48 -55 93 -62 100 -10 10 -13 62 -13 218 l0\n        204 -40 0 -40 0 0 -205z m73 -330 c12 -22 25 -41 30 -43 4 -2 7 -8 7 -13 0 -6\n        5 -15 10 -22 9 -11 49 -74 91 -147 8 -14 17 -27 20 -30 4 -3 16 -24 27 -46 12\n        -23 27 -48 35 -55 7 -8 21 -32 31 -54 11 -22 22 -42 25 -45 3 -3 12 -16 20\n        -30 33 -56 81 -136 88 -146 35 -46 41 -79 17 -88 -9 -3 -209 -6 -445 -6 -381\n        0 -430 2 -436 16 -5 14 9 53 30 79 7 9 42 66 88 145 8 13 20 30 27 38 6 7 12\n        18 12 23 0 6 18 37 40 69 22 32 40 63 40 69 0 5 6 16 13 23 6 8 18 25 26 38\n        53 90 82 137 91 147 5 7 10 17 10 23 0 5 5 10 10 10 6 0 10 4 10 9 0 18 42 82\n        52 79 5 -2 19 -21 31 -43z`,\n            dztwinPathData = `M987 1503 c-4 -3 -7 -78 -7 -166 0 -152 -1 -160 -22 -178 -13 -10\n        -29 -18 -35 -19 -7 0 -13 -3 -13 -8 0 -4 -36 -30 -80 -57 -44 -27 -80 -53 -80\n        -57 0 -5 -5 -8 -10 -8 -12 0 -94 -52 -98 -62 -2 -5 -10 -8 -18 -8 -8 0 -14 -4\n        -14 -8 0 -5 -12 -15 -27 -23 -16 -8 -49 -29 -74 -46 l-46 -33 -159 0 c-141 0\n        -162 -3 -184 -20 l-25 -19 -3 -323 c-4 -373 -2 -400 34 -417 17 -7 131 -11\n        363 -11 326 0 338 1 359 20 22 21 22 23 22 373 0 194 -4 357 -8 363 -17 26\n        -56 34 -161 34 -67 0 -111 4 -111 10 0 6 7 10 15 10 8 0 15 4 15 8 0 5 18 17\n        40 27 22 10 40 22 40 27 0 4 5 8 10 8 6 0 19 8 30 18 10 9 36 26 57 37 35 18\n        56 33 87 60 6 6 28 19 49 30 21 11 47 28 57 38 11 9 22 17 25 17 3 0 59 -35\n        123 -77 64 -43 121 -80 127 -82 5 -2 18 -12 29 -23 11 -10 24 -18 28 -18 5 0\n        18 -8 29 -19 11 -10 37 -27 59 -37 22 -10 40 -22 40 -26 0 -5 -52 -8 -116 -8\n        -101 0 -120 -3 -145 -21 l-29 -20 0 -350 c0 -344 0 -349 22 -374 l22 -25 345\n        0 c293 1 349 3 366 16 19 14 20 28 23 369 l3 355 -27 25 c-26 24 -31 25 -181\n        25 -131 0 -159 3 -181 18 -46 29 -66 42 -82 49 -8 4 -24 15 -34 25 -11 10 -25\n        18 -32 18 -7 0 -14 4 -16 8 -1 5 -48 37 -103 72 -55 36 -102 67 -105 70 -13\n        14 -70 50 -80 50 -5 0 -10 4 -10 9 0 5 -9 13 -20 16 -19 6 -20 15 -20 176 l0\n        169 -28 0 c-16 0 -32 -3 -35 -7z m-187 -1062 c0 -282 -2 -320 -16 -325 -20 -8\n        -588 -8 -608 0 -14 5 -16 43 -16 318 0 172 3 316 7 319 3 4 147 7 320 7 l313\n        0 0 -319z m1068 307 c9 -9 12 -93 12 -315 0 -289 -1 -303 -19 -313 -21 -11\n        -587 -15 -615 -4 -14 5 -16 43 -16 318 0 172 3 316 7 319 3 4 144 7 313 7 225\n        0 309 -3 318 -12z`,\n            mztwinPathData = `M1027 1503 c-4 -3 -7 -78 -7 -166 0 -152 -1 -160 -22 -178 -13 -10\n        -29 -18 -35 -19 -7 0 -13 -3 -13 -8 0 -4 -36 -30 -80 -57 -44 -27 -80 -53 -80\n        -57 0 -5 -5 -8 -10 -8 -12 0 -94 -52 -98 -62 -2 -5 -10 -8 -18 -8 -8 0 -14 -4\n        -14 -8 0 -5 -12 -15 -27 -23 -16 -8 -49 -29 -74 -46 l-46 -33 -159 0 c-141 0\n        -162 -3 -184 -20 l-25 -19 -3 -323 c-4 -373 -2 -400 34 -417 17 -7 131 -11\n        363 -11 326 0 338 1 359 20 22 21 22 23 22 373 0 194 -4 357 -8 363 -17 26\n        -56 34 -161 34 -67 0 -111 4 -111 10 0 6 7 10 15 10 8 0 15 4 15 8 0 5 18 17\n        40 27 22 10 40 22 40 27 0 4 7 8 15 8 8 0 15 4 15 8 0 5 15 17 33 26 28 15 60\n        17 267 14 228 -3 236 -4 260 -25 13 -13 28 -23 32 -23 5 0 18 -8 29 -19 11\n        -10 37 -27 59 -37 22 -10 40 -22 40 -26 0 -5 -52 -8 -116 -8 -101 0 -120 -3\n        -145 -21 l-29 -20 0 -350 0 -350 25 -24 24 -25 343 0 c290 1 346 3 363 16 19\n        14 20 28 23 369 l3 355 -27 25 c-26 24 -31 25 -181 25 -131 0 -159 3 -181 18\n        -46 29 -66 42 -82 49 -8 4 -24 15 -34 25 -11 10 -25 18 -32 18 -7 0 -14 4 -16\n        8 -1 5 -48 37 -103 72 -55 36 -102 67 -105 70 -13 14 -70 50 -80 50 -5 0 -10\n        4 -10 9 0 5 -9 13 -20 16 -19 6 -20 15 -20 176 l0 169 -28 0 c-16 0 -32 -3\n        -35 -7z m92 -420 c34 -21 61 -41 61 -45 0 -5 -57 -8 -126 -8 -139 0 -140 1\n        -46 55 17 11 32 23 32 27 0 15 19 8 79 -29z m-279 -642 c0 -282 -2 -320 -16\n        -325 -20 -8 -588 -8 -608 0 -14 5 -16 43 -16 318 0 172 3 316 7 319 3 4 147 7\n        320 7 l313 0 0 -319z m1068 307 c9 -9 12 -93 12 -315 0 -289 -1 -303 -19 -313\n        -21 -11 -587 -15 -615 -4 -14 5 -16 43 -16 318 0 172 3 316 7 319 3 4 144 7\n        313 7 225 0 309 -3 318 -12z`;\n\n        // popup gender selection box\n        var font_size = parseInt($(\"body\").css('font-size'));\n        var popup_selection = d3.select('.diagram');\n        popup_selection.append(\"rect\").attr(\"class\", \"popup_selection\")\n            .attr(\"rx\", 6)\n            .attr(\"ry\", 6)\n            .attr(\"transform\", \"translate(-1000,-100)\")\n            .style(\"opacity\", 0)\n            .attr(\"width\", 186)\n            .attr(\"height\", 36.4)\n            .style(\"stroke\", \"darkgrey\")\n            .attr(\"fill\", \"white\");\n\n        /*male section*/\n        var square = popup_selection.append(\"g\")\n            .style(\"opacity\", 0)\n            .attr(\"class\", \"popup_selection\");\n        square.append('rect')\n            .attr('x', 6)\n            .attr('y', 2)\n            .attr('width', 18)\n            .attr('height', 25)\n            .attr('stroke-width', 2)\n            .attr('fill', 'transparent')\n            .attr('class', 'persontype fa-square');\n        square.append('g')\n            .attr('transform', 'translate(30.200000,32.200000) scale(0.0200000,0.0200000)')\n            .style('fill', 'black')\n            .style('stroke', 'none')\n            .style('stroke', 'none')\n            .append('g')\n            .attr('transform', 'rotate(180)')\n            .append('path')\n            .attr('d', malePathData);\n        var square_title = square.append(\"svg:title\").text(\"add male\");\n\n        /*female section*/\n        var circle = popup_selection.append(\"g\")\n            .style(\"opacity\", 0)\n            .attr(\"class\", \"popup_selection\");\n        circle.append('rect')\n            .attr('x', 28)\n            .attr('y', 2)\n            .attr('width', 18)\n            .attr('height', 25)\n            .attr('stroke-width', 2)\n            .attr('fill', 'transparent')\n            .attr('class', 'persontype fa-circle');\n        circle.append('g')\n            .attr('transform', 'translate(52.800000,32.200000) scale(0.0200000,0.0200000)')\n            .style('fill', 'black')\n            .style('stroke', 'none')\n            .append('g')\n            .attr('transform', 'rotate(180)')\n            .append('path')\n            .attr('d', femalePathData);\n        var circle_title = circle.append(\"svg:title\").text(\"add female\");\n\n        /*unspecified section*/\n        var unspecified = popup_selection.append(\"g\")\n            .style(\"opacity\", 0)\n            .attr(\"class\", \"popup_selection\");\n        unspecified.append('rect')\n            .attr('x', 50)\n            .attr('y', 2)\n            .attr('width', 18)\n            .attr('height', 28)\n            .attr('stroke-width', 2)\n            .attr('fill', 'transparent')\n            .attr('class', 'persontype fa-unspecified');\n        unspecified.append('g')\n            .attr('transform', 'translate(76.800000,32.200000) scale(0.0200000,0.0200000)')\n            .style('fill', 'black')\n            .style('stroke', 'none')\n            .append('g')\n            .attr('transform', 'rotate(180)')\n            .append('path')\n            .attr('d', unspecifiedPathData);\n        var unspecified_title = unspecified.append(\"svg:title\").text(\"add unspecified\");\n\n        /*abortion section*/\n        var abortion = popup_selection.append(\"g\")\n            .style(\"opacity\", 0)\n            .attr(\"class\", \"popup_selection\");\n        abortion.append('rect')\n            .attr('x', 73)\n            .attr('y', 2)\n            .attr('width', 22)\n            .attr('height', 28)\n            .attr('stroke-width', 2)\n            .attr('fill', 'transparent')\n            .attr('class', 'persontype fa-abortion');\n        abortion.append('g')\n            .attr('transform', 'translate(98.800000,32.200000) scale(0.0200000,0.0200000)')\n            .style('fill', 'black')\n            .style('stroke', 'none')\n            .append('g')\n            .attr('transform', 'rotate(180)')\n            .append('path')\n            .attr('d', abortionPathData);\n        var abortion_title = abortion.append(\"svg:title\").text(\"add abortion\");\n\n        /*dztwin section*/\n        var dztwin = popup_selection.append(\"g\")\n            .style(\"opacity\", 0)\n            .attr(\"class\", \"popup_selection\");\n        dztwin.append('rect')\n            .attr('x', 96)\n            .attr('y', 2)\n            .attr('width', 40)\n            .attr('height', 28)\n            .attr('stroke-width', 2)\n            .attr('fill', 'transparent')\n            .attr('class', 'persontype fa-angle-up dztwin');\n        dztwin.append('g')\n            .attr('transform', 'translate(134.800000,30.200000) scale(0.0200000,0.0200000)')\n            .style('fill', 'black')\n            .style('stroke', 'none')\n            .append('g')\n            .attr('transform', 'rotate(180)')\n            .append('path')\n            .attr('d', dztwinPathData);\n        var dztwin_title = dztwin.append(\"svg:title\").text(\"add dizygotic/fraternal twins\");\n\n        var mztwin = popup_selection.append(\"g\")\n            .style(\"opacity\", 0)\n            .attr(\"class\", \"popup_selection\");\n        mztwin.append('rect')\n            .attr('x', 140)\n            .attr('y', 2)\n            .attr('width', 40)\n            .attr('height', 28)\n            .attr('stroke-width', 2)\n            .attr('fill', 'transparent')\n            .attr('class', 'fa-caret-up persontype mztwin');\n        mztwin.append('g')\n            .attr('transform', 'translate(179.800000,30.200000) scale(0.0200000,0.0200000)')\n            .style('fill', 'black')\n            .style('stroke', 'none')\n            .append('g')\n            .attr('transform', 'rotate(180)')\n            .append('path')\n            .attr('d', mztwinPathData);\n        var mztwin_title = mztwin.append(\"svg:title\").text(\"add monozygotic/identical twins\");\n\n        var add_person = {};\n        // click the person type selection\n        d3.selectAll(\".persontype\")\n            .on(\"click\", function () {\n                var newdataset = ptree.copy_dataset(opts.dataset);\n                var mztwin = d3.select(this).classed(\"mztwin\");\n                var dztwin = d3.select(this).classed(\"dztwin\");\n                var abortion = d3.select(this).classed(\"fa-abortion\");\n                var twin_type;\n                var sex;\n                if (mztwin || dztwin) {\n                    sex = add_person.node.datum().data.sex;\n                    twin_type = (mztwin ? \"mztwin\" : \"dztwin\");\n                } else {\n                    sex = d3.select(this).classed(\"fa-square\") ? 'M' : (d3.select(this).classed(\"fa-circle\") ? 'F' : 'U');\n                }\n\n                if (add_person.type === 'addsibling')\n                    ptree.addsibling(newdataset, add_person.node.datum().data, sex, false, twin_type, abortion);\n                else if (add_person.type === 'addchild')\n                    ptree.addchild(newdataset, add_person.node.datum().data, (twin_type ? 'U' : sex), (twin_type ? 2 : 1), twin_type, abortion);\n                else\n                    return;\n                opts.dataset = newdataset;\n                ptree.rebuild(opts);\n                d3.selectAll('.popup_selection').style(\"opacity\", 0);\n                add_person = {};\n            })\n            .on(\"mouseover\", function () {\n                if (add_person.node)\n                    add_person.node.select('rect').style(\"opacity\", 0.2);\n                d3.selectAll('.popup_selection').style(\"opacity\", 1);\n                // add tooltips to font awesome widgets\n                if (add_person.type === 'addsibling') {\n                    if (d3.select(this).classed(\"fa-square\"))\n                        square_title.text(\"add brother\");\n                    else\n                        circle_title.text(\"add sister\");\n                } else if (add_person.type === 'addchild') {\n                    if (d3.select(this).classed(\"fa-square\"))\n                        square_title.text(\"add son\");\n                    else\n                        circle_title.text(\"add daughter\");\n                }\n            });\n\n        // handle mouse out of popup selection\n        d3.selectAll(\".popup_selection\").on(\"mouseout\", function () {\n            // hide rect and popup selection\n            if (add_person.node !== undefined && highlight.indexOf(add_person.node.datum()) == -1)\n                add_person.node.select('rect').style(\"opacity\", 0);\n            d3.selectAll('.popup_selection').style(\"opacity\", 0);\n        });\n\n\n        // drag line between nodes to create partners\n        drag_handle(opts);\n\n        // rectangle used to highlight on mouse over\n        node.append(\"rect\")\n            .filter(function (d) {\n                return d.data.hidden && !opts.DEBUG ? false : true;\n            })\n            .attr(\"class\", 'indi_rect')\n            .attr(\"rx\", 6)\n            .attr(\"ry\", 6)\n            .attr(\"x\", function (d) {\n                return -0.75 * opts.symbol_size;\n            })\n            .attr(\"y\", function (d) {\n                return -opts.symbol_size;\n            })\n            .attr(\"width\", (1.5 * opts.symbol_size) + 'px')\n            .attr(\"height\", (2 * opts.symbol_size) + 'px')\n            .style(\"stroke\", \"black\")\n            .style(\"stroke-width\", 0.7)\n            .style(\"opacity\", 0)\n            .attr(\"fill\", \"lightgrey\");\n\n        // widgets\n        var fx = function (d) {\n            return off - 0.75 * opts.symbol_size;\n        };\n        var fy = opts.symbol_size - 2;\n        var off = 0;\n        var widgets = {\n            'addchild': {'text': '\\uf063', 'title': 'add child', 'fx': fx, 'fy': fy},\n            'addsibling': {'text': '\\uf234', 'title': 'add sibling', 'fx': fx, 'fy': fy},\n            'addpartner': {'text': '\\uf0c1', 'title': 'add partner', 'fx': fx, 'fy': fy},\n            'addparents': {\n                'text': '\\uf062', 'title': 'add parents',\n                'fx': -0.75 * opts.symbol_size,\n                'fy': -opts.symbol_size + 11\n            },\n            'delete': {\n                'text': 'X', 'title': 'delete',\n                'fx': opts.symbol_size / 2 - 1,\n                'fy': -opts.symbol_size + 12,\n                'styles': {\"font-weight\": \"bold\", \"fill\": \"darkred\", \"font-family\": \"monospace\"}\n            }\n        };\n\n        for (var key in widgets) {\n            var widget = node.append(\"text\")\n                .filter(function (d) {\n                    return (d.data.hidden && !opts.DEBUG ? false : true) &&\n                        !((d.data.mother === undefined || d.data.noparents) && key === 'addsibling') &&\n                        !(d.data.parent_node !== undefined && d.data.parent_node.length > 1 && key === 'addpartner') &&\n                        !(d.data.parent_node === undefined && key === 'addchild') &&\n                        !((d.data.noparents === undefined && d.data.top_level === undefined) && key === 'addparents');\n                })\n                .attr(\"class\", key)\n                .style(\"opacity\", 0)\n                .attr('font-family', 'FontAwesome')\n                .attr(\"xx\", function (d) {\n                    return d.x;\n                })\n                .attr(\"yy\", function (d) {\n                    return d.y;\n                })\n                .attr(\"x\", widgets[key].fx)\n                .attr(\"y\", widgets[key].fy)\n                .attr('font-size', '0.9em')\n                .text(widgets[key].text);\n\n            if ('styles' in widgets[key])\n                for (var style in widgets[key].styles) {\n                    widget.attr(style, widgets[key].styles[style]);\n                }\n\n            widget.append(\"svg:title\").text(widgets[key].title);\n            off += 17;\n        }\n\n        // add sibling or child\n        d3.selectAll(\".addsibling, .addchild\")\n            .on(\"mouseover\", function () {\n                var type = d3.select(this).attr('class');\n                d3.selectAll('.popup_selection').style(\"opacity\", 1);\n                add_person = {'node': d3.select(this.parentNode), 'type': type};\n\n                //var translate = getTranslation(d3.select('.diagram').attr(\"transform\"));\n                var x = parseInt(d3.select(this).attr(\"xx\")) + parseInt(d3.select(this).attr(\"x\"));\n                var y = parseInt(d3.select(this).attr(\"yy\")) + parseInt(d3.select(this).attr(\"y\"));\n                d3.selectAll('.popup_selection').attr(\"transform\", \"translate(\" + x + \",\" + (y + 4) + \")\");\n                d3.selectAll('.popup_selection_rotate45')\n                    .attr(\"transform\", \"translate(\" + (x + 3 * font_size) + \",\" + (y + (font_size * 1.2)) + \") rotate(45)\");\n            });\n\n        // handle widget clicks\n        d3.selectAll(\".addchild, .addpartner, .addparents, .delete, .settings\")\n            .on(\"click\", function () {\n                d3.event.stopPropagation();\n                var opt = d3.select(this).attr('class');\n                var d = d3.select(this.parentNode).datum();\n                if (opts.DEBUG) {\n                    console.log(opt);\n                }\n\n                var newdataset;\n                if (opt === 'settings') {\n                    if (typeof opts.edit === 'function') {\n                        opts.edit(opts, d);\n                    }\n                } else if (opt === 'delete') {\n                    newdataset = ptree.copy_dataset(opts.dataset);\n\n                    function onDone(opts, dataset) {\n                        // assign new dataset and rebuild pedigree\n                        opts.dataset = dataset;\n                        ptree.rebuild(opts);\n                    }\n\n                    ptree.delete_node_dataset(newdataset, d.data, opts, onDone);\n                } else if (opt === 'addparents') {\n                    newdataset = ptree.copy_dataset(opts.dataset);\n                    opts.dataset = newdataset;\n                    ptree.addparents(opts, newdataset, d.data.name);\n                    ptree.rebuild(opts);\n                } else if (opt === 'addpartner') {\n                    newdataset = ptree.copy_dataset(opts.dataset);\n                    ptree.addpartner(opts, newdataset, d.data.name);\n                    opts.dataset = newdataset;\n                    ptree.rebuild(opts);\n                }\n                // trigger fhChange event\n                $(document).trigger('fhChange', [opts]);\n            });\n\n        // other mouse events\n        var highlight = [];\n\n        node.filter(function (d) {\n            return !d.data.hidden;\n        })\n            .on(\"click\", function (d) {\n                if (d3.event.ctrlKey) {\n                    if (highlight.indexOf(d) == -1)\n                        highlight.push(d);\n                    else\n                        highlight.splice(highlight.indexOf(d), 1);\n                } else\n                    highlight = [d];\n\n                if ('nodeclick' in opts) {\n                    opts.nodeclick(d.data);\n                    d3.selectAll(\".indi_rect\").style(\"opacity\", 0);\n                    d3.selectAll('.indi_rect').filter(function (d) {\n                        return highlight.indexOf(d) != -1;\n                    }).style(\"opacity\", 0.5);\n                }\n                let e = d3.event;\n                openTabbedDialog(opts, d, e);\n            })\n            .on(\"mouseover\", function (d) {\n                d3.event.stopPropagation();\n                last_mouseover = d;\n                if (dragging) {\n                    if (dragging.data.name !== last_mouseover.data.name &&\n                        dragging.data.sex !== last_mouseover.data.sex) {\n                        d3.select(this).select('rect').style(\"opacity\", 0.2);\n                    }\n                    return;\n                }\n                d3.select(this).select('rect').style(\"opacity\", 0.2);\n                d3.select(this).selectAll('.addchild, .addsibling, .addpartner, .addparents, .delete, .settings').style(\"opacity\", 1);\n                d3.select(this).selectAll('.indi_details').style(\"opacity\", 0);\n                setLineDragPosition(opts.symbol_size - 10, 0, opts.symbol_size - 2, 0, d.x + \",\" + (d.y + 2));\n            })\n            .on(\"mouseout\", function (d) {\n                if (dragging)\n                    return;\n\n                d3.select(this).selectAll('.addchild, .addsibling, .addpartner, .addparents, .delete, .settings').style(\"opacity\", 0);\n                if (highlight.indexOf(d) == -1)\n                    d3.select(this).select('rect').style(\"opacity\", 0);\n                d3.select(this).selectAll('.indi_details').style(\"opacity\", 1);\n                // hide popup if it looks like the mouse is moving north\n                if (d3.mouse(this)[1] < 0.8 * opts.symbol_size)\n                    d3.selectAll('.popup_selection').style(\"opacity\", 0);\n                if (!dragging) {\n                    // hide popup if it looks like the mouse is moving north, south or west\n                    if (Math.abs(d3.mouse(this)[1]) > 0.25 * opts.symbol_size ||\n                        Math.abs(d3.mouse(this)[1]) < -0.25 * opts.symbol_size ||\n                        d3.mouse(this)[0] < 0.2 * opts.symbol_size) {\n                        setLineDragPosition(0, 0, 0, 0);\n                    }\n                }\n            });\n    };\n\n    // drag line between nodes to create partners\n    function drag_handle(opts) {\n        var line_drag_selection = d3.select('.diagram');\n        line_drag_selection.append(\"line\").attr(\"class\", 'line_drag_selection')\n            .attr(\"stroke-width\", 6)\n            .style(\"stroke-dasharray\", (\"2, 1\"))\n            .attr(\"stroke\", \"black\")\n            .call(d3.drag()\n                .on(\"start\", dragstart)\n                .on(\"drag\", drag)\n                .on(\"end\", dragstop));\n        setLineDragPosition(0, 0, 0, 0);\n\n        function dragstart(d) {\n            d3.event.sourceEvent.stopPropagation();\n            dragging = last_mouseover;\n            d3.selectAll('.line_drag_selection')\n                .attr(\"stroke\", \"darkred\");\n        }\n\n        function dragstop(d) {\n            if (last_mouseover &&\n                dragging.data.name !== last_mouseover.data.name &&\n                dragging.data.sex !== last_mouseover.data.sex) {\n                // make partners\n                var child = {\n                    \"name\": ptree.makeid(4), \"sex\": 'U',\n                    \"mother\": (dragging.data.sex === 'F' ? dragging.data.name : last_mouseover.data.name),\n                    \"father\": (dragging.data.sex === 'F' ? last_mouseover.data.name : dragging.data.name)\n                };\n                newdataset = ptree.copy_dataset(opts.dataset);\n                opts.dataset = newdataset;\n\n                var idx = pedigree_util.getIdxByName(opts.dataset, dragging.data.name) + 1;\n                opts.dataset.splice(idx, 0, child);\n                ptree.rebuild(opts);\n            }\n            setLineDragPosition(0, 0, 0, 0);\n            d3.selectAll('.line_drag_selection')\n                .attr(\"stroke\", \"black\");\n            dragging = undefined;\n            return;\n        }\n\n        function drag(d) {\n            d3.event.sourceEvent.stopPropagation();\n            var dx = d3.event.dx;\n            var xnew = parseFloat(d3.select(this).attr('x2')) + dx;\n            setLineDragPosition(opts.symbol_size - 10, 0, xnew, 0);\n        }\n    }\n\n    function setLineDragPosition(x1, y1, x2, y2, translate) {\n        if (translate)\n            d3.selectAll('.line_drag_selection').attr(\"transform\", \"translate(\" + translate + \")\");\n        d3.selectAll('.line_drag_selection')\n            .attr(\"x1\", x1)\n            .attr(\"y1\", y1)\n            .attr(\"x2\", x2)\n            .attr(\"y2\", y2);\n    }\n\n    function capitaliseFirstLetter(string) {\n        return string.charAt(0).toUpperCase() + string.slice(1);\n    }\n\n    // if opt.edit is set true (rather than given a function) this is called to edit node attributes\n    widgets.openNodeLinkDialog = function (opts, d, e) {\n        let currentNode_tabs = $('#node_link');\n        if (currentNode_tabs.length > 0) {\n            currentNode_tabs.remove();\n        }\n        let $targetDiv = $('#' + opts.targetDiv);\n        $targetDiv.append('<div id=\"node_link\"></div>');\n        let $node_link = $('#node_link');\n        let dialogWidth = ($(window).width() > 400 ? 450 : $(window).width() - 30)\n        ;\n        $node_link.dialog({\n            autoOpen: false,\n            appendTo: '#pedigrees',\n            width: dialogWidth\n        });\n        let motherName = d.source.data.mother.name;\n        let fatherName = d.source.data.father.name;\n        let consanguity = d.source.data.mother.consanguity;\n        let divorced = d.source.data.mother.divorced && d.source.data.mother.divorced === d.source.data.father.name;\n        let table = `<table class=\"table\">\n        <tr><td colspan=\"3\"><strong>Consanguinity of this Relationship?</strong></td></tr>\n             <tr>\n             <td colspan=\"1\">\n           <label class=\"radio-inline\"><input type=\"radio\" name=\"consanguity\" value=\"auto\" ${(!consanguity || consanguity === 'auto') ? 'checked' : ''}>Automatic</label><br /><br />\n           <label class=\"checkbox-inline\" style=\"margin-left: 8px\"><input type=\"checkbox\" name=\"separated\" ${divorced ? 'checked' : ''} value=\"separated\">Separated</label>\n        </td>\n         <td colspan=\"1\">\n         <label class=\"radio-inline\"><input type=\"radio\" name=\"consanguity\" value=\"yes\" ${consanguity && consanguity === 'yes' ? 'checked' : ''} >Yes</label>\n         </td>\n         <td colspan=\"1\">\n         <label class=\"radio-inline\"><input type=\"radio\" name=\"consanguity\" value=\"no\" ${consanguity && consanguity === 'no' ? 'checked' : ''} >No</label>\n         </td>\n        </tr>\n             </table>`;\n        let x = e.pageX + 30;\n        let y = e.pageY - 20;\n        if (x + dialogWidth > $targetDiv.width()) {\n            panZoom.translateX(opts, -(x + dialogWidth - $targetDiv.width()))\n            x = x - (x + dialogWidth - $targetDiv.width());\n        }\n        $node_link.html(table);\n        $node_link.dialog('option', 'position', {my: \"left top\", at: \"left+\" + x + \" top+\" + y + \"\", of: window});\n        $node_link.dialog('open');\n        opts.dataset = ptree.copy_dataset(pedcache.current(opts));\n        $(\"#node_link input:radio\").on('change', function () {\n            let consanguity = $('input[name=consanguity]:checked').val();\n            if (consanguity === 'yes') {\n                $.each(opts.dataset, function (index, value) {\n                    if (value.name === motherName) {\n                        opts.dataset[index].consanguity = 'yes';\n                    }\n                    if (value.name === fatherName) {\n                        opts.dataset[index].consanguity = 'yes';\n                    }\n                });\n            } else if (consanguity === 'no') {\n                $.each(opts.dataset, function (index, value) {\n                    if (value.name === motherName) {\n                        opts.dataset[index].consanguity = 'no';\n                    }\n                    if (value.name === fatherName) {\n                        opts.dataset[index].consanguity = 'no';\n                    }\n                });\n            } else {\n                $.each(opts.dataset, function (index, value) {\n                    if (value.name === motherName) {\n                        delete opts.dataset[index].consanguity;\n                    }\n                    if (value.name === fatherName) {\n                        delete opts.dataset[index].consanguity;\n                    }\n                });\n            }\n            ptree.rebuild(opts);\n\n        });\n\n        $(\"#node_link input:checkbox\").change(function () {\n            if ($(this).is(':checked')) {\n                $.each(opts.dataset, function (index, value) {\n                    if (value.name === motherName) {\n                        opts.dataset[index].divorced = fatherName\n                    }\n                    if (value.name === fatherName) {\n                        opts.dataset[index].divorced = motherName\n                    }\n                });\n            } else {\n                $.each(opts.dataset, function (index, value) {\n                    if (value.name === motherName) {\n                        delete opts.dataset[index].divorced;\n                    }\n                    if (value.name === fatherName) {\n                        delete opts.dataset[index].divorced;\n                    }\n                });\n            }\n            ptree.rebuild(opts);\n\n        });\n    };\n\n    // remove any dialog currently sh0wing\n    widgets.removeDialogs = function () {\n        dialog = $('#node_tabs');\n        if (dialog.length > 0) {\n            dialog.remove();\n        }\n    };\n\n    // if opt.edit is set true (rather than given a function) this is called to edit node attributes\n    function openTabbedDialog(opts, d, e) {\n        let currentNode_tabs = $('#node_tabs');\n        if (currentNode_tabs.length > 0) {\n            currentNode_tabs.remove();\n        }\n        let $targetDiv = $('#' + opts.targetDiv);\n        $targetDiv.append('<div id=\"node_tabs\"></div>');\n        let $node_tabs = $('#node_tabs');\n        let dialogWidth = ($(window).width() > 400 ? 450 : $(window).width() - 30);\n        $node_tabs.dialog({\n            autoOpen: false,\n            appendTo: '#pedigrees',\n            width: dialogWidth\n        });\n        //add tabs\n        let name = d.data.full_name ? d.data.full_name : \"\";\n        let isChildNode =  pedigree_util.isChildNode(opts, d.data.name)\n        let tabHeader = `\n        <div id=\"nodeTabs\" style=\"border: 0; max-height:calc(100vh - 50px); overflow-y: auto;\">\n            <ol>\n                <li><a href=\"#personal\"><span>Personal</span></a></li>\n                <li><a href=\"#clinical\" id=\"clinicalTab\"><span>Clinical</span></a></li>\n                <li><a href=\"#riskFactors\"><span>Risk Factors</span></a></li>\n                <li class=\"ui-tabs-close-button\" style=\"float: right; margin-top: 20px;\">\n                    <button id=\"closeBtn\" type=\"button\"\n                            class=\"ui-button ui-corner-all ui-widget ui-button-icon-only ui-dialog-titlebar-close\"\n                            title=\"Close\"><span class=\"ui-button-icon ui-icon ui-icon-closethick\"></span><span\n                            class=\"ui-button-icon-space\"> </span>Close\n                    </button>\n                </li>\n            </ol>\n        \n            <div id=\"personal\">\n                <input type='hidden' id='id_name' name='name'/>\n        \n                <div><strong>Link to an existing patient record</strong></div>\n                <table class=\"table\">\n                    <tr>\n                        <td colspan=\"3\">\n                            <input class=\"form-control\" type=\"text\" placeholder=\"Type patient name or identifier\"\n                                   style=\" font-size: 12px; padding: 4px; border-radius: 4px\"/>\n                        </td>\n                        <td colspan=\"3\">\n                            <span style=\" text-align: center; margin-right: 8px\">Or</span>\n                            <button class=\"ui-button\" style=\"border-radius: 4px\">Create New</button>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"1\" style=\"text-align: left;\"><strong>Gender:</strong></td>\n                        <td colspan=\"2\"><label class=\"radio-inline\"><input type=\"radio\" name=\"sex\" value=\"M\" ${d.data.sex === 'M' ? \"checked\" : \"\" } ${!isChildNode? \"disabled\" :\"\" }>Male</label></td>\n                        <td colspan=\"2\"><label class=\"radio-inline\"><input type=\"radio\" name=\"sex\" value=\"F\" ${d.data.sex === 'F' ? \"checked\" : \"\" } ${!isChildNode? \"disabled\" : \"\" }>Female</label></td>\n                        <td colspan=\"2\"><label class=\"radio-inline\"><input type=\"radio\" name=\"sex\" value=\"U\" ${d.data.sex === 'U' ? \"checked\" : \"\" } ${!isChildNode? \"disabled\" : \"\" }>Unknown</label></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"3\"><strong>Name</strong>\n                            <input class=\"form-control\" id=\"id__name\" type=\"text\" style=\" font-size: 12px; padding: 4px; border-radius: 4px\" value=\"${name}\"/>\n                        </td>\n                        <td colspan=\"3\"><strong>Identifier</strong><input id=\"id_uniqueId\" class=\"form-control\" type=\"text\" value=\"${d.data.uniqueId ? d.data.uniqueId : \"\"}\"\n                                                                          style=\" font-size: 12px; padding: 4px; border-radius: 4px\"/>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"1\" style=\"text-align: left;\"><strong>Status:</strong></td>\n                        <td colspan=\"2\"><label class=\"radio-inline\" style=\"padding-left: 15px;\"><input type=\"radio\" value=\"0\"\n                        ${d.data.status === 0 ? \"checked\" : \"\" }\n                                                                                                       name=\"status\">Alive</label>\n                        </td>\n                        <td colspan=\"2\"><label class=\"radio-inline\" style=\"padding-left: 15px;\"><input type=\"radio\" value=\"1\"\n                         ${d.data.status === 1 ? \"checked\" : \"\" }\n                                                                                                       name=\"status\">Deceased</label>\n                        </td>\n                        <td colspan=\"2\"><label class=\"radio-inline\" style=\"padding-left: 15px;\"><input  type=\"radio\" value=\"2\"\n                         ${d.data.status === 2 ? \"checked\" : \"\" }\n                                                                                                       name=\"status\">A&W</label>\n                        </td>\n                    </tr>\n                    <tr>\n                    <td colspan=\"7\" style=\"border-top: 0px\">\n                    <div class=\"checkbox\">\n                                <label class=\"radio-inline\"><input type=\"radio\" name=\"status\" value=\"3\" ${d.data.status === 3 ? \"checked\" : \"\" } >Unborn</label>\n                                <label class=\"radio-inline\"><input type=\"radio\" name=\"status\" value=\"4\" ${d.data.status === 4 ? \"checked\" : \"\" } >Miscarriage</label>\n                                <label class=\"radio-inline\"><input type=\"radio\" name=\"status\" value=\"5\" ${d.data.status === 5 ? \"checked\" : \"\" }>Stillbirth</label> <br />\n                                <label class=\"radio-inline\"><input type=\"radio\" name=\"status\" value=\"6\" ${d.data.status === 6 ? \"checked\" : \"\" }>Termination</label>\n                                <label id=\"gestation_container\"  class=\"radio-inline\"><span>Gestation age: </span><input id=\"gestation\" value=\"${d.data.gestation ? d.data.gestation: ''}\" class=\"form-control\" type=\"number\" style=\" display: inline-block;width:70px;\"  /><span></span>  weeks</label>\n                         </div>\n</td>\n                        </tr>\n        \n                    <tr>\n                        <td colspan=\"3\">\n                            <strong>Age</strong> <br/>\n                            <input id=\"id__age\" class=\"form-control\" type=\"text\" style=\" font-size: 12px; padding: 4px; border-radius: 4px\" value='${d.data.age ? d.data.age : \"\"}'/>\n                            <br/>\n                            <strong>Died at age</strong> <br/>\n                            <input id=\"id__dage\" class=\"form-control\" type=\"text\" style=\" font-size: 12px; padding: 4px; border-radius: 4px\"  value='${d.data.dage ? d.data.dage : \"\"}'/>\n                        </td>\n                        <td colspan=\"3\">\n                            <strong>Date of birth</strong> <br/>\n                            <input id=\"dob\" class=\"form-control\" type=\"text\" style=\" font-size: 12px; padding: 4px; border-radius: 4px\" value='${d.data.dob ? d.data.dob : \"\"}'/>\n                            <br/>\n                            <strong>Cause of death</strong> <br/>\n                            <input id=\"cause_of_death\" class=\"form-control\" type=\"text\" style=\" font-size: 12px; padding: 4px; border-radius: 4px\" value='${d.data.cause_of_death ? d.data.cause_of_death : \"\"}'/>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"3\">\n                            <strong>Ethnicity</strong> <br/>\n                            <input class=\"form-control magicsearch\" id=\"ethnicity\"/>\n                        </td>\n                        <td colspan=\"3\">\n                            <strong>Country of origin</strong> <br/>\n                            <input id=\"country_of_origin\" class=\"form-control magicsearch\"  value='${d.data.country_of_origin ? d.data.country_of_origin : \"\"}'/>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"7\" style=\"text-align: left;\">\n                            <strong>Reproduction details</strong>\n                            <div class=\"checkbox\">\n                                <label><input type=\"checkbox\" value=\"\" ${d.data['adopted_in'] ? \"checked\" : \"\"} id=\"id_adopted_in\">Adopted in</label>\n                                <label><input type=\"checkbox\" value=\"\" ${d.data['adopted_out'] ? \"checked\" : \"\"} id=\"id_adopted_out\">Adopted out</label>\n                            </div>\n                            <div class=\"checkbox\">\n                                <label class=\"radio-inline\"><input type=\"radio\" name=\"individual_role\"  value=\"IVF\" ${d.data['individual_role'] === 'IVF' ? \"checked\" : \"\"} id=\"IVF\"> Conceived by IVF</label>\n                                <label class=\"radio-inline\"><input type=\"radio\" name=\"individual_role\" value=\"ICSI\" ${d.data['individual_role'] === 'ICSI'? \"checked\" : \"\"} id=\"id_ivf_icsi\"> IVF + ICSI </label>\n                            </div>\n                            <div class=\"checkbox\">\n                                <label><input type=\"checkbox\" value=\"\" ${d.data['consanguineous_parents'] ? \"checked\" : \"\"} id=\"id_consanguineous_parents\">Consanguineous parents</label>\n                            </div>\n                             <div class=\"checkbox\">\n                             <span>Conceived by Donor:</span>\n                                <label><input type=\"checkbox\" value=\"egg\" ${d.data['conceived_by_donor_egg'] ? \"checked\" : \"\"} id=\"id_conceived_by_donor_egg\">Egg</label>\n                                <label><input type=\"checkbox\" value=\"sperm\" ${d.data['conceived_by_donor_sperm'] ? \"checked\" : \"\"} id=\"id_conceived_by_donor_sperm\">Sperm </label>\n                            </div>\n                            <div class=\"checkbox\">\n                                <span>Individual is:</span>\n                                <label><input  name=\"individual_role\" ${d.data['individual_role']==='Donor' ? \"checked\" : \"\"}  type=\"radio\" value=\"Donor\"> Donor</label>\n                                <label><input name=\"individual_role\" ${d.data['individual_role']==='SRG' ? \"checked\" : \"\"}  type=\"radio\" value=\"SRG\"> Surrogate</label>\n                                <label><input name=\"individual_role\" ${d.data['individual_role']==='none'|| !d.data['individual_role'] ? \"checked\" : \"\"} type=\"radio\" value=\"none\"> None</label>\n                            </div>\n                        </td>\n        \n                    </tr>\n                    <tr>\n                        <td colspan=\"7\"><strong>Heredity option </strong></td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"2\">\n                            <select id=\"heredity\" class=\"form-control\" style=\" font-size: 12px; padding: 4px; border-radius: 4px\">\n                                <option ${d.data.heredity === 'None' ? 'selected=selected' : \"\"} >None</option>\n                                <option ${d.data.heredity === 'Childless' ? 'selected=selected' : \"\"} >Childless</option>\n                                <option ${d.data.heredity === 'Infertile' ? 'selected=selected' : \"\"} >Infertile</option>\n                            </select>\n                        </td>\n                        <td colspan=\"4\">\n                            <input class=\"form-control\" type=\"text\" placeholder=\"Reason\"\n                                   style=\" font-size: 12px; padding: 4px; border-radius: 4px\"/>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"7\" style=\"text-align: left;\"><span><strong>Market by:</strong><input id=\"reason\" type=\"text\"\n                                                                class=\"form-control\" value=\"${d.data.market_by_text? d.data.market_by_text:''}\"\n                                                                                                          placeholder=\"Reason\"\n                                                                                                          style=\" font-size: 12px; padding: 4px; border-radius: 4px\"/></span>\n                            <div class=\"checkbox\">\n                                <label><input ${d.data.market_by_tick === 'market_na'?\"checked\":\"\"} id=\"market_na\" type=\"checkbox\" value=\"NA\">N/A</label>\n                                <label><input  ${d.data.market_by_tick === 'market_p'?\"checked\":\"\"} id=\"market_p\" type=\"checkbox\" value=\"+\">+</label>\n                                <label><input  ${d.data.market_by_tick === 'market_m'?\"checked\":\"\"} id=\"market_m\" type=\"checkbox\" value=\"-\">-</label>\n                                <label><input  ${d.data.market_by_tick === 'market_s'?\"checked\":\"\"} id=\"market_s\" type=\"checkbox\" value=\"*\">*</label>\n                                <label><input  ${d.data.market_by_tick === 'market_st'?\"checked\":\"\"} id=\"market_st\" type=\"checkbox\" value=\"sample_taken\">Sample taken</label>\n                            </div>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"7\" style=\"text-align: left;\">\n                            <div class=\"checkbox\">\n                                <label><input type=\"checkbox\" value=\"\" ${d.data['proband'] ? \"checked\" : \"\"} id=\"id_proband\"/>Proband</label>\n                            </div>\n                        </td>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"7\"><strong>Comments </strong><br/>\n                            <textarea class=\"form-control\" style=\" font-size: 12px; padding: 4px; border-radius: 4px\"/>\n                        </td>\n                    </tr>\n        \n                </table>\n            </div>\n        \n            <div id=\"clinical\">\n                <table class=\"table\">\n                    <tr>\n                        <td colspan=\"3\">\n                            <strong style=\"float: left;\">Carrier status</strong><br/>\n                            <div class=\"radio\">\n                                <label style=\"float: left;\"><input value=\"na\" type=\"radio\" ${d.data.carrier_status === 'na'? 'checked': ''} name=\"carrier_status\">Not affected</label>\n                            </div></br>\n                            <div class=\"radio\">\n                                <label style=\"float: left;\"><input value=\"carrier\" type=\"radio\" ${d.data.carrier_status === 'carrier'? 'checked': ''} name=\"carrier_status\">Carrier</label>\n                            </div></br>\n                            <div class=\"radio\">\n                                <label style=\"float: left;\"><input value=\"uncertain\" type=\"radio\" ${d.data.carrier_status === 'uncertain'? 'checked': ''} name=\"carrier_status\">Uncertain</label>\n                            </div>\n                        </td>\n                        <td colspan=\"3\">\n                            <strong></strong><br/>\n                            <div class=\"radio\">\n                                <label style=\"float: left;\"><input value=\"affected\" type=\"radio\" ${d.data.carrier_status === 'affected'? 'checked': ''} name=\"carrier_status\">Affected</label>\n                            </div></br>\n                            <div class=\"radio\">\n                                <label style=\"float: left;\"><input value=\"asymptomatic\" type=\"radio\" ${d.data.carrier_status === 'asymptomatic'? 'checked': ''} name=\"carrier_status\">Asymptomatic</label>\n                            </div>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"6\">\n                            <div class=\"form-group\" id=\"conditions-clinical-tab\">\n                                <label for=\"conditions\" style=\"float: left;\">Conditions</label>\n                                <input type=\"text\" class=\"form-control\" placeholder=\"Search for condition\" id=\"conditions\" style=\" font-size: 12px; padding: 4px; border-radius: 4px\"/>\n                            </div>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"6\">\n                            <div class=\"form-group\">\n                                <label for=\"phenotypes\" style=\"float: left;\">Phenotypes, clinical symptoms</label>\n                                <input type=\"text\" class=\"form-control\" placeholder=\"Search or type in\" id=\"phenotypes\" style=\" font-size: 12px; padding: 4px; border-radius: 4px\"/>\n                                <div id=\"phenotypeGapDiv\" class=\"gapDiv\"></div>\n                                <ul id=\"phenotypeTypedText\" tabindex=\"0\" class=\"ui-menu ui-widget ui-widget-content ui-autocomplete ui-front typedText\" style=\"position: unset; width: 100%; display: none;\"><li class=\"ui-menu-item\">\n                                <span id=\"phenotype-non-standard-text\" style=\"width: 380px;\" tabindex=\"-1\" class=\"ui-menu-item-wrapper non-standard-text\"></span><br/><strong>(your text, not a standard term)</strong></li></ul>\n                            </div>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"6\">\n                            <div class=\"form-group\">\n                                <label for=\"candidateGenes\" style=\"float: left;\">Genotype: candidate genes</label>\n                                <input type=\"text\" class=\"form-control\" placeholder=\"Search or type in\" id=\"candidateGenes\" style=\" font-size: 12px; padding: 4px; border-radius: 4px\"/>\n                                <div id=\"candidateGapDiv\" class=\"gapDiv\"></div>\n                                <ul id=\"candidateTypedText\" tabindex=\"0\" class=\"ui-menu ui-widget ui-widget-content ui-autocomplete ui-front typedText\" style=\"position: unset; width: 100%; display: none;\"><li class=\"ui-menu-item\">\n                                <span id=\"candidate-non-standard-text\" style=\"width: 380px;\" tabindex=\"-1\" class=\"ui-menu-item-wrapper non-standard-text\"></span><br/><strong>(your text, not a standard term)</strong></li></ul>\n                            </div>\n                            <div class=\"form-group\">\n                                <label for=\"causalGenes\" style=\"float: left;\">Genotype: confirmed causal genes</label>\n                                <input type=\"text\" class=\"form-control\" placeholder=\"Search or type in\" id=\"causalGenes\" style=\" font-size: 12px; padding: 4px; border-radius: 4px\"/>\n                                <div id=\"causalGapDiv\" class=\"gapDiv\"></div>\n                                <ul id=\"causalTypedText\" tabindex=\"0\" class=\"ui-menu ui-widget ui-widget-content ui-autocomplete ui-front typedText\" style=\"position: unset; width: 100%; display: none;\"><li class=\"ui-menu-item\">\n                                <span id=\"causal-non-standard-text\" style=\"width: 380px;\" tabindex=\"-1\" class=\"ui-menu-item-wrapper non-standard-text\"></span><br/><strong>(your text, not a standard term)</strong></li></ul>\n                            </div>\n                            <div class=\"form-group\">\n                                <label for=\"carrierGenes\" style=\"float: left;\">Genotype: carrier genes</label>\n                                <input type=\"text\" class=\"form-control\" placeholder=\"Search or type in\" id=\"carrierGenes\" style=\" font-size: 12px; padding: 4px; border-radius: 4px\"/>\n                                <div id=\"carrierGapDiv\" class=\"gapDiv\"></div>\n                                <ul tabindex=\"0\" id=\"carrierTypedText\" class=\"ui-menu ui-widget ui-widget-content ui-autocomplete ui-front typedText\" style=\"position: unset; width: 100%; display: none;\"><li class=\"ui-menu-item\">\n                                <span id=\"carrier-non-standard-text\" style=\"width: 380px;\" tabindex=\"-1\" class=\"ui-menu-item-wrapper non-standard-text\"></span><br/><strong>(your text, not a standard term)</strong></li></ul>\n                            </div>\n                            <div class=\"form-group\">\n                              <label for=\"commentClinical\" style=\"float: left;\">Comments</label>\n                              <textarea class=\"form-control\" rows=\"5\" id=\"commentClinical\">${d.data.clinical_comments?d.data.clinical_comments:''}</textarea>\n                            </div>\n                        </td>\n                    </tr>\n                </table>\n            </div>\n            \n            <div id=\"riskFactors\" style=\"float:left; width: 100%;\">\n                <table class=\"table\">\n                    <tr>\n                        <td colspan=\"7\" style=\"text-align: left;\" id=\"commonCancers\">\n                            <strong>Common Cancers</strong>\n                            <div class=\"checkbox\">\n                              <label><input type=\"checkbox\" class=\"cancer-checkbox\" ${d.data.breast_cancer?\"checked\":\"\"} value=\"breast_cancer\">Breast&emsp;<i class=\"glyphicon glyphicon-info-sign\"></i></label>\n                              &emsp;<input style=\"display: none;\" type=\"number\" min=\"0\" class=\"cancer-age\" placeholder=\"Enter age of diagnosis\" value=\"${d.data.breast_cancer_age?d.data.breast_cancer_age:\"\"}\" />\n                            </div>\n                            <div class=\"checkbox\">\n                              <label><input type=\"checkbox\" class=\"cancer-checkbox\" ${d.data.ovarian_cancer?\"checked\":\"\"} value=\"ovarian_cancer\">Ovarian&emsp;<i class=\"glyphicon glyphicon-info-sign\"></i></label>\n                              &emsp;<input style=\"display: none;\" type=\"number\" min=\"0\" class=\"cancer-age\" placeholder=\"Enter age of diagnosis\" value=\"${d.data.ovarian_cancer_age?d.data.ovarian_cancer_age:\"\"}\" />\n                            </div>\n                            <div class=\"checkbox\">\n                              <label><input type=\"checkbox\" class=\"cancer-checkbox\" ${d.data.colon_cancer?\"checked\":\"\"} value=\"colon_cancer\">Colon&emsp;<i class=\"glyphicon glyphicon-info-sign\"></i></label>\n                              &emsp;<input style=\"display: none;\" type=\"number\" min=\"0\" class=\"cancer-age\" placeholder=\"Enter age of diagnosis\" value=\"${d.data.colon_cancer_age?d.data.colon_cancer_age:\"\"}\" />\n                            </div>\n                            <div class=\"checkbox\">\n                              <label><input type=\"checkbox\" class=\"cancer-checkbox\" ${d.data.prostate_cancer?\"checked\":\"\"} value=\"prostate_cancer\">Prostate&emsp;<i class=\"glyphicon glyphicon-info-sign\"></i></label>\n                              &emsp;<input style=\"display: none;\" type=\"number\" min=\"0\" class=\"cancer-age\" placeholder=\"Enter age of diagnosis\" value=\"${d.data.prostate_cancer_age?d.data.prostate_cancer_age:\"\"}\" />\n                            </div>\n                            <div class=\"checkbox\">\n                              <label><input type=\"checkbox\" class=\"cancer-checkbox\" ${d.data.pancreatic_cancer?\"checked\":\"\"} value=\"pancreatic_cancer\">Pancreatic&emsp;<i class=\"glyphicon glyphicon-info-sign\"></i></label>\n                              &emsp;<input style=\"display: none;\" type=\"number\" min=\"0\" class=\"cancer-age\" placeholder=\"Enter age of diagnosis\" value=\"${d.data.pancreatic_cancer_age?d.data.pancreatic_cancer_age:\"\"}\" />\n                            </div>\n                            <div class=\"checkbox\">\n                              <label><input type=\"checkbox\" class=\"cancer-checkbox\" ${d.data.melanoma_cancer?\"checked\":\"\"} value=\"melanoma_cancer\">Melanoma&emsp;<i class=\"glyphicon glyphicon-info-sign\"></i></label>\n                              &emsp;<input style=\"display: none;\" type=\"number\" min=\"0\" class=\"cancer-age\" placeholder=\"Enter age of diagnosis\" value=\"${d.data.melanoma_cancer_age?d.data.melanoma_cancer_age:\"\"}\" />\n                            </div>\n                            <div class=\"checkbox\">\n                              <label><input type=\"checkbox\" class=\"cancer-checkbox\" ${d.data.kidney_cancer?\"checked\":\"\"} value=\"kidney_cancer\">Kidney&emsp;<i class=\"glyphicon glyphicon-info-sign\"></i></label>\n                              &emsp;<input style=\"display: none;\" type=\"number\" min=\"0\" class=\"cancer-age\" placeholder=\"Enter age of diagnosis\" value=\"${d.data.kidney_cancer_age?d.data.kidney_cancer_age:\"\"}\" />\n                            </div>\n                            <div class=\"checkbox\">\n                              <label><input type=\"checkbox\" class=\"cancer-checkbox\" ${d.data.gastric_cancer?\"checked\":\"\"} value=\"gastric_cancer\">Gastric&emsp;<i class=\"glyphicon glyphicon-info-sign\"></i></label>\n                              &emsp;<input style=\"display: none;\" type=\"number\" min=\"0\" class=\"cancer-age\" placeholder=\"Enter age of diagnosis\" value=\"${d.data.gastric_cancer_age?d.data.gastric_cancer_age:\"\"}\" />\n                            </div>\n                            <div class=\"checkbox\">\n                              <label><input type=\"checkbox\" class=\"cancer-checkbox\" ${d.data.lung_cancer?\"checked\":\"\"} value=\"lung_cancer\">Lung&emsp;<i class=\"glyphicon glyphicon-info-sign\"></i></label>\n                              &emsp;<input style=\"display: none;\" type=\"number\" min=\"0\" class=\"cancer-age\" placeholder=\"Enter age of diagnosis\" value=\"${d.data.lung_cancer_age?d.data.lung_cancer_age:\"\"}\" />\n                            </div>\n                            <div class=\"checkbox\">\n                              <label><input type=\"checkbox\" class=\"cancer-checkbox\" ${d.data.brain_cancer?\"checked\":\"\"} value=\"brain_cancer\">Brain&emsp;<i class=\"glyphicon glyphicon-info-sign\"></i></label>\n                              &emsp;<input style=\"display: none;\" type=\"number\" min=\"0\" class=\"cancer-age\" placeholder=\"Enter age of diagnosis\" value=\"${d.data.brain_cancer_age?d.data.brain_cancer_age:\"\"}\" />\n                            </div>\n                            <div class=\"checkbox\">\n                              <label><input type=\"checkbox\" class=\"cancer-checkbox\" ${d.data.oesophagus_cancer?\"checked\":\"\"} value=\"oesophagus_cancer\">Oesophagus&emsp;<i class=\"glyphicon glyphicon-info-sign\"></i></label>\n                              &emsp;<input style=\"display: none;\" type=\"number\" min=\"0\" class=\"cancer-age\" placeholder=\"Enter age of diagnosis\" value=\"${d.data.oesophagus_cancer_age?d.data.oesophagus_cancer_age:\"\"}\" />\n                            </div>\n                            <div class=\"checkbox\">\n                              <label><input type=\"checkbox\" class=\"cancer-checkbox\" ${d.data.thyroid_cancer?\"checked\":\"\"} value=\"thyroid_cancer\">Thyroid&emsp;<i class=\"glyphicon glyphicon-info-sign\"></i></label>\n                              &emsp;<input style=\"display: none;\" type=\"number\" min=\"0\" class=\"cancer-age\" placeholder=\"Enter age of diagnosis\" value=\"${d.data.thyroid_cancer_age?d.data.thyroid_cancer_age:\"\"}\" />\n                            </div>\n                            <div class=\"checkbox\">\n                              <label><input type=\"checkbox\" class=\"cancer-checkbox\" ${d.data.liver_cancer?\"checked\":\"\"} value=\"liver_cancer\">Liver&emsp;<i class=\"glyphicon glyphicon-info-sign\"></i></label>\n                              &emsp;<input style=\"display: none;\" type=\"number\" min=\"0\" class=\"cancer-age\" placeholder=\"Enter age of diagnosis\" value=\"${d.data.liver_cancer_age?d.data.liver_cancer_age:\"\"}\" />\n                            </div>\n                            <div class=\"checkbox\">\n                              <label><input type=\"checkbox\" class=\"cancer-checkbox\" ${d.data.cervix_cancer?\"checked\":\"\"} value=\"cervix_cancer\">Cervix&emsp;<i class=\"glyphicon glyphicon-info-sign\"></i></label>\n                              &emsp;<input style=\"display: none;\" type=\"number\" min=\"0\" class=\"cancer-age\" placeholder=\"Enter age of diagnosis\" value=\"${d.data.cervix_cancer_age?d.data.cervix_cancer_age:\"\"}\" />\n                            </div>\n                            <div class=\"checkbox\">\n                              <label><input type=\"checkbox\" class=\"cancer-checkbox\" ${d.data.myeloma_cancer?\"checked\":\"\"} value=\"myeloma_cancer\">Myeloma&emsp;<i class=\"glyphicon glyphicon-info-sign\"></i></label>\n                              &emsp;<input style=\"display: none;\" type=\"number\" min=\"0\" class=\"cancer-age\" placeholder=\"Enter age of diagnosis\" value=\"${d.data.myeloma_cancer_age?d.data.myeloma_cancer_age:\"\"}\" />\n                            </div>\n                            <div class=\"checkbox\">\n                              <label><input type=\"checkbox\" class=\"cancer-checkbox\" ${d.data.leukemia_cancer?\"checked\":\"\"} value=\"leukemia_cancer\">Leukemia&emsp;<i class=\"glyphicon glyphicon-info-sign\"></i></label>\n                              &emsp;<input style=\"display: none;\" type=\"number\" min=\"0\" class=\"cancer-age\" placeholder=\"Enter age of diagnosis\" value=\"${d.data.leukemia_cancer_age?d.data.leukemia_cancer_age:\"\"}\" />\n                            </div>\n                            <div class=\"form-group\">\n                                <input type=\"text\" class=\"form-control\" id=\"searchForCancers\" placeholder=\"Search for cancers\" style=\" font-size: 12px; padding: 4px; border-radius: 4px\"/>\n                            </div>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td colspan=\"7\" style=\"text-align: left;\">\n                            <div class=\"form-group\">\n                              <label for=\"commentRiskFactors\">Comments</label>\n                              <textarea class=\"form-control\" rows=\"5\" id=\"commentRiskFactors\"></textarea>\n                            </div>\n                        </td>\n                    </tr>\n                 </table>\n            </div>\n        </div>\n        `;\n\n        setTimeout(()=>{\n            let gestationContainer = $('#gestation_container');\n            if(d.data.status > 2){\n                gestationContainer.show();\n            }else{\n                gestationContainer.hide();\n            }\n        }, 50);\n\n        let x = e.pageX + 50;\n        y = 10;\n        if (x + dialogWidth > $targetDiv.width()) {\n            x+=170;\n            panZoom.translateX(opts, -(x + dialogWidth - $targetDiv.width()))\n            x = x - (x + dialogWidth - $targetDiv.width())-170;\n        }\n\n        $node_tabs.html(tabHeader);\n        $('#nodeTabs').tabs({\n            create: function (e, ui) {\n                $('#closeBtn').click(function () {\n                    $node_tabs.dialog('close');\n                });\n            }\n        });\n        $node_tabs.dialog('option', 'position', {my: \"left top\", at: \"left+\" + x + \" top+\" + y + \"\", of: window});\n        $node_tabs.dialog('open');\n        $node_tabs.css('padding', '0');\n        $('.ui-dialog-titlebar').remove();\n        $('#dob').datepicker();\n        $('#dod-date-picker').datepicker();\n        pedigree_form.update(opts);\n        var dataSource = [\n            {id: 1, data_value: 'Tim Cook'},\n            {id: 2, data_value: 'Eric Baker'},\n            {id: 3, data_value: 'Victor Brown'},\n            {id: 4, data_value: 'Lisa White'},\n            {id: 5, data_value: 'Oliver Bull'},\n            {id: 6, data_value: 'Zade Stock'},\n            {id: 7, data_value: 'David Reed'},\n            {id: 8, data_value: 'George Hand'},\n            {id: 9, data_value: 'Tony Well'},\n            {id: 10, data_value: 'Bruce Wayne'},\n        ];\n\n        let ethnicity = $('#ethnicity');\n        ethnicity.magicsearch({\n            dataSource: dataSource,\n            fields: ['data_value'],\n            id: 'id',\n            format: '%data_value%',\n            multiple: true,\n            multiField: 'data_value',\n            multiStyle: {\n                space: 5,\n                width: 80\n            },\n            success:function($input, data){\n                pedigree_form.saveTabbedForm(opts, d.data.name,\n                    {\n                        ethnicity:{\n                            action:'save',\n                            data: data,\n                            id:'ethnicity'\n                        }\n                    });\n            },\n            afterDelete:function ($input, data) {\n                pedigree_form.saveTabbedForm(opts, d.data.name,\n                    {\n                        ethnicity:{\n                            action:'delete',\n                            data: data,\n                            id:'ethnicity'\n                        }\n                    });\n            }\n        });\n        if(d.data.ethnicity && d.data.ethnicity.length>0) {\n            let ethnicityIds= d.data.ethnicity.map((e)=>e.id).join();\n            ethnicity.trigger('set', {id: ethnicityIds});\n        }\n\n         dataSource = [\n            {id: 1, data_value: 'Nigeria'},\n            {id: 2, data_value: 'United State'},\n            {id: 3, data_value: 'Germany'},\n            {id: 4, data_value: 'Canada'},\n            {id: 5, data_value: 'Japan'},\n        ];\n\n        let countryOfOrigin = $('#country_of_origin');\n        countryOfOrigin.magicsearch({\n            dataSource: dataSource,\n            fields: ['data_value'],\n            id: 'id',\n            format: '%data_value%',\n            isClear: true,\n            multiple: true,\n            multiField: 'data_value',\n            multiStyle: {\n                space: 5,\n                width: 80\n            },\n            success:function($input, data){\n                pedigree_form.saveTabbedForm(opts, d.data.name,\n                    {\n                        countryOfOrigin:{\n                            action:'save',\n                            data: data,\n                            id:'country_of_origin'\n                        }\n                    });\n            },\n            afterDelete:function ($input, data) {\n                pedigree_form.saveTabbedForm(opts, d.data.name,\n                    {\n                        countryOfOrigin:{\n                            action:'delete',\n                            data: data,\n                            id:'country_of_origin'\n                        }\n                    });\n            }\n        });\n        if(d.data.country_of_origin && d.data.country_of_origin.length>0) {\n            let countryOfOriginIds= d.data.country_of_origin.map((e)=>e.id).join();\n           countryOfOrigin.trigger('set', {id: countryOfOriginIds});\n        }\n\n        var availableTags = [\n            \"ActionScript\",\n            \"AppleScript\",\n            \"Asp\",\n            \"BASIC\",\n            \"C\",\n            \"C++\",\n            \"Clojure\",\n            \"COBOL\",\n            \"ColdFusion\",\n            \"Erlang\",\n            \"Fortran\",\n            \"Groovy\",\n            \"Haskell\",\n            \"Java\",\n            \"JavaScript\",\n            \"Lisp\",\n            \"Perl\",\n            \"PHP\",\n            \"Python\",\n            \"Ruby\",\n            \"Scala\",\n            \"Scheme\"];\n\n        var phenotypes = [];\n        Object.keys(opts.phenotypes).forEach(function(key) {\n            phenotypes.push(opts.phenotypes[key].name);\n        });\n\n        var candidate_genotypes = [];\n        Object.keys(opts.candidate_genotype).forEach(function (key) {\n            candidate_genotypes.push(opts.candidate_genotype[key].name);\n        });\n\n        var causal_genotypes = [];\n        Object.keys(opts.causal_genotype).forEach(function (key) {\n            causal_genotypes.push(opts.causal_genotype[key].name);\n        });\n\n        var carrier_genotypes = [];\n        Object.keys(opts.carrier_genotype).forEach(function (key) {\n            carrier_genotypes.push(opts.carrier_genotype[key].name);\n        });\n\n        var cancers = [];\n        Object.keys(opts.cancers).forEach(function (key) {\n            cancers.push(opts.cancers[key].name);\n        });\n\n        function genesAppender(geneId, geneName, geneType) {\n            var close_cls = geneType+'-close';\n            var gene_inp = geneId+'_key';\n            return '<span id='+geneId+' style=\"float:left; width:100%;\">' + geneName + '&emsp;' +\n                '<i class=\"glyphicon glyphicon-info-sign\"></i>' +\n                '<a href=\"#\" onclick=\"return false\" style=\"float: right; padding: 2px; color: red;\" class='+close_cls+' >' +\n                '<i class=\"glyphicon glyphicon-remove\"></i></a><input id='+gene_inp+' style=\"display:none;\" value=' + geneId + ' /></span>';\n        }\n\n        $(\"#phenotypes\").autocomplete({\n            source: phenotypes,\n            response: function (e, ui) {\n                var gap = (28.666 * ui.content.length) + (ui.content.length > 0 ? 4 : 0) + 'px';\n                $(this).closest('div').find('.gapDiv').css('height', gap);\n            },\n            select: function (event, ui) {\n                $('#phenotypeTypedText').hide();\n                $('#phenotypeGapDiv').hide();\n                $('#phenotypeGapDiv').css('height', 0);\n                var phenotypeId = getGenesId(ui.item.value, opts.phenotypes);\n                if (phenotypeId === null) {\n                    var phenoName = ui.item.value;\n                    var phenoType = ui.item.value.trim().toLowerCase().replace(/ /g, '_') + '_phenotype';\n                    opts.phenotypes.push({type: phenoType, name: phenoName});\n                    phenotypeId = phenoType;\n                }\n                var phenotypeElement = genesAppender(phenotypeId, ui.item.value, 'phenotype');\n                var phenotypeAlreadyThere = false;\n                $(this).closest('td').find('input').each(function () {\n                    if ($(this).val() === phenotypeId) {\n                        phenotypeAlreadyThere = true;\n                        return false;\n                    }\n                });\n\n                if (!phenotypeAlreadyThere) {\n                    $(this).closest('td').append(phenotypeElement);\n                    if (d.data.name in opts.selected_phenotypes) {\n                        opts.selected_phenotypes[d.data.name].push(phenotypeId);\n                    } else {\n                        opts.selected_phenotypes[d.data.name] = [];\n                        opts.selected_phenotypes[d.data.name].push(phenotypeId);\n                    }\n                    pedigree_form.saveTabbedForm(opts, d.data.name);\n                }\n                $(this).val('');\n                return false;\n            }\n        }).off('blur').on('blur', function() {\n            if(document.hasFocus()) {\n                //$('ul.ui-autocomplete').hide();\n            }\n        }).data(\"ui-autocomplete\")._renderItem = function (ul, item) {\n            return $(\"<li></li>\")\n                .data(\"item.autocomplete\", item)\n                .append('<span style=\"width: 380px;\">' + item.label + '&emsp;<i class=\"glyphicon glyphicon-info-sign\"></i></span>')\n                .appendTo(ul);\n        };\n\n        $(\"#candidateGenes\").autocomplete({\n            source: candidate_genotypes,\n            response: function (e, ui) {\n                var gap = (28.666 * ui.content.length) + (ui.content.length > 0 ? 4 : 0) + 'px';\n                $(this).closest('div').find('.gapDiv').css('height', gap);\n            },\n            select: function (event, ui) {\n                $('#candidateTypedText').hide();\n                $('#candidateGapDiv').hide();\n                $('#candidateGapDiv').css('height', 0);\n                var candidateId = getGenesId(ui.item.value, opts.candidate_genotype);\n                if (candidateId === null) {\n                    var candidateName = ui.item.value;\n                    var candidateType = ui.item.value.trim().toLowerCase().replace(/ /g, '_') + '_candidate';\n                    opts.candidate_genotype.push({type: candidateType, name: candidateName});\n                    candidateId = candidateType;\n                }\n                var candidateElement = genesAppender(candidateId, ui.item.value, 'candidate');\n                var candidateAlreadyThere = false;\n                $(this).closest('div').find('input').each(function () {\n                    if ($(this).val() === candidateId) {\n                        candidateAlreadyThere = true;\n                        return false;\n                    }\n                });\n\n                if (!candidateAlreadyThere) {\n                    $(this).closest('div').append(candidateElement);\n                    if (d.data.name in opts.selected_candidate_genotype) {\n                        opts.selected_candidate_genotype[d.data.name].push(candidateId);\n                    } else {\n                        opts.selected_candidate_genotype[d.data.name] = [];\n                        opts.selected_candidate_genotype[d.data.name].push(candidateId);\n                    }\n                    pedigree_form.saveTabbedForm(opts, d.data.name);\n                }\n                $(this).val('');\n                return false;\n            }\n        }).off('blur').on('blur', function() {\n            if(document.hasFocus()) {\n                //$('ul.ui-autocomplete').hide();\n            }\n        }).data(\"ui-autocomplete\")._renderItem = function (ul, item) {\n            return $(\"<li></li>\")\n                .data(\"item.autocomplete\", item)\n                .append('<span style=\"width: 380px;\">' + item.label + '&emsp;<i class=\"glyphicon glyphicon-info-sign\"></i></span>')\n                .appendTo(ul);\n        };\n\n        $(\"#causalGenes\").autocomplete({\n            source: causal_genotypes,\n            response: function (e, ui) {\n                var gap = (28.666 * ui.content.length) + (ui.content.length > 0 ? 4 : 0) + 'px';\n                $(this).closest('div').find('.gapDiv').css('height', gap);\n            },\n            select: function (event, ui) {\n                $('#causalTypedText').hide();\n                $('#causalGapDiv').hide();\n                $('#causalGapDiv').css('height', 0);\n                var casualId = getGenesId(ui.item.value, opts.causal_genotype);\n                if (casualId === null) {\n                    var casualName = ui.item.value;\n                    var casualType = ui.item.value.trim().toLowerCase().replace(/ /g, '_') + '_causal';\n                    opts.causal_genotype.push({type: casualType, name: casualName});\n                    casualId = casualType;\n                }\n                var casualElement = genesAppender(casualId, ui.item.value, 'causal');\n                var casualAlreadyThere = false;\n                $(this).closest('div').find('input').each(function () {\n                    if ($(this).val() === casualId) {\n                        casualAlreadyThere = true;\n                        return false;\n                    }\n                });\n\n                if (!casualAlreadyThere) {\n                    $(this).closest('div').append(casualElement);\n                    if (d.data.name in opts.selected_causal_genotype) {\n                        opts.selected_causal_genotype[d.data.name].push(casualId);\n                    } else {\n                        opts.selected_causal_genotype[d.data.name] = [];\n                        opts.selected_causal_genotype[d.data.name].push(casualId);\n                    }\n                    pedigree_form.saveTabbedForm(opts, d.data.name);\n                }\n                $(this).val('');\n                return false;\n            }\n        }).off('blur').on('blur', function() {\n            if(document.hasFocus()) {\n                //$('ul.ui-autocomplete').hide();\n            }\n        }).data(\"ui-autocomplete\")._renderItem = function (ul, item) {\n            return $(\"<li></li>\")\n                .data(\"item.autocomplete\", item)\n                .append('<span style=\"width: 380px;\">'+item.label + '&emsp;<i class=\"glyphicon glyphicon-info-sign\"></i></span>')\n                .appendTo(ul);\n        };\n\n        $(\"#carrierGenes\").autocomplete({\n            source: carrier_genotypes,\n            response: function (e, ui) {\n                var gap = (28.666 * ui.content.length) + (ui.content.length > 0 ? 4 : 0) + 'px';\n                $(this).closest('div').find('.gapDiv').css('height', gap);\n            },\n            select: function (event, ui) {\n                $('#carrierTypedText').hide();\n                $('#carrierGapDiv').hide();\n                $('#carrierGapDiv').css('height', 0);\n                var carrierId = getGenesId(ui.item.value, opts.carrier_genotype);\n                if (carrierId === null) {\n                    var carrierName = ui.item.value;\n                    var carrierType = ui.item.value.trim().toLowerCase().replace(/ /g, '_') + '_carrier';\n                    opts.carrier_genotype.push({type: carrierType, name: carrierName});\n                    carrierId = carrierType;\n                }\n                var carrierElement = genesAppender(carrierId, ui.item.value, 'carrier');\n                var carrierAlreadyThere = false;\n                $(this).closest('div').find('input').each(function () {\n                    if ($(this).val() === carrierId) {\n                        carrierAlreadyThere = true;\n                        return false;\n                    }\n                });\n\n                if (!carrierAlreadyThere) {\n                    $(this).closest('div').append(carrierElement);\n                    if (d.data.name in opts.selected_carrier_genotype) {\n                        opts.selected_carrier_genotype[d.data.name].push(carrierId);\n                    } else {\n                        opts.selected_carrier_genotype[d.data.name] = [];\n                        opts.selected_carrier_genotype[d.data.name].push(carrierId);\n                    }\n                    pedigree_form.saveTabbedForm(opts, d.data.name);\n                }\n                $(this).val('');\n                return false;\n            }\n        }).off('blur').on('blur', function() {\n            if(document.hasFocus()) {\n                //$('ul.ui-autocomplete').hide();\n            }\n        }).data(\"ui-autocomplete\")._renderItem = function (ul, item) {\n            return $(\"<li></li>\")\n                .data(\"item.autocomplete\", item)\n                .append('<span style=\"width: 380px;\">'+item.label + '&emsp;<i class=\"glyphicon glyphicon-info-sign\"></i></span>')\n                .appendTo(ul);\n        };\n\n        $('#nodeTabs').on('input', '#phenotypes', function () {\n            if ($(this).val().trim().length == 0) {\n                $('#phenotypeTypedText').hide();\n                $('#phenotypeGapDiv').hide();\n                $('#phenotypeGapDiv').css('height', 0);\n            } else {\n                $('#phenotypeTypedText').show();\n                $('#phenotypeGapDiv').show();\n            }\n            $('#phenotype-non-standard-text').text($(this).val());\n        });\n\n        $('#phenotype-non-standard-text').on('click', function () {\n            $('#phenotypes').data('ui-autocomplete')._trigger('select', 'autocompleteselect', {item: {value: $('#phenotypes').val()}});\n            $('#phenotypeGapDiv').css('height', 0);\n            $('#phenotypeTypedText').hide();\n        });\n\n        $('#nodeTabs').on('click', function () {\n            $('.gapDiv').css('height', 0);\n            $('.non-standard-text').closest('ul').hide();\n        });\n\n        $('#nodeTabs').on('input', '#candidateGenes', function () {\n            if ($(this).val().trim().length == 0) {\n                $('#candidateTypedText').hide();\n                $('#candidateGapDiv').hide();\n                $('#candidateGapDiv').css('height', 0);\n            } else {\n                $('#candidateTypedText').show();\n                $('#candidateGapDiv').show();\n            }\n            $('#candidate-non-standard-text').text($(this).val());\n        });\n\n        $('#candidate-non-standard-text').on('click', function () {\n            $('#candidateGenes').data('ui-autocomplete')._trigger('select', 'autocompleteselect', {item: {value: $('#candidateGenes').val()}});\n            $('#candidateGapDiv').css('height', 0);\n            $('#candidateTypedText').hide();\n        });\n\n        $('#nodeTabs').on('input', '#causalGenes', function () {\n            if ($(this).val().trim().length == 0) {\n                $('#causalTypedText').hide();\n                $('#causalGapDiv').hide();\n                $('#causalGapDiv').css('height', 0);\n            } else {\n                $('#causalTypedText').show();\n                $('#causalGapDiv').show();\n            }\n            $('#causal-non-standard-text').text($(this).val());\n        });\n\n        $('#causal-non-standard-text').on('click', function () {\n            $('#causalGenes').data('ui-autocomplete')._trigger('select', 'autocompleteselect', {item: {value: $('#causalGenes').val()}});\n            $('#causalGapDiv').css('height', 0);\n            $('#causalTypedText').hide();\n        });\n\n        $('#nodeTabs').on('input', '#carrierGenes', function () {\n            if ($(this).val().trim().length == 0) {\n                $('#carrierTypedText').hide();\n                $('#carrierGapDiv').hide();\n                $('#carrierGapDiv').css('height', 0);\n            } else {\n                $('#carrierTypedText').show();\n                $('#carrierGapDiv').show();\n            }\n            $('#carrier-non-standard-text').text($(this).val());\n        });\n\n        $('#carrier-non-standard-text').on('click', function () {\n            $('#carrierGenes').data('ui-autocomplete')._trigger('select', 'autocompleteselect', {item: {value: $('#carrierGenes').val()}});\n            $('#carrierGapDiv').css('height', 0);\n            $('#carrierTypedText').hide();\n        });\n\n        function conditionForm(conditionKey) {\n            return '<span class=\"diagnosisTypes\"><label style=\"float: left;\"><input type=\"checkbox\" id=\"' + conditionKey + '_check\" value=\"\" checked>'+opts.conditions[conditionKey].name+'&emsp;<i class=\"glyphicon glyphicon-info-sign\"></i>' +\n                '</label><br/><div class=\"panel panel-default\"><a id=\"'+ conditionKey+'\" href=\"#\" onclick=\"return false\" style=\"float: right; padding: 2px; color: red;\" class=\"diagnosis-close\"><i class=\"glyphicon glyphicon-remove\"></i></a>' +\n                '<div class=\"panel-body\"><div class=\"form-group\"><strong style=\"float: left;\">Status:</strong>&emsp;' +\n                '<label class=\"radio-inline\" style=\"padding-left: 15px;\"><input type=\"radio\" value=\"Affected\" name=\"' + conditionKey + '_status\">Affected</label>' +\n                '<label class=\"radio-inline\" style=\"padding-left: 15px;\"><input type=\"radio\" value=\"Carrier\" name=\"' + conditionKey + '_status\">Carrier</label>' +\n                '<label class=\"radio-inline\" style=\"padding-left: 15px;\"><input type=\"radio\" value=\"Uncertain\" name=\"' + conditionKey + '_status\">Uncertain</label></div>' +\n                '<label style=\"float: left;\">Age onset:</label>' +\n                '<input type=\"text\" id=\"' + conditionKey + '_ageOnset\" class=\"form-control\" style=\"width: 190px; height: 27px; padding: 4px; border-radius: 4px; float:right;\"/>' +\n                '<label style=\"float: left;\">Diagnosed:</label>' +\n                '<input type=\"text\" id=\"' + conditionKey +'_diagnosed\" class=\"form-control\" style=\"width: 190px; height: 27px; padding: 4px; border-radius: 4px; float:right;\"/>' +\n                '<label style=\"float: left;\">Diagnosis type:</label>' +\n                '<select id=\"' + conditionKey +'_diagnosisType\" class=\"form-control\" style=\"width: 190px; height: 27px; padding: 4px; border-radius: 4px; float:right;\">' +\n                '<option value=\"\"></option>'+\n                '<option value=\"Clinical\">Clinical</option>'+\n                '<option value=\"Confirmed Moleculary\">Confirmed Moleculary</option>'+\n                '<option value=\"Confirmed Cytogenetically\">Confirmed Cytogenetically</option>'+\n                '<option value=\"Confirmed Biochemically\">Confirmed Biochemically</option>'+\n                '</select>'+\n                '<label style=\"float: left;\">Notes:</label><textarea class=\"form-control\" rows=\"3\" id=\"' + conditionKey +'_notes\"></textarea></div></div></span>';\n        }\n\n        function conditionWindow(conditionKey) {\n            return '<span><label style=\"float: left;\"><input type=\"checkbox\" id=\"' + conditionKey + '_check_stat\" value=\"\" checked=\"checked\" onclick=\"return false;\">&emsp;'+opts.conditions[conditionKey].name+'&emsp;<i class=\"glyphicon glyphicon-info-sign\"></i></label><br/>'+\n                '<div class=\"panel panel-default\"><a id=\"'+ conditionKey + '\" href=\"#\" onclick=\"return false\" style=\"float: right; padding: 2px; color: red;\" class=\"diagnosis-close\"><i class=\"glyphicon glyphicon-remove\"></i></a>' +\n                '<a href=\"#\" onclick=\"return false\" style=\"float: right; padding: 2px; color: green;\" class=\"diagnosis-edit\"><i class=\"glyphicon glyphicon-pencil\"></i></a>'+\n                '<div class=\"panel-body\"><div class=\"form-group\"><span style=\"float:left; padding-left:3px;\"><strong>Status:</strong>&nbsp;<span id=\"' + conditionKey + '_status_stat\"></span></span>' +\n                '<span style=\"float:left; padding-left:3px;\"><strong>Onset:</strong>&nbsp;<span id=\"' + conditionKey + '_ageOnset_stat\"></span></span>' +\n                '<span style=\"float:left; padding-left:3px;\"><strong>Dx:</strong>&nbsp;<span id=\"' + conditionKey + '_diagnosed_stat\"></span></span><br/>' +\n                '<span style=\"float:left; padding-left:3px;\"><strong>Dx type:</strong>&nbsp;<span id=\"' + conditionKey + '_diagnosisType_stat\"></span></span>' +\n                '<span style=\"float:left; padding-left:3px;\"><strong>Notes:</strong>&nbsp;<span id=\"' + conditionKey + '_notes_stat\"></span></span></div></div></div></span>';\n        }\n\n        function cancersView(cancer_id, cancer_name, type, ageValue) {\n            var cancer_close = type + '-close';\n            return '<div class=\"checkbox\"><label><input type=\"checkbox\" class=\"cancer-checkbox\" value='+cancer_id+' checked>'+cancer_name+'&emsp;<i class=\"glyphicon glyphicon-info-sign\"></i></label>' +\n                '&emsp;<input type=\"number\" min=\"0\" class=\"cancer-age\" placeholder=\"Enter age of diagnosis\" value='+ageValue+' ><a href=\"#\" onclick=\"return false\" style=\"float: right; padding: 2px; color: red;\" class='+cancer_close+'><i class=\"glyphicon glyphicon-remove\"></i></a></div>';\n        }\n\n        var dataset = pedcache.current(opts);\n        var selectedName = d.data.name;\n        var node_name = typeof (selectedName) === 'string' && selectedName.length > 0 ? selectedName : $('#id_name').val();\n        var newdataset = ptree.copy_dataset(dataset);\n        var person = pedigree_util.getNodeByName(newdataset, node_name);\n\n        var availableConditions = [];\n        Object.keys(opts.conditions).forEach(function(key) {\n            availableConditions.push(opts.conditions[key].name);\n        });\n\n        $(\"#conditions\").autocomplete({\n            source: availableConditions,\n            select: function (event, ui) {\n                let conditionId = getConditionId(ui.item.value, opts.conditions);\n                let condition = conditionForm(conditionId);\n                if ($(this).closest('td').find('input').is('#' + conditionId + '_check_stat')) {\n                    $('#' + conditionId + '_check_stat').closest('span').show();\n                    $(this).val('');\n                    return false;\n                } else if ($(this).closest('td').find('input').is('#' + conditionId + '_check')) {\n                    $('#' + conditionId + '_check').closest('span').show();\n                    $(this).val('');\n                    return false;\n                }\n                $(this).closest('td').append(condition);\n                pedigree_form.saveTabbedForm(opts, d.data.name);\n                $(this).val('');\n                return false;\n            }\n        }).data(\"ui-autocomplete\")._renderItem = function (ul, item) {\n            return $(\"<li></li>\")\n                .data(\"item.autocomplete\", item)\n                .append('<span style=\"width: 380px;\">' + item.label + '&emsp;<i class=\"glyphicon glyphicon-info-sign\"></i></span>')\n                .appendTo(ul);\n        };\n\n        $(\"#searchForCancers\").autocomplete({\n            source: cancers,\n            select: function (event, ui) {\n                var cancerId = getGenesId(ui.item.value, opts.cancers);\n                var cancerElement = cancersView(cancerId, ui.item.value, 'cancer', '');\n                var cancerAlreadyThere = false;\n                $(this).closest('div').find('input').each(function () {\n                    if ($(this).val() === cancerId) {\n                        cancerAlreadyThere = true;\n                        return false;\n                    }\n                });\n\n                if (!cancerAlreadyThere) {\n                    $(this).closest('div').append(cancerElement);\n                    if (d.data.name in opts.selected_cancers) {\n                        opts.selected_cancers[d.data.name].push(cancerId);\n                    } else {\n                        opts.selected_cancers[d.data.name] = [];\n                        opts.selected_cancers[d.data.name].push(cancerId);\n                    }\n                    pedigree_form.save_common_cancers($(this).closest('div').find('input[type=checkbox]').val(), $(this).closest('div').find('input[type=number]').val(), opts, d.data.name, false);\n                }\n                $(this).val('');\n                return false;\n            }\n        }).data(\"ui-autocomplete\")._renderItem = function (ul, item) {\n            return $(\"<li></li>\")\n                .data(\"item.autocomplete\", item)\n                .append('<span style=\"width: 380px;\">' + item.label + '&emsp;<i class=\"glyphicon glyphicon-info-sign\"></i></span>')\n                .appendTo(ul);\n        };\n\n        $(document).on('click', 'a.diagnosis-close', function () {\n            if ($(this).closest('span').find('input[type=checkbox]').is(':checked')) {\n                $(this).closest('span').hide();\n            } else {\n                $(this).closest('span').remove();\n            }\n        });\n\n        $('#nodeTabs').on('click', 'a.cancer-close', function () {\n            $(this).closest('div').remove();\n        });\n\n        $('#nodeTabs').on('click', 'a.phenotype-close', function () {\n            $(this).closest('span').remove();\n            pedigree_form.remove_phenotypes(opts, d.data.name, $(this).closest('span').find('input').val());\n        });\n\n        $('#nodeTabs').on('click', 'a.candidate-close', function () {\n            $(this).closest('span').remove();\n            pedigree_form.remove_candidate(opts, d.data.name, $(this).closest('span').find('input').val());\n        });\n\n        $('#nodeTabs').on('click', 'a.causal-close', function () {\n            $(this).closest('span').remove();\n            pedigree_form.remove_causal(opts, d.data.name, $(this).closest('span').find('input').val());\n        });\n\n        $('#nodeTabs').on('click', 'a.carrier-close', function () {\n            $(this).closest('span').remove();\n            pedigree_form.remove_carrier(opts, d.data.name, $(this).closest('span').find('input').val());\n        });\n\n        person.conditions = person.conditions ||  [];\n        const specialRegex = new RegExp(`[ ~!@#$%^&*()|+-=?;:'\",.]`, 'gi') ;\n        $.each(opts.conditions, function (k, v) {\n            let conditionAge = 'age';\n            let conditionStatus = 'status';\n            let conditionDiagnosed =  'diagnosed';\n            let conditionType =  'type';\n            let conditionNotes =  'notes';\n            const condition =  person.conditions.find((condition)=> condition.name.replace(specialRegex, '-') + '_condition' === k);\n            if (condition) {\n                let condition_window = conditionWindow(k);\n                let condition_form = conditionForm(k);\n                $(\"#conditions\").closest('td').append(condition_window);\n                $(\"#conditions\").closest('td').append(condition_form);\n                $('#' + k + '_ageOnset_stat').text(condition[conditionAge]);\n                $('#' + k + '_status_stat').text(condition[conditionStatus]);\n                $('#' + k + '_diagnosed_stat').text(condition[conditionDiagnosed]);\n                $('#' + k + '_diagnosisType_stat').text(condition[conditionType]);\n                $('#' + k + '_notes_stat').text(condition[conditionNotes]);\n\n                $('#' + k + '_ageOnset').val(condition[conditionAge]);\n                $(\"input[name='\" + k + \"_status']\").val([condition[conditionStatus]]);\n                $('#' + k + '_diagnosed').val(condition[conditionDiagnosed]);\n                $('#' + k + '_diagnosisType').val(condition[conditionType]);\n                $('#' + k + '_notes').val(condition[conditionNotes]);\n\n                $('#' + k + '_check').closest('span').hide();\n            }\n        });\n\n        $('#nodeTabs').on('click', 'a.diagnosis-close', function () {\n           let conditionToDelete = $(this).attr('id')\n             pedigree_form.saveTabbedForm(opts, d.data.name, {conditionToDelete});\n        });\n\n\n        for (var ph_count=0; ph_count<opts.phenotypes.length; ph_count++) {\n            if(person.hasOwnProperty(opts.phenotypes[ph_count].type)) {\n                opts.selected_phenotypes[d.data.name] = [opts.phenotypes[ph_count].type];\n                $(\"#phenotypes\").closest('td').append(genesAppender(opts.phenotypes[ph_count].type, opts.phenotypes[ph_count].name, 'phenotype'));\n            }\n        }\n\n        for (var gn_count = 0; gn_count < opts.candidate_genotype.length; gn_count++) {\n            if (person.hasOwnProperty(opts.candidate_genotype[gn_count].type)) {\n                opts.selected_candidate_genotype[d.data.name] = [opts.candidate_genotype[gn_count].type];\n                $(\"#candidateGenes\").closest('div').append(genesAppender(opts.candidate_genotype[gn_count].type, opts.candidate_genotype[gn_count].name, 'candidate'));\n            }\n        }\n\n        for (var gn_count = 0; gn_count < opts.causal_genotype.length; gn_count++) {\n            if (person.hasOwnProperty(opts.causal_genotype[gn_count].type)) {\n                opts.selected_causal_genotype[d.data.name] = [opts.causal_genotype[gn_count].type];\n                $(\"#causalGenes\").closest('div').append(genesAppender(opts.causal_genotype[gn_count].type, opts.causal_genotype[gn_count].name, 'causal'));\n            }\n        }\n\n        for (var gn_count = 0; gn_count < opts.carrier_genotype.length; gn_count++) {\n            if (person.hasOwnProperty(opts.carrier_genotype[gn_count].type)) {\n                opts.selected_carrier_genotype[d.data.name] = [opts.carrier_genotype[gn_count].type];\n                $(\"#carrierGenes\").closest('div').append(genesAppender(opts.carrier_genotype[gn_count].type, opts.carrier_genotype[gn_count].name, 'carrier'));\n            }\n        }\n\n        for (var ca_count = 0; ca_count < opts.cancers.length; ca_count++) {\n            if (person.hasOwnProperty(opts.cancers[ca_count].type)) {\n                opts.selected_cancers[d.data.name] = [opts.cancers[ca_count].type];\n                if (person.hasOwnProperty(opts.cancers[ca_count].type + '_age')) {\n                    $(\"#searchForCancers\").closest('div').append(cancersView(opts.cancers[ca_count].type, opts.cancers[ca_count].name, 'cancer', person[opts.cancers[ca_count].type + '_age']));\n                } else {\n                    $(\"#searchForCancers\").closest('div').append(cancersView(opts.cancers[ca_count].type, opts.cancers[ca_count].name, 'cancer', ''));\n                }\n            }\n        }\n\n        $('#reason').on('keyup blur', function (e) {\n            if (e.keyCode === 13) {\n                pedigree_form.saveTabbedForm(opts, d.data.name);\n            }\n        });\n\n        $('.diagnosis-edit').on('click', function () {\n            let conditionName = $(this).closest('span').find('label').text();\n            let conditionId = getConditionId(conditionName.trim(), opts.conditions);\n            $('#' + conditionId + '_check').closest('span').show();\n            $(this).closest('span').remove();\n        });\n\n        $('#nodeTabs').on('change', 'input[type=text], input[type=radio], input[type=checkbox],#nodeTabs' +\n            ' input[type=number], select, textarea, #heredity,#ethnicity,  #country_of_origin', function() {\n            pedigree_form.saveTabbedForm(opts, d.data.name, null);\n        });\n\n        $('.cancer-checkbox').each(function () {\n            if ($(this).is(':checked')) {\n                $(this).closest('div').find('input[type=number]').show();\n            }\n        });\n\n        $('#nodeTabs').on('change', '.cancer-checkbox', function () {\n            if ($(this).is(':checked')) {\n                $(this).closest('div').find('input[type=number]').show();\n                pedigree_form.save_common_cancers($(this).val(), $(this).closest('div').find('input[type=number]').val(), opts, d.data.name, false);\n            } else {\n                $(this).closest('div').find('input[type=number]').hide();\n                pedigree_form.remove_cancers($(this).val(), $(this).closest('div').find('input[type=number]').val(), opts, d.data.name, false);\n                if (opts.hasOwnProperty('cancer_legend')) {\n                    for (var i = 0; i < opts.cancer_legend.length; i++) {\n                        if ($(this).val() === opts.cancer_legend[i].type) {\n                            var cancerCount = opts.cancer_legend[i].count;\n                            opts.cancer_legend[i].count = cancerCount - 1;\n                            break;\n                        }\n                    }\n                }\n            }\n            legend.showCancerLegends(opts);\n        });\n\n        $('#nodeTabs').on('change', '.cancer-age', function () {\n            if ($(this).closest('div').find('input[type=checkbox]').is(':checked')) {\n                if ($(this).val()) {\n                    pedigree_form.save_common_cancers($(this).closest('div').find('input[type=checkbox]').val(), $(this).val(), opts, d.data.name, true);\n                } else {\n                    pedigree_form.remove_cancers($(this).closest('div').find('input[type=checkbox]').val(), $(this).val(), opts, d.data.name, true);\n                }\n            }\n        });\n    }\n\n    function getConditionId(conditionName, conditions) {\n        let conditionKey = null;\n        Object.keys(conditions).forEach(function(key) {\n            if(conditions[key].name === conditionName) {\n                conditionKey = key;\n            }\n        });\n        return conditionKey;\n    }\n\n    function getGenesId(genesName, genes) {\n        for (var i = 0; i < genes.length; i++) {\n            if (genes[i].name === genesName) {\n                return genes[i].type;\n            }\n        }\n        return null;\n    }\n\n}(window.widgets = window.widgets || {}, jQuery));\n"]}
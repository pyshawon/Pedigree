/*! pedigreejs 2019-10-08 */

function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}!function(e,t,a){e.messages=function(e,a,n,i,s){n?t('<div id="msgDialog">'+a+"</div>").dialog({modal:!0,title:e,width:350,buttons:{Yes:function(){t(this).dialog("close"),n(i,s)},No:function(){t(this).dialog("close")}}}):t('<div id="msgDialog">'+a+"</div>").dialog({title:e,width:350,buttons:[{text:"OK",click:function(){t(this).dialog("close")}}]})},e.validate_age_yob=function(e,t,a){var n=(new Date).getFullYear(),i=parseInt(e)+parseInt(t);return 1==a?n>=i:Math.abs(n-i)<=1&&n>=i}}(window.utils=window.utils||{},jQuery),function(e,t,a){function n(e){for(var t=0;t<e.length;t++)a=e,n=e[t].name,void 0,void 0,s=pedigree_util.getIdxByName(a,n),r=a[s].level?a[s].level:0,function e(t,a,n){var i=["mother","father"];a++;for(var s=0;s<i.length;s++){var r=pedigree_util.getIdxByName(n,n[t][i[s]]);r>=0&&((!n[r].level||n[r].level<a)&&(n[pedigree_util.getIdxByName(n,n[t].mother)].level=a,n[pedigree_util.getIdxByName(n,n[t].father)].level=a),e(r,a,n))}}(s,r,a);var a,n,s,r,o=0;for(t=0;t<e.length;t++)e[t].level&&e[t].level>o&&(o=e[t].level);for(t=0;t<e.length;t++)if(1==pedigree_util.getDepth(e,e[t].name))if(e[t].level&&e[t].level==o)e[t].top_level=!0;else{e[t].noparents=!0;var d=i(e,e[t]);if(d>-1&&e[d].mother&&(e[t].mother=e[d].mother,e[t].father=e[d].father),!e[t].mother)for(var l=0;l<e.length;l++)e[t].level==e[l].level-1&&(d=i(e,e[l]))>-1&&(e[t].mother="F"===e[l].sex?e[l].name:e[d].name,e[t].father="M"===e[l].sex?e[l].name:e[d].name)}else delete e[t].top_level;return e}function i(e,t){for(var a=0;a<e.length;a++){var n=e[a];if(t.name===n.mother)return pedigree_util.getIdxByName(e,n.father);if(t.name===n.father)return pedigree_util.getIdxByName(e,n.mother)}return-1}e.cancers={breast_cancer:"breast_cancer_diagnosis_age",breast_cancer2:"breast_cancer2_diagnosis_age",ovarian_cancer:"ovarian_cancer_diagnosis_age",prostate_cancer:"prostate_cancer_diagnosis_age",pancreatic_cancer:"pancreatic_cancer_diagnosis_age"},e.genetic_test=["brca1","brca2","palb2","atm","chek2"],e.pathology_tests=["er","pr","her2","ck14","ck56"],e.add=function(a){t("#load").change(function(t){e.load(t,a)}),t("#save").click(function(t){e.save(a)}),t("#print").click(function(t){e.print(e.get_printable_svg(a))}),t("#svg_download").click(function(t){e.svg_download(e.get_printable_svg(a))}),t("#png_download").click(function(n){var i,s=t(e.get_printable_svg(a)).appendTo("body")[0],r=s.querySelector("svg");void 0!==window.XMLSerializer?i=(new XMLSerializer).serializeToString(r):void 0!==r.xml&&(i=r.xml);var o=document.createElement("canvas"),d=r.getBoundingClientRect();o.width=d.width,o.height=d.height;var l=o.getContext("2d"),c=document.createElement("img");c.setAttribute("src","data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(i)))),c.onload=function(){l.drawImage(c,0,0);var e=o.toDataURL("image/png"),t=document.createElement("a");t.href=e,t.download="plot.png",t.target="_blank",document.body.appendChild(t),t.click(),document.body.removeChild(t),setTimeout(function(){s.remove()},200)}})},e.copy_svg_html=function(t){for(var a=e.get_printable_svg(t).html(),n=/url\(\#(.*?)\)/g,i=n.exec(a);null!==i;){var s=i[1];a=a.replace(new RegExp(s,"g"),s+ptree.makeid(2)),i=n.exec(a)}return a},e.get_printable_svg=function(e){var a=pedcache.current(e);void 0!==a&&null!==a&&(e.dataset=a);var n=ptree.get_tree_dimensions(e),i=t("#"+e.targetDiv).find("svg").parent();if(e.width<n.width||e.height<n.height||n.width>595||n.height>842){var s=n.width,r=n.height+100,o=1;if(n.width>595||n.height>842){n.width>595&&(s=595),n.height>842&&(r=842);var d=s/n.width,l=r/n.height;o=d<l?d:l}i=t("<div></div>");let a=t("svg").parent().clone();[".view-controls",".view-controls-zoom .field-no-user-select",".all-legend-container","#dataButton","#dataShower"].map(e=>a.find(e).remove()),i.append(a.html());var c=i.find("svg");c.attr("width",s),c.attr("height",r);var p=1.5*-e.symbol_size*o;c.find(".diagram").attr("transform","translate(0, "+p+") scale("+o+")")}return i},e.svg_download=function(e){var t=document.createElement("a");t.href="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e.html()))),t.download="plot.svg",t.target="_blank",document.body.appendChild(t),t.click(),document.body.removeChild(t)},e.print=function(e){e.constructor!==Array&&(e=[e]);for(var a=2*t(window).width()/3,n=t(window).height()-40,i=["/static/css/output.css","https://use.fontawesome.com/releases/v5.7.2/css/all.css","https://use.fontawesome.com/releases/v5.7.2/css/v4-shims.css"],s=window.open("","PrintMap","width="+a+",height="+n),r="",o=0;o<i.length;o++)r+='<link href="'+i[o]+'" rel="stylesheet" type="text/css" media="all">';for(r+="<style>body {font-size: "+t("body").css("font-size")+";}</style>",html="",o=0;o<e.length;o++)html+=t(e[o]).html(),o<e.length-1&&(html+='<div style="page-break-before:always"> </div>');s.document.write(r),s.document.write(html),s.document.close(),s.focus(),setTimeout(function(){s.print(),s.close()},100)},e.save=function(e){var t=JSON.stringify(pedcache.current(e));e.DEBUG&&console.log(t);var a="data:application/csv;charset=utf-8,"+encodeURIComponent(t);window.open(a,"boadicea_pedigree")},e.load=function(a,n){var i=a.target.files[0];if(i){var s=new FileReader;s.onload=function(t){n.DEBUG&&console.log(t.target.result);try{if(t.target.result.startsWith("BOADICEA import pedigree file format 4.0"))n.dataset=e.readBoadiceaV4(t.target.result);else try{n.dataset=JSON.parse(t.target.result)}catch(a){n.dataset=e.readLinkage(t.target.result)}ptree.validate_pedigree(n)}catch(e){return console.error(e),void utils.messages("File Error",e.message?e.message:e)}console.log(n.dataset);try{ptree.rebuild(n)}catch(e){utils.messages("File Error",e.message?e.message:e)}},s.onerror=function(e){utils.messages("File Error","File could not be read! Code "+e.target.error.code)},s.readAsText(i)}else console.error("File could not be read!");t("#load")[0].value=""},e.readLinkage=function(e){for(var a,i=e.trim().split("\n"),s=[],r=0;r<i.length;r++){var o=t.map(i[r].trim().split(/\s+/),function(e,t){return e.trim()});if(o.length<5)throw"unknown format";var d="1"==o[4]?"M":"2"==o[4]?"F":"U",l={famid:o[0],display_name:o[1],name:o[1],sex:d};if("0"!==o[2]&&(l.father=o[2]),"0"!==o[3]&&(l.mother=o[3]),void 0!==a&&a!==l.famid){console.error("multiple family IDs found only using famid = "+a);break}if("2"==o[5]&&(l.affected=2),o.length>6){l.alleles="";for(var c=6;c<o.length;c+=2)l.alleles+=o[c]+"/"+o[c+1]+";"}s.unshift(l),a=o[0]}return n(s)},e.readBoadiceaV4=function(a){for(var i=a.trim().split("\n"),s=[],r=2;r<i.length;r++){var o=t.map(i[r].trim().split(/\s+/),function(e,t){return e.trim()});if(o.length>1){var d={famid:o[0],display_name:o[1],name:o[3],sex:o[6],status:o[8]};1==o[2]&&(d.proband=!0),"0"!==o[4]&&(d.father=o[4]),"0"!==o[5]&&(d.mother=o[5]),"0"!==o[7]&&(d.mztwin=o[7]),"0"!==o[9]&&(d.age=o[9]),"0"!==o[10]&&(d.yob=o[10]);var l=11;t.each(e.cancers,function(e,t){"0"!==o[l]&&(d[t]=o[l]),l++}),"0"!==o[l++]&&(d.ashkenazi=1);for(var c=0;c<e.genetic_test.length;c++)"0"!==o[(l+=2)-2]&&("S"!==o[l-2]&&"T"!==o[l-2]||"P"!==o[l-1]&&"N"!==o[l-1]?console.warn("UNRECOGNISED GENE TEST ON LINE "+(r+1)+": "+o[l-2]+" "+o[l-1]):d[e.genetic_test[c]+"_gene_test"]={type:o[l-2],result:o[l-1]});for(c=0;c<e.pathology_tests.length;c++)"0"!==o[l]&&("N"===o[l]||"P"===o[l]?d[e.pathology_tests[c]+"_bc_pathology"]=o[l]:console.warn("UNRECOGNISED PATHOLOGY ON LINE "+(r+1)+": "+e.pathology_tests[c]+" "+o[l])),l++;s.unshift(d)}}try{return n(s)}catch(e){return console.error(e),s}}}(window.io=window.io||{},jQuery),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e("undefined"!=typeof jQuery?jQuery:window.Zepto)}(function(e){"use strict";var t=8,a=13,n=27,i=32,s=37,r=38,o=39,d=40,l="magicsearch-wrapper",c="magicsearch-box",p="magicsearch-arrow",u="magicsearch-loading",h="magicsearch-hidden",g="multi-items",f="multi-item",m="multi-item-close",y=function(t){return"string"===e.type(t)},_=function(e,t){var a=e.match(new RegExp("\\%[^\\%]+\\%","g"));if(!a)return e;for(var n=0;n<a.length;n++)a[n]=a[n].replace(new RegExp("\\%","g"),"");for(var i=0;i<a.length;i++)e=e.replace("%"+a[i]+"%",t[a[i]]?t[a[i]]:"error");return e},v=function(e){var t=e.lastIndexOf("px");return t<0?Number(e):Number(e.substring(0,t))},b=function(t,a){return e.isNumeric(t)?(t=Math.ceil(Number(t)))<=0&&(t=x.defaults[a]):t=x.defaults[a],t},x=function(t,a){this.element=t,this.$element=e(t),this.options=a};x.defaults={dataSource:[],type:"",ajaxOptions:{},id:"",hidden:!1,fields:"",format:"",inputFormat:"",maxShow:5,isClear:!0,showSelected:!0,dropdownBtn:!1,dropdownMaxItem:8,multiple:!1,maxItem:!0,showMultiSkin:!0,multiStyle:{},multiField:"",focusShow:!1,noResult:"",skin:"",disableRule:function(e){return!1},success:function(e,t){return!0},afterDelete:function(e,t){return!0}},x.prototype={init:function(){var t=this;window.MagicSearch.index+=1;var a=this.$element;if(this.options=e.extend({},x.defaults,this.options),this.props={isFirstGetDataSource:!0,style:e.extend({},this.element.style),objDataSource:{},multiStyle:{space:3,width:57}},!this.$element.is("input:text"))return console.error("magicsearch: Can not bind magicsearch to other elements except input which type is text."),!1;if(!y(this.options.id)||""===this.options.id)return console.error("magicsearch: The option id must be a string which is not empty."),!1;this.options.multiple?this.options.isClear=!0:this.options.isClear||(this.options.hidden=!1),this.props.styles={borderTopWidth:v(a.css("border-top-width")),borderRightWidth:v(a.css("border-right-width")),borderBottomWidth:v(a.css("border-bottom-width")),borderLeftWidth:v(a.css("border-left-width")),paddingTop:v(a.css("padding-top")),paddingRight:v(a.css("padding-right")),paddingBottom:v(a.css("padding-bottom")),paddingLeft:v(a.css("padding-left")),maxWidth:v(a.css("max-width"))||500},this.props.styles.height=a.height()+this.props.styles.borderTopWidth+this.props.styles.borderBottomWidth+this.props.styles.paddingTop+this.props.styles.paddingBottom,this.props.styles.sightHeight=this.props.styles.height-this.props.styles.borderTopWidth-this.props.styles.borderBottomWidth,this.props.styles.width=a.width()+this.props.styles.borderLeftWidth+this.props.styles.borderRightWidth+this.props.styles.paddingLeft+this.props.styles.paddingRight;var n=this.props.styles,i=a.attr("data-id");if("magicsearch"!==a.parent().attr("data-belong")){var s=e('<div class="'+l+(this.options.skin?" "+this.options.skin:"")+'" data-belong="magicsearch"></div>');s.css("width",n.width),a.wrap(s)}var r=a.parent(),o=a.css("display");if(r.css({display:"inline"===o?"inline-block":o,float:a.css("float"),margin:a.css("margin")}),r.attr("data-index",window.MagicSearch.index),a.css({margin:0,"box-sizing":"border-box",width:n.width,height:n.height}),a.attr("placeholder")&&a.attr("data-placeholder",a.attr("placeholder")),a.removeAttr("disabled"),this.options.isClear&&a.val(""),void 0===i&&(a.attr("data-id",""),i=""),0===r.find("."+c).length&&r.append('<div class="'+c+'"></div>'),r.find("."+c).css({top:n.height}),this.options.hidden){var d=a.attr("name"),g=e('<input class="'+h+'" type="hidden" value="'+i+'">');d&&(g.attr("name",d),a.removeAttr("name")),r.append(g)}if(this.options.dropdownBtn){var f=e('<div class="'+p+'"><i></i></div>');a.addClass("dropdown"),a.css("padding-right",n.paddingRight+24),f.css({top:n.borderTopWidth,bottom:n.borderBottomWidth,right:n.borderRightWidth}),r.append(f)}if("ajax"==this.options.type){var m=e('<div class="'+u+'"><div></div></div>');r.append(m);var _=setTimeout(function(){r.find("."+u).find("div").show()},500),b={type:"GET",url:this.options.dataSource,dataType:"json",error:function(){console.error("magicsearch: Error with xhr.Index: "+window.MagicSearch.index)},success:function(e){}},w=(b=e.extend({},b,this.options.ajaxOptions)).success;b.success=function(e){clearTimeout(_),t.options.dataSource=e,r.find("."+u).remove(),t.initAfterAjax(),w(e)},e.ajax(b)}else this.initAfterAjax();return this},initAfterAjax:function(){var t=this.$element,a=t.parent(),n=this.props.styles,i=t.attr("data-id");if(e.isFunction(this.options.dataSource)&&(this.options.dataSource=this.options.dataSource(this.$element)),this.options.dataSource){if(y(this.options.dataSource))if("null"==this.options.dataSource.toLowerCase())this.options.dataSource=[];else try{if(this.options.dataSource=e.parseJSON(this.options.dataSource),!e.isArray(this.options.dataSource)){var s=[];for(var r in this.options.dataSource)s.push(this.options.dataSource[r]);this.options.dataSource=s}}catch(e){return this.options.dataSource=[],console.error("magicsearch: A problem is occured during parsing dataSource,please check.Index: "+window.MagicSearch.index),!1}else if(!e.isArray(this.options.dataSource)){var o=[];for(var d in this.options.dataSource)o.push(this.options.dataSource[d]);this.options.dataSource=o}}else this.options.dataSource=[];if(y(this.options.fields)?this.options.fields=[""===this.options.fields?this.options.id:this.options.fields]:e.isArray(this.options.fields)||(this.options.fields=[this.options.id]),y(this.options.format)&&""!==this.options.format||(this.options.format="%"+this.options.id+"%"),this.options.maxShow=b(this.options.maxShow,"maxShow"),this.options.dropdownBtn&&(this.options.dropdownMaxItem=b(this.options.dropdownMaxItem,"dropdownMaxItem")),this.options.multiple&&(!0!==this.options.maxItem&&(this.options.maxItem=b(this.options.maxItem,"maxItem")),this.options.showMultiSkin&&(y(this.options.multiField)&&""!==this.options.multiField||(this.options.multiField=this.options.id)),this.options.multiStyle&&(this.props.multiStyle.space=this.options.multiStyle.space?this.options.multiStyle.space:3,this.props.multiStyle.width=this.options.multiStyle.width?this.options.multiStyle.width:57)),e.isFunction(this.options.success)||(this.options.success=function(e,t){return!0}),e.isFunction(this.options.disableRule)||(this.options.disableRule=function(e){return!1}),""!==i&&this.getDataSource(),this.options.multiple&&(t.addClass("multi"),this.options.showMultiSkin&&0===a.find("."+g).length)){var l=e('<div class="'+g+'"></div>');l.css({top:this.props.multiStyle.space+n.borderTopWidth,left:this.props.multiStyle.space+n.borderLeftWidth,bottom:this.props.multiStyle.space+n.borderBottomWidth,right:this.props.multiStyle.space+n.borderRightWidth+(this.options.dropdownBtn?24:0)}),a.append(l)}if(this.options.multiple){var c=i?i.split(","):[];if(!0!==this.options.maxItem&&c.length>=this.options.maxItem&&(t.attr("disabled","disabled"),a.addClass("disabled")),this.options.showMultiSkin)for(var p=[],u=0;u<c.length;u++)p.push(c[u]),t.attr("data-id",p.join(",")),this.options.hidden&&a.find("."+h).val(p.join(",")),this.appendHtml(this.props.objDataSource[c[u]])}else if(""!==i){var f=this.props.objDataSource[i],m=this.options.inputFormat?this.options.inputFormat:this.options.format;t.val(_(m,f))}},destroy:function(){var e=this.$element,t=e.parent();if("magicsearch"===t.attr("data-belong")){this.element.style=this.props.style,e.css({margin:t.css("margin"),"padding-top":this.props.styles.paddingTop,"padding-right":this.props.styles.paddingRight,"padding-bottom":this.props.styles.paddingBottom,height:this.props.styles.height,width:this.props.styles.width});var a=e.attr("data-placeholder");void 0!==a&&(e.attr("placeholder",a),e.removeAttr("data-placeholder")),e.removeClass("dropdown multi").removeAttr("disabled data-id"),e.siblings().remove(),e.unwrap(),e.off(),e.val("")}},getDataSource:function(){var e=this.options.dataSource;if(this.props.isFirstGetDataSource){for(var t={},a=0;a<e.length;a++)for(var n in e[a])this.options.dataSource[a][n]=String(e[a][n]);this.props.isFirstGetDataSource=!1;for(var i=0;i<e.length;i++)t[e[i][this.options.id]]=e[i];this.props.objDataSource=t}return this.options.dataSource},setData:function(){var e=this.$element,t=e.parent(),a=t.find("."+c),n=(t.find("."+p),a.find("li.ishover")),i=this.options,s=e.attr("data-id"),r=this.props.objDataSource[n.attr("data-id")];if(i.multiple){if(a.is(":hidden"))return;e.val("");var o=s?s.split(","):[];if(!0!==i.maxItem&&o.length>=i.maxItem)return this;o.push(n.attr("data-id")),!0!==i.maxItem&&o.length==i.maxItem&&(e.attr("disabled","disabled"),t.addClass("disabled")),e.attr("data-id",o.join(",")),i.hidden&&t.find("."+h).val(o.join(",")),i.showMultiSkin&&this.appendHtml(r)}else e.val(i.inputFormat?_(i.inputFormat,r):n.text()),e.attr("data-id",n.attr("data-id")),i.hidden&&t.find("."+h).val(n.attr("data-id"));return i.success(e,r),this},deleteData:function(t){var a=this.$element,n=a.parent(),i=n.find("."+c),s=(n.find("."+p),this),r=t?t.split(","):[],o=a.attr("data-id"),d=o?o.split(","):[],l=this.options,u=this.props.styles;if(!l.multiple)return t=a.attr("data-id"),a.val("").attr("data-id",""),l.hidden&&n.find("."+h).val(""),l.afterDelete(a,s.props.objDataSource[t]),this;for(var g=function(){e(this).remove()},m=0;m<r.length;m++)n.find("."+f+'[data-id="'+r[m]+'"]').fadeOut(400,g),d.splice(d.indexOf(r[m]),1);return setTimeout(function(){var e=parseInt((u.maxWidth-(l.dropdownBtn?24:0)-u.borderLeftWidth-u.borderRightWidth-s.props.multiStyle.space)/(s.props.multiStyle.width+s.props.multiStyle.space)),t=parseInt(d.length/e);if(a.attr("data-id",d.join(",")),l.hidden&&n.find("."+h).val(d.join(",")),n.removeClass("disabled"),a.removeAttr("disabled"),l.showMultiSkin&&(0===d.length&&a.attr("data-placeholder")&&a.attr("placeholder",a.attr("data-placeholder")),a.css("height",u.height+t*u.sightHeight),a.css("padding-top",t*u.sightHeight+u.paddingTop),i.css("top",u.height+t*u.sightHeight),0===t))d.length,s.props.multiStyle.width,s.props.multiStyle.space,s.props.multiStyle.space,u.borderLeftWidth,u.borderRightWidth,l.dropdownBtn;1==r.length&&l.afterDelete(a,s.props.objDataSource[r[0]])},400),this},searchData:function(t,a){var n=this.$element,i=n.parent().find("."+c),s=this.options,r=this.getDataSource(),o=n.attr("data-id"),d=o?o.split(","):[],l=e.trim(n.val()),p="",u=[],h=!0;if(!0!==a&&i.html(""),""===l&&!t)return this;if(t){var g=n.data("page")||1;if(u=r.slice(0),!s.showSelected)for(var f=0,m=0;f<u.length;f++){if(d.indexOf(u[f][s.id])>-1&&(u.splice(f,1),f--,++m==d.length))break}g<=Math.ceil(u.length/100)&&n.data("page",g+1),u=u.slice(100*(g-1),100*g),1!=g&&0===u.length&&(h=!1)}else{for(var y=[].concat(_toConsumableArray(new Set(l.toLowerCase().split(" ")))),v=[],b=0;b<y.length;b++)""!==y[b]&&v.push({value:y[b],flag:!1});for(var x=0;x<r.length;x++)if(s.showSelected||!d.includes(r[x][s.id])){v=v.map(function(e){return e.flag=!1,e});for(var w=0;w<s.fields.length;w++){for(var k=0;k<v.length;k++)null!==r[x][s.fields[w]]&&r[x][s.fields[w]].toLowerCase().includes(v[k].value)&&(v[k].flag=!0);if(v.every(function(e){return e.flag})){u.push(r[x]);break}}if(u.length>=s.maxShow)break}}if(0===u.length){var z=s.noResult?s.noResult:"&#x672a;&#x641c;&#x7d22;&#x5230;&#x7ed3;&#x679c;";p='<span class="no-result">'+z+"</span>"}else{for(var S=[].concat(_toConsumableArray(new Set(l.split(" ")))).filter(function(e){return""!==e}),N=[],C=0;C<S.length-1;C++)for(var T=C+1;T<S.length;T++)N.push(S[C]+" "+S[T]);S=S.concat(N);var D=void 0;t||(D=e.extend(!0,[],u),u.forEach(function(e,t){s.fields.forEach(function(a){var n=[];if(null!==e[a]){for(var i=0;i<e[a].length;i++)n[i]=0;S.forEach(function(t){var i=e[a].toLowerCase().indexOf(t.toLowerCase());if(i>-1)for(var s=i;s<t.length+i;s++)n[s]=1})}for(var s=[],r=!1,o=-1,d=0,l=n.length-1;l>=0;l--)1==n[l]?(r?o--:(r=!0,o=l),d++,0===l&&s.push({start:o,length:d})):r&&(r=!1,s.push({start:o,length:d}),d=0);void 0!==D[t][a]&&(D[t][a]=s)})})),p+="<ul>",u.forEach(function(a,n){var i=e.extend({},a);p+='<li class="',p+=s.disableRule(a)?"disabled":"enabled",s.showSelected&&(p+=d.includes(a[s.id])?" selected":""),p+='" data-id="'+(void 0===a[s.id]?"":a[s.id])+'"',t||s.fields.forEach(function(e){null!==a[e]&&D[n][e].forEach(function(t){var a=i[e].substr(t.start,t.length);i[e]=i[e].replace(new RegExp(a,"i"),'<span class="keyword">'+a+"</span>")})}),p+=' title="'+_(s.format,a)+'">'+_(s.format,i)+"</li>"}),p+="</ul>"}return t?(h&&i.html(i.html()+p),i.addClass("all")):(i.html(p),i.removeClass("all").css("max-height","none")),this},showSearchBox:function(e){var t=this.$element.parent(),a=t.find("."+c);if(a.is(":visible"))return!1;if(this.options.dropdownBtn){var n=t.find("."+p);n.removeClass("arrow-rotate-360"),n.addClass("arrow-rotate-180")}return a.slideDown(200,e),this},hideSearchBox:function(e){var t=this.$element,a=t.parent(),n=a.find("."+c);if(!n.is(":visible"))return!1;if(void 0===e?this.options.isClear&&(this.options.multiple||""===t.attr("data-id"))&&t.val(""):e&&t.val(""),this.options.dropdownBtn){var i=a.find("."+p);i.removeClass("arrow-rotate-180"),i.addClass("arrow-rotate-360")}return setTimeout(function(){n.scrollTop(0)},199),n.slideUp(200,function(){n.html("")}),this},appendHtml:function(t){var a=this.$element,n=a.parent(),i=n.find("."+c),s=(n.find("."+p),i.find("li.ishover"),this.options),r=this.props.styles,o=this,d=a.attr("data-id").split(",");a.attr("placeholder")&&a.removeAttr("placeholder");var l=parseInt((r.maxWidth-(s.dropdownBtn?24:0)-r.borderLeftWidth-r.borderRightWidth-o.props.multiStyle.space)/(o.props.multiStyle.width+o.props.multiStyle.space)),u=e('<div class="'+f+'" data-id="'+t[s.id]+'" title="'+_(s.format,t)+'"><span>'+_("%"+s.multiField+"%",t)+'</span><a class="'+m+'" data-id="'+t[s.id]+'" href="javascript:;"></a></div>');u.css({height:r.sightHeight-2*o.props.multiStyle.space,width:o.props.multiStyle.width,"margin-bottom":2*o.props.multiStyle.space,"margin-right":o.props.multiStyle.space,"line-height":r.sightHeight-2*o.props.multiStyle.space-2+"px"}),u.find("."+m).css({top:parseInt((r.sightHeight-2*o.props.multiStyle.space-2-12)/2)});var h=parseInt(d.length/l);if(d.length%l==0)a.css("height",r.height+h*r.sightHeight),a.css("padding-top",h*r.sightHeight),i.css("top",r.height+h*r.sightHeight);else if(0===h)d.length,o.props.multiStyle.width,o.props.multiStyle.space,o.props.multiStyle.space,r.borderLeftWidth,r.borderRightWidth,s.dropdownBtn;u.find("."+m).click(function(){o.deleteData(e(this).attr("data-id")).hideSearchBox()}),n.find("."+g).append(u)}},e.fn.magicsearch=function(u){var m=!1,_=null,v="",b=this.each(function(){var l=e(this),b=e.data(this,"magicsearch");if(b&&b.destroy(),!1!==(b=new x(this,u)).init()){e.data(this,"magicsearch",b);var w=b.options,k=l.parent(),z=k.find("."+c),S=function(){if(k.hasClass("disabled"))return!1;z.is(":visible")?b.hideSearchBox():(z.css({"max-height":30*w.dropdownMaxItem+8}),z.unbind("scroll"),l.data("page",1),b.searchData(!0).showSearchBox(function(){z.on("scroll",function(t){this.scrollHeight-e(this).scrollTop()<300&&b.searchData(!0,!0)})}))};l.off().on("keyup",function(l){var c=e(this);if(l.which==n)c.val("").focus(),b.hideSearchBox();else{if(l.which==d){var p=z.find("li"),u=z.find("li.ishover");return p.length>0&&(u.length>0?(u.toggleClass("ishover"),u.next().length>0?u.next().toggleClass("ishover"):z.find("li:first").toggleClass("ishover")):z.find("li:first").toggleClass("ishover")),!1}if(l.which==r){var h=z.find("li"),g=z.find("li.ishover");return h.length>0&&(g.length>0?(g.toggleClass("ishover"),g.prev().length>0?g.prev().toggleClass("ishover"):z.find("li:last").toggleClass("ishover")):z.find("li:last").toggleClass("ishover")),!1}if(l.which==a){var f=z.find("li.ishover");f.length>0&&f.trigger("click")}else{if(l.which==s||l.which==o)return!0;var m=c.val();if(e.trim(v)==e.trim(m))return!0;if(""!==m){if(""===e.trim(m))return b.hideSearchBox(l.which!=t&&l.which!=i&&void 0),!1;if(!w.multiple&&""!==c.attr("data-id"))return void b.hideSearchBox();clearTimeout(_),_=setTimeout(function(){b.searchData().showSearchBox()},200)}else b.hideSearchBox()}}}).on("keydown",function(i){var l=e(this);if(i.which==n);else{if(i.which==r)return!1;if(i.which==d)return!1;if(i.which==a)return!z.is(":visible");if(i.which==t)if(v=l.val(),w.multiple){var c=k.find("."+g+" ."+f+":last");w.showMultiSkin&&""===l.val()&&b.deleteData(c.attr("data-id")).hideSearchBox()}else""!==e(this).attr("data-id")&&(b.deleteData(),b.hideSearchBox());else{if(i.which==s||i.which==o)return!0;if(""!==(v=l.val())&&!w.multiple&&""!==l.attr("data-id"))return void b.deleteData()}}}).on("focus",function(){k.addClass("focus"),w.isClear||""===l.val()||""!==l.attr("data-id")?w.focusShow&&S():b.searchData().showSearchBox()}).on("blur",function(){k.removeClass("focus"),b.hideSearchBox()}),z.off().on("mousedown","ul",function(){return!1}).on("mouseenter","li",function(){e(this).parent().find("li.ishover").removeClass("ishover"),e(this).addClass("ishover")}).on("mouseleave","li",function(){e(this).removeClass("ishover")}).on("click","li",function(){var t=e(this);t.hasClass("selected")&&w.multiple?b.deleteData(t.attr("data-id")).hideSearchBox():b.setData().hideSearchBox()}),w.dropdownBtn&&(m=!0,k.on("click","."+p,function(){return S()})),l.on("clear",function(){l.val(""),w.multiple&&w.showMultiSkin?b.deleteData(l.attr("data-id")):(l.attr("data-id",""),w.hidden&&k.find("."+h).val(""))}).on("update",function(t,a){if(void 0!==a.dataSource){var n=a.dataSource;if(y(n))if("null"==a.dataSource.toLowerCase())n=[];else try{if(n=e.parseJSON(a.dataSource),!e.isArray(n)){var i=[];for(var s in n)i.push(n[s]);n=i}}catch(e){n=[],console.error("magicsearch: The dataSource you updated is wrong,please check.")}b.props.isFirstGetDataSource=!0,b.options.dataSource=n}}).on("set",function(e,t){var a=b.$element.attr("data-id"),n=b.options.multiple;b.destroy(),b.$element.attr("data-id",t.override||!n?t.id:[].concat(_toConsumableArray(new Set((a?a.split(","):[]).concat(t.id.split(",")))))),b.$element.magicsearch(b.options)}).on("destroy",function(){b.destroy()}),k.on("click","."+g,function(t){e(t.target).is("."+g)&&l.focus()}).on("mousedown","."+g,function(){return!1})}});return m&&!window.MagicSearch.hasBindBody&&(e("body").on("mousedown",function(t){var a=e(t.target),n=e(this).find("."+l+" ."+c+":visible").first().parent(),i=n.find("input:text"),s=n.attr("data-index");void 0===s||a.is("."+l+'[data-index="'+s+'"] *')||e.data(i.get(0),"magicsearch").hideSearchBox()}),window.MagicSearch.hasBindBody=!0),b},window.MagicSearch={v:"1.0.2",index:0,hasBindBody:!1}}),function(e,t){e.add=function(a){t(".all-legend-container").length<1&&t("#"+a.targetDiv).append('\n        <div class="all-legend-container" id="all-legend-container">\n    <div class="patient-assign-legend generic-legend field-no-user-select pedigree_family_record_ui" id="legend-assign" style="\n    min-width:150px;width: 175px; margin-top: 8px; clear: both">\n       <div class="legend-box-controls-closed">\n       <span id="legend-horizontal-expand" style="float: left;" class="fa fa-angle-double-left" title="expand"></span>\n       <span id="legend-vertical-expand" class="fa legend-box-button-right legend-action-restore fa-angle-double-up" title="restore" style="float: right;"></span>\n       <span class="glyphicon glyphicon-cog" title="settings" style="float: right; padding-right: 10px;" id="settings"></span>\n       <div class="legend-minimized-title field-no-user-select" style="">\n       &emsp;Legend </div></div>\n       <div id="legend-content"  class="legend-box"  style="display: block">\n            <input id="dragged-legend-name" style="display:none;"/>\n            <h2 class="legend-title field-no-user-select">Conditions <input id="legend-condition-checkbox" type="checkbox" class="legend-hide-show-checkbox" checked></h2>\n            <ul class="candidategene-list abnormality-list" id="legend-condition-list">\n            </ul>\n            <h2 class="legend-title field-no-user-select">Phenotypes</h2>\n            <ul class="candidategene-list abnormality-list" id="legend-phenotype-list"></ul>\n            <h2 class="legend-title field-no-user-select">Candidate Genes</h2>\n            <ul class="candidategene-list abnormality-list" id="legend-candidate-list">\n            <li><div></div></li></ul>\n            <h2 class="legend-title field-no-user-select">Confirmed Causal Genes</h2>\n            <ul class="candidategene-list abnormality-list" id="legend-causal-list">\n            <li><div></div></li></ul>\n            <h2 class="legend-title field-no-user-select">Carrier Genes</h2>\n            <ul class="candidategene-list abnormality-list" id="legend-carrier-list">\n            <li><div></div></li></ul>\n            <h2 class="legend-title field-no-user-select">Cancers<input type="checkbox" id="legend-cancer-checkbox" class="legend-hide-show-checkbox" checked></h2>\n            <ul class="candidategene-list abnormality-list" id="legend-cancer-list"></ul>\n        </div>\n    </div>\n    <div class="patient-assign-legend generic-legend field-no-user-select pedigree_family_record_ui" id="samples-assign" style="\n    width: 175px; min-width: 150px; margin-top: 8px; clear: both">\n       <div class="legend-box-controls-closed" id="samples-legend-box-controls"><div class="legend-minimized-title field-no-user-select" style="">\n       Samples </div><span class="fa legend-box-button-right legend-action-restore fa-angle-double-down" title="restore"></span></div>\n       <div id="sample-content">\n</div>\n    </div>\n</div>'),t("#legend-vertical-expand").click(function(){t(this).toggleClass("fa-angle-double-up fa-angle-double-down legend-action-minimize legend-action-restore"),t("#legend-content").toggle()}),t("#legend-horizontal-expand").click(function(){t(this).hasClass("fa-angle-double-left")?t("#legend-assign").css("width","245px"):t("#legend-assign").css("width","175px"),t(this).toggleClass("fa fa-angle-double-left fa fa-angle-double-right")}),t("#samples-legend-box-controls").click(function(){t(this).toggleClass("legend-box-controls-open legend-box-controls-close");let e=t(this).find(".legend-box-button-right");e.toggleClass("fa-angle-double-up fa-angle-double-down legend-action-minimize legend-action-restore"),e.hasClass("fa-angle-double-up")?(t("#sample-content").css({height:"50px"}),t("#samples-assign").css({"min-width":"245px"})):(t("#sample-content").css("height","0"),t("#samples-assign").css({"min-width":"150px"}))}),window.drag=function(e){e.target.addEventListener("dragstart",function(e){e.dataTransfer.setData("text","sample")}),t("#dragged-legend-name").val(""),t("#dragged-legend-name").val(t(e.target).find("input").val())},t.each(a.conditions,function(e,a){var n=t('<li draggable="true" ondragstart="drag(event)" id='+(e+"_legend")+' class="condition-legend"><div><span class="dot" style="background-color:'+a.color+'"></span>&nbsp;<span class="condition-name">'+a.name+'</span>&nbsp;<span class="case"></span><input style="display: none;" value='+e+" /></div></li>");t("#legend-condition-list").append(n),n.hide()}),t.each(a.phenotypes,function(n){var i=a.phenotypes[n].type+"_legend",s=t('<li draggable="true" ondragstart="drag(event)" id='+i+"><div>"+a.phenotypes[n].name+'<input style="display: none;" value='+a.phenotypes[n].type+" ></div></li>");t("#legend-phenotype-list").append(s),s.hide();for(var r=0;r<a.dataset.length;r++)a.dataset[r].hasOwnProperty(a.phenotypes[n].type)&&e.addPhenotypesToLegend(a.phenotypes[n].type)}),t.each(a.candidate_genotype,function(n){var i=a.candidate_genotype[n].type+"_legend",s=t('<li draggable="true" ondragstart="drag(event)" id='+i+"><div>"+a.candidate_genotype[n].name+'<input style="display: none;" value='+a.candidate_genotype[n].type+" ></div></li>");t("#legend-candidate-list").append(s),s.hide();for(var r=0;r<a.dataset.length;r++)a.dataset[r].hasOwnProperty(a.candidate_genotype[n].type)&&e.addCandidateToLegend(a.candidate_genotype[n].type)}),t.each(a.causal_genotype,function(n){var i=a.causal_genotype[n].type+"_legend",s=t('<li draggable="true" ondragstart="drag(event)" id='+i+"><div>"+a.causal_genotype[n].name+'<input style="display: none;" value='+a.causal_genotype[n].type+" ></div></li>");t("#legend-causal-list").append(s),s.hide();for(var r=0;r<a.dataset.length;r++)a.dataset[r].hasOwnProperty(a.causal_genotype[n].type)&&e.addCausalsToLegend(a.causal_genotype[n].type)}),t.each(a.carrier_genotype,function(n){var i=a.carrier_genotype[n].type+"_legend",s=t('<li draggable="true" ondragstart="drag(event)" id='+i+"><div>"+a.carrier_genotype[n].name+'<input style="display: none;" value='+a.carrier_genotype[n].type+"></div></li>");t("#legend-carrier-list").append(s),s.hide();for(var r=0;r<a.dataset.length;r++)a.dataset[r].hasOwnProperty(a.carrier_genotype[n].type)&&e.addCarriersToLegend(a.carrier_genotype[n].type)}),t.each(a.conditions,function(t,n){for(var i=0;i<a.dataset.length;i++)a.dataset[i].hasOwnProperty(t)&&e.addConditionLegendToOpts(a,t,n)});let n=a.cancers.concat(a.common_cancers);t.each(n,function(e){var a=n[e].type+"_legend",i=t('<li draggable="true" ondragstart="drag(event)" id='+a+' class="cancer-legend"><div><span class="dot" style="background-color:'+n[e].colour+'"></span>&nbsp;<span class="cancer-name">'+n[e].name+'</span>&nbsp;<span class="case"></span><input style="display: none;" value='+n[e].type+" /></div></li>");t("#legend-cancer-list").append(i),i.hide()}),e.showCancerLegends(a),a.hasOwnProperty("show_cancer_colors")&&!a.show_cancer_colors&&t("#legend-cancer-checkbox").prop("checked",!1),t("#legend-cancer-checkbox").change(function(){e.showHideCancerColors(a)}),a.hasOwnProperty("show_condition_colors")&&!a.show_condition_colors&&t("#legend-condition-checkbox").prop("checked",!1),t("#legend-condition-checkbox").change(function(){e.showHideConditionColors(a)}),t(document).on("click","#settings",function(){e.openEditDialog(a)})},e.addConditionLegendToOpts=function(a,n,i){if(a.hasOwnProperty("condition_legend")){var s=!1;a.condition_legend.forEach(function(e){n!==e.condition_id||(s=!0)}),s||a.condition_legend.push({condition_id:n,color:i.color})}else a.condition_legend=[{condition_id:n,color:i.color}];var r=n+"_legend",o=e.getCaseCount(a,n),d="";d=o>1?"("+o+" cases)":"("+o+" case)",t("#"+r).find(".case").text(""),t("#"+r).find(".case").text(d),t("#"+r).show()},e.addPhenotypesToLegend=function(e){if(opts.hasOwnProperty("phenotype_legend")){for(var a=!1,n=0;n<opts.phenotype_legend.length;n++)if(e===opts.phenotype_legend[n]){a=!0;break}a||opts.phenotype_legend.push(e)}else opts.phenotype_legend=[e];t("#"+(e+"_legend")).show()},e.addCandidateToLegend=function(e){if(opts.hasOwnProperty("candidate_legend")){for(var a=!1,n=0;n<opts.candidate_legend.length;n++)if(e===opts.candidate_legend[n]){a=!0;break}a||opts.candidate_legend.push(e)}else opts.candidate_legend=[e];t("#"+(e+"_legend")).show()},e.addCausalsToLegend=function(e){if(opts.hasOwnProperty("causal_legend")){for(var a=!1,n=0;n<opts.causal_legend.length;n++)if(e===opts.causal_legend[n]){a=!0;break}a||opts.causal_legend.push(e)}else opts.causal_legend=[e];t("#"+(e+"_legend")).show()},e.addCarriersToLegend=function(e){if(opts.hasOwnProperty("carrier_legend")){for(var a=!1,n=0;n<opts.carrier_legend.length;n++)if(e===opts.carrier_legend[n]){a=!0;break}a||opts.carrier_legend.push(e)}else opts.carrier_legend=[e];t("#"+(e+"_legend")).show()},e.addCancersToLegend=function(e){if(opts.hasOwnProperty("cancer_legend")){for(var t=!0,a=0;a<opts.cancer_legend.length;a++)if(e===opts.cancer_legend[a].type){var n=opts.cancer_legend[a].count;opts.cancer_legend[a].count=n+1,t=!1;break}t&&opts.cancer_legend.push({type:e,count:1})}else opts.cancer_legend=[{type:e,count:1}]},e.deleteConditionsFromOpts=function(a,n,i,s,r){if(a.hasOwnProperty(s)){for(var o=!1,d=0;d<a[s].length;d++)if(a[s][d].condition_id===i){o=!0;var l=e.getCaseCount(a,i)-1,c="";c=l>1?"("+l+" cases)":"("+l+" case)",t("#"+i+"_legend").find(".case").text(""),t("#"+i+"_legend").find(".case").text(c);break}if(!o){for(var p=0;p<a[s].length;p++)if(a[s][p].condition_id===i){a[s].slice(p,1);break}t("#"+i+"_legend").hide()}}},e.getCaseCount=function(e,t){let a=0;return e.dataset.forEach(function(e){e.hasOwnProperty(t)&&a++}),a},e.showCancerLegends=function(e){t.each(e.cancer_legend,function(a){var n=e.cancer_legend[a].type+"_legend";if(e.cancer_legend[a].count>0){var i=e.cancer_legend[a].count,s="";s=i>1?"("+i+" cases)":"("+i+" case)",t("#"+n).find(".case").text(""),t("#"+n).find(".case").text(s),t("#"+n).show()}else t("#"+n).hide()})},e.showHideCancerColors=function(e){t("#legend-cancer-checkbox").is(":checked")?e.hasOwnProperty("show_cancer_colors")&&(e.show_cancer_colors=!0):e.show_cancer_colors=!1,e.dataset=ptree.copy_dataset(pedcache.current(e)),ptree.rebuild(e)},e.showHideConditionColors=function(e){t("#legend-condition-checkbox").is(":checked")?e.hasOwnProperty("show_condition_colors")&&(e.show_condition_colors=!0):e.show_condition_colors=!1,e.dataset=ptree.copy_dataset(pedcache.current(e)),ptree.rebuild(e)},e.openEditDialog=function(a){let n=t("#node_properties");n.length>0&&n.remove(),t("#"+a.targetDiv).append('<div id="node_properties"></div>');let i=t("#node_properties"),s=t(window).width()>400?450:t(window).width()-30;i.dialog({autoOpen:!1,appendTo:"#pedigrees",width:s,dialogClass:"node-properties-dialog"});let r=pedcache.get_hierarchy_settings(a,String(1));function o(e){return r.includes(e)||r.includes("all")?"checked":""}var d="<table id='person_details' class='table'><tr><td><div class='form-group' style='text-align: left;'>Select the legends to display under the nodes of this generation line</div><div class='checkbox'><label style='width: 100%; text-align: left;'><input id='s_name' type='checkbox' value='' "+o("name")+">Node ID</label><label style='width: 100%; text-align: left;'><input id='s_full_name' type='checkbox' value='' "+o("full_name")+">Name</label><label style='width: 100%; text-align: left;'><input id='s_id' type='checkbox' value='' "+o("id")+">Identifier</label><label style='width: 100%; text-align: left;'><input id='s_age_dob' type='checkbox' value='' "+o("age_dob")+">Age and date of birth</label><label style='width: 100%; text-align: left;'><input id='s_dod_cod' type='checkbox' value='' "+o("dod_cod")+">Date and cause of death</label><label style='width: 100%; text-align: left;'><input id='s_ethnicity_country' type='checkbox' value='' "+o("ethnicity_country")+">Ethnicity and Country of origin</label><label style='width: 100%; text-align: left;'><input id='s_phenotypes_symptoms' type='checkbox' value='' "+o("phenotypes_symptoms")+">Phenotypes, clinical symptoms</label><label style='width: 100%; text-align: left;'><input id='s_conditions' type='checkbox' value='' "+o("conditions")+">Conditions</label><label style='width: 100%; text-align: left;'><input id='s_genotypes_can_genes' type='checkbox' value='' "+o("genotypes_can_genes")+">Genotype: candidate genes</label><label style='width: 100%; text-align: left;'><input id='s_genotypes_con_genes' type='checkbox' value='' "+o("genotypes_con_genes")+">Genotype: confirmed causal genes</label><label style='width: 100%; text-align: left;'><input id='s_genotypes_car_genes' type='checkbox' value='' "+o("genotypes_car_genes")+">Genotype: carrier genes</label><label style='width: 100%; text-align: left;'><input id='s_risk_factors_cancers' type='checkbox' value='' "+o("risk_factors_cancers")+">Risk factors: cancers</label></div></td></tr></table>";i.html(d),t(".node-properties-dialog").css("float","left"),i.dialog("open");var l=!1;t("#node_properties input[type=radio], #node_properties input[type=checkbox], #node_properties input[type=text], #node_properties input[type=number]").change(function(){var t=-1;d3.selectAll("g").each(function(n){n&&n.depth&&(l=!0,t!==n.depth&&e.save_hierarchy_settings(a,String(n.depth)),t=n.depth)}),l&&ptree.rebuild(a)}),pedigree_form.update(a)},e.save_hierarchy_settings=function(e,a){var n=["name","full_name","id","age_dob","dod_cod","ethnicity_country","phenotypes_symptoms","conditions","genotypes_can_genes","genotypes_con_genes","genotypes_car_genes","risk_factors_cancers"];let i=[];function s(e){e.map(e=>{d3.select("#s_"+e).property("checked",!0)})}n.map(e=>{t("#s_"+e).is(":checked")&&i.push(e)}),t("#"+e.targetDiv).empty(),e.dataset=ptree.copy_dataset(pedcache.current(e)),i.includes("all")?(i=n,s(n)):s(i),pedcache.save_hierarchy_settings(e,a,JSON.stringify(i))}}(window.legend=window.legend||{},jQuery),function(e,t){function a(t,a){let n=e.config.zoom.zoomHandle;return d3.scaleLinear().domain([n.maxTop,n.minTop]).range([t.zoomIn,t.zoomOut])(a)}function n(t,a){let n=e.config.zoom.zoomHandle;return d3.scaleLinear().domain([t.zoomIn,t.zoomOut]).range([n.maxTop,n.minTop])(a)}e.config={zoom:{zoomHandle:{minTop:0,maxTop:92,zoomStep:5,panStep:30,zoom:1,minZoom:.1,maxZoom:2}}},e.updatePedigreeDiagram=function(e,t,a,n){pedcache.setposition(e,t,a,n),d3.select(".diagram").attr("transform","translate("+t+","+a+") scale("+n+")")},e.updateXYTransform=function(e,a,i,s){t(".zoom-handle").css({top:n(e,parseFloat(s))})},e.add=function(i){let s=t(".view-controls");if(s.length>0&&s.remove(),!i.showPanZoomControl&&!e.config.isFullScreenMode)return;t(`#${i.targetDiv}`).append('<div class="view-controls"><div class="view-controls-pan field-no-user-select" title="Pan">\n<span class="view-control-pan pan-up fa fa-fw fa-arrow-up" title="Pan up"></span>\n<span class="view-control-pan pan-right fa fa-fw fa-arrow-right" title="Pan right">\n</span><span class="view-control-pan pan-down fa fa-fw fa-arrow-down" title="Pan down">\n</span><span class="view-control-pan pan-left fa fa-fw fa-arrow-left" title="Pan left">\n</span><span class="view-control-pan pan-home fa fa-fw fa-user" title="Pan home"></span>\n</div><div class="view-controls-zoom field-no-user-select" title="Zoom">\n<div class="field-no-user-select zoom-button zoom-in fa fa-fw fa-search-plus" title="Zoom in">\n</div><div class="field-no-user-select zoom-track" style="height: 100px;">\n<div class="field-no-user-select zoom-handle selected" title="Drag to zoom" style="top: 85px; position: relative;">\n</div></div><div class="field-no-user-select zoom-button zoom-out fa fa-fw fa-search-minus" title="Zoom out"></div>\n<div class="field-no-user-select zoom-crt-value"></div></div></div>');let r=t(".zoom-handle"),o=pedcache.getposition(i),d=(null!==o[0]&&o[0],null!==o[1]&&o[1],1);3===o.length&&(d=o[2]),r.css({top:n(i,d)}),r.draggable({axis:"y",drag:function(t,n){n.position.top=Math.max(e.config.zoom.zoomHandle.minTop,n.position.top),n.position.top=Math.min(e.config.zoom.zoomHandle.maxTop,n.position.top);var s=pedcache.getposition(i),r=s[0],o=s[1];e.svg.call(e.zoom.transform,d3.zoomIdentity.translate(r,o).scale(a(i,n.position.top)))}}),function(n){!function(a){let n=e.config.zoom.zoomHandle;t(".fa-arrow-up").on("click",function(){e.translateY(a,-n.panStep)}),t(".fa-arrow-right").on("click",function(){e.translateX(a,n.panStep)}),t(".fa-arrow-down").on("click",function(){e.translateY(a,n.panStep)}),t(".fa-arrow-left").on("click",function(){e.translateX(a,-n.panStep)}),t(".fa-user").on("click",function(){var t=pedcache.getposition(a);null!==t[0]&&t[0],null!==t[1]&&t[1];let n=1;3===t.length&&(n=t[2]);let i=d3.select(".diagram").node().getBoundingClientRect();e.svg.call(e.zoom.transform,d3.zoomIdentity.translate(window.innerWidth/2-i.width/4,window.innerHeight/2-i.width/4).scale(n))})}(n);let i,s=pedcache.getposition(n),r=(null!==s[0]&&s[0],null!==s[1]&&s[1],t(".zoom-handle")),o=e.config.zoom.zoomHandle;t(".fa-search-plus").on("click",function(){let t=r.css("top");t=t.substring(0,t.length-2),i=Math.max(o.minTop,parseFloat(t,10)-o.zoomStep);var s=pedcache.getposition(n),d=s[0],l=s[1];e.svg.call(e.zoom.transform,d3.zoomIdentity.translate(d,l).scale(a(n,i))),e.updateXYTransform(n,d,l,a(n,i))}),t(".fa-search-minus").on("click",function(){let t=r.css("top");t=t.substring(0,t.length-2),i=Math.min(o.maxTop,parseFloat(t,10)+o.zoomStep);var s=pedcache.getposition(n),d=s[0],l=s[1];e.svg.call(e.zoom.transform,d3.zoomIdentity.translate(d,l).scale(a(n,i))),e.updateXYTransform(n,d,l,a(n,i))})}(i)},e.translateX=function(t,a){var n=pedcache.getposition(t),i=null!==n[0]?n[0]:0,s=null!==n[1]?n[1]:0;let r=1;3===n.length&&(r=n[2]),e.svg.call(e.zoom.transform,d3.zoomIdentity.translate(i,s).scale(r)),e.updatePedigreeDiagram(t,parseFloat(i)+a,s,r)},e.translateY=function(t,a){var n=pedcache.getposition(t),i=null!==n[0]?n[0]:0,s=null!==n[1]?n[1]:0;let r=1;3===n.length&&(r=n[2]),e.svg.call(e.zoom.transform,d3.zoomIdentity.translate(i,s).scale(r)),e.updatePedigreeDiagram(t,parseFloat(i),parseFloat(s)+a,r)}}(window.panZoom=window.panZoom||{},jQuery),function(e,t,a){function n(t,a,n,i,s){if("parent_node"in t?t.parent_node.push(a):t.parent_node=[a],t.mztwin||t.dztwins)for(var r=e.getTwins(s.dataset,t),o=0;o<r.length;o++){var d=e.getNodeByName(i,r[o].name);d&&(d.id=n++)}return n}function i(e,n){return e.sort(function(e,t){return e.mztwin&&t.mztwin&&e.mztwin==t.mztwin?0:e.dztwin&&t.dztwin&&e.dztwin==t.dztwin?0:e.mztwin||t.mztwin||e.dztwin||t.dztwin?1:0}),t.each(e,function(e,t){t.id===a&&(t.id=n++)}),n}e.buildTree=function(s,r,o,d,l){typeof r.children==typeof a&&(r.children=e.getChildren(s.dataset,r)),typeof d==typeof a&&(d=[],l=1);var c=e.flatten(o),p=[];return t.each(r.children,function(n,i){t.each(s.dataset,function(t,n){if((i.name===n.mother||i.name===n.father)&&i.id===a){var r=e.getNodeByName(c,n.mother),o=e.getNodeByName(c,n.father);r=r!==a?r:e.getNodeByName(s.dataset,n.mother),o=o!==a?o:e.getNodeByName(s.dataset,n.father),function(e,t,a){for(var n=0;n<e.length;n++)if(e[n].mother===t&&e[n].father===a)return!0;return!1}(p,r,o)||p.push({mother:r,father:o})}})}),t.merge(d,p),t.each(p,function(t,a){var o=a.mother,d=a.father;o.children=[];var p={name:ptree.makeid(4),hidden:!0,parent:null,father:d,mother:o,children:e.getChildren(s.dataset,o,d)},u=e.getIdxByName(s.dataset,o.name),h=e.getIdxByName(s.dataset,d.name);"id"in d||"id"in o||(l=i(r.children,l));var g=e.get_grandparents_idx(s.dataset,u,h);g.fidx<g.midx?(d.id=l++,p.id=l++,o.id=l++):(o.id=l++,p.id=l++,d.id=l++),l=n(d,p,l=n(o,p,l,c,s),c,s),r.children.push(p)}),l=i(r.children,l),t.each(r.children,function(t,a){l=e.buildTree(s,a,o,d,l)[1]}),[d,l]},e.isProband=function(e){return typeof t(e).attr("proband")!=typeof a&&!1!==t(e).attr("proband")},e.setProband=function(e,a,n){t.each(e,function(e,t){a===t.name?t.proband=n:delete t.proband})},e.getProbandIndex=function(a){var n;return t.each(a,function(t,a){if(e.isProband(a))return n=t}),n},e.getChildren=function(e,a,n){var i=[];return"F"===a.sex&&t.each(e,function(e,t){a.name===t.mother&&(n&&n.name!=t.father||i.push(t))}),i},e.getSiblings=function(e,a,n){return!a.mother||a.noparents?[]:t.map(e,function(e,t){return e.name===a.name||"noparents"in e||!e.mother||e.mother!==a.mother||e.father!==a.father||n&&e.sex!=n?null:e})},e.getAllSiblings=function(e,a,n){return t.map(e,function(e,t){return e.name===a.name||"noparents"in e||!e.mother||e.mother!==a.mother||e.father!==a.father||n&&e.sex!=n?null:e})},e.getTwins=function(a,n){var i=e.getSiblings(a,n),s=n.mztwin?"mztwin":"dztwin";return t.map(i,function(e,t){return e.name!==n.name&&e[s]==n[s]?e:null})},e.getAdoptedSiblings=function(e,a){return t.map(e,function(e,t){return e.name!==a.name&&"noparents"in e&&e.mother===a.mother&&e.father===a.father?e:null})},e.getAllChildren=function(e,a,n){return t.map(e,function(e,t){return"noparents"in e||e.mother!==a.name&&e.father!==a.name||n&&e.sex!==n?null:e})},e.getDepth=function(t,a){for(var n=e.getIdxByName(t,a),i=1;n>=0&&("mother"in t[n]||t[n].top_level);)n=e.getIdxByName(t,t[n].mother),i++;return i},e.getIdxByName=function(e,a){var n=-1;return t.each(e,function(e,t){if(a===t.name)return n=e}),n},e.getNodesAtDepth=function(e,a,n){return t.map(e,function(e,i){return e.depth!=a||e.data.hidden||-1!=t.inArray(e.data.name,n)?null:e}).sort(function(e,t){return e.x-t.x})},e.linkNodes=function(t,a){for(var n=[],i=0;i<a.length;i++)n.push({mother:e.getNodeByName(t,a[i].mother.name),father:e.getNodeByName(t,a[i].father.name)});return n},e.ancestors=function(t,a){var n=[];return function a(i){i.data&&(i=i.data),"mother"in i&&"father"in i&&!("noparents"in i)&&(a(e.getNodeByName(t,i.mother)),a(e.getNodeByName(t,i.father))),n.push(i)}(a),n},e.consanguity=function(a,n,i){var s=e.ancestors(i.dataset,a),r=e.ancestors(i.dataset,n),o=t.map(s,function(e,t){return e.name}),d=t.map(r,function(e,t){return e.name});return o.some(function(e){return-1!==d.indexOf(e)})||e.getChildren(i.dataset,a.data,n.data).some(function(e){return e.consanguineous_parents})},e.flatten=function(e){var t=[];return function e(a){a.children&&a.children.forEach(e),t.push(a)}(e),t},e.adjust_coords=function(n,i,s){function r(o){if(o.children&&(o.children.forEach(r),o.data.father!==a)){var d=e.getNodeByName(s,o.data.father.name),l=e.getNodeByName(s,o.data.mother.name),c=(d.x+l.x)/2;if(e.overlap(n,i.descendants(),c,o.depth,[o.data.name]))(o.x<d.x&&o.x<l.x||o.x>d.x&&o.x>l.x)&&(o.x=c);else{o.x=c;var p=o.x-c;if(2==o.children.length&&(o.children[0].data.hidden||o.children[1].data.hidden)){if(!o.children[0].data.hidden||!o.children[1].data.hidden){var u=o.children[0].data.hidden?o.children[1]:o.children[0],h=o.children[0].data.hidden?o.children[0]:o.children[1];(u.x<h.x&&c<h.x||u.x>h.x&&c>h.x)&&!e.overlap(n,i.descendants(),c,u.depth,[u.data.name])&&(u.x=c)}}else if(1!=o.children.length||o.children[0].data.hidden){if(0!==p&&!function(a,n,i,s){for(var r=n.descendants(),o=t.map(r,function(e,t){return e.data.name}),d=s.descendants(),l=0;l<r.length;l++){var c=r[l];if(n.data.name!==c.data.name){var p=c.x-i;if(e.overlap(a,d,p,c.depth,o))return!0}}return!1}(n,o,p,i))if(1==o.children.length)o.children[0].x=c;else{var g=o.descendants();n.DEBUG&&console.log("ADJUSTING "+o.data.name+" NO. DESCENDANTS "+g.length+" diff="+p);for(var f=0;f<g.length;f++)o.data.name!==g[f].data.name&&(g[f].x-=p)}}else e.overlap(n,i.descendants(),c,o.children[0].depth,[o.children[0].data.name])||(o.children[0].x=c)}}}r(i),r(i)},e.overlap=function(e,a,n,i,s){for(var r=0;r<a.length;r++)if(i==a[r].depth&&-1==t.inArray(a[r].data.name,s)&&Math.abs(n-a[r].x)<1.15*e.symbol_size)return!0;return!1},e.getNodeByName=function(e,t){for(var a=0;a<e.length;a++){if(e[a].data&&t===e[a].data.name)return e[a];if(t===e[a].name)return e[a]}},e.urlParam=function(e){var t=new RegExp("[?&]"+e+"=([^&#]*)").exec(window.location.href);return null===t?null:t[1]||0},e.get_grandparents_idx=function(t,a,n){for(var i=a,s=n;"mother"in t[i]&&"mother"in t[s]&&!("noparents"in t[i])&&!("noparents"in t[s]);)i=e.getIdxByName(t,t[i].mother),s=e.getIdxByName(t,t[s].mother);return{midx:i,fidx:s}},e.proband_attr=function(t,a,n){var i=ptree.copy_dataset(pedcache.current(t)),s=i[e.getProbandIndex(i)];if(s){if(n){if(a in s){if(s[a]===n)return;try{if(JSON.stringify(s[a])===JSON.stringify(n))return}catch(e){}}s[a]=n}else{if(!(a in s))return;delete s[a]}ptree.syncTwins(i,s),t.dataset=i,ptree.rebuild(t)}else console.warn("No proband defined")},e.proband_add_child=function(t,n,i,s,r){var o=ptree.copy_dataset(pedcache.current(t)),d=o[e.getProbandIndex(o)];if(d){var l=ptree.addchild(o,d,n,1)[0];return l.age=i,l.yob=s,r!==a&&(l.breastfeeding=r),t.dataset=o,ptree.rebuild(t),l.name}console.warn("No proband defined")},e.exists=function(t,n){return e.getNodeByName(pedcache.current(t),n)!==a},e.isChildNode=function(e,t){let a=[];return ptree.copy_dataset(pedcache.current(e)).map(e=>{e.father!==t&&e.mother!==t||a.push(e)}),0===a.length},e.print_opts=function(e){var n;t("#pedigree_data").remove(),t("body").append("<div id='pedigree_data'></div>");for(var i=0;i<e.dataset.length;i++){var s="<div class='row'><strong class='col-md-1 text-right'>"+e.dataset[i].name+"</strong><div class='col-md-11'>";for(n in e.dataset[i])"name"!==n&&("parent"===n?s+="<span>"+n+":"+e.dataset[i][n].name+"; </span>":"children"===n?e.dataset[i][n][0]!==a&&(s+="<span>"+n+":"+e.dataset[i][n][0].name+"; </span>"):s+="<span>"+n+":"+e.dataset[i][n]+"; </span>");t("#pedigree_data").append(s+"</div></div>")}for(n in t("#pedigree_data").append("<br /><br />"),e)"dataset"!==n&&t("#pedigree_data").append("<span>"+n+":"+e[n]+"; </span>")}}(window.pedigree_util=window.pedigree_util||{},jQuery),function(e,t,a){function n(e,a){var n=!1;a&&t.each(a,function(t,a){if(0===t.indexOf(e+"_")||t===e)return n=!0});const i=new RegExp("[ ~!@#$%^&*()|+-=?;:'\",.]","gi"),s=a.conditions&&a.conditions.find(t=>t.name.replace(i,"-")+"_condition"===e);return n||s}function i(e,a,n){if(-1!=t.inArray(a.name,e)){s(e,o(n,a));var i=pedigree_util.getAllChildren(n,a);t.each(i,function(a,i){-1==t.inArray(i.name,e)&&(e.push(i.name),s(e,o(n,i)))})}}function s(e,a){for(var n=0;n<a.length;n++)-1==t.inArray(a[n],e)&&e.push(a[n])}function r(e){return{width:pbuttons.is_fullscreen()?window.innerWidth:e.width,height:pbuttons.is_fullscreen()?window.innerHeight:e.height}}function o(e,a){for(var n=[],i=0;i<e.length;i++){var s=e[i];a.name===s.mother&&-1==t.inArray(s.father,n)?n.push(s.father):a.name===s.father&&-1==t.inArray(s.mother,n)&&n.push(s.mother)}return n}function d(e,t,a,n,i,s,r){e.labels.includes("full_name")&&(n=-50),n+=25,t.filter(function(t){return!(t.data.hidden&&!e.DEBUG)}).append("text").attr("class",r+" ped_label"||"ped_label").attr("x",n).attr("y",i).attr("font-family",e.font_family).attr("font-size",e.font_size).attr("font-weight",e.font_weight).text(s)}function l(e,t){for(var n=[1,2,3,4,5,6,7,8,9,"A"],i=0;i<e.length;i++)if(e[i][t]){var s=n.indexOf(e[i][t]);s>-1&&n.splice(s,1)}return n.length>0?n[0]:a}function c(e,t,a){for(var n,i,s=pedigree_util.getNodesAtDepth(pedigree_util.flatten(e),t.depth,a),r=0;r<s.length;r++)s[r].x<t.x&&(n=s[r]),!i&&s[r].x>t.x&&(i=s[r]);return[n,i]}e.roots={},e.build=function(i){var s=t.extend({targetDiv:"pedigree_edit",dataset:[{name:"m21",display_name:"father",sex:"M",top_level:!0},{name:"f21",display_name:"mother",sex:"F",top_level:!0},{name:"ch1",display_name:"me",sex:"F",mother:"f21",father:"m21",proband:!0}],width:600,height:400,symbol_size:35,zoomIn:1,zoomOut:1,diseases:[{type:"breast_cancer",colour:"#F68F35"},{type:"ovarian_cancer",colour:"#4DAA4D"},{type:"pancreatic_cancer",colour:"#4289BA"},{type:"prostate_cancer",colour:"#D5494A"}],labels:["stillbirth","age","yob","alleles"],font_size:".75em",font_family:"Helvetica",font_weight:700,background:"#EEE",node_background:"#fdfdfd",validate:!0,showPanZoomControl:!1,DEBUG:!1},i);0===t("#fullscreen").length&&(pbuttons.add(s),io.add(s)),panZoom.add(s),legend.add(s),-1==pedcache.nstore(s)&&pedcache.add(s),pbuttons.updateButtons(s),e.validate_pedigree(s),s.dataset=function(e){for(var a=0;a<e.length;a++)2==pedigree_util.getDepth(e,e[a].name)&&(e[a].top_level=!0);var n=[],i=[];for(a=0;a<e.length;a++){var s=e[a];if("top_level"in s&&-1==t.inArray(s.name,i)){i.push(s.name),n.push(s);for(var r=o(e,s),d=0;d<r.length;d++)-1==t.inArray(r[d],i)&&(i.push(r[d]),n.push(pedigree_util.getNodeByName(e,r[d])))}}var l=t.map(e,function(e,t){return"top_level"in e&&e.top_level?null:e});for(a=n.length;a>0;--a)l.unshift(n[a-1]);return l}(s.dataset),function(){const e=new RegExp("[ ~!@#$%^&*()|+-=?;:'\",.]","gi");s.diseases.forEach(t=>{t.type=t.type.replace(e,"-")}),Object.keys(s.conditions).forEach(function(t){if(e.test(t)){let a=t.replace(e,"-"),n=s.conditions[t];delete s.conditions[t],s.conditions[a]=n}})}(),s.DEBUG&&pedigree_util.print_opts(s);var l=r(s),c=d3.select("#"+s.targetDiv).append("svg:svg").attr("width",l.width).attr("height",l.height);c.append("rect").attr("width","100%").attr("height","100%").attr("rx",6).attr("ry",6).style("stroke","darkgrey").style("fill",s.background).style("stroke-width",1);var p=pedcache.getposition(s),u=p[0],h=p[1];let g=1;3===p.length&&(g=p[2]),null===u&&(u=s.symbol_size/2,h=2.5*-s.symbol_size);var f=c.append("g").attr("class","diagram").attr("transform","translate("+u+","+h+") scale("+g+")"),m={name:"hidden_root",id:0,hidden:!0,children:t.map(s.dataset,function(e,t){return"top_level"in e&&e.top_level?e:null})},y=pedigree_util.buildTree(s,m,m)[0],_=d3.hierarchy(m);e.roots[s.targetDiv]=_;var v=e.get_tree_dimensions(s);s.DEBUG&&console.log("opts.width="+l.width+" width="+v.width+" opts.height="+l.height+" height="+v.height);var b=d3.tree().separation(function(e,t){return e.parent===t.parent||e.data.hidden||t.data.hidden?1.2:2.2}).size([v.width,v.height])(_.sort(function(e,t){return e.data.id-t.data.id})),x=b.descendants();if(t.map(s.dataset,function(e,t){return e.hidden?null:e}).length!==s.dataset.length)throw create_err("NUMBER OF VISIBLE NODES DIFFERENT TO NUMBER IN THE DATASET");pedigree_util.adjust_coords(s,b,x);var w=pedigree_util.linkNodes(x,y);!function(t,a){for(var n=0;n<a.length;n++){var i=e.check_ptr_link_clashes(t,a[n]);i&&console.log("CLASH :: "+a[n].mother.data.name+" "+a[n].father.data.name,i)}}(s,w);var k=f.selectAll(".node").data(b.descendants()).enter().append("g").attr("transform",function(e,t){return"translate("+e.x+","+e.y+")"});k.append("path").filter(function(e){return!e.data.hidden}).attr("shape-rendering","geometricPrecision").attr("transform",function(e){return"U"==e.data.sex&&4!==e.data.status&&6!==e.data.status?"rotate(45)":""}).attr("d",d3.symbol().size(function(e){return s.symbol_size*s.symbol_size+2}).type(function(e){return 4===e.data.status||6==e.data.status?d3.symbolTriangle:"F"==e.data.sex?d3.symbolCircle:d3.symbolSquare})).style("stroke",function(e){return e.data.age&&e.data.yob&&!e.data.exclude?"#303030":"grey"}).style("stroke-width",function(e){return e.data.age&&e.data.yob&&!e.data.exclude?".3em":".1em"}).style("stroke-dasharray",function(e){return e.data.exclude?"3, 3":null}).style("fill","none"),k.append("clipPath").attr("id",function(e){return e.data.name}).append("path").filter(function(e){return!(e.data.hidden&&!s.DEBUG)}).attr("class","node").attr("transform",function(e){return"U"==e.data.sex&&4!==e.data.status&&6!==e.data.status?"rotate(45)":""}).attr("d",d3.symbol().size(function(e){return e.data.hidden?s.symbol_size*s.symbol_size/5:s.symbol_size*s.symbol_size}).type(function(e){return 4===e.data.status||6==e.data.status?d3.symbolTriangle:"F"==e.data.sex?d3.symbolCircle:d3.symbolSquare}));let z={};k.selectAll("pienode").data(function(e){z[e.depth]=pedcache.get_hierarchy_settings(s,String(e.depth))||[];var a=0,i=t.map(s.diseases,function(t,i){return n(s.diseases[i].type,e.data)?s.diseases[i].type.replace("_"," ").includes("cancer")&&s.hasOwnProperty("show_cancer_colors")&&!s.show_cancer_colors?0:s.diseases[i].type.replace("_"," ").includes("condition")&&s.hasOwnProperty("show_condition_colors")&&!s.show_condition_colors?0:(a++,1):0});return 0===a&&(i=[1]),[t.map(i,function(t,n){return{cancer:t,ncancers:a,id:e.data.name,sex:e.data.sex,proband:e.data.proband,hidden:e.data.hidden,affected:e.data.affected,exclude:e.data.exclude,carrier_status:e.data.carrier_status}})]}).enter().append("g").selectAll("path").data(d3.pie().value(function(e){return e.cancer})).enter().append("path").attr("clip-path",function(e){return"url(#"+e.data.id+")"}).attr("class","pienode").attr("d",d3.arc().innerRadius(0).outerRadius(s.symbol_size)).style("fill",function(e,t){return"affected"===e.data.carrier_status?"#7f7f7f":e.data.exclude?"lightgrey":0===e.data.ncancers?e.data.affected?"darkgrey":s.node_background:s.diseases[t].colour}),k.append("path").filter(function(e){return!e.data.hidden&&(!0===e.data.adopted_in||!0===e.data.adopted_out)}).attr("d",function(e){{function t(e,t,a){return"M"+(e+a)+","+t+"L"+e+" "+t+"L"+e+" "+(t+1.28*s.symbol_size)+"L"+e+" "+(t+1.28*s.symbol_size)+"L"+(e+a)+","+(t+1.28*s.symbol_size)}var a=-.66*s.symbol_size,n=-.64*s.symbol_size,i=s.symbol_size/4;return t(a,n,i)+t(-a,n,-i)}}).style("stroke",function(e){return e.data.age&&e.data.yob&&!e.data.exclude?"#303030":"grey"}).style("stroke-width",function(e){return".1em"}).style("stroke-dasharray",function(e){return e.data.exclude?"3, 3":null}).style("fill","none"),function(e,t){function a(e){let a=0;return 4===e.data.status||6===e.data.status?a=-.36*t.symbol_size:"F"===e.data.sex?a=-.08*t.symbol_size:"U"===e.data.sex&&(a=-.2*t.symbol_size),a}const n=t.symbol_size/2,i=t.symbol_size*(2.5/3);let s=.04*t.symbol_size;e.append("text").filter(function(e){return!e.data.hidden&&e.data.conceived_by_donor_egg}).attr("x",function(){return 1.5*t.symbol_size}).style("text-anchor","middle").attr("y",function(e){return-(n+.5*t.symbol_size+i/2-4)+a(e)-s}).text("D"),e.append("path").filter(function(e){return!e.data.hidden&&e.data.conceived_by_donor_egg}).attr("d",function(e){return`M 0,${-n+a(e)} \n            l ${1.5*t.symbol_size},${-.5*t.symbol_size} \n            ${r=0,o=i/2+s,d=i/2+s,"m "+r+" "+-o+" m -"+d+", 0 a "+d+","+d+" 0 1,0 "+2*d+",0 a "+d+","+d+" 0 1,0 -"+2*d+",0"}`;var r,o,d}).attr("shape-rendering","geometricPrecision").style("stroke","grey").style("stroke-width",function(e){return".05em"}).style("fill","transparent"),e.append("text").filter(function(e){return!e.data.hidden&&e.data.conceived_by_donor_sperm}).attr("x",function(){return-1.5*t.symbol_size}).attr("y",function(e){return-(n+.5*t.symbol_size+i/2-4)+a(e)}).style("text-anchor","middle").text("D"),e.append("path").filter(function(e){return!e.data.hidden&&e.data.conceived_by_donor_sperm}).attr("d",function(e){return`M 0, ${-n+a(e)} l ${-1.5*t.symbol_size},${-.5*t.symbol_size} \n            m ${-i/2}  ${-i} l ${i} ,0 0,${i}   ${-i},0 z\n            `}).style("stroke","grey").style("stroke-width",function(e){return".05em"}).style("fill","transparent")}(k,s);k.append("line").filter(function(e){return 1===e.data.status||5===e.data.status||6===e.data.status}).style("stroke","black").attr("x1",function(e,t){return-.6*s.symbol_size}).attr("y1",function(e,t){return.6*s.symbol_size}).attr("x2",function(e,t){return.6*s.symbol_size}).attr("y2",function(e,t){return-.6*s.symbol_size});d(s,k,".25em",-.4*s.symbol_size,e=>-.12*s.symbol_size,function(e){return e.data.individual_role&&"none"!==e.data.individual_role?e.data.individual_role:""});for(var S=parseInt(function(e){if(e===parseInt(e,10))return e;if(e.indexOf("px")>-1)return e.replace("px","");if(-1===e.indexOf("em"))return e;var a=t('<div style="display: none; font-size: '+e+'; margin: 0; padding:0; height: auto; line-height: 1; border:0;">&nbsp;</div>').appendTo("body"),n=a.height();return a.remove(),n}(s.font_size))+4,N=0;N<s.labels.length;N++){var C=s.labels[N];d(s,k,".25em",-.7*s.symbol_size,function(e){if(z[e.depth].includes(C)&&e.data[C])return e.y_offset=e.y_offset?e.y_offset+S:2.25*S+10,e.y_offset;"name"===C&&(e.y_offset=2.25*S+10)},function(e){if(!z[e.depth].includes(C))return"";if(e.data[C]){if("alleles"===C){for(var t="",a=e.data.alleles.split(";"),n=0;n<a.length;n++)""!==a[n]&&(t+=a[n]+";");return t}return"age"===C?e.data[C]+"y":e.data[C]}},"indi_details")}d(s,k,".25em",-.7*s.symbol_size,function(e){if(!(e.data.status<2)&&e.data.gestation)return e.y_offset=e.y_offset?e.y_offset+S:2.25*S+10,e.y_offset},function(e){return e.data.status>2&&e.data.gestation?"GA: "+e.data.gestation+" weeks":""},"indi_details"),d(s,k,".25em",-.7*s.symbol_size,function(e){if(e.data.uniqueId&&z[e.depth].includes("id"))return e.y_offset=e.y_offset?e.y_offset+S:2.25*S+10,e.y_offset},function(e){return e.data.uniqueId&&z[e.depth].includes("id")?"ID: "+e.data.uniqueId:""},"indi_details"),d(s,k,".25em",-.4*s.symbol_size,e=>{if(z[e.depth].includes("age_dob"))return(e.data.age||e.data.dob)&&(e.y_offset=e.y_offset+S),e.y_offset},function(e){let t="";return z[e.depth].includes("age_dob")&&(e.data.age&&(t+=e.data.age+"y"),e.data.dob&&(t+=" b. "+e.data.dob)),t}),d(s,k,".25em",-.4*s.symbol_size,e=>{if(z[e.depth].includes("dod_cod"))return(e.data.dage||e.data.cause_of_death)&&(e.y_offset=e.y_offset+S),e.y_offset},function(e){let t="";return z[e.depth].includes("dod_cod")&&(e.data.dage&&(t+="d "+e.data.dage+"y"),e.data.cause_of_death&&(t+=" "+e.data.cause_of_death)),t}),d(s,k,".25em",-.4*s.symbol_size,e=>{if(z[e.depth].includes("ethnicity_country"))return(e.data.ethnicity&&e.data.ethnicity.length>0||e.data.country_of_origin&&e.data.country_of_origin.length>0)&&(e.y_offset=e.y_offset+S),e.y_offset},function(e){let t="";return z[e.depth].includes("ethnicity_country")&&(e.data.ethnicity&&e.data.ethnicity.length>0&&(t+=e.data.ethnicity[0].data_value+" "),e.data.country_of_origin&&e.data.country_of_origin.length>0&&(t+=e.data.country_of_origin[0].data_value)),t});const T=new RegExp("[ ~!@#$%^&*()|+-=?;:'\",.]","gi");for(var D=0;D<s.diseases.length;D++){var B=s.diseases[D].type;d(s,k,".25em",-s.symbol_size,function(e){if(z[e.depth].includes("risk_factors_cancers")){for(var t=e.y_offset?e.y_offset+S:2.2*S,a=0;a<s.diseases.length&&B!==s.diseases[a].type;a++)n(s.diseases[a].type,e.data)&&(t+=S-1);return t}},function(e){if(e.data.conditions=e.data.conditions||[],z[e.depth].includes("risk_factors_cancers")){var t="";if(B.replace("_"," ").includes("cancer")){var a=B.replace("_"," ").replace("cancer","ca."),n=B+"_age"in e.data?e.data[B+"_age"]:null;B in e.data&&(t=null===n?a:a+": "+n)}if(B.replace("_"," ").includes("condition")){const n=e.data.conditions.find(e=>e.name.replace(T,"-")+"_condition"===B);if(n)t=a=s.conditions[B].name.toLowerCase(),n.age&&(t=a+": "+n.age)}return t}},"indi_details")}for(var I=0;I<s.phenotypes.length;I++){var O=s.phenotypes[I].type;d(s,k,".25em",-s.symbol_size,function(e){for(var t=e.y_offset?e.y_offset+S:2.2*S,a=0;a<s.diseases.length;a++)n(s.diseases[a].type,e.data)&&(t+=S-1);for(a=0;a<s.phenotypes.length&&O!==s.phenotypes[a].type;a++)n(s.phenotypes[a].type,e.data)&&(t+=S-1);return t},function(e){var t="";O in e.data&&(t=s.phenotypes[I].name.toLowerCase()+" ph.");return t},"indi_details")}for(I=0;I<s.candidate_genotype.length;I++){var A=s.candidate_genotype[I].type;d(s,k,".25em",-s.symbol_size,function(e){for(var t=e.y_offset?e.y_offset+S:2.2*S,a=0;a<s.diseases.length;a++)n(s.diseases[a].type,e.data)&&(t+=S-1);for(a=0;a<s.phenotypes.length;a++)n(s.phenotypes[a].type,e.data)&&(t+=S-1);for(a=0;a<s.candidate_genotype.length&&A!==s.candidate_genotype[a].type;a++)n(s.candidate_genotype[a].type,e.data)&&(t+=S-1);return t},function(e){var t="";A in e.data&&(t=s.candidate_genotype[I].name.toLowerCase()+" ge. candidate genes");return t},"indi_details")}for(I=0;I<s.causal_genotype.length;I++){var F=s.causal_genotype[I].type;d(s,k,".25em",-s.symbol_size,function(e){for(var t=e.y_offset?e.y_offset+S:2.2*S,a=0;a<s.diseases.length;a++)n(s.diseases[a].type,e.data)&&(t+=S-1);for(a=0;a<s.phenotypes.length;a++)n(s.phenotypes[a].type,e.data)&&(t+=S-1);for(a=0;a<s.candidate_genotype.length;a++)n(s.candidate_genotype[a].type,e.data)&&(t+=S-1);for(a=0;a<s.causal_genotype.length&&F!==s.causal_genotype[a].type;a++)n(s.causal_genotype[a].type,e.data)&&(t+=S-1);return t},function(e){var t="";F in e.data&&(t=s.causal_genotype[I].name.toLowerCase()+" ge. causal genes");return t},"indi_details")}for(I=0;I<s.carrier_genotype.length;I++){var $=s.carrier_genotype[I].type;d(s,k,".25em",-s.symbol_size,function(e){for(var t=e.y_offset?e.y_offset+S:2.2*S,a=0;a<s.diseases.length;a++)n(s.diseases[a].type,e.data)&&(t+=S-1);for(a=0;a<s.phenotypes.length;a++)n(s.phenotypes[a].type,e.data)&&(t+=S-1);for(a=0;a<s.candidate_genotype.length;a++)n(s.candidate_genotype[a].type,e.data)&&(t+=S-1);for(a=0;a<s.causal_genotype.length;a++)n(s.causal_genotype[a].type,e.data)&&(t+=S-1);for(a=0;a<s.carrier_genotype.length&&$!==s.carrier_genotype[a].type;a++)n(s.carrier_genotype[a].type,e.data)&&(t+=S-1);return t},function(e){var t="";$ in e.data&&(t=s.carrier_genotype[I].name.toLowerCase()+" carrier genes");return t},"indi_details")}!function(e,t,a,n,i,s,r){t.filter(function(t){return!(t.data.hidden&&!e.DEBUG)}).append("text").attr("class",r+" ped_label"||"ped_label").attr("x",n).attr("y",i).attr("font-family",e.font_family).attr("font-size",e.font_size).attr("font-weight",e.font_weight).text(s)}(s,k,0,.36*s.symbol_size,.76*s.symbol_size,function(e){let t="";return 2===e.data.status?t="A & W":5===e.data.status&&(t="SB"),t},"indi_details"),k.filter(function(e){return!e.data.hidden&&3===e.data.status}).append("text").attr("x",0).attr("y",.3*s.symbol_size).style("font-size",.8*s.symbol_size).attr("text-anchor","middle").text("P"),function(e,t,a,n,i,s,r){t.filter(function(t){return!(t.data.hidden&&!e.DEBUG)}).append("text").attr("class",r+" ped_label"||"ped_label").attr("x",n).attr("y",i).attr("font-family",e.font_family).attr("font-size",e.font_size).attr("font-weight",e.font_weight).text(s),t.filter(function(e){return!e.data.hidden&&e.data.market_by_tick}).append("foreignObject").attr("font-family","FontAwesome").attr("width",50).attr("height",50).attr("x",n-18).attr("y",i-14).html(e=>{switch(e.data.market_by_tick){case"market_na":return"";case"market_p":return"";case"market_m":return"";case"market_s":return"";case"market_st":return'<i class="fas fa-vial"></i>';default:return""}}).append("svg:title").text("incomplete")}(s,k,0,.7*s.symbol_size,-.76*s.symbol_size,function(e){return e.data.market_by_text?e.data.market_by_text.substring(0,Math.min(10,e.data.market_by_text.length)):""},"indi_details"),function(e,t,a,n){let i,s,r,o;i=s=0,r=0,o=8;let d=t.filter(function(t){return!(t.data.hidden&&!e.DEBUG)}).append("g").attr("opacity",function(e){return"Childless"===e.data.heredity||"Infertile"===e.data.heredity?1:0}).attr("class","heredity").attr("transform",function(e){return`translate(${a},${n})`});d.append("line").attr("x1",i).attr("x2",0).attr("y1",0).attr("y2",o),d.append("line").attr("x1",i-4).attr("x2",i+4).attr("y1",o).attr("y2",o),o+=2,d.append("line").attr("opacity",function(e){return"Infertile"===e.data.heredity?1:0}).attr("x1",i-4).attr("x2",i+4).attr("y1",o).attr("y2",o)}(s,k,.04*s.symbol_size,.55*s.symbol_size),function(e,t){e.font_size;t.filter(function(t){return!(t.data.hidden&&!e.DEBUG||"carrier"!==t.data.carrier_status&&"uncertain"!==t.data.carrier_status)}).append("text").attr("font-family","FontAwesome").attr("x",-6).attr("y",4).html(e=>{switch(e.data.carrier_status){case"carrier":return"";case"uncertain":return"";default:return""}}),t.filter(function(t){return!(t.data.hidden&&!e.DEBUG)&&"asymptomatic"===t.data.carrier_status}).append("line").attr("class","asymptomatic").attr("x1",0).attr("x2",0).attr("y1",-e.symbol_size/2).attr("y2",e.symbol_size/2)}(s,k),widgets.addWidgets(s,k);var E={};y=f.selectAll(".partner").data(w).enter().insert("path","g").attr("fill","none").attr("stroke","#000").attr("shape-rendering","auto").attr("d",function(t,a){var n=pedigree_util.getNodeByName(x,t.mother.data.name),i=pedigree_util.getNodeByName(x,t.father.data.name),r=pedigree_util.consanguity(n,i,s)||n.data.consanguity&&"yes"===n.data.consanguity&&"yes"===i.data.consanguity,o=t.mother.data.divorced&&t.mother.data.divorced===t.father.data.name,d=t.mother.x<t.father.x?t.mother.x:t.father.x,l=t.mother.x<t.father.x?t.father.x:t.mother.x,c=t.mother.y,p=e.check_ptr_link_clashes(s,t),u="";if(p){t.mother.depth in E?E[t.mother.depth]+=4:E[t.mother.depth]=4,c-=E[t.mother.depth];for(var h=E[t.mother.depth]+s.symbol_size/2+2,g=t.mother.data.parent_node,f=g[0],m=0;m<g.length;m++)g[m].father.name===t.father.data.name&&g[m].mother.name===t.mother.data.name&&(f=g[m].name);var y=pedigree_util.getNodeByName(x,f);y.y=c,p.sort(function(e,t){return e-t});var _=c-s.symbol_size/2-3;draw_path=function(e,t,a,n,i,s){extend=function(e,t){return e+1<t?extend(++e):e};for(var r="",o=0;o<e.length;o++){var d=extend(o,e.length),l=e[o]-t-s,c=e[d]+t+s;i.x>l&&i.x<c&&(i.y=n),r+="L"+l+","+(a-s)+"L"+l+","+(n-s)+"L"+c+","+(n-s)+"L"+c+","+(a-s),o=d}return r},u=draw_path(p,h,c,_,y,0)}var v="";if(o&&!p&&(v="M"+(d+.66*(l-d)+6)+","+(c-6)+"L"+(d+.66*(l-d)-6)+","+(c+6)+"M"+(d+.66*(l-d)+10)+","+(c-6)+"L"+(d+.66*(l-d)-2)+","+(c+6)),r){return"M"+d+","+c+u+"L"+l+","+c+",M"+d+","+(c-3)+(p?draw_path(p,h,c,_,y,3):"")+"L"+l+","+(c-3)+v}return"M"+d+","+c+u+"L"+l+","+c+v});f.selectAll(".link").data(_.links(b.descendants())).enter().filter(function(e){return s.DEBUG||e.target.data.noparents===a&&null!==e.source.parent&&!e.target.data.hidden}).insert("path","g").attr("fill","none").attr("stroke-width",function(e,t){return e.target.data.noparents!==a||null===e.source.parent||e.target.data.hidden?1:s.DEBUG?2:1}).attr("stroke",function(e,t){return e.target.data.noparents!==a||null===e.source.parent||e.target.data.hidden?"pink":"#000"}).attr("stroke-dasharray",function(e,a){if(!e.target.data.adopted_in)return null;var n=Math.abs(e.source.y-(e.source.y+e.target.y)/2),i=[n,0,Math.abs(e.source.x-e.target.x),0];pedigree_util.getTwins(s.dataset,e.target.data).length>=1&&(n*=3);for(var r=0;r<n;r+=10)t.merge(i,[5,5]);return i}).attr("shape-rendering",function(e,t){return e.target.data.mztwin||e.target.data.dztwin?"geometricPrecision":"auto"}).attr("d",function(e,t){if(e.target.data.mztwin||e.target.data.dztwin){var a=pedigree_util.getTwins(s.dataset,e.target.data);if(a.length>=1){for(var n=0,i=e.target.x,r=e.target.x,o=0;o<a.length;o++){var d=pedigree_util.getNodeByName(x,a[o].name).x;i>d&&(i=d),r<d&&(r=d),n+=d}var l=(e.target.x+n)/(a.length+1),c=(e.source.y+e.target.y)/2,p="";if(i===e.target.x&&e.target.data.mztwin){var u=(l+e.target.x)/2,h=(c+(e.target.y-s.symbol_size/2))/2;p="M"+u+","+h+"L"+(l+(l-u))+" "+h}return"M"+e.source.x+","+e.source.y+"V"+c+"H"+l+"L"+e.target.x+" "+(e.target.y-s.symbol_size/2)+p}}return"M"+e.source.x+","+e.source.y+"V"+(e.source.y+e.target.y)/2+"H"+e.target.x+"V"+e.target.y});let M=_.links(b.descendants()).slice();f.selectAll(".link-circles").data(M).enter().append("circle").attr("opacity",e=>null===e.source.parent?0:1).attr("class","link-circles").attr("r",5).attr("cx",function(e){return e.source.x}).attr("cy",function(e){return e.source.y}).on("click",function(e){let t=d3.event;widgets.openNodeLinkDialog(s,e,t)}).style("fill","#337ab7").style("stroke-width","2").style("stroke","black");var G=pedigree_util.getProbandIndex(s.dataset);if(G){var L=pedigree_util.getNodeByName(x,s.dataset[G].name);f.append("svg:defs").append("svg:marker").attr("id","triangle").attr("refX",6).attr("refY",6).attr("markerWidth",20).attr("markerHeight",20).attr("orient","auto").append("path").attr("d","M 0 0 12 6 0 12 3 6").style("fill","black"),f.append("line").attr("x1",L.x-s.symbol_size).attr("y1",L.y+s.symbol_size).attr("x2",L.x-s.symbol_size/2).attr("y2",L.y+s.symbol_size/2).attr("stroke-width",1).attr("stroke","black").attr("marker-end","url(#triangle)")}let P=d3.zoom().scaleExtent([s.zoomIn,s.zoomOut]).on("zoom",function(e){var t=d3.event.transform;pos=[t.x,t.y],console.log(s.zoomIn,t),f.attr("transform","translate("+pos[0]+","+pos[1]+") scale("+t.k+")"),pedcache.setposition(s,pos[0],pos[1],t.k),panZoom.updateXYTransform(s,pos[0],pos[1],t.k)});return t("svg").on("drop","rect",function(e){var a=t(this).hasClass("indi_rect");if(a){var n=d3.select(e.target).data()[0].data.name;window.drop(e,a,n)}}),t("svg").on("dragover","rect",function(e){window.allowDrop(e)}),window.allowDrop=function(a){a.preventDefault(),window.drop=function(a,n,i){if(a.preventDefault(),n){var r=t("#dragged-legend-name").val().trim();let n=pedcache.current(s),d="string"==typeof i&&i.length>0?i:t("#id_name").val(),l=e.copy_dataset(n);var o=pedigree_util.getNodeByName(l,d);i===o.name&&(o.hasOwnProperty(r)||(o[r]=!0,r.replace("_"," ").includes("cancer")&&(legend.addCancersToLegend(r),legend.showCancerLegends(s)))),e.syncTwins(l,o),s.dataset=l,e.rebuild(s),a.preventDefault()}}},panZoom.zoom=P,panZoom.svg=c,c.call(P).call(P.transform,d3.zoomIdentity.translate(u,h).scale(g)),s},e.validate_pedigree=function(a){if(a.validate){if("function"==typeof a.validate)return a.DEBUG&&console.log("CALLING CONFIGURED VALIDATION FUNCTION"),a.validate.call(this,a);function n(e){return console.error(e),new Error(e)}for(var i=[],s=0;s<a.dataset.length;s++){if(!s.hidden&&(a.dataset[s].mother||a.dataset[s].father)){var r=a.dataset[s].display_name;r||(r="unnamed"),r+=" (IndivID: "+a.dataset[s].name+")";var o=a.dataset[s].mother,d=a.dataset[s].father;if(!o||!d)throw n("Missing parent for "+r);var l=pedigree_util.getIdxByName(a.dataset,o),c=pedigree_util.getIdxByName(a.dataset,d);if(-1===l)throw n("The mother (IndivID: "+o+") of family member "+r+" is missing from the pedigree.");if(-1===c)throw n("The father (IndivID: "+d+") of family member "+r+" is missing from the pedigree.");if("F"!==a.dataset[l].sex)throw n("The mother of family member "+r+" is not specified as female. All mothers in the pedigree must have sex specified as 'F'.");if("M"!==a.dataset[c].sex)throw n("The father of family member "+r+" is not specified as male. All fathers in the pedigree must have sex specified as 'M'.")}if(!a.dataset[s].name)throw n(r+" has no IndivID.");if(t.inArray(a.dataset[s].name,i)>-1)throw n("IndivID for family member "+r+" is not unique.");i.push(a.dataset[s].name)}var p=e.unconnected(a.dataset);p.length>0&&console.warn("individuals unconnected to pedigree ",p)}},e.unconnected=function(e){var a=e[pedigree_util.getProbandIndex(e)];if(!a){if(console.warn("No target defined"),0==e.length)throw"empty pedigree data set";a=e[0]}for(var n=[a.name],s=!0,r=0;s&&r<200;){r++;var d=n.length;t.each(e,function(s,r){if(-1!=t.inArray(r.name,n)){for(var d=o(e,r),l=r.name===a.name||!r.noparents,c=0;c<d.length;c++)pedigree_util.getNodeByName(e,d[c]).noparents||(l=!0);l&&(r.mother&&-1==t.inArray(r.mother,n)&&n.push(r.mother),r.father&&-1==t.inArray(r.father,n)&&n.push(r.father))}else!r.noparents&&(r.mother&&-1!=t.inArray(r.mother,n)||r.father&&-1!=t.inArray(r.father,n))&&n.push(r.name);i(n,r,e)}),s=d!=n.length}var l=t.map(e,function(e,t){return e.name});return t.map(l,function(e,a){return-1==t.inArray(e,n)?e:null})},e.check_ptr_link_clashes=function(a,n){var i,s,r=e.roots[a.targetDiv],o=pedigree_util.flatten(r);if("name"in n){if(!("mother"in(n=pedigree_util.getNodeByName(o,n.name)).data))return null;i=pedigree_util.getNodeByName(o,n.data.mother),s=pedigree_util.getNodeByName(o,n.data.father)}else i=n.mother,s=n.father;var d=i.x<s.x?i.x:s.x,l=i.x<s.x?s.x:i.x,c=i.y,p=t.map(o,function(e,t){return!e.data.hidden&&e.data.name!==i.data.name&&e.data.name!==s.data.name&&e.y==c&&e.x>d&&e.x<l?e.x:null});return p.length>0?p:null},e.get_tree_dimensions=function(e){for(var t=r(e),a=0,n={},i=0;i<e.dataset.length;i++){var s=pedigree_util.getDepth(e.dataset,e.dataset[i].name),o=pedigree_util.getAllChildren(e.dataset,e.dataset[i]),d=1+(o.length>0?.55+.25*o.length:0)+(e.dataset[i].father?.25:0);s in n?n[s]+=d:n[s]=d,n[s]>a&&(a=n[s])}var l=Object.keys(n).length*e.symbol_size*3.5;return{width:t.width-e.symbol_size>a*e.symbol_size*1.65?t.width-e.symbol_size:a*e.symbol_size*1.65,height:t.height-e.symbol_size>l?t.height-e.symbol_size:l}},e.rebuild=function(a){t("#"+a.targetDiv).empty(),pedcache.add(a);try{e.build(a)}catch(e){throw console.error(e),e}try{templates.update(a)}catch(e){}t(document).trigger("ptree.rebuild",[a])},e.copy_dataset=function(e){e[0].id&&e.sort(function(e,t){return e.id&&t.id?e.id>t.id?1:t.id>e.id?-1:0:0});for(var t=["id","parent_node"],a=[],n=0;n<e.length;n++){var i={};for(var s in e[n])-1==t.indexOf(s)&&(i[s]=e[n][s]);a.push(i)}return a},e.addchild=function(n,i,s,r,o,d){if(o&&-1===t.inArray(o,["mztwin","dztwin"]))return new Error("INVALID TWIN TYPE SET: "+o);typeof r==typeof a&&(r=1);var c,p,u=pedigree_util.getAllChildren(n,i);if(0===u.length){var h=e.addsibling(n,i,"F"===i.sex?"M":"F");h.noparents=!0,c=h.name,p=pedigree_util.getIdxByName(n,i.name)+1}else{var g=u[0];c=g.father===i.name?g.mother:g.father,p=pedigree_util.getIdxByName(n,g.name)}if(o)var f=l(n,o);for(var m=[],y=0;y<r;y++){var _={name:e.makeid(4),sex:s,mother:"F"===i.sex?i.name:c,father:"F"===i.sex?c:i.name};d&&(_.status=6),n.splice(p,0,_),o&&(_[o]=f),m.push(_)}return m},e.addsibling=function(a,n,i,s,r,o){if(r&&-1===t.inArray(r,["mztwin","dztwin"]))return new Error("INVALID TWIN TYPE SET: "+r);var d={name:e.makeid(4),sex:i};o&&(d.status=6),n.top_level?d.top_level=!0:(d.mother=n.mother,d.father=n.father);var c=pedigree_util.getIdxByName(a,n.name);return r&&function(e,t,a,n){if(!t[n]&&(t[n]=l(e,n),!t[n]))return!1;a[n]=t[n],t.yob&&(a.yob=t.yob);!t.age||0!=t.status&&t.status||(a.age=t.age)}(a,a[c],d,r),s?c>0&&c--:c++,a.splice(c,0,d),d},e.syncTwins=function(e,t){if(t.mztwin||t.dztwin)for(var a=t.mztwin?"mztwin":"dztwin",n=0;n<e.length;n++){var i=e[n];i[a]&&t[a]==i[a]&&i.name!==t.name&&("mztwin"===a&&(i.sex=t.sex),t.yob&&(i.yob=t.yob),!t.age||0!=t.status&&t.status||(i.age=t.age))}},e.addparents=function(t,a,n){var i,s,r,o,d=e.roots[t.targetDiv],l=pedigree_util.flatten(d),c=pedigree_util.getNodeByName(l,n),p=c.data,u=c.depth,h=-101,g=pedigree_util.getAllChildren(a,p);if(g.length>0&&(r=g[0].mother==p.name?g[0].father:g[0].mother,h=pedigree_util.getNodeByName(l,r).data.id),1==u)for(i={name:e.makeid(4),sex:"F",top_level:!0},s={name:e.makeid(4),sex:"M",top_level:!0},a.splice(0,0,s),a.splice(0,0,i),o=0;o<a.length;o++)a[o].top_level&&a[o].name!==i.name&&a[o].name!==s.name&&(delete a[o].top_level,a[o].noparents=!0,a[o].mother=i.name,a[o].father=s.name);else{var f=pedigree_util.getNodeByName(l,c.data.mother),m=pedigree_util.getNodeByName(l,c.data.father),y=pedigree_util.getAllSiblings(a,p),_=1e4,v=c.data.id;for(o=0;o<y.length;o++){var b=pedigree_util.getNodeByName(l,y[o].name).data.id;b<_&&b>c.data.id&&(_=b),b<v&&(v=b)}var x=v>=c.data.id||h==v&&_<1e4;t.DEBUG&&console.log("lid="+v+" rid="+_+" nid="+c.data.id+" ADD_LHS="+x);var w=a[!x&&m.data.id>f.data.id||x&&m.data.id<f.data.id?pedigree_util.getIdxByName(a,p.father):pedigree_util.getIdxByName(a,p.mother)];i=e.addsibling(a,w,"F",x),s=e.addsibling(a,w,"M",x);var k=pedigree_util.getAdoptedSiblings(a,p),z=c.data.id;for(o=0;o<k.length;o++){var S=pedigree_util.getNodeByName(l,k[o].name).data.id;if(t.DEBUG&&console.log("ORPHAN="+o+" "+k[o].name+" "+(z<S&&S<_)+" nid="+z+" oid="+S+" rid="+_),(x||z<S)&&S<_){var N=pedigree_util.getIdxByName(a,k[o].name);a[N].mother=i.name,a[N].father=s.name}}}2==u?(i.top_level=!0,s.top_level=!0):u>2&&(i.noparents=!0,s.noparents=!0);var C=pedigree_util.getIdxByName(a,p.name);if(a[C].mother=i.name,a[C].father=s.name,delete a[C].noparents,"parent_node"in p){var T=a[pedigree_util.getIdxByName(a,r)];"noparents"in T&&(T.mother=i.name,T.father=s.name)}},e.addpartner=function(t,a,n){var i=e.roots[t.targetDiv],s=pedigree_util.flatten(i),r=pedigree_util.getNodeByName(s,n),o=e.addsibling(a,r.data,"F"===r.data.sex?"M":"F");o.noparents=!0;var d={name:e.makeid(4),sex:"M"};d.mother="F"===r.data.sex?r.data.name:o.name,d.father="F"===r.data.sex?o.name:r.data.name;var l=pedigree_util.getIdxByName(a,r.data.name)+2;a.splice(l,0,d)},e.delete_node_dataset=function(n,i,s,r){var d,l,p=e.roots[s.targetDiv],u=pedigree_util.flatten(p),h=[];if(i.id===a){var g=pedigree_util.getNodeByName(u,i.name);g!==a&&(i=g.data)}if(i.parent_node)for(d=0;d<i.parent_node.length;d++){var f=i.parent_node[d],m=[pedigree_util.getNodeByName(n,f.mother.name),pedigree_util.getNodeByName(n,f.father.name)];for(l=0;l<m.length;l++)(m[l].name===i.name||m[l].noparents!==a||m[l].top_level)&&(n.splice(pedigree_util.getIdxByName(n,m[l].name),1),h.push(m[l]));var y=f.children,_=t.map(y,function(e,t){return e.name});for(l=0;l<y.length;l++){var v=pedigree_util.getNodeByName(n,y[l].name);if(v){v.noparents=!0;var b,x=o(n,v);if(x.length>0&&(b=pedigree_util.getNodeByName(n,x[0])),b&&b.mother!==v.mother)v.mother=b.mother,v.father=b.father;else if(b){var w=c(p,pedigree_util.getNodeByName(u,v.name),_);v.mother=w[0]?w[0].data.mother:w[1]?w[1].data.mother:null,v.father=w[0]?w[0].data.father:w[1]?w[1].data.father:null}else n.splice(pedigree_util.getIdxByName(n,v.name),1)}}}else n.splice(pedigree_util.getIdxByName(n,i.name),1);for(console.log(h),d=0;d<h.length;d++){var k=h[d],z=pedigree_util.getAllSiblings(n,k);if(console.log("DEL",k.name,z),z.length<1){console.log("del sibs",k.name,z);var S=pedigree_util.getNodeByName(u,k.name).ancestors();for(l=0;l<S.length;l++)console.log(S[d]),S[l].data.mother&&(console.log("DELETE ",S[l].data.mother,S[l].data.father),n.splice(pedigree_util.getIdxByName(n,S[l].data.mother.name),1),n.splice(pedigree_util.getIdxByName(n,S[l].data.father.name),1))}}!function(e){for(var t=["mztwin","dztwin"],a=0;a<e.length;a++)for(var n=0;n<t.length;n++){var i=t[n];if(e[a][i]){var s=0;for(n=0;n<e.length;n++)e[n][i]==e[a][i]&&s++;s<2&&delete e[a][[i]]}}}(n);try{var N=t.extend({},s);N.dataset=e.copy_dataset(n),e.validate_pedigree(N);var C=e.unconnected(n)}catch(e){throw utils.messages("Warning","Deletion of this pedigree member is disallowed."),e}return C.length>0&&0===e.unconnected(s.dataset).length?(console.error("individuals unconnected to pedigree ",C),void utils.messages("Warning","Deleting this will split the pedigree. Continue?",r,s,n)):(r&&r(s,n),n)},e.makeid=function(e){for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n=0;n<e;n++)t+=a.charAt(Math.floor(Math.random()*a.length));return t}}(window.ptree=window.ptree||{},jQuery),function(e,t,a){function n(e){t("#cancer .row").show(),"M"===e.sex?(delete e.ovarian_cancer_diagnosis_age,t("[id^='id_ovarian_cancer_diagnosis_age']").closest(".row").hide()):"F"===e.sex&&(delete e.prostate_cancer_diagnosis_age,t("[id^='id_prostate_cancer_diagnosis_age']").closest(".row").hide())}function i(e){var t=10*Math.round((e-1)/10);return e<t?t-5:t+5}e.update=function(a){t(".node_save").click(function(){e.save(a)}),t("#id_proband, #id_exclude").click(function(e){var n=pedcache.current(a);a.dataset=ptree.copy_dataset(n);var i=t("#id_name").val();if("id_proband"===t(this).attr("id"))pedigree_util.setProband(a.dataset,i,t(this).is(":checked"));else{var s=pedigree_util.getIdxByName(a.dataset,i);t(this).is(":checked")?a.dataset[s].exclude=!0:delete a.dataset[s].exclude}pedcache.add(a),t("#"+a.targetDiv).empty(),ptree.build(a)}),t("input[id$='_mut_sensitivity'], input[id$='_mut_frequency']").prop("disabled",!0),t("#id_use_custom_mutation_sensitivities").change(function(){t("input[id$='_mut_sensitivity']").prop("disabled",!t(this).is(":checked"))}),t("#id_mutation_frequencies").change(function(){if(t("input[id$='_mut_frequency']").prop("disabled","Custom"!==this.value),e.mutation_frequencies&&"Custom"!==this.value){var a=e.mutation_frequencies[this.value];for(var n in a)t("#id_"+n.toLowerCase()+"_mut_frequency").val(a[n])}})},t(document).on("fhChange",function(e,a){try{var n=t("#id_name").val();void 0===pedigree_util.getNodeByName(pedcache.current(a),n)?t("form > fieldset").prop("disabled",!0):t("form > fieldset").prop("disabled",!1)}catch(e){console.warn(e)}}),e.nodeclick=function(a){for(var s in t("form > fieldset").prop("disabled",!1),t("#person_details").find("input[type=text], input[type=number]").val(""),t("#person_details select").val("").prop("selected",!0),"M"===a.sex||"F"===a.sex?t('input[name=sex][value="'+a.sex+'"]').prop("checked",!0):t("input[name=sex]").prop("checked",!1),n(a),"status"in a||(a.status=0),t('input[name=status][value="'+a.status+'"]').prop("checked",!0),"proband"in a?t("#id_proband").prop("checked",a.proband):t("#id_proband").prop("checked",!1),"exclude"in a?t("#id_exclude").prop("checked",a.exclude):t("#id_exclude").prop("checked",!1),"yob"in a?t("#id_yob_0").val(a.yob):t("#id_yob_0").val("-"),t('select[name$="_bc_pathology"]').val("-"),t('select[name*="_gene_test"]').val("-"),t("input[id^='id_sex_']").prop("disabled",!(!a.parent_node||"U"===a.sex)),t("select[id$='_bc_pathology']").prop("disabled","M"===a.sex),t("#id_approx").prop("checked",!!a.approx_diagnosis_age),e.update_diagnosis_age_widget(),a)"proband"!==s&&"sex"!==s&&(t("#id_"+s).length?-1!==s.indexOf("_gene_test")&&null!==a[s]&&"object"==typeof a[s]?(t("#id_"+s).val(a[s].type),t("#id_"+s+"_result").val(a[s].result)):t("#id_"+s).val(a[s]):-1!==s.indexOf("_diagnosis_age")&&(t("#id_approx").is(":checked")?t("#id_"+s+"_1").val(i(a[s])).prop("selected",!0):t("#id_"+s+"_0").val(a[s])));try{t("#person_details").find("form").valid()}catch(e){console.warn("valid() not found")}},e.saveTabbedForm=function(e,a,n){let i=pedcache.current(e),s="string"==typeof a&&a.length>0?a:t("#id_name").val(),r=ptree.copy_dataset(i);var o=pedigree_util.getNodeByName(r,s);if(!o)return void console.warn("TABBED DIALOG: ","person not found when saving details");t("#"+e.targetDiv).empty();let d=t("#id__name").val();if(o.full_name=d&&d.length>0?d.substring(0,Math.min(15,d.length)):"",o.uniqueId=t("#id_uniqueId").val(),o.age=t("#id__age").val(),o.dob=t("#dob").val(),o.dage=t("#id__dage").val(),o.cause_of_death=t("#cause_of_death").val(),o.country_of_origin=t("#country_of_origin").val(),o.individual_role=t("input[name='individual_role']:checked").val(),o.conceived_by_donor_egg=t("#id_conceived_by_donor_egg").is(":checked"),o.conceived_by_donor_sperm=t("#id_conceived_by_donor_sperm").is(":checked"),n){if(n.ethnicity){let e=n.ethnicity;if("save"===e.action?o.ethnicity&&!o.ethnicity.includes(e.data)?(o.ethnicity=o.ethnicity.filter(t=>t.id!==e.data.id),o.ethnicity.push(e.data)):o.ethnicity=[e.data]:"delete"===e.action&&o.ethnicity&&o.ethnicity.length>0&&(o.ethnicity=o.ethnicity.filter(t=>t.id!==e.data.id)),o.ethnicity&&o.ethnicity.length>0){let a=o.ethnicity.map(e=>e.id).join();t("#"+e.id).trigger("set",{id:a})}}if(n.countryOfOrigin){let e=n.countryOfOrigin;if("save"===e.action?o.country_of_origin&&o.country_of_origin.length>0?(o.country_of_origin=o.country_of_origin.filter(t=>t.id!==e.data.id),o.country_of_origin.push(e.data)):o.country_of_origin=[e.data]:"delete"===e.action&&o.country_of_origin&&o.country_of_origin.length>0&&(o.country_of_origin=o.country_of_origin.filter(t=>t.id!==e.data.id)),o.country_of_origin&&o.country_of_origin.length>0){let a=o.country_of_origin.map(e=>e.id).join();t("#"+e.id).trigger("set",{id:a})}}}let l=t("#gestation").val();l&&o.status&&o.status>2&&(o.gestation=l);o.conditions=o.conditions||[],o.conditions=[];const c=new RegExp("[ ~!@#$%^&*()|+-=?;:'\",.]","gi");if(d3.selectAll(".diagnosisTypes").each(function(){let a=d3.select(this).select("label").select("input").attr("id").split("_")[0]+"_condition";if(t("#"+a+"_check").is(":checked")){var n=t("#"+a+"_ageOnset").val(),i=t("input[name='"+a+"_status']:checked").val(),s=t("#"+a+"_diagnosed").val(),r=t("#"+a+"_diagnosisType").val(),d=t("#"+a+"_notes").val();let l={name:e.conditions[a].name};n&&n.length>0&&(l.age=n),i&&i.length>0&&(l.status=i),s&&s.length>0&&(l.diagnosed=s),r&&r.length>0&&(l.type=r),d&&d.length>0&&(l.notes=d),o.conditions.push(l),legend.addConditionLegendToOpts(e,a,e.conditions[a])}}),n&&n.conditionToDelete){const a=n.conditionToDelete;o.conditions=o.conditions.filter(e=>e.name.replace(c,"-")+"_condition"!==a),legend.deleteConditionsFromOpts(e,o,a,"condition_legend","legend-condition-list"),t("#"+a+"_check").prop("checked",!1)}e.selected_phenotypes[o.name]&&t.each(e.selected_phenotypes[o.name],function(t){o[e.selected_phenotypes[o.name][t]]=!0}),e.selected_candidate_genotype[o.name]&&t.each(e.selected_candidate_genotype[o.name],function(t){o[e.selected_candidate_genotype[o.name][t]]=!0}),e.selected_causal_genotype[o.name]&&t.each(e.selected_causal_genotype[o.name],function(t){o[e.selected_causal_genotype[o.name][t]]=!0}),e.selected_carrier_genotype[o.name]&&t.each(e.selected_carrier_genotype[o.name],function(t){o[e.selected_carrier_genotype[o.name][t]]=!0}),t("#commentClinical")&&(o.clinical_comments=t("#commentClinical").val());let p=t("input[name='status']:checked").val();p&&(o.status=parseInt(p));let u=t("#gestation_container");o.status>2?u.show():u.hide();let h=t("input[name='sex']:checked").val();h&&(o.sex=h);let g=t("#heredity").val();g&&(o.heredity=g),o.market_by_text=t("#reason").val();let f=["market_na","market_p","market_m","market_s","market_st"],m=o.market_by_tick;delete o.market_by_tick,t(f).each(function(e,a){t("#"+a).is(":checked")&&m!==a&&(o.market_by_tick=a)}),o.market_by_tick||(o.market_by_tick=m);for(let e=0;e<f.length;e++)f[e]!==o.market_by_tick&&(t("#"+f[e])[0].checked=!1);for(var y=["adopted_in","adopted_out","conceived_by_donor_egg_or_sperm","conceived_by_icf","ivf_icsi","termination","consanguineous_parents","proband"],_=0;_<y.length;_++){var v=y[_],b=t("#id_"+v);b.length>0&&(b.is(":checked")?o[v]=!0:delete o[v])}let x=t("input[name='carrier_status']:checked").val();x&&(o.carrier_status=x),ptree.syncTwins(r,o),e.dataset=r,ptree.rebuild(e)},e.save=function(e,a){var s=pedcache.current(e),r="string"==typeof a&&a.length>0?a:t("#id_name").val(),o=ptree.copy_dataset(s),d=pedigree_util.getNodeByName(o,r);if(d){t("#"+e.targetDiv).empty();var l=t("#id_yob_0").val();l&&""!==l?d.yob=l:delete d.yob;var c=t("#id_status").find("input[type='radio']:checked");c.length>0&&(d.status=c.val());for(var p=["adopted_in","adopted_out","consanguineous_parents"],u=0;u<p.length;u++){var h=p[u],g=t("#id_"+h);g.length>0&&(g.is(":checked")?d[h]=!0:delete d[h])}var f=t("#id_sex").find("input[type='radio']:checked");f.length>0&&(d.sex=f.val(),n(d)),t("#id_approx").is(":checked")?d.approx_diagnosis_age=!0:delete d.approx_diagnosis_age,t("#person_details select[name*='_diagnosis_age']:visible, #person_details input[type=text]:visible, #person_details input[type=number]:visible, #person_details input[type=checkbox][id$=_diagnosis_age_0]:visible").each(function(){var e=this.name.indexOf("_diagnosis_age")>-1?this.name.substring(0,this.name.length-2):this.name;if("checkbox"===t(this).attr("type"))t(this).is(":checked")?d[e]=-1:delete d[e];else if(t(this).val()){var a=t(this).val();e.indexOf("_diagnosis_age")>-1&&t("#id_approx").is(":checked")&&(a=i(a)),d[e]=a}else delete d[e]}),t('#person_details input[type="checkbox"][name$="cancer"],input[type="checkbox"][name$="cancer2"]').each(function(){this.checked?d[t(this).attr("name")]=!0:delete d[t(this).attr("name")]}),t('#person_details select[name$="_bc_pathology"]').each(function(){"-"!==t(this).val()?d[t(this).attr("name")]=t(this).val():delete d[t(this).attr("name")]}),t('#person_details select[name$="_gene_test"]').each(function(){if("-"!==t(this).val()){var e=t('select[name="'+t(this).attr("name")+'_result"]');d[t(this).attr("name")]={type:t(this).val(),result:t(e).val()}}else delete d[t(this).attr("name")]});try{t("#person_details").find("form").valid()}catch(e){console.warn("valid() not found")}ptree.syncTwins(o,d),e.dataset=o,ptree.rebuild(e)}else console.warn("person not found when saving details")},e.update_diagnosis_age_widget=function(){t("#id_approx").is(":checked")?(t("[id$='_diagnosis_age_0']").each(function(e){if(""!==t(this).val()){var a=this.name.substring(0,this.name.length-2);t("#id_"+a+"_1").val(i(t(this).val())).prop("selected",!0)}}),t("[id$='_diagnosis_age_0']").hide(),t("[id$='_diagnosis_age_1']").show()):(t("[id$='_diagnosis_age_1']").each(function(e){if(""!==t(this).val()){var a=this.name.substring(0,this.name.length-2);t("#id_"+a+"_0").val(t(this).val())}}),t("[id$='_diagnosis_age_0']").show(),t("[id$='_diagnosis_age_1']").hide())},e.save_common_cancers=function(e,a,n,i,s){let r=pedcache.current(n),o="string"==typeof i&&i.length>0?i:t("#id_name").val(),d=ptree.copy_dataset(r);var l=pedigree_util.getNodeByName(d,o);(e&&(l[e]=!0,s||legend.addCancersToLegend(e)),a)&&(l[e+"_age"]=a);ptree.syncTwins(d,l),n.dataset=d,ptree.rebuild(n)},e.remove_cancers=function(e,a,n,i,s){let r=pedcache.current(n),o="string"==typeof i&&i.length>0?i:t("#id_name").val(),d=ptree.copy_dataset(r);var l=pedigree_util.getNodeByName(d,o);!s&&e&&e in l&&delete l[e];var c=e+"_age";c in l&&delete l[c],ptree.syncTwins(d,l),n.dataset=d,ptree.rebuild(n)},e.remove_phenotypes=function(e,a,n){let i=pedcache.current(e),s="string"==typeof a&&a.length>0?a:t("#id_name").val(),r=ptree.copy_dataset(i);var o=pedigree_util.getNodeByName(r,s);n in o&&delete o[n],e.selected_phenotypes[o.name]&&t.each(e.selected_phenotypes[o.name],function(t){e.selected_phenotypes[o.name].splice(t,1)}),ptree.syncTwins(r,o),e.dataset=r,ptree.rebuild(e)},e.remove_candidate=function(e,a,n){let i=pedcache.current(e),s="string"==typeof a&&a.length>0?a:t("#id_name").val(),r=ptree.copy_dataset(i);var o=pedigree_util.getNodeByName(r,s);n in o&&delete o[n],e.selected_candidate_genotype[o.name]&&t.each(e.selected_candidate_genotype[o.name],function(t){e.selected_candidate_genotype[o.name].splice(t,1)}),ptree.syncTwins(r,o),e.dataset=r,ptree.rebuild(e)},e.remove_causal=function(e,a,n){let i=pedcache.current(e),s="string"==typeof a&&a.length>0?a:t("#id_name").val(),r=ptree.copy_dataset(i);var o=pedigree_util.getNodeByName(r,s);n in o&&delete o[n],e.selected_causal_genotype[o.name]&&t.each(e.selected_causal_genotype[o.name],function(t){e.selected_causal_genotype[o.name].splice(t,1)}),ptree.syncTwins(r,o),e.dataset=r,ptree.rebuild(e)},e.remove_carrier=function(e,a,n){let i=pedcache.current(e),s="string"==typeof a&&a.length>0?a:t("#id_name").val(),r=ptree.copy_dataset(i);var o=pedigree_util.getNodeByName(r,s);n in o&&delete o[n],e.selected_carrier_genotype[o.name]&&t.each(e.selected_carrier_genotype[o.name],function(t){e.selected_carrier_genotype[o.name].splice(t,1)}),ptree.syncTwins(r,o),e.dataset=r,ptree.rebuild(e)}}(window.pedigree_form=window.pedigree_form||{},jQuery),function(e,t,a){e.add=function(n){var i=t.extend({btn_target:"pedigree_history"},n);t("#"+n.btn_target).empty();var s=[{fa:"fa-undo",title:"undo"},{fa:"fa-repeat",title:"redo"},{fa:"fa-refresh",title:"reset"}];let r=t("#"+i.btn_target);var o='<div style="margin-bottom: 5px">';o+='<li class="inline-block">\n        <label class="btn btn-default btn-file">\n\t\t\t\t\t\t<input id="load" type="file" style="display: none;">Load\n\t\t\t\t</label>\t\n\t\t\t\t</li>\n\t\t\t\t<li class="inline-block">\t\n\t\t\t\t<label class="btn btn-default btn-file">\n\t\t\t\t\t\t<input id="save" type="button" style="display: none;">Save\n\t\t\t\t</label>\t\t\n                </li>\n                <li class="inline-block">\n                <label class="btn btn-default btn-file">\n                                        <input id="print" type="button" style="display: none;">Print\n                                </label>\n                </li>\n                <li class="inline-block">\n                <label class="btn btn-default btn-file">\n                                        <input id="svg_download" type="button" style="display: none;">SVG\n                                </label>\n                </li>\n                <li class="inline-block">\n                <label class="btn btn-default btn-file">\n                                        <input id="png_download" type="button" style="display: none;">PNG\n                                </label>\n                </li>\n               </div\n        ';for(var d=0;d<s.length;d++)o+='<li">',o+='&nbsp;<i class="fa fa-lg '+s[d].fa+'" '+("fa-arrows-alt"==s[d].fa?'id="fullscreen" ':"")+' aria-hidden="true" title="'+s[d].title+'"></i>',o+="</li>";r.append(o),function(n){t(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",function(e){var t=pedcache.current(n);t!==a&&null!==t&&(n.dataset=t),ptree.rebuild(n),panZoom.config.isFullScreenMode=!panZoom.config.isFullScreenMode,panZoom.add(n),panZoom.config.isFullScreenMode&&legend.add(n),widgets.removeDialogs()}),t("#fullscreen").on("click",function(e){if(document.mozFullScreen||document.webkitFullScreen)document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen();else{var a=t("#"+n.targetDiv)[0];a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}}),t("#"+n.btn_target).on("click",function(a){if(a.stopPropagation(),t(a.target).hasClass("disabled"))return!1;t(a.target).hasClass("fa-undo")?(n.dataset=pedcache.previous(n),t("#"+n.targetDiv).empty(),ptree.build(n)):t(a.target).hasClass("fa-repeat")?(n.dataset=pedcache.next(n),t("#"+n.targetDiv).empty(),ptree.build(n)):t(a.target).hasClass("fa-refresh")&&e.reset(n),t(document).trigger("fhChange",[n])})}(i)},e.is_fullscreen=function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement},e.reset=function(e){pedcache.clear(e),delete e.dataset;var a=t("input[name='default_fam']:checked");a.length>0&&"extended2"==a.val()?e.dataset=[{name:"wZA",sex:"M",top_level:!0,status:"0",display_name:"paternal grandfather"},{name:"MAk",sex:"F",top_level:!0,status:"0",display_name:"paternal grandmother"},{name:"zwB",sex:"M",top_level:!0,status:"0",display_name:"maternal grandfather"},{name:"dOH",sex:"F",top_level:!0,status:"0",display_name:"maternal grandmother"},{name:"MKg",sex:"F",mother:"MAk",father:"wZA",status:"0",display_name:"paternal aunt"},{name:"xsm",sex:"M",mother:"MAk",father:"wZA",status:"0",display_name:"paternal uncle"},{name:"m21",sex:"M",mother:"MAk",father:"wZA",status:"0",display_name:"father"},{name:"f21",sex:"F",mother:"dOH",father:"zwB",status:"0",display_name:"mother"},{name:"aOH",sex:"F",mother:"f21",father:"m21",status:"0",display_name:"sister"},{name:"Vha",sex:"M",mother:"f21",father:"m21",status:"0",display_name:"brother"},{name:"Spj",sex:"M",mother:"f21",father:"m21",noparents:!0,status:"0",display_name:"partner"},{name:"ch1",sex:"F",mother:"f21",father:"m21",proband:!0,status:"0",display_name:"me"},{name:"zhk",sex:"F",mother:"ch1",father:"Spj",status:"0",display_name:"daughter"},{name:"Knx",display_name:"son",sex:"M",mother:"ch1",father:"Spj",status:"0"},{name:"uuc",display_name:"maternal aunt",sex:"F",mother:"dOH",father:"zwB",status:"0"},{name:"xIw",display_name:"maternal uncle",sex:"M",mother:"dOH",father:"zwB",status:"0"}]:a.length>0&&"extended1"==a.val()?e.dataset=[{name:"m21",sex:"M",mother:null,father:null,status:"0",display_name:"father",noparents:!0},{name:"f21",sex:"F",mother:null,father:null,status:"0",display_name:"mother",noparents:!0},{name:"aOH",sex:"F",mother:"f21",father:"m21",status:"0",display_name:"sister"},{name:"Vha",sex:"M",mother:"f21",father:"m21",status:"0",display_name:"brother"},{name:"Spj",sex:"M",mother:"f21",father:"m21",noparents:!0,status:"0",display_name:"partner"},{name:"ch1",sex:"F",mother:"f21",father:"m21",proband:!0,status:"0",display_name:"me"},{name:"zhk",sex:"F",mother:"ch1",father:"Spj",status:"0",display_name:"daughter"},{name:"Knx",display_name:"son",sex:"M",mother:"ch1",father:"Spj",status:"0"}]:e.dataset=[{name:"m21",display_name:"father",sex:"M",top_level:!0},{name:"f21",display_name:"mother",sex:"F",top_level:!0},{name:"ch1",display_name:"me",sex:"F",mother:"f21",father:"m21",proband:!0}],ptree.rebuild(e)},e.updateButtons=function(e){var a=pedcache.get_count(e),n=pedcache.nstore(e),i="#"+e.btn_target;n<=a?t(i+" .fa-repeat").addClass("disabled"):t(i+" .fa-repeat").removeClass("disabled"),a>1?t(i+" .fa-undo").removeClass("disabled"):t(i+" .fa-undo").addClass("disabled")}}(window.pbuttons=window.pbuttons||{},jQuery),function(e,t,a){var n=25,i={};function s(e){try{if("array"===e.store_type)return!1;if("local"!==e.store_type&&"session"!==e.store_type&&e.store_type!==a)return!1;return localStorage.setItem("test","test"),localStorage.removeItem("test"),!0}catch(e){return!1}}function r(e){return"PEDIGREE_"+e.btn_target+"_"}function o(e){return i[r(e)]}function d(e,t){return"local"===e.store_type?localStorage.getItem(t):sessionStorage.getItem(t)}function l(e,t,a){return"local"===e.store_type?localStorage.setItem(t,a):sessionStorage.setItem(t,a)}function c(e,t){s(e)?l(e,r(e)+"COUNT",t):i[r(e)+"COUNT"]=t}e.save_hierarchy_settings=function(e,t,a){l(e,r(e)+"hierarchy_"+t,a)},e.get_hierarchy_settings=function(e,t){let a=d(e,r(e)+"hierarchy_"+t);return null===a?["name","full_name","id","age_dob","dod_cod","ethnicity_country","phenotypes_symptoms","conditions","genotypes_can_genes","genotypes_con_genes","genotypes_car_genes","risk_factors_cancers"]:JSON.parse(a)},e.get_count=function(e){var t;return null!==(t=s(e)?d(e,r(e)+"COUNT"):i[r(e)+"COUNT"])&&t!==a?t:0},e.add=function(t){if(t.dataset){var d=e.get_count(t);s(t)?l(t,r(t)+d,JSON.stringify(t.dataset)):(console.warn("Local storage not found/supported for this browser!",t.store_type),n=500,o(t)===a&&(i[r(t)]=[]),o(t).push(JSON.stringify(t.dataset))),d<n?d++:d=0,c(t,d)}},e.nstore=function(e){if(!s(e))return o(e)&&o(e).length>0?o(e).length:-1;for(var t=n;t>0;t--)if(null!==d(e,r(e)+(t-1)))return t;return-1},e.current=function(t){var a=e.get_count(t)-1;return-1==a&&(a=n-1),s(t)?JSON.parse(d(t,r(t)+a)):o(t)?JSON.parse(o(t)[a]):void 0},e.last=function(e){if(s(e))for(var t=n;t>0;t--){var i=d(e,r(e)+(t-1));if(null!==i)return c(e,t),JSON.parse(i)}else{var l=o(e);if(l)return JSON.parse(l(l.length-1))}return a},e.previous=function(t,i){if(i===a&&(i=e.get_count(t)-2),i<0){var l=e.nstore(t);i=l<n?l-1:n-1}return c(t,i+1),s(t)?JSON.parse(d(t,r(t)+i)):JSON.parse(o(t)[i])},e.next=function(t,i){return i===a&&(i=e.get_count(t)),i>=n&&(i=0),c(t,parseInt(i)+1),s(t)?JSON.parse(d(t,r(t)+i)):JSON.parse(o(t)[i])},e.clear=function(e){s(e)&&function(e){"local"===e.store_type?localStorage.clear():sessionStorage.clear()}(e),i={}},e.setposition=function(e,t,a,n){s(e)&&(l(e,r(e)+"_X",t),l(e,r(e)+"_Y",a),n&&l(e,r(e)+"_ZOOM",n))},e.getposition=function(e){if(!s(e)||null===localStorage.getItem(r(e)+"_X")&&null===sessionStorage.getItem(r(e)+"_X"))return[null,null];var t=[parseInt(d(e,r(e)+"_X")),parseInt(d(e,r(e)+"_Y"))];return null!==d(e,r(e)+"_ZOOM")&&t.push(parseFloat(d(e,r(e)+"_ZOOM"))),t}}(window.pedcache=window.pedcache||{},jQuery),function(e,t,a){var n,i;function s(e,t,a,n,i){i&&d3.selectAll(".line_drag_selection").attr("transform","translate("+i+")"),d3.selectAll(".line_drag_selection").attr("x1",e).attr("y1",t).attr("x2",a).attr("y2",n)}function r(e,t){let a=null;return Object.keys(t).forEach(function(n){t[n].name===e&&(a=n)}),a}function o(e,t){for(var a=0;a<t.length;a++)if(t[a].name===e)return t[a].type;return null}e.addWidgets=function(e,d){var l=parseInt(t("body").css("font-size")),c=d3.select(".diagram");c.append("rect").attr("class","popup_selection").attr("rx",6).attr("ry",6).attr("transform","translate(-1000,-100)").style("opacity",0).attr("width",186).attr("height",36.4).style("stroke","darkgrey").attr("fill","white");var p=c.append("g").style("opacity",0).attr("class","popup_selection");p.append("rect").attr("x",6).attr("y",2).attr("width",18).attr("height",25).attr("stroke-width",2).attr("fill","transparent").attr("class","persontype fa-square"),p.append("g").attr("transform","translate(30.200000,32.200000) scale(0.0200000,0.0200000)").style("fill","black").style("stroke","none").style("stroke","none").append("g").attr("transform","rotate(180)").append("path").attr("d","M730 1285 l0 -215 -193 0 c-189 0 -194 -1 -215 -23 -22 -23 -22 -26\n        -22 -448 l0 -426 23 -21 c23 -22 26 -22 443 -22 l421 0 21 23 c22 23 22 26 22\n        448 l0 426 -23 21 c-22 21 -32 22 -215 22 l-192 0 0 215 0 215 -35 0 -35 0 0\n        -215z m418 -307 c17 -17 17 -739 0 -756 -17 -17 -749 -17 -766 0 -17 17 -17\n        739 0 756 17 17 749 17 766 0z");var u=p.append("svg:title").text("add male"),h=c.append("g").style("opacity",0).attr("class","popup_selection");h.append("rect").attr("x",28).attr("y",2).attr("width",18).attr("height",25).attr("stroke-width",2).attr("fill","transparent").attr("class","persontype fa-circle"),h.append("g").attr("transform","translate(52.800000,32.200000) scale(0.0200000,0.0200000)").style("fill","black").style("stroke","none").append("g").attr("transform","rotate(180)").append("path").attr("d","M690 1286 l0 -214 -32 -6 c-79 -16 -88 -19 -88 -27 0 -5 -6 -9 -14\n        -9 -28 0 -112 -56 -163 -107 -51 -52 -100 -141 -122 -219 -24 -90 -10 -213 35\n        -311 34 -72 115 -166 156 -179 10 -3 18 -10 18 -15 0 -5 7 -9 15 -9 8 0 15 -4\n        15 -10 0 -5 9 -10 20 -10 11 0 20 -4 20 -9 0 -20 169 -42 238 -31 101 17 122\n        22 122 31 0 5 7 9 16 9 21 0 101 55 146 102 44 44 88 111 88 133 0 8 3 15 8\n        15 26 0 42 217 21 295 -33 126 -137 252 -250 303 -74 33 -128 52 -152 52 -15\n        0 -17 20 -17 215 l0 215 -40 0 -40 0 0 -214z m172 -314 c7 -7 20 -12 30 -12\n        10 0 18 -4 18 -10 0 -5 5 -10 10 -10 30 0 98 -62 141 -127 59 -91 78 -178 60\n        -284 -14 -86 -43 -140 -111 -209 -55 -55 -69 -65 -145 -95 -57 -23 -209 -23\n        -272 1 -90 33 -174 108 -220 197 -26 48 -28 61 -28 172 0 86 4 129 15 153 8\n        17 18 32 22 32 5 0 8 5 8 11 0 31 119 149 151 149 5 0 9 5 9 10 0 6 8 10 18\n        10 10 0 22 4 28 9 15 15 54 19 156 17 61 -1 102 -6 110 -14z");var g=h.append("svg:title").text("add female"),f=c.append("g").style("opacity",0).attr("class","popup_selection");f.append("rect").attr("x",50).attr("y",2).attr("width",18).attr("height",28).attr("stroke-width",2).attr("fill","transparent").attr("class","persontype fa-unspecified"),f.append("g").attr("transform","translate(76.800000,32.200000) scale(0.0200000,0.0200000)").style("fill","black").style("stroke","none").append("g").attr("transform","rotate(180)").append("path").attr("d","M770 1323 l0 -176 -260 -260 c-219 -219 -260 -264 -260 -288 0 -25\n        41 -70 265 -294 221 -220 270 -265 294 -265 23 0 72 45 294 267 219 218 267\n        271 267 293 0 23 -47 75 -260 287 l-260 260 0 177 0 176 -40 0 -40 0 0 -177z\n        m274 -478 c136 -136 226 -233 226 -244 0 -27 -436 -461 -463 -461 -30 0 -457\n        427 -457 456 0 15 49 70 151 170 83 82 161 160 173 173 11 13 32 34 45 45 13\n        12 38 36 54 54 17 17 33 32 37 32 4 0 109 -101 234 -225");f.append("svg:title").text("add unspecified");var m=c.append("g").style("opacity",0).attr("class","popup_selection");m.append("rect").attr("x",73).attr("y",2).attr("width",22).attr("height",28).attr("stroke-width",2).attr("fill","transparent").attr("class","persontype fa-abortion"),m.append("g").attr("transform","translate(98.800000,32.200000) scale(0.0200000,0.0200000)").style("fill","black").style("stroke","none").append("g").attr("transform","rotate(180)").append("path").attr("d","M770 1295 l0 -204 -39 -55 c-21 -31 -44 -69 -51 -86 -7 -16 -16 -30\n        -21 -30 -5 0 -9 -7 -9 -15 0 -8 -4 -15 -10 -15 -5 0 -10 -4 -10 -10 0 -5 -20\n        -41 -45 -80 -25 -39 -45 -75 -45 -80 0 -6 -4 -10 -10 -10 -5 0 -10 -5 -10 -11\n        0 -6 -20 -42 -45 -80 -25 -38 -45 -74 -45 -79 0 -6 -4 -10 -9 -10 -5 0 -13\n        -10 -17 -22 -4 -12 -31 -60 -60 -106 -30 -45 -54 -87 -54 -92 0 -6 -4 -10 -10\n        -10 -17 0 -11 -46 12 -89 l22 -41 497 0 497 0 21 45 c12 25 21 49 21 55 0 10\n        -21 51 -30 60 -11 10 -130 212 -130 220 0 5 -3 10 -8 12 -9 4 -82 126 -82 139\n        0 5 -4 9 -10 9 -5 0 -10 6 -10 14 0 8 -3 16 -8 18 -9 4 -82 126 -82 139 0 5\n        -4 9 -8 9 -5 0 -30 39 -57 88 -27 48 -55 93 -62 100 -10 10 -13 62 -13 218 l0\n        204 -40 0 -40 0 0 -205z m73 -330 c12 -22 25 -41 30 -43 4 -2 7 -8 7 -13 0 -6\n        5 -15 10 -22 9 -11 49 -74 91 -147 8 -14 17 -27 20 -30 4 -3 16 -24 27 -46 12\n        -23 27 -48 35 -55 7 -8 21 -32 31 -54 11 -22 22 -42 25 -45 3 -3 12 -16 20\n        -30 33 -56 81 -136 88 -146 35 -46 41 -79 17 -88 -9 -3 -209 -6 -445 -6 -381\n        0 -430 2 -436 16 -5 14 9 53 30 79 7 9 42 66 88 145 8 13 20 30 27 38 6 7 12\n        18 12 23 0 6 18 37 40 69 22 32 40 63 40 69 0 5 6 16 13 23 6 8 18 25 26 38\n        53 90 82 137 91 147 5 7 10 17 10 23 0 5 5 10 10 10 6 0 10 4 10 9 0 18 42 82\n        52 79 5 -2 19 -21 31 -43z");m.append("svg:title").text("add abortion");var _=c.append("g").style("opacity",0).attr("class","popup_selection");_.append("rect").attr("x",96).attr("y",2).attr("width",40).attr("height",28).attr("stroke-width",2).attr("fill","transparent").attr("class","persontype fa-angle-up dztwin"),_.append("g").attr("transform","translate(134.800000,30.200000) scale(0.0200000,0.0200000)").style("fill","black").style("stroke","none").append("g").attr("transform","rotate(180)").append("path").attr("d","M987 1503 c-4 -3 -7 -78 -7 -166 0 -152 -1 -160 -22 -178 -13 -10\n        -29 -18 -35 -19 -7 0 -13 -3 -13 -8 0 -4 -36 -30 -80 -57 -44 -27 -80 -53 -80\n        -57 0 -5 -5 -8 -10 -8 -12 0 -94 -52 -98 -62 -2 -5 -10 -8 -18 -8 -8 0 -14 -4\n        -14 -8 0 -5 -12 -15 -27 -23 -16 -8 -49 -29 -74 -46 l-46 -33 -159 0 c-141 0\n        -162 -3 -184 -20 l-25 -19 -3 -323 c-4 -373 -2 -400 34 -417 17 -7 131 -11\n        363 -11 326 0 338 1 359 20 22 21 22 23 22 373 0 194 -4 357 -8 363 -17 26\n        -56 34 -161 34 -67 0 -111 4 -111 10 0 6 7 10 15 10 8 0 15 4 15 8 0 5 18 17\n        40 27 22 10 40 22 40 27 0 4 5 8 10 8 6 0 19 8 30 18 10 9 36 26 57 37 35 18\n        56 33 87 60 6 6 28 19 49 30 21 11 47 28 57 38 11 9 22 17 25 17 3 0 59 -35\n        123 -77 64 -43 121 -80 127 -82 5 -2 18 -12 29 -23 11 -10 24 -18 28 -18 5 0\n        18 -8 29 -19 11 -10 37 -27 59 -37 22 -10 40 -22 40 -26 0 -5 -52 -8 -116 -8\n        -101 0 -120 -3 -145 -21 l-29 -20 0 -350 c0 -344 0 -349 22 -374 l22 -25 345\n        0 c293 1 349 3 366 16 19 14 20 28 23 369 l3 355 -27 25 c-26 24 -31 25 -181\n        25 -131 0 -159 3 -181 18 -46 29 -66 42 -82 49 -8 4 -24 15 -34 25 -11 10 -25\n        18 -32 18 -7 0 -14 4 -16 8 -1 5 -48 37 -103 72 -55 36 -102 67 -105 70 -13\n        14 -70 50 -80 50 -5 0 -10 4 -10 9 0 5 -9 13 -20 16 -19 6 -20 15 -20 176 l0\n        169 -28 0 c-16 0 -32 -3 -35 -7z m-187 -1062 c0 -282 -2 -320 -16 -325 -20 -8\n        -588 -8 -608 0 -14 5 -16 43 -16 318 0 172 3 316 7 319 3 4 147 7 320 7 l313\n        0 0 -319z m1068 307 c9 -9 12 -93 12 -315 0 -289 -1 -303 -19 -313 -21 -11\n        -587 -15 -615 -4 -14 5 -16 43 -16 318 0 172 3 316 7 319 3 4 144 7 313 7 225\n        0 309 -3 318 -12z");_.append("svg:title").text("add dizygotic/fraternal twins");var v=c.append("g").style("opacity",0).attr("class","popup_selection");v.append("rect").attr("x",140).attr("y",2).attr("width",40).attr("height",28).attr("stroke-width",2).attr("fill","transparent").attr("class","fa-caret-up persontype mztwin"),v.append("g").attr("transform","translate(179.800000,30.200000) scale(0.0200000,0.0200000)").style("fill","black").style("stroke","none").append("g").attr("transform","rotate(180)").append("path").attr("d","M1027 1503 c-4 -3 -7 -78 -7 -166 0 -152 -1 -160 -22 -178 -13 -10\n        -29 -18 -35 -19 -7 0 -13 -3 -13 -8 0 -4 -36 -30 -80 -57 -44 -27 -80 -53 -80\n        -57 0 -5 -5 -8 -10 -8 -12 0 -94 -52 -98 -62 -2 -5 -10 -8 -18 -8 -8 0 -14 -4\n        -14 -8 0 -5 -12 -15 -27 -23 -16 -8 -49 -29 -74 -46 l-46 -33 -159 0 c-141 0\n        -162 -3 -184 -20 l-25 -19 -3 -323 c-4 -373 -2 -400 34 -417 17 -7 131 -11\n        363 -11 326 0 338 1 359 20 22 21 22 23 22 373 0 194 -4 357 -8 363 -17 26\n        -56 34 -161 34 -67 0 -111 4 -111 10 0 6 7 10 15 10 8 0 15 4 15 8 0 5 18 17\n        40 27 22 10 40 22 40 27 0 4 7 8 15 8 8 0 15 4 15 8 0 5 15 17 33 26 28 15 60\n        17 267 14 228 -3 236 -4 260 -25 13 -13 28 -23 32 -23 5 0 18 -8 29 -19 11\n        -10 37 -27 59 -37 22 -10 40 -22 40 -26 0 -5 -52 -8 -116 -8 -101 0 -120 -3\n        -145 -21 l-29 -20 0 -350 0 -350 25 -24 24 -25 343 0 c290 1 346 3 363 16 19\n        14 20 28 23 369 l3 355 -27 25 c-26 24 -31 25 -181 25 -131 0 -159 3 -181 18\n        -46 29 -66 42 -82 49 -8 4 -24 15 -34 25 -11 10 -25 18 -32 18 -7 0 -14 4 -16\n        8 -1 5 -48 37 -103 72 -55 36 -102 67 -105 70 -13 14 -70 50 -80 50 -5 0 -10\n        4 -10 9 0 5 -9 13 -20 16 -19 6 -20 15 -20 176 l0 169 -28 0 c-16 0 -32 -3\n        -35 -7z m92 -420 c34 -21 61 -41 61 -45 0 -5 -57 -8 -126 -8 -139 0 -140 1\n        -46 55 17 11 32 23 32 27 0 15 19 8 79 -29z m-279 -642 c0 -282 -2 -320 -16\n        -325 -20 -8 -588 -8 -608 0 -14 5 -16 43 -16 318 0 172 3 316 7 319 3 4 147 7\n        320 7 l313 0 0 -319z m1068 307 c9 -9 12 -93 12 -315 0 -289 -1 -303 -19 -313\n        -21 -11 -587 -15 -615 -4 -14 5 -16 43 -16 318 0 172 3 316 7 319 3 4 144 7\n        313 7 225 0 309 -3 318 -12z");v.append("svg:title").text("add monozygotic/identical twins");var b={};d3.selectAll(".persontype").on("click",function(){var t,a,n=ptree.copy_dataset(e.dataset),i=d3.select(this).classed("mztwin"),s=d3.select(this).classed("dztwin"),r=d3.select(this).classed("fa-abortion");if(i||s?(a=b.node.datum().data.sex,t=i?"mztwin":"dztwin"):a=d3.select(this).classed("fa-square")?"M":d3.select(this).classed("fa-circle")?"F":"U","addsibling"===b.type)ptree.addsibling(n,b.node.datum().data,a,!1,t,r);else{if("addchild"!==b.type)return;ptree.addchild(n,b.node.datum().data,t?"U":a,t?2:1,t,r)}e.dataset=n,ptree.rebuild(e),d3.selectAll(".popup_selection").style("opacity",0),b={}}).on("mouseover",function(){b.node&&b.node.select("rect").style("opacity",.2),d3.selectAll(".popup_selection").style("opacity",1),"addsibling"===b.type?d3.select(this).classed("fa-square")?u.text("add brother"):g.text("add sister"):"addchild"===b.type&&(d3.select(this).classed("fa-square")?u.text("add son"):g.text("add daughter"))}),d3.selectAll(".popup_selection").on("mouseout",function(){b.node!==a&&-1==T.indexOf(b.node.datum())&&b.node.select("rect").style("opacity",0),d3.selectAll(".popup_selection").style("opacity",0)}),function(e){d3.select(".diagram").append("line").attr("class","line_drag_selection").attr("stroke-width",6).style("stroke-dasharray","2, 1").attr("stroke","black").call(d3.drag().on("start",function(e){d3.event.sourceEvent.stopPropagation(),n=i,d3.selectAll(".line_drag_selection").attr("stroke","darkred")}).on("drag",function(t){d3.event.sourceEvent.stopPropagation();var a=d3.event.dx,n=parseFloat(d3.select(this).attr("x2"))+a;s(e.symbol_size-10,0,n,0)}).on("end",function(t){if(i&&n.data.name!==i.data.name&&n.data.sex!==i.data.sex){var r={name:ptree.makeid(4),sex:"U",mother:"F"===n.data.sex?n.data.name:i.data.name,father:"F"===n.data.sex?i.data.name:n.data.name};newdataset=ptree.copy_dataset(e.dataset),e.dataset=newdataset;var o=pedigree_util.getIdxByName(e.dataset,n.data.name)+1;e.dataset.splice(o,0,r),ptree.rebuild(e)}return s(0,0,0,0),d3.selectAll(".line_drag_selection").attr("stroke","black"),void(n=a)})),s(0,0,0,0)}(e),d.append("rect").filter(function(t){return!(t.data.hidden&&!e.DEBUG)}).attr("class","indi_rect").attr("rx",6).attr("ry",6).attr("x",function(t){return-.75*e.symbol_size}).attr("y",function(t){return-e.symbol_size}).attr("width",1.5*e.symbol_size+"px").attr("height",2*e.symbol_size+"px").style("stroke","black").style("stroke-width",.7).style("opacity",0).attr("fill","lightgrey");var x=function(t){return k-.75*e.symbol_size},w=e.symbol_size-2,k=0,z={addchild:{text:"",title:"add child",fx:x,fy:w},addsibling:{text:"",title:"add sibling",fx:x,fy:w},addpartner:{text:"",title:"add partner",fx:x,fy:w},addparents:{text:"",title:"add parents",fx:-.75*e.symbol_size,fy:11-e.symbol_size},delete:{text:"X",title:"delete",fx:e.symbol_size/2-1,fy:12-e.symbol_size,styles:{"font-weight":"bold",fill:"darkred","font-family":"monospace"}}};for(var S in z){var N=d.append("text").filter(function(t){return!(t.data.hidden&&!e.DEBUG||(t.data.mother===a||t.data.noparents)&&"addsibling"===S||t.data.parent_node!==a&&t.data.parent_node.length>1&&"addpartner"===S||t.data.parent_node===a&&"addchild"===S||t.data.noparents===a&&t.data.top_level===a&&"addparents"===S)}).attr("class",S).style("opacity",0).attr("font-family","FontAwesome").attr("xx",function(e){return e.x}).attr("yy",function(e){return e.y}).attr("x",z[S].fx).attr("y",z[S].fy).attr("font-size","0.9em").text(z[S].text);if("styles"in z[S])for(var C in z[S].styles)N.attr(C,z[S].styles[C]);N.append("svg:title").text(z[S].title),k+=17}d3.selectAll(".addsibling, .addchild").on("mouseover",function(){var e=d3.select(this).attr("class");d3.selectAll(".popup_selection").style("opacity",1),b={node:d3.select(this.parentNode),type:e};var t=parseInt(d3.select(this).attr("xx"))+parseInt(d3.select(this).attr("x")),a=parseInt(d3.select(this).attr("yy"))+parseInt(d3.select(this).attr("y"));d3.selectAll(".popup_selection").attr("transform","translate("+t+","+(a+4)+")"),d3.selectAll(".popup_selection_rotate45").attr("transform","translate("+(t+3*l)+","+(a+1.2*l)+") rotate(45)")}),d3.selectAll(".addchild, .addpartner, .addparents, .delete, .settings").on("click",function(){d3.event.stopPropagation();var a,n=d3.select(this).attr("class"),i=d3.select(this.parentNode).datum();if(e.DEBUG&&console.log(n),"settings"===n)"function"==typeof e.edit&&e.edit(e,i);else if("delete"===n){a=ptree.copy_dataset(e.dataset),ptree.delete_node_dataset(a,i.data,e,function(e,t){e.dataset=t,ptree.rebuild(e)})}else"addparents"===n?(a=ptree.copy_dataset(e.dataset),e.dataset=a,ptree.addparents(e,a,i.data.name),ptree.rebuild(e)):"addpartner"===n&&(a=ptree.copy_dataset(e.dataset),ptree.addpartner(e,a,i.data.name),e.dataset=a,ptree.rebuild(e));t(document).trigger("fhChange",[e])});var T=[];d.filter(function(e){return!e.data.hidden}).on("click",function(a){d3.event.ctrlKey?-1==T.indexOf(a)?T.push(a):T.splice(T.indexOf(a),1):T=[a],"nodeclick"in e&&(e.nodeclick(a.data),d3.selectAll(".indi_rect").style("opacity",0),d3.selectAll(".indi_rect").filter(function(e){return-1!=T.indexOf(e)}).style("opacity",.5));let n=d3.event;!function(e,a,n){let i=t("#node_tabs");i.length>0&&i.remove();let s=t("#"+e.targetDiv);s.append('<div id="node_tabs"></div>');let d=t("#node_tabs"),l=t(window).width()>400?450:t(window).width()-30;d.dialog({autoOpen:!1,appendTo:"#pedigrees",width:l});let c=a.data.full_name?a.data.full_name:"",p=pedigree_util.isChildNode(e,a.data.name),u=`\n        <div id="nodeTabs" style="border: 0; max-height:calc(100vh - 50px); overflow-y: auto;">\n            <ol>\n                <li><a href="#personal"><span>Personal</span></a></li>\n                <li><a href="#clinical" id="clinicalTab"><span>Clinical</span></a></li>\n                <li><a href="#riskFactors"><span>Risk Factors</span></a></li>\n                <li class="ui-tabs-close-button" style="float: right; margin-top: 20px;">\n                    <button id="closeBtn" type="button"\n                            class="ui-button ui-corner-all ui-widget ui-button-icon-only ui-dialog-titlebar-close"\n                            title="Close"><span class="ui-button-icon ui-icon ui-icon-closethick"></span><span\n                            class="ui-button-icon-space"> </span>Close\n                    </button>\n                </li>\n            </ol>\n        \n            <div id="personal">\n                <input type='hidden' id='id_name' name='name'/>\n        \n                <div><strong>Link to an existing patient record</strong></div>\n                <table class="table">\n                    <tr>\n                        <td colspan="3">\n                            <input class="form-control" type="text" placeholder="Type patient name or identifier"\n                                   style=" font-size: 12px; padding: 4px; border-radius: 4px"/>\n                        </td>\n                        <td colspan="3">\n                            <span style=" text-align: center; margin-right: 8px">Or</span>\n                            <button class="ui-button" style="border-radius: 4px">Create New</button>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td colspan="1" style="text-align: left;"><strong>Gender:</strong></td>\n                        <td colspan="2"><label class="radio-inline"><input type="radio" name="sex" value="M" ${"M"===a.data.sex?"checked":""} ${p?"":"disabled"}>Male</label></td>\n                        <td colspan="2"><label class="radio-inline"><input type="radio" name="sex" value="F" ${"F"===a.data.sex?"checked":""} ${p?"":"disabled"}>Female</label></td>\n                        <td colspan="2"><label class="radio-inline"><input type="radio" name="sex" value="U" ${"U"===a.data.sex?"checked":""} ${p?"":"disabled"}>Unknown</label></td>\n                    </tr>\n                    <tr>\n                        <td colspan="3"><strong>Name</strong>\n                            <input class="form-control" id="id__name" type="text" style=" font-size: 12px; padding: 4px; border-radius: 4px" value="${c}"/>\n                        </td>\n                        <td colspan="3"><strong>Identifier</strong><input id="id_uniqueId" class="form-control" type="text" value="${a.data.uniqueId?a.data.uniqueId:""}"\n                                                                          style=" font-size: 12px; padding: 4px; border-radius: 4px"/>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td colspan="1" style="text-align: left;"><strong>Status:</strong></td>\n                        <td colspan="2"><label class="radio-inline" style="padding-left: 15px;"><input type="radio" value="0"\n                        ${0===a.data.status?"checked":""}\n                                                                                                       name="status">Alive</label>\n                        </td>\n                        <td colspan="2"><label class="radio-inline" style="padding-left: 15px;"><input type="radio" value="1"\n                         ${1===a.data.status?"checked":""}\n                                                                                                       name="status">Deceased</label>\n                        </td>\n                        <td colspan="2"><label class="radio-inline" style="padding-left: 15px;"><input  type="radio" value="2"\n                         ${2===a.data.status?"checked":""}\n                                                                                                       name="status">A&W</label>\n                        </td>\n                    </tr>\n                    <tr>\n                    <td colspan="7" style="border-top: 0px">\n                    <div class="checkbox">\n                                <label class="radio-inline"><input type="radio" name="status" value="3" ${3===a.data.status?"checked":""} >Unborn</label>\n                                <label class="radio-inline"><input type="radio" name="status" value="4" ${4===a.data.status?"checked":""} >Miscarriage</label>\n                                <label class="radio-inline"><input type="radio" name="status" value="5" ${5===a.data.status?"checked":""}>Stillbirth</label> <br />\n                                <label class="radio-inline"><input type="radio" name="status" value="6" ${6===a.data.status?"checked":""}>Termination</label>\n                                <label id="gestation_container"  class="radio-inline"><span>Gestation age: </span><input id="gestation" value="${a.data.gestation?a.data.gestation:""}" class="form-control" type="number" style=" display: inline-block;width:70px;"  /><span></span>  weeks</label>\n                         </div>\n</td>\n                        </tr>\n        \n                    <tr>\n                        <td colspan="3">\n                            <strong>Age</strong> <br/>\n                            <input id="id__age" class="form-control" type="text" style=" font-size: 12px; padding: 4px; border-radius: 4px" value='${a.data.age?a.data.age:""}'/>\n                            <br/>\n                            <strong>Died at age</strong> <br/>\n                            <input id="id__dage" class="form-control" type="text" style=" font-size: 12px; padding: 4px; border-radius: 4px"  value='${a.data.dage?a.data.dage:""}'/>\n                        </td>\n                        <td colspan="3">\n                            <strong>Date of birth</strong> <br/>\n                            <input id="dob" class="form-control" type="text" style=" font-size: 12px; padding: 4px; border-radius: 4px" value='${a.data.dob?a.data.dob:""}'/>\n                            <br/>\n                            <strong>Cause of death</strong> <br/>\n                            <input id="cause_of_death" class="form-control" type="text" style=" font-size: 12px; padding: 4px; border-radius: 4px" value='${a.data.cause_of_death?a.data.cause_of_death:""}'/>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td colspan="3">\n                            <strong>Ethnicity</strong> <br/>\n                            <input class="form-control magicsearch" id="ethnicity"/>\n                        </td>\n                        <td colspan="3">\n                            <strong>Country of origin</strong> <br/>\n                            <input id="country_of_origin" class="form-control magicsearch"  value='${a.data.country_of_origin?a.data.country_of_origin:""}'/>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td colspan="7" style="text-align: left;">\n                            <strong>Reproduction details</strong>\n                            <div class="checkbox">\n                                <label><input type="checkbox" value="" ${a.data.adopted_in?"checked":""} id="id_adopted_in">Adopted in</label>\n                                <label><input type="checkbox" value="" ${a.data.adopted_out?"checked":""} id="id_adopted_out">Adopted out</label>\n                            </div>\n                            <div class="checkbox">\n                                <label class="radio-inline"><input type="radio" name="individual_role"  value="IVF" ${"IVF"===a.data.individual_role?"checked":""} id="IVF"> Conceived by IVF</label>\n                                <label class="radio-inline"><input type="radio" name="individual_role" value="ICSI" ${"ICSI"===a.data.individual_role?"checked":""} id="id_ivf_icsi"> IVF + ICSI </label>\n                            </div>\n                            <div class="checkbox">\n                                <label><input type="checkbox" value="" ${a.data.consanguineous_parents?"checked":""} id="id_consanguineous_parents">Consanguineous parents</label>\n                            </div>\n                             <div class="checkbox">\n                             <span>Conceived by Donor:</span>\n                                <label><input type="checkbox" value="egg" ${a.data.conceived_by_donor_egg?"checked":""} id="id_conceived_by_donor_egg">Egg</label>\n                                <label><input type="checkbox" value="sperm" ${a.data.conceived_by_donor_sperm?"checked":""} id="id_conceived_by_donor_sperm">Sperm </label>\n                            </div>\n                            <div class="checkbox">\n                                <span>Individual is:</span>\n                                <label><input  name="individual_role" ${"Donor"===a.data.individual_role?"checked":""}  type="radio" value="Donor"> Donor</label>\n                                <label><input name="individual_role" ${"SRG"===a.data.individual_role?"checked":""}  type="radio" value="SRG"> Surrogate</label>\n                                <label><input name="individual_role" ${"none"!==a.data.individual_role&&a.data.individual_role?"":"checked"} type="radio" value="none"> None</label>\n                            </div>\n                        </td>\n        \n                    </tr>\n                    <tr>\n                        <td colspan="7"><strong>Heredity option </strong></td>\n                    </tr>\n                    <tr>\n                        <td colspan="2">\n                            <select id="heredity" class="form-control" style=" font-size: 12px; padding: 4px; border-radius: 4px">\n                                <option ${"None"===a.data.heredity?"selected=selected":""} >None</option>\n                                <option ${"Childless"===a.data.heredity?"selected=selected":""} >Childless</option>\n                                <option ${"Infertile"===a.data.heredity?"selected=selected":""} >Infertile</option>\n                            </select>\n                        </td>\n                        <td colspan="4">\n                            <input class="form-control" type="text" placeholder="Reason"\n                                   style=" font-size: 12px; padding: 4px; border-radius: 4px"/>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td colspan="7" style="text-align: left;"><span><strong>Market by:</strong><input id="reason" type="text"\n                                                                class="form-control" value="${a.data.market_by_text?a.data.market_by_text:""}"\n                                                                                                          placeholder="Reason"\n                                                                                                          style=" font-size: 12px; padding: 4px; border-radius: 4px"/></span>\n                            <div class="checkbox">\n                                <label><input ${"market_na"===a.data.market_by_tick?"checked":""} id="market_na" type="checkbox" value="NA">N/A</label>\n                                <label><input  ${"market_p"===a.data.market_by_tick?"checked":""} id="market_p" type="checkbox" value="+">+</label>\n                                <label><input  ${"market_m"===a.data.market_by_tick?"checked":""} id="market_m" type="checkbox" value="-">-</label>\n                                <label><input  ${"market_s"===a.data.market_by_tick?"checked":""} id="market_s" type="checkbox" value="*">*</label>\n                                <label><input  ${"market_st"===a.data.market_by_tick?"checked":""} id="market_st" type="checkbox" value="sample_taken">Sample taken</label>\n                            </div>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td colspan="7" style="text-align: left;">\n                            <div class="checkbox">\n                                <label><input type="checkbox" value="" ${a.data.proband?"checked":""} id="id_proband"/>Proband</label>\n                            </div>\n                        </td>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td colspan="7"><strong>Comments </strong><br/>\n                            <textarea class="form-control" style=" font-size: 12px; padding: 4px; border-radius: 4px"/>\n                        </td>\n                    </tr>\n        \n                </table>\n            </div>\n        \n            <div id="clinical">\n                <table class="table">\n                    <tr>\n                        <td colspan="3">\n                            <strong style="float: left;">Carrier status</strong><br/>\n                            <div class="radio">\n                                <label style="float: left;"><input value="na" type="radio" ${"na"===a.data.carrier_status?"checked":""} name="carrier_status">Not affected</label>\n                            </div></br>\n                            <div class="radio">\n                                <label style="float: left;"><input value="carrier" type="radio" ${"carrier"===a.data.carrier_status?"checked":""} name="carrier_status">Carrier</label>\n                            </div></br>\n                            <div class="radio">\n                                <label style="float: left;"><input value="uncertain" type="radio" ${"uncertain"===a.data.carrier_status?"checked":""} name="carrier_status">Uncertain</label>\n                            </div>\n                        </td>\n                        <td colspan="3">\n                            <strong></strong><br/>\n                            <div class="radio">\n                                <label style="float: left;"><input value="affected" type="radio" ${"affected"===a.data.carrier_status?"checked":""} name="carrier_status">Affected</label>\n                            </div></br>\n                            <div class="radio">\n                                <label style="float: left;"><input value="asymptomatic" type="radio" ${"asymptomatic"===a.data.carrier_status?"checked":""} name="carrier_status">Asymptomatic</label>\n                            </div>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td colspan="6">\n                            <div class="form-group" id="conditions-clinical-tab">\n                                <label for="conditions" style="float: left;">Conditions</label>\n                                <input type="text" class="form-control" placeholder="Search for condition" id="conditions" style=" font-size: 12px; padding: 4px; border-radius: 4px"/>\n                            </div>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td colspan="6">\n                            <div class="form-group">\n                                <label for="phenotypes" style="float: left;">Phenotypes, clinical symptoms</label>\n                                <input type="text" class="form-control" placeholder="Search or type in" id="phenotypes" style=" font-size: 12px; padding: 4px; border-radius: 4px"/>\n                                <div id="phenotypeGapDiv" class="gapDiv"></div>\n                                <ul id="phenotypeTypedText" tabindex="0" class="ui-menu ui-widget ui-widget-content ui-autocomplete ui-front typedText" style="position: unset; width: 100%; display: none;"><li class="ui-menu-item">\n                                <span id="phenotype-non-standard-text" style="width: 380px;" tabindex="-1" class="ui-menu-item-wrapper non-standard-text"></span><br/><strong>(your text, not a standard term)</strong></li></ul>\n                            </div>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td colspan="6">\n                            <div class="form-group">\n                                <label for="candidateGenes" style="float: left;">Genotype: candidate genes</label>\n                                <input type="text" class="form-control" placeholder="Search or type in" id="candidateGenes" style=" font-size: 12px; padding: 4px; border-radius: 4px"/>\n                                <div id="candidateGapDiv" class="gapDiv"></div>\n                                <ul id="candidateTypedText" tabindex="0" class="ui-menu ui-widget ui-widget-content ui-autocomplete ui-front typedText" style="position: unset; width: 100%; display: none;"><li class="ui-menu-item">\n                                <span id="candidate-non-standard-text" style="width: 380px;" tabindex="-1" class="ui-menu-item-wrapper non-standard-text"></span><br/><strong>(your text, not a standard term)</strong></li></ul>\n                            </div>\n                            <div class="form-group">\n                                <label for="causalGenes" style="float: left;">Genotype: confirmed causal genes</label>\n                                <input type="text" class="form-control" placeholder="Search or type in" id="causalGenes" style=" font-size: 12px; padding: 4px; border-radius: 4px"/>\n                                <div id="causalGapDiv" class="gapDiv"></div>\n                                <ul id="causalTypedText" tabindex="0" class="ui-menu ui-widget ui-widget-content ui-autocomplete ui-front typedText" style="position: unset; width: 100%; display: none;"><li class="ui-menu-item">\n                                <span id="causal-non-standard-text" style="width: 380px;" tabindex="-1" class="ui-menu-item-wrapper non-standard-text"></span><br/><strong>(your text, not a standard term)</strong></li></ul>\n                            </div>\n                            <div class="form-group">\n                                <label for="carrierGenes" style="float: left;">Genotype: carrier genes</label>\n                                <input type="text" class="form-control" placeholder="Search or type in" id="carrierGenes" style=" font-size: 12px; padding: 4px; border-radius: 4px"/>\n                                <div id="carrierGapDiv" class="gapDiv"></div>\n                                <ul tabindex="0" id="carrierTypedText" class="ui-menu ui-widget ui-widget-content ui-autocomplete ui-front typedText" style="position: unset; width: 100%; display: none;"><li class="ui-menu-item">\n                                <span id="carrier-non-standard-text" style="width: 380px;" tabindex="-1" class="ui-menu-item-wrapper non-standard-text"></span><br/><strong>(your text, not a standard term)</strong></li></ul>\n                            </div>\n                            <div class="form-group">\n                              <label for="commentClinical" style="float: left;">Comments</label>\n                              <textarea class="form-control" rows="5" id="commentClinical">${a.data.clinical_comments?a.data.clinical_comments:""}</textarea>\n                            </div>\n                        </td>\n                    </tr>\n                </table>\n            </div>\n            \n            <div id="riskFactors" style="float:left; width: 100%;">\n                <table class="table">\n                    <tr>\n                        <td colspan="7" style="text-align: left;" id="commonCancers">\n                            <strong>Common Cancers</strong>\n                            <div class="checkbox">\n                              <label><input type="checkbox" class="cancer-checkbox" ${a.data.breast_cancer?"checked":""} value="breast_cancer">Breast&emsp;<i class="glyphicon glyphicon-info-sign"></i></label>\n                              &emsp;<input style="display: none;" type="number" min="0" class="cancer-age" placeholder="Enter age of diagnosis" value="${a.data.breast_cancer_age?a.data.breast_cancer_age:""}" />\n                            </div>\n                            <div class="checkbox">\n                              <label><input type="checkbox" class="cancer-checkbox" ${a.data.ovarian_cancer?"checked":""} value="ovarian_cancer">Ovarian&emsp;<i class="glyphicon glyphicon-info-sign"></i></label>\n                              &emsp;<input style="display: none;" type="number" min="0" class="cancer-age" placeholder="Enter age of diagnosis" value="${a.data.ovarian_cancer_age?a.data.ovarian_cancer_age:""}" />\n                            </div>\n                            <div class="checkbox">\n                              <label><input type="checkbox" class="cancer-checkbox" ${a.data.colon_cancer?"checked":""} value="colon_cancer">Colon&emsp;<i class="glyphicon glyphicon-info-sign"></i></label>\n                              &emsp;<input style="display: none;" type="number" min="0" class="cancer-age" placeholder="Enter age of diagnosis" value="${a.data.colon_cancer_age?a.data.colon_cancer_age:""}" />\n                            </div>\n                            <div class="checkbox">\n                              <label><input type="checkbox" class="cancer-checkbox" ${a.data.prostate_cancer?"checked":""} value="prostate_cancer">Prostate&emsp;<i class="glyphicon glyphicon-info-sign"></i></label>\n                              &emsp;<input style="display: none;" type="number" min="0" class="cancer-age" placeholder="Enter age of diagnosis" value="${a.data.prostate_cancer_age?a.data.prostate_cancer_age:""}" />\n                            </div>\n                            <div class="checkbox">\n                              <label><input type="checkbox" class="cancer-checkbox" ${a.data.pancreatic_cancer?"checked":""} value="pancreatic_cancer">Pancreatic&emsp;<i class="glyphicon glyphicon-info-sign"></i></label>\n                              &emsp;<input style="display: none;" type="number" min="0" class="cancer-age" placeholder="Enter age of diagnosis" value="${a.data.pancreatic_cancer_age?a.data.pancreatic_cancer_age:""}" />\n                            </div>\n                            <div class="checkbox">\n                              <label><input type="checkbox" class="cancer-checkbox" ${a.data.melanoma_cancer?"checked":""} value="melanoma_cancer">Melanoma&emsp;<i class="glyphicon glyphicon-info-sign"></i></label>\n                              &emsp;<input style="display: none;" type="number" min="0" class="cancer-age" placeholder="Enter age of diagnosis" value="${a.data.melanoma_cancer_age?a.data.melanoma_cancer_age:""}" />\n                            </div>\n                            <div class="checkbox">\n                              <label><input type="checkbox" class="cancer-checkbox" ${a.data.kidney_cancer?"checked":""} value="kidney_cancer">Kidney&emsp;<i class="glyphicon glyphicon-info-sign"></i></label>\n                              &emsp;<input style="display: none;" type="number" min="0" class="cancer-age" placeholder="Enter age of diagnosis" value="${a.data.kidney_cancer_age?a.data.kidney_cancer_age:""}" />\n                            </div>\n                            <div class="checkbox">\n                              <label><input type="checkbox" class="cancer-checkbox" ${a.data.gastric_cancer?"checked":""} value="gastric_cancer">Gastric&emsp;<i class="glyphicon glyphicon-info-sign"></i></label>\n                              &emsp;<input style="display: none;" type="number" min="0" class="cancer-age" placeholder="Enter age of diagnosis" value="${a.data.gastric_cancer_age?a.data.gastric_cancer_age:""}" />\n                            </div>\n                            <div class="checkbox">\n                              <label><input type="checkbox" class="cancer-checkbox" ${a.data.lung_cancer?"checked":""} value="lung_cancer">Lung&emsp;<i class="glyphicon glyphicon-info-sign"></i></label>\n                              &emsp;<input style="display: none;" type="number" min="0" class="cancer-age" placeholder="Enter age of diagnosis" value="${a.data.lung_cancer_age?a.data.lung_cancer_age:""}" />\n                            </div>\n                            <div class="checkbox">\n                              <label><input type="checkbox" class="cancer-checkbox" ${a.data.brain_cancer?"checked":""} value="brain_cancer">Brain&emsp;<i class="glyphicon glyphicon-info-sign"></i></label>\n                              &emsp;<input style="display: none;" type="number" min="0" class="cancer-age" placeholder="Enter age of diagnosis" value="${a.data.brain_cancer_age?a.data.brain_cancer_age:""}" />\n                            </div>\n                            <div class="checkbox">\n                              <label><input type="checkbox" class="cancer-checkbox" ${a.data.oesophagus_cancer?"checked":""} value="oesophagus_cancer">Oesophagus&emsp;<i class="glyphicon glyphicon-info-sign"></i></label>\n                              &emsp;<input style="display: none;" type="number" min="0" class="cancer-age" placeholder="Enter age of diagnosis" value="${a.data.oesophagus_cancer_age?a.data.oesophagus_cancer_age:""}" />\n                            </div>\n                            <div class="checkbox">\n                              <label><input type="checkbox" class="cancer-checkbox" ${a.data.thyroid_cancer?"checked":""} value="thyroid_cancer">Thyroid&emsp;<i class="glyphicon glyphicon-info-sign"></i></label>\n                              &emsp;<input style="display: none;" type="number" min="0" class="cancer-age" placeholder="Enter age of diagnosis" value="${a.data.thyroid_cancer_age?a.data.thyroid_cancer_age:""}" />\n                            </div>\n                            <div class="checkbox">\n                              <label><input type="checkbox" class="cancer-checkbox" ${a.data.liver_cancer?"checked":""} value="liver_cancer">Liver&emsp;<i class="glyphicon glyphicon-info-sign"></i></label>\n                              &emsp;<input style="display: none;" type="number" min="0" class="cancer-age" placeholder="Enter age of diagnosis" value="${a.data.liver_cancer_age?a.data.liver_cancer_age:""}" />\n                            </div>\n                            <div class="checkbox">\n                              <label><input type="checkbox" class="cancer-checkbox" ${a.data.cervix_cancer?"checked":""} value="cervix_cancer">Cervix&emsp;<i class="glyphicon glyphicon-info-sign"></i></label>\n                              &emsp;<input style="display: none;" type="number" min="0" class="cancer-age" placeholder="Enter age of diagnosis" value="${a.data.cervix_cancer_age?a.data.cervix_cancer_age:""}" />\n                            </div>\n                            <div class="checkbox">\n                              <label><input type="checkbox" class="cancer-checkbox" ${a.data.myeloma_cancer?"checked":""} value="myeloma_cancer">Myeloma&emsp;<i class="glyphicon glyphicon-info-sign"></i></label>\n                              &emsp;<input style="display: none;" type="number" min="0" class="cancer-age" placeholder="Enter age of diagnosis" value="${a.data.myeloma_cancer_age?a.data.myeloma_cancer_age:""}" />\n                            </div>\n                            <div class="checkbox">\n                              <label><input type="checkbox" class="cancer-checkbox" ${a.data.leukemia_cancer?"checked":""} value="leukemia_cancer">Leukemia&emsp;<i class="glyphicon glyphicon-info-sign"></i></label>\n                              &emsp;<input style="display: none;" type="number" min="0" class="cancer-age" placeholder="Enter age of diagnosis" value="${a.data.leukemia_cancer_age?a.data.leukemia_cancer_age:""}" />\n                            </div>\n                            <div class="form-group">\n                                <input type="text" class="form-control" id="searchForCancers" placeholder="Search for cancers" style=" font-size: 12px; padding: 4px; border-radius: 4px"/>\n                            </div>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td colspan="7" style="text-align: left;">\n                            <div class="form-group">\n                              <label for="commentRiskFactors">Comments</label>\n                              <textarea class="form-control" rows="5" id="commentRiskFactors"></textarea>\n                            </div>\n                        </td>\n                    </tr>\n                 </table>\n            </div>\n        </div>\n        `;setTimeout(()=>{let e=t("#gestation_container");a.data.status>2?e.show():e.hide()},50);let h=n.pageX+50;y=10,h+l>s.width()&&(h+=170,panZoom.translateX(e,-(h+l-s.width())),h=h-(h+l-s.width())-170);d.html(u),t("#nodeTabs").tabs({create:function(e,a){t("#closeBtn").click(function(){d.dialog("close")})}}),d.dialog("option","position",{my:"left top",at:"left+"+h+" top+"+y,of:window}),d.dialog("open"),d.css("padding","0"),t(".ui-dialog-titlebar").remove(),t("#dob").datepicker(),t("#dod-date-picker").datepicker(),pedigree_form.update(e);var g=[{id:1,data_value:"Tim Cook"},{id:2,data_value:"Eric Baker"},{id:3,data_value:"Victor Brown"},{id:4,data_value:"Lisa White"},{id:5,data_value:"Oliver Bull"},{id:6,data_value:"Zade Stock"},{id:7,data_value:"David Reed"},{id:8,data_value:"George Hand"},{id:9,data_value:"Tony Well"},{id:10,data_value:"Bruce Wayne"}];let f=t("#ethnicity");if(f.magicsearch({dataSource:g,fields:["data_value"],id:"id",format:"%data_value%",multiple:!0,multiField:"data_value",multiStyle:{space:5,width:80},success:function(t,n){pedigree_form.saveTabbedForm(e,a.data.name,{ethnicity:{action:"save",data:n,id:"ethnicity"}})},afterDelete:function(t,n){pedigree_form.saveTabbedForm(e,a.data.name,{ethnicity:{action:"delete",data:n,id:"ethnicity"}})}}),a.data.ethnicity&&a.data.ethnicity.length>0){let e=a.data.ethnicity.map(e=>e.id).join();f.trigger("set",{id:e})}g=[{id:1,data_value:"Nigeria"},{id:2,data_value:"United State"},{id:3,data_value:"Germany"},{id:4,data_value:"Canada"},{id:5,data_value:"Japan"}];let m=t("#country_of_origin");if(m.magicsearch({dataSource:g,fields:["data_value"],id:"id",format:"%data_value%",isClear:!0,multiple:!0,multiField:"data_value",multiStyle:{space:5,width:80},success:function(t,n){pedigree_form.saveTabbedForm(e,a.data.name,{countryOfOrigin:{action:"save",data:n,id:"country_of_origin"}})},afterDelete:function(t,n){pedigree_form.saveTabbedForm(e,a.data.name,{countryOfOrigin:{action:"delete",data:n,id:"country_of_origin"}})}}),a.data.country_of_origin&&a.data.country_of_origin.length>0){let e=a.data.country_of_origin.map(e=>e.id).join();m.trigger("set",{id:e})}var _=[];Object.keys(e.phenotypes).forEach(function(t){_.push(e.phenotypes[t].name)});var v=[];Object.keys(e.candidate_genotype).forEach(function(t){v.push(e.candidate_genotype[t].name)});var b=[];Object.keys(e.causal_genotype).forEach(function(t){b.push(e.causal_genotype[t].name)});var x=[];Object.keys(e.carrier_genotype).forEach(function(t){x.push(e.carrier_genotype[t].name)});var w=[];function k(e,t,a){var n=a+"-close",i=e+"_key";return"<span id="+e+' style="float:left; width:100%;">'+t+'&emsp;<i class="glyphicon glyphicon-info-sign"></i><a href="#" onclick="return false" style="float: right; padding: 2px; color: red;" class='+n+' ><i class="glyphicon glyphicon-remove"></i></a><input id='+i+' style="display:none;" value='+e+" /></span>"}function z(t){return'<span class="diagnosisTypes"><label style="float: left;"><input type="checkbox" id="'+t+'_check" value="" checked>'+e.conditions[t].name+'&emsp;<i class="glyphicon glyphicon-info-sign"></i></label><br/><div class="panel panel-default"><a id="'+t+'" href="#" onclick="return false" style="float: right; padding: 2px; color: red;" class="diagnosis-close"><i class="glyphicon glyphicon-remove"></i></a><div class="panel-body"><div class="form-group"><strong style="float: left;">Status:</strong>&emsp;<label class="radio-inline" style="padding-left: 15px;"><input type="radio" value="Affected" name="'+t+'_status">Affected</label><label class="radio-inline" style="padding-left: 15px;"><input type="radio" value="Carrier" name="'+t+'_status">Carrier</label><label class="radio-inline" style="padding-left: 15px;"><input type="radio" value="Uncertain" name="'+t+'_status">Uncertain</label></div><label style="float: left;">Age onset:</label><input type="text" id="'+t+'_ageOnset" class="form-control" style="width: 190px; height: 27px; padding: 4px; border-radius: 4px; float:right;"/><label style="float: left;">Diagnosed:</label><input type="text" id="'+t+'_diagnosed" class="form-control" style="width: 190px; height: 27px; padding: 4px; border-radius: 4px; float:right;"/><label style="float: left;">Diagnosis type:</label><select id="'+t+'_diagnosisType" class="form-control" style="width: 190px; height: 27px; padding: 4px; border-radius: 4px; float:right;"><option value=""></option><option value="Clinical">Clinical</option><option value="Confirmed Moleculary">Confirmed Moleculary</option><option value="Confirmed Cytogenetically">Confirmed Cytogenetically</option><option value="Confirmed Biochemically">Confirmed Biochemically</option></select><label style="float: left;">Notes:</label><textarea class="form-control" rows="3" id="'+t+'_notes"></textarea></div></div></span>'}function S(e,t,a,n){var i=a+"-close";return'<div class="checkbox"><label><input type="checkbox" class="cancer-checkbox" value='+e+" checked>"+t+'&emsp;<i class="glyphicon glyphicon-info-sign"></i></label>&emsp;<input type="number" min="0" class="cancer-age" placeholder="Enter age of diagnosis" value='+n+' ><a href="#" onclick="return false" style="float: right; padding: 2px; color: red;" class='+i+'><i class="glyphicon glyphicon-remove"></i></a></div>'}Object.keys(e.cancers).forEach(function(t){w.push(e.cancers[t].name)}),t("#phenotypes").autocomplete({source:_,response:function(e,a){var n=28.666*a.content.length+(a.content.length>0?4:0)+"px";t(this).closest("div").find(".gapDiv").css("height",n)},select:function(n,i){t("#phenotypeTypedText").hide(),t("#phenotypeGapDiv").hide(),t("#phenotypeGapDiv").css("height",0);var s=o(i.item.value,e.phenotypes);if(null===s){var r=i.item.value,d=i.item.value.trim().toLowerCase().replace(/ /g,"_")+"_phenotype";e.phenotypes.push({type:d,name:r}),s=d}var l=k(s,i.item.value,"phenotype"),c=!1;return t(this).closest("td").find("input").each(function(){if(t(this).val()===s)return c=!0,!1}),c||(t(this).closest("td").append(l),a.data.name in e.selected_phenotypes?e.selected_phenotypes[a.data.name].push(s):(e.selected_phenotypes[a.data.name]=[],e.selected_phenotypes[a.data.name].push(s)),pedigree_form.saveTabbedForm(e,a.data.name)),t(this).val(""),!1}}).off("blur").on("blur",function(){document.hasFocus()}).data("ui-autocomplete")._renderItem=function(e,a){return t("<li></li>").data("item.autocomplete",a).append('<span style="width: 380px;">'+a.label+'&emsp;<i class="glyphicon glyphicon-info-sign"></i></span>').appendTo(e)},t("#candidateGenes").autocomplete({source:v,response:function(e,a){var n=28.666*a.content.length+(a.content.length>0?4:0)+"px";t(this).closest("div").find(".gapDiv").css("height",n)},select:function(n,i){t("#candidateTypedText").hide(),t("#candidateGapDiv").hide(),t("#candidateGapDiv").css("height",0);var s=o(i.item.value,e.candidate_genotype);if(null===s){var r=i.item.value,d=i.item.value.trim().toLowerCase().replace(/ /g,"_")+"_candidate";e.candidate_genotype.push({type:d,name:r}),s=d}var l=k(s,i.item.value,"candidate"),c=!1;return t(this).closest("div").find("input").each(function(){if(t(this).val()===s)return c=!0,!1}),c||(t(this).closest("div").append(l),a.data.name in e.selected_candidate_genotype?e.selected_candidate_genotype[a.data.name].push(s):(e.selected_candidate_genotype[a.data.name]=[],e.selected_candidate_genotype[a.data.name].push(s)),pedigree_form.saveTabbedForm(e,a.data.name)),t(this).val(""),!1}}).off("blur").on("blur",function(){document.hasFocus()}).data("ui-autocomplete")._renderItem=function(e,a){return t("<li></li>").data("item.autocomplete",a).append('<span style="width: 380px;">'+a.label+'&emsp;<i class="glyphicon glyphicon-info-sign"></i></span>').appendTo(e)},t("#causalGenes").autocomplete({source:b,response:function(e,a){var n=28.666*a.content.length+(a.content.length>0?4:0)+"px";t(this).closest("div").find(".gapDiv").css("height",n)},select:function(n,i){t("#causalTypedText").hide(),t("#causalGapDiv").hide(),t("#causalGapDiv").css("height",0);var s=o(i.item.value,e.causal_genotype);if(null===s){var r=i.item.value,d=i.item.value.trim().toLowerCase().replace(/ /g,"_")+"_causal";e.causal_genotype.push({type:d,name:r}),s=d}var l=k(s,i.item.value,"causal"),c=!1;return t(this).closest("div").find("input").each(function(){if(t(this).val()===s)return c=!0,!1}),c||(t(this).closest("div").append(l),a.data.name in e.selected_causal_genotype?e.selected_causal_genotype[a.data.name].push(s):(e.selected_causal_genotype[a.data.name]=[],e.selected_causal_genotype[a.data.name].push(s)),pedigree_form.saveTabbedForm(e,a.data.name)),t(this).val(""),!1}}).off("blur").on("blur",function(){document.hasFocus()}).data("ui-autocomplete")._renderItem=function(e,a){return t("<li></li>").data("item.autocomplete",a).append('<span style="width: 380px;">'+a.label+'&emsp;<i class="glyphicon glyphicon-info-sign"></i></span>').appendTo(e)},t("#carrierGenes").autocomplete({source:x,response:function(e,a){var n=28.666*a.content.length+(a.content.length>0?4:0)+"px";t(this).closest("div").find(".gapDiv").css("height",n)},select:function(n,i){t("#carrierTypedText").hide(),t("#carrierGapDiv").hide(),t("#carrierGapDiv").css("height",0);var s=o(i.item.value,e.carrier_genotype);if(null===s){var r=i.item.value,d=i.item.value.trim().toLowerCase().replace(/ /g,"_")+"_carrier";e.carrier_genotype.push({type:d,name:r}),s=d}var l=k(s,i.item.value,"carrier"),c=!1;return t(this).closest("div").find("input").each(function(){if(t(this).val()===s)return c=!0,!1}),c||(t(this).closest("div").append(l),a.data.name in e.selected_carrier_genotype?e.selected_carrier_genotype[a.data.name].push(s):(e.selected_carrier_genotype[a.data.name]=[],e.selected_carrier_genotype[a.data.name].push(s)),pedigree_form.saveTabbedForm(e,a.data.name)),t(this).val(""),!1}}).off("blur").on("blur",function(){document.hasFocus()}).data("ui-autocomplete")._renderItem=function(e,a){return t("<li></li>").data("item.autocomplete",a).append('<span style="width: 380px;">'+a.label+'&emsp;<i class="glyphicon glyphicon-info-sign"></i></span>').appendTo(e)},t("#nodeTabs").on("input","#phenotypes",function(){0==t(this).val().trim().length?(t("#phenotypeTypedText").hide(),t("#phenotypeGapDiv").hide(),t("#phenotypeGapDiv").css("height",0)):(t("#phenotypeTypedText").show(),t("#phenotypeGapDiv").show()),t("#phenotype-non-standard-text").text(t(this).val())}),t("#phenotype-non-standard-text").on("click",function(){t("#phenotypes").data("ui-autocomplete")._trigger("select","autocompleteselect",{item:{value:t("#phenotypes").val()}}),t("#phenotypeGapDiv").css("height",0),t("#phenotypeTypedText").hide()}),t("#nodeTabs").on("click",function(){t(".gapDiv").css("height",0),t(".non-standard-text").closest("ul").hide()}),t("#nodeTabs").on("input","#candidateGenes",function(){0==t(this).val().trim().length?(t("#candidateTypedText").hide(),t("#candidateGapDiv").hide(),t("#candidateGapDiv").css("height",0)):(t("#candidateTypedText").show(),t("#candidateGapDiv").show()),t("#candidate-non-standard-text").text(t(this).val())}),t("#candidate-non-standard-text").on("click",function(){t("#candidateGenes").data("ui-autocomplete")._trigger("select","autocompleteselect",{item:{value:t("#candidateGenes").val()}}),t("#candidateGapDiv").css("height",0),t("#candidateTypedText").hide()}),t("#nodeTabs").on("input","#causalGenes",function(){0==t(this).val().trim().length?(t("#causalTypedText").hide(),t("#causalGapDiv").hide(),t("#causalGapDiv").css("height",0)):(t("#causalTypedText").show(),t("#causalGapDiv").show()),t("#causal-non-standard-text").text(t(this).val())}),t("#causal-non-standard-text").on("click",function(){t("#causalGenes").data("ui-autocomplete")._trigger("select","autocompleteselect",{item:{value:t("#causalGenes").val()}}),t("#causalGapDiv").css("height",0),t("#causalTypedText").hide()}),t("#nodeTabs").on("input","#carrierGenes",function(){0==t(this).val().trim().length?(t("#carrierTypedText").hide(),t("#carrierGapDiv").hide(),t("#carrierGapDiv").css("height",0)):(t("#carrierTypedText").show(),t("#carrierGapDiv").show()),t("#carrier-non-standard-text").text(t(this).val())}),t("#carrier-non-standard-text").on("click",function(){t("#carrierGenes").data("ui-autocomplete")._trigger("select","autocompleteselect",{item:{value:t("#carrierGenes").val()}}),t("#carrierGapDiv").css("height",0),t("#carrierTypedText").hide()});var N=pedcache.current(e),C=a.data.name,T="string"==typeof C&&C.length>0?C:t("#id_name").val(),D=ptree.copy_dataset(N),B=pedigree_util.getNodeByName(D,T),I=[];Object.keys(e.conditions).forEach(function(t){I.push(e.conditions[t].name)}),t("#conditions").autocomplete({source:I,select:function(n,i){let s=r(i.item.value,e.conditions),o=z(s);return t(this).closest("td").find("input").is("#"+s+"_check_stat")?(t("#"+s+"_check_stat").closest("span").show(),t(this).val(""),!1):t(this).closest("td").find("input").is("#"+s+"_check")?(t("#"+s+"_check").closest("span").show(),t(this).val(""),!1):(t(this).closest("td").append(o),pedigree_form.saveTabbedForm(e,a.data.name),t(this).val(""),!1)}}).data("ui-autocomplete")._renderItem=function(e,a){return t("<li></li>").data("item.autocomplete",a).append('<span style="width: 380px;">'+a.label+'&emsp;<i class="glyphicon glyphicon-info-sign"></i></span>').appendTo(e)},t("#searchForCancers").autocomplete({source:w,select:function(n,i){var s=o(i.item.value,e.cancers),r=S(s,i.item.value,"cancer",""),d=!1;return t(this).closest("div").find("input").each(function(){if(t(this).val()===s)return d=!0,!1}),d||(t(this).closest("div").append(r),a.data.name in e.selected_cancers?e.selected_cancers[a.data.name].push(s):(e.selected_cancers[a.data.name]=[],e.selected_cancers[a.data.name].push(s)),pedigree_form.save_common_cancers(t(this).closest("div").find("input[type=checkbox]").val(),t(this).closest("div").find("input[type=number]").val(),e,a.data.name,!1)),t(this).val(""),!1}}).data("ui-autocomplete")._renderItem=function(e,a){return t("<li></li>").data("item.autocomplete",a).append('<span style="width: 380px;">'+a.label+'&emsp;<i class="glyphicon glyphicon-info-sign"></i></span>').appendTo(e)},t(document).on("click","a.diagnosis-close",function(){t(this).closest("span").find("input[type=checkbox]").is(":checked")?t(this).closest("span").hide():t(this).closest("span").remove()}),t("#nodeTabs").on("click","a.cancer-close",function(){t(this).closest("div").remove()}),t("#nodeTabs").on("click","a.phenotype-close",function(){t(this).closest("span").remove(),pedigree_form.remove_phenotypes(e,a.data.name,t(this).closest("span").find("input").val())}),t("#nodeTabs").on("click","a.candidate-close",function(){t(this).closest("span").remove(),pedigree_form.remove_candidate(e,a.data.name,t(this).closest("span").find("input").val())}),t("#nodeTabs").on("click","a.causal-close",function(){t(this).closest("span").remove(),pedigree_form.remove_causal(e,a.data.name,t(this).closest("span").find("input").val())}),t("#nodeTabs").on("click","a.carrier-close",function(){t(this).closest("span").remove(),pedigree_form.remove_carrier(e,a.data.name,t(this).closest("span").find("input").val())}),B.conditions=B.conditions||[];const O=new RegExp("[ ~!@#$%^&*()|+-=?;:'\",.]","gi");t.each(e.conditions,function(a,n){const i=B.conditions.find(e=>e.name.replace(O,"-")+"_condition"===a);if(i){let n='<span><label style="float: left;"><input type="checkbox" id="'+(s=a)+'_check_stat" value="" checked="checked" onclick="return false;">&emsp;'+e.conditions[s].name+'&emsp;<i class="glyphicon glyphicon-info-sign"></i></label><br/><div class="panel panel-default"><a id="'+s+'" href="#" onclick="return false" style="float: right; padding: 2px; color: red;" class="diagnosis-close"><i class="glyphicon glyphicon-remove"></i></a><a href="#" onclick="return false" style="float: right; padding: 2px; color: green;" class="diagnosis-edit"><i class="glyphicon glyphicon-pencil"></i></a><div class="panel-body"><div class="form-group"><span style="float:left; padding-left:3px;"><strong>Status:</strong>&nbsp;<span id="'+s+'_status_stat"></span></span><span style="float:left; padding-left:3px;"><strong>Onset:</strong>&nbsp;<span id="'+s+'_ageOnset_stat"></span></span><span style="float:left; padding-left:3px;"><strong>Dx:</strong>&nbsp;<span id="'+s+'_diagnosed_stat"></span></span><br/><span style="float:left; padding-left:3px;"><strong>Dx type:</strong>&nbsp;<span id="'+s+'_diagnosisType_stat"></span></span><span style="float:left; padding-left:3px;"><strong>Notes:</strong>&nbsp;<span id="'+s+'_notes_stat"></span></span></div></div></div></span>',r=z(a);t("#conditions").closest("td").append(n),t("#conditions").closest("td").append(r),t("#"+a+"_ageOnset_stat").text(i.age),t("#"+a+"_status_stat").text(i.status),t("#"+a+"_diagnosed_stat").text(i.diagnosed),t("#"+a+"_diagnosisType_stat").text(i.type),t("#"+a+"_notes_stat").text(i.notes),t("#"+a+"_ageOnset").val(i.age),t("input[name='"+a+"_status']").val([i.status]),t("#"+a+"_diagnosed").val(i.diagnosed),t("#"+a+"_diagnosisType").val(i.type),t("#"+a+"_notes").val(i.notes),t("#"+a+"_check").closest("span").hide()}var s}),t("#nodeTabs").on("click","a.diagnosis-close",function(){let n=t(this).attr("id");pedigree_form.saveTabbedForm(e,a.data.name,{conditionToDelete:n})});for(var A=0;A<e.phenotypes.length;A++)B.hasOwnProperty(e.phenotypes[A].type)&&(e.selected_phenotypes[a.data.name]=[e.phenotypes[A].type],t("#phenotypes").closest("td").append(k(e.phenotypes[A].type,e.phenotypes[A].name,"phenotype")));for(var F=0;F<e.candidate_genotype.length;F++)B.hasOwnProperty(e.candidate_genotype[F].type)&&(e.selected_candidate_genotype[a.data.name]=[e.candidate_genotype[F].type],t("#candidateGenes").closest("div").append(k(e.candidate_genotype[F].type,e.candidate_genotype[F].name,"candidate")));for(var F=0;F<e.causal_genotype.length;F++)B.hasOwnProperty(e.causal_genotype[F].type)&&(e.selected_causal_genotype[a.data.name]=[e.causal_genotype[F].type],t("#causalGenes").closest("div").append(k(e.causal_genotype[F].type,e.causal_genotype[F].name,"causal")));for(var F=0;F<e.carrier_genotype.length;F++)B.hasOwnProperty(e.carrier_genotype[F].type)&&(e.selected_carrier_genotype[a.data.name]=[e.carrier_genotype[F].type],t("#carrierGenes").closest("div").append(k(e.carrier_genotype[F].type,e.carrier_genotype[F].name,"carrier")));for(var $=0;$<e.cancers.length;$++)B.hasOwnProperty(e.cancers[$].type)&&(e.selected_cancers[a.data.name]=[e.cancers[$].type],B.hasOwnProperty(e.cancers[$].type+"_age")?t("#searchForCancers").closest("div").append(S(e.cancers[$].type,e.cancers[$].name,"cancer",B[e.cancers[$].type+"_age"])):t("#searchForCancers").closest("div").append(S(e.cancers[$].type,e.cancers[$].name,"cancer","")));t("#reason").on("keyup blur",function(t){13===t.keyCode&&pedigree_form.saveTabbedForm(e,a.data.name)}),t(".diagnosis-edit").on("click",function(){let a=t(this).closest("span").find("label").text(),n=r(a.trim(),e.conditions);t("#"+n+"_check").closest("span").show(),t(this).closest("span").remove()}),t("#nodeTabs").on("change","input[type=text], input[type=radio], input[type=checkbox],#nodeTabs input[type=number], select, textarea, #heredity,#ethnicity,  #country_of_origin",function(){pedigree_form.saveTabbedForm(e,a.data.name,null)}),t(".cancer-checkbox").each(function(){t(this).is(":checked")&&t(this).closest("div").find("input[type=number]").show()}),t("#nodeTabs").on("change",".cancer-checkbox",function(){if(t(this).is(":checked"))t(this).closest("div").find("input[type=number]").show(),pedigree_form.save_common_cancers(t(this).val(),t(this).closest("div").find("input[type=number]").val(),e,a.data.name,!1);else if(t(this).closest("div").find("input[type=number]").hide(),pedigree_form.remove_cancers(t(this).val(),t(this).closest("div").find("input[type=number]").val(),e,a.data.name,!1),e.hasOwnProperty("cancer_legend"))for(var n=0;n<e.cancer_legend.length;n++)if(t(this).val()===e.cancer_legend[n].type){var i=e.cancer_legend[n].count;e.cancer_legend[n].count=i-1;break}legend.showCancerLegends(e)}),t("#nodeTabs").on("change",".cancer-age",function(){t(this).closest("div").find("input[type=checkbox]").is(":checked")&&(t(this).val()?pedigree_form.save_common_cancers(t(this).closest("div").find("input[type=checkbox]").val(),t(this).val(),e,a.data.name,!0):pedigree_form.remove_cancers(t(this).closest("div").find("input[type=checkbox]").val(),t(this).val(),e,a.data.name,!0))})}(e,a,n)}).on("mouseover",function(t){d3.event.stopPropagation(),i=t,n?n.data.name!==i.data.name&&n.data.sex!==i.data.sex&&d3.select(this).select("rect").style("opacity",.2):(d3.select(this).select("rect").style("opacity",.2),d3.select(this).selectAll(".addchild, .addsibling, .addpartner, .addparents, .delete, .settings").style("opacity",1),d3.select(this).selectAll(".indi_details").style("opacity",0),s(e.symbol_size-10,0,e.symbol_size-2,0,t.x+","+(t.y+2)))}).on("mouseout",function(t){n||(d3.select(this).selectAll(".addchild, .addsibling, .addpartner, .addparents, .delete, .settings").style("opacity",0),-1==T.indexOf(t)&&d3.select(this).select("rect").style("opacity",0),d3.select(this).selectAll(".indi_details").style("opacity",1),d3.mouse(this)[1]<.8*e.symbol_size&&d3.selectAll(".popup_selection").style("opacity",0),n||(Math.abs(d3.mouse(this)[1])>.25*e.symbol_size||Math.abs(d3.mouse(this)[1])<-.25*e.symbol_size||d3.mouse(this)[0]<.2*e.symbol_size)&&s(0,0,0,0))})},e.openNodeLinkDialog=function(e,a,n){let i=t("#node_link");i.length>0&&i.remove();let s=t("#"+e.targetDiv);s.append('<div id="node_link"></div>');let r=t("#node_link"),o=t(window).width()>400?450:t(window).width()-30;r.dialog({autoOpen:!1,appendTo:"#pedigrees",width:o});let d=a.source.data.mother.name,l=a.source.data.father.name,c=a.source.data.mother.consanguity,p=a.source.data.mother.divorced&&a.source.data.mother.divorced===a.source.data.father.name,u=`<table class="table">\n        <tr><td colspan="3"><strong>Consanguinity of this Relationship?</strong></td></tr>\n             <tr>\n             <td colspan="1">\n           <label class="radio-inline"><input type="radio" name="consanguity" value="auto" ${c&&"auto"!==c?"":"checked"}>Automatic</label><br /><br />\n           <label class="checkbox-inline" style="margin-left: 8px"><input type="checkbox" name="separated" ${p?"checked":""} value="separated">Separated</label>\n        </td>\n         <td colspan="1">\n         <label class="radio-inline"><input type="radio" name="consanguity" value="yes" ${c&&"yes"===c?"checked":""} >Yes</label>\n         </td>\n         <td colspan="1">\n         <label class="radio-inline"><input type="radio" name="consanguity" value="no" ${c&&"no"===c?"checked":""} >No</label>\n         </td>\n        </tr>\n             </table>`,h=n.pageX+30,g=n.pageY-20;h+o>s.width()&&(panZoom.translateX(e,-(h+o-s.width())),h-=h+o-s.width()),r.html(u),r.dialog("option","position",{my:"left top",at:"left+"+h+" top+"+g,of:window}),r.dialog("open"),e.dataset=ptree.copy_dataset(pedcache.current(e)),t("#node_link input:radio").on("change",function(){let a=t("input[name=consanguity]:checked").val();"yes"===a?t.each(e.dataset,function(t,a){a.name===d&&(e.dataset[t].consanguity="yes"),a.name===l&&(e.dataset[t].consanguity="yes")}):"no"===a?t.each(e.dataset,function(t,a){a.name===d&&(e.dataset[t].consanguity="no"),a.name===l&&(e.dataset[t].consanguity="no")}):t.each(e.dataset,function(t,a){a.name===d&&delete e.dataset[t].consanguity,a.name===l&&delete e.dataset[t].consanguity}),ptree.rebuild(e)}),t("#node_link input:checkbox").change(function(){t(this).is(":checked")?t.each(e.dataset,function(t,a){a.name===d&&(e.dataset[t].divorced=l),a.name===l&&(e.dataset[t].divorced=d)}):t.each(e.dataset,function(t,a){a.name===d&&delete e.dataset[t].divorced,a.name===l&&delete e.dataset[t].divorced}),ptree.rebuild(e)})},e.removeDialogs=function(){dialog=t("#node_tabs"),dialog.length>0&&dialog.remove()}}(window.widgets=window.widgets||{},jQuery);
//# sourceMappingURL=pedigreejs.min.js.map